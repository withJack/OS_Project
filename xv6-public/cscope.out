cscope 15 $HOME/OS2018/xv6-public -q 0000002765 0000328095
	@asm.h

5 
	#SEG_NULLASM
 \

6 .
w‹d
 0, 0; \

7 .
byã
 0, 0, 0, 0

	)

11 
	#SEG_ASM
(
ty≥
,
ba£
,
lim
) \

12 .
	`w‹d
 (((
lim
Ë>> 12Ë& 0xffff), ((
ba£
) & 0xffff); \

13 .
	`byã
 (((
ba£
Ë>> 16Ë& 0xff), (0x90 | (
ty≥
)), \

14 (0xC0 | (((
lim
Ë>> 28Ë& 0xf)), (((
ba£
Ë>> 24Ë& 0xff)

	)

16 
	#STA_X
 0x8

17 
	#STA_E
 0x4

18 
	#STA_C
 0x4

19 
	#STA_W
 0x2

20 
	#STA_R
 0x2

21 
	#STA_A
 0x1

	@bio.c

21 
	~"ty≥s.h
"

22 
	~"defs.h
"

23 
	~"∑øm.h
"

24 
	~"•ölock.h
"

25 
	~"¶ì∂ock.h
"

26 
	~"fs.h
"

27 
	~"buf.h
"

30 
•ölock
 
	mlock
;

31 
buf
 
	mbuf
[
NBUF
];

35 
buf
 
	mhód
;

36 } 
	gbˇche
;

39 
	$böô
()

41 
buf
 *
b
;

43 
	`öôlock
(&
bˇche
.
lock
, "bcache");

47 
bˇche
.
hód
.
¥ev
 = &bcache.head;

48 
bˇche
.
hód
.
√xt
 = &bcache.head;

49 
b
 = 
bˇche
.
buf
; b < bˇche.buf+
NBUF
; b++){

50 
b
->
√xt
 = 
bˇche
.
hód
.next;

51 
b
->
¥ev
 = &
bˇche
.
hód
;

52 
	`öô¶ì∂ock
(&
b
->
lock
, "buffer");

53 
bˇche
.
hód
.
√xt
->
¥ev
 = 
b
;

54 
bˇche
.
hód
.
√xt
 = 
b
;

56 
	}
}

61 
buf
*

62 
	$bgë
(
uöt
 
dev
, uöà
blockno
)

64 
buf
 *
b
;

66 
	`acquúe
(&
bˇche
.
lock
);

69 
b
 = 
bˇche
.
hód
.
√xt
; b != &bcache.head; b = b->next){

70 if(
b
->
dev
 =dev && b->
blockno
 == blockno){

71 
b
->
ªf˙t
++;

72 
	`ªÀa£
(&
bˇche
.
lock
);

73 
	`acquúe¶ìp
(&
b
->
lock
);

74  
b
;

81 
b
 = 
bˇche
.
hód
.
¥ev
; b != &bcache.head; b = b->prev){

82 if(
b
->
ªf˙t
 =0 && (b->
Êags
 & 
B_DIRTY
) == 0) {

83 
b
->
dev
 = dev;

84 
b
->
blockno
 = blockno;

85 
b
->
Êags
 = 0;

86 
b
->
ªf˙t
 = 1;

87 
	`ªÀa£
(&
bˇche
.
lock
);

88 
	`acquúe¶ìp
(&
b
->
lock
);

89  
b
;

92 
	`∑nic
("bget:Ço buffers");

93 
	}
}

96 
buf
*

97 
	$bªad
(
uöt
 
dev
, uöà
blockno
)

99 
buf
 *
b
;

101 
b
 = 
	`bgë
(
dev
, 
blockno
);

102 if((
b
->
Êags
 & 
B_VALID
) == 0) {

103 
	`idîw
(
b
);

105  
b
;

106 
	}
}

110 
	$bwrôe
(
buf
 *
b
)

112 if(!
	`hﬁdög¶ìp
(&
b
->
lock
))

113 
	`∑nic
("bwrite");

114 
b
->
Êags
 |
B_DIRTY
;

115 
	`idîw
(
b
);

116 
	}
}

121 
	$bªl£
(
buf
 *
b
)

123 if(!
	`hﬁdög¶ìp
(&
b
->
lock
))

124 
	`∑nic
("brelse");

126 
	`ªÀa£¶ìp
(&
b
->
lock
);

128 
	`acquúe
(&
bˇche
.
lock
);

129 
b
->
ªf˙t
--;

130 i‡(
b
->
ªf˙t
 == 0) {

132 
b
->
√xt
->
¥ev
 = b->prev;

133 
b
->
¥ev
->
√xt
 = b->next;

134 
b
->
√xt
 = 
bˇche
.
hód
.next;

135 
b
->
¥ev
 = &
bˇche
.
hód
;

136 
bˇche
.
hód
.
√xt
->
¥ev
 = 
b
;

137 
bˇche
.
hód
.
√xt
 = 
b
;

140 
	`ªÀa£
(&
bˇche
.
lock
);

141 
	}
}

	@bootmain.c

8 
	~"ty≥s.h
"

9 
	~"ñf.h
"

10 
	~"x86.h
"

11 
	~"memœyout.h
"

13 
	#SECTSIZE
 512

	)

15 
ªad£g
(
uch¨
*, 
uöt
, uint);

18 
	$boŸmaö
()

20 
ñfhdr
 *
ñf
;

21 
¥oghdr
 *
ph
, *
ïh
;

22 (*
íåy
)();

23 
uch¨
* 
∑
;

25 
ñf
 = (
ñfhdr
*)0x10000;

28 
	`ªad£g
((
uch¨
*)
ñf
, 4096, 0);

31 if(
ñf
->
magic
 !
ELF_MAGIC
)

35 
ph
 = (
¥oghdr
*)((
uch¨
*)
ñf
 +Élf->
phoff
);

36 
ïh
 = 
ph
 + 
ñf
->
phnum
;

37 ; 
ph
 < 
ïh
;Öh++){

38 
∑
 = (
uch¨
*)
ph
->
∑ddr
;

39 
	`ªad£g
(
∑
, 
ph
->
fûesz
,Öh->
off
);

40 if(
ph
->
memsz
 >Öh->
fûesz
)

41 
	`°osb
(
∑
 + 
ph
->
fûesz
, 0,Öh->
memsz
 -Öh->filesz);

46 
íåy
 = ((*)())(
ñf
->entry);

47 
	`íåy
();

48 
	}
}

51 
	$waôdisk
()

54 (
	`öb
(0x1F7) & 0xC0) != 0x40)

56 
	}
}

60 
	$ªad£˘
(*
d°
, 
uöt
 
off£t
)

63 
	`waôdisk
();

64 
	`outb
(0x1F2, 1);

65 
	`outb
(0x1F3, 
off£t
);

66 
	`outb
(0x1F4, 
off£t
 >> 8);

67 
	`outb
(0x1F5, 
off£t
 >> 16);

68 
	`outb
(0x1F6, (
off£t
 >> 24) | 0xE0);

69 
	`outb
(0x1F7, 0x20);

72 
	`waôdisk
();

73 
	`ö¶
(0x1F0, 
d°
, 
SECTSIZE
/4);

74 
	}
}

79 
	$ªad£g
(
uch¨
* 
∑
, 
uöt
 
cou¡
, uöà
off£t
)

81 
uch¨
* 
ïa
;

83 
ïa
 = 
∑
 + 
cou¡
;

86 
∑
 -
off£t
 % 
SECTSIZE
;

89 
off£t
 = (off£à/ 
SECTSIZE
) + 1;

94 ; 
∑
 < 
ïa
;Ö®+
SECTSIZE
, 
off£t
++)

95 
	`ªad£˘
(
∑
, 
off£t
);

96 
	}
}

	@buf.h

1 
	sbuf
 {

2 
	mÊags
;

3 
uöt
 
	mdev
;

4 
uöt
 
	mblockno
;

5 
¶ì∂ock
 
	mlock
;

6 
uöt
 
	mªf˙t
;

7 
buf
 *
	m¥ev
;

8 
buf
 *
	m√xt
;

9 
buf
 *
	mq√xt
;

10 
uch¨
 
	md©a
[
BSIZE
];

12 
	#B_VALID
 0x2

13 
	#B_DIRTY
 0x4

14 

	)

	@cat.c

1 
	~"ty≥s.h
"

2 
	~"°©.h
"

3 
	~"u£r.h
"

5 
	gbuf
[512];

8 
	$ˇt
(
fd
)

10 
n
;

12 (
n
 = 
	`ªad
(
fd
, 
buf
, (buf))) > 0) {

13 i‡(
	`wrôe
(1, 
buf
, 
n
) !=Ç) {

14 
	`¥ötf
(1, "cat: writeÉrror\n");

15 
	`exô
();

18 if(
n
 < 0){

19 
	`¥ötf
(1, "cat:ÑeadÉrror\n");

20 
	`exô
();

22 
	}
}

25 
	$maö
(
¨gc
, *
¨gv
[])

27 
fd
, 
i
;

29 if(
¨gc
 <= 1){

30 
	`ˇt
(0);

31 
	`exô
();

34 
i
 = 1; i < 
¨gc
; i++){

35 if((
fd
 = 
	`›í
(
¨gv
[
i
], 0)) < 0){

36 
	`¥ötf
(1, "ˇt: c™nŸ o≥¿%s\n", 
¨gv
[
i
]);

37 
	`exô
();

39 
	`ˇt
(
fd
);

40 
	`˛o£
(
fd
);

42 
	`exô
();

43 
	}
}

	@console.c

5 
	~"ty≥s.h
"

6 
	~"defs.h
"

7 
	~"∑øm.h
"

8 
	~"å≠s.h
"

9 
	~"•ölock.h
"

10 
	~"¶ì∂ock.h
"

11 
	~"fs.h
"

12 
	~"fûe.h
"

13 
	~"memœyout.h
"

14 
	~"mmu.h
"

15 
	~"¥oc.h
"

16 
	~"x86.h
"

18 
c⁄•utc
();

20 
	g∑nicked
 = 0;

23 
•ölock
 
	mlock
;

24 
	mlockög
;

25 } 
	gc⁄s
;

28 
	$¥ötöt
(
xx
, 
ba£
, 
sign
)

30 
digôs
[] = "0123456789abcdef";

31 
buf
[16];

32 
i
;

33 
uöt
 
x
;

35 if(
sign
 && (sig¿
xx
 < 0))

36 
x
 = -
xx
;

38 
x
 = 
xx
;

40 
i
 = 0;

42 
buf
[
i
++] = 
digôs
[
x
 % 
ba£
];

43 }(
x
 /
ba£
) != 0);

45 if(
sign
)

46 
buf
[
i
++] = '-';

48 --
i
 >= 0)

49 
	`c⁄•utc
(
buf
[
i
]);

50 
	}
}

55 
	$˝rötf
(*
fmt
, ...)

57 
i
, 
c
, 
lockög
;

58 
uöt
 *
¨gp
;

59 *
s
;

61 
lockög
 = 
c⁄s
.locking;

62 if(
lockög
)

63 
	`acquúe
(&
c⁄s
.
lock
);

65 i‡(
fmt
 == 0)

66 
	`∑nic
("null fmt");

68 
¨gp
 = (
uöt
*)(*)(&
fmt
 + 1);

69 
i
 = 0; (
c
 = 
fmt
[i] & 0xff) != 0; i++){

70 if(
c
 != '%'){

71 
	`c⁄•utc
(
c
);

74 
c
 = 
fmt
[++
i
] & 0xff;

75 if(
c
 == 0)

77 
c
){

79 
	`¥ötöt
(*
¨gp
++, 10, 1);

83 
	`¥ötöt
(*
¨gp
++, 16, 0);

86 if((
s
 = (*)*
¨gp
++) == 0)

87 
s
 = "(null)";

88 ; *
s
; s++)

89 
	`c⁄•utc
(*
s
);

92 
	`c⁄•utc
('%');

96 
	`c⁄•utc
('%');

97 
	`c⁄•utc
(
c
);

102 if(
lockög
)

103 
	`ªÀa£
(&
c⁄s
.
lock
);

104 
	}
}

107 
	$∑nic
(*
s
)

109 
i
;

110 
uöt
 
pcs
[10];

112 
	`˛i
();

113 
c⁄s
.
lockög
 = 0;

115 
	`˝rötf
("œpicid %d:Ö™ic: ", 
	`œpicid
());

116 
	`˝rötf
(
s
);

117 
	`˝rötf
("\n");

118 
	`gëˇŒîpcs
(&
s
, 
pcs
);

119 
i
=0; i<10; i++)

120 
	`˝rötf
(" %p", 
pcs
[
i
]);

121 
∑nicked
 = 1;

124 
	}
}

127 
	#BACKSPACE
 0x100

	)

128 
	#CRTPORT
 0x3d4

	)

129 
ush‹t
 *
	g¸t
 = (ush‹t*)
P2V
(0xb8000);

132 
	$cg≠utc
(
c
)

134 
pos
;

137 
	`outb
(
CRTPORT
, 14);

138 
pos
 = 
	`öb
(
CRTPORT
+1) << 8;

139 
	`outb
(
CRTPORT
, 15);

140 
pos
 |
	`öb
(
CRTPORT
+1);

142 if(
c
 == '\n')

143 
pos
 += 80 -Öos%80;

144 if(
c
 =
BACKSPACE
){

145 if(
pos
 > 0) --pos;

147 
¸t
[
pos
++] = (
c
&0xff) | 0x0700;

149 if(
pos
 < 0 ||Öos > 25*80)

150 
	`∑nic
("pos under/overflow");

152 if((
pos
/80) >= 24){

153 
	`memmove
(
¸t
, crt+80, (crt[0])*23*80);

154 
pos
 -= 80;

155 
	`mem£t
(
¸t
+
pos
, 0, (crt[0])*(24*80 -Öos));

158 
	`outb
(
CRTPORT
, 14);

159 
	`outb
(
CRTPORT
+1, 
pos
>>8);

160 
	`outb
(
CRTPORT
, 15);

161 
	`outb
(
CRTPORT
+1, 
pos
);

162 
¸t
[
pos
] = ' ' | 0x0700;

163 
	}
}

166 
	$c⁄•utc
(
c
)

168 if(
∑nicked
){

169 
	`˛i
();

174 if(
c
 =
BACKSPACE
){

175 
	`u¨çutc
('\b'); uartputc(' '); uartputc('\b');

177 
	`u¨çutc
(
c
);

178 
	`cg≠utc
(
c
);

179 
	}
}

181 
	#INPUT_BUF
 128

	)

183 
	mbuf
[
INPUT_BUF
];

184 
uöt
 
	mr
;

185 
uöt
 
	mw
;

186 
uöt
 
	me
;

187 } 
	göput
;

189 
	#C
(
x
) ((x)-'@')

190 

	)

192 
	$c⁄sﬁeöå
((*
gëc
)())

194 
c
, 
d›rocdump
 = 0;

196 
	`acquúe
(&
c⁄s
.
lock
);

197 (
c
 = 
	`gëc
()) >= 0){

198 
c
){

199 
	`C
('P'):

201 
d›rocdump
 = 1;

203 
	`C
('U'):

204 
öput
.
e
 !öput.
w
 &&

205 
öput
.
buf
[(öput.
e
-1Ë% 
INPUT_BUF
] != '\n'){

206 
öput
.
e
--;

207 
	`c⁄•utc
(
BACKSPACE
);

210 
	`C
('H'): '\x7f':

211 if(
öput
.
e
 !öput.
w
){

212 
öput
.
e
--;

213 
	`c⁄•utc
(
BACKSPACE
);

217 if(
c
 !0 && 
öput
.
e
-öput.
r
 < 
INPUT_BUF
){

218 
c
 = (c == '\r') ? '\n' : c;

219 
öput
.
buf
[öput.
e
++ % 
INPUT_BUF
] = 
c
;

220 
	`c⁄•utc
(
c
);

221 if(
c
 ='\n' || c =
	`C
('D'Ë|| 
öput
.
e
 =öput.
r
+
INPUT_BUF
){

222 
öput
.
w
 = i≈ut.
e
;

223 
	`wakeup
(&
öput
.
r
);

229 
	`ªÀa£
(&
c⁄s
.
lock
);

230 if(
d›rocdump
) {

231 
	`¥ocdump
();

233 
	}
}

236 
	$c⁄sﬁîód
(
öode
 *
ù
, *
d°
, 
n
)

238 
uöt
 
èrgë
;

239 
c
;

241 
	`iu∆ock
(
ù
);

242 
èrgë
 = 
n
;

243 
	`acquúe
(&
c⁄s
.
lock
);

244 
n
 > 0){

245 
öput
.
r
 =öput.
w
){

246 if(
	`my¥oc
()->
kûÀd
){

247 
	`ªÀa£
(&
c⁄s
.
lock
);

248 
	`ûock
(
ù
);

251 
	`¶ìp
(&
öput
.
r
, &
c⁄s
.
lock
);

253 
c
 = 
öput
.
buf
[öput.
r
++ % 
INPUT_BUF
];

254 if(
c
 =
	`C
('D')){

255 if(
n
 < 
èrgë
){

258 
öput
.
r
--;

262 *
d°
++ = 
c
;

263 --
n
;

264 if(
c
 == '\n')

267 
	`ªÀa£
(&
c⁄s
.
lock
);

268 
	`ûock
(
ù
);

270  
èrgë
 - 
n
;

271 
	}
}

274 
	$c⁄sﬁewrôe
(
öode
 *
ù
, *
buf
, 
n
)

276 
i
;

278 
	`iu∆ock
(
ù
);

279 
	`acquúe
(&
c⁄s
.
lock
);

280 
i
 = 0; i < 
n
; i++)

281 
	`c⁄•utc
(
buf
[
i
] & 0xff);

282 
	`ªÀa£
(&
c⁄s
.
lock
);

283 
	`ûock
(
ù
);

285  
n
;

286 
	}
}

289 
	$c⁄sﬁeöô
()

291 
	`öôlock
(&
c⁄s
.
lock
, "console");

293 
devsw
[
CONSOLE
].
wrôe
 = 
c⁄sﬁewrôe
;

294 
devsw
[
CONSOLE
].
ªad
 = 
c⁄sﬁîód
;

295 
c⁄s
.
lockög
 = 1;

297 
	`iﬂpi˚«bÀ
(
IRQ_KBD
, 0);

298 
	}
}

	@date.h

1 
	sπcd©e
 {

2 
uöt
 
	m£c⁄d
;

3 
uöt
 
	mmöuã
;

4 
uöt
 
	mhour
;

5 
uöt
 
	mday
;

6 
uöt
 
	mm⁄th
;

7 
uöt
 
	myór
;

	@defs.h

1 
	gbuf
;

2 
	gc⁄ãxt
;

3 
	gfûe
;

4 
	göode
;

5 
	gpùe
;

6 
	g¥oc
;

7 
	gπcd©e
;

8 
	g•ölock
;

9 
	g¶ì∂ock
;

10 
	g°©
;

11 
	gsu≥rblock
;

14 
böô
();

15 
buf
* 
bªad
(
uöt
, uint);

16 
bªl£
(
buf
*);

17 
bwrôe
(
buf
*);

20 
c⁄sﬁeöô
();

21 
˝rötf
(*, ...);

22 
c⁄sﬁeöå
((*)());

23 
	$∑nic
(*Ë
	`__©åibuã__
((
n‹ëu∫
));

26 
	`exec
(*, **);

29 
fûe
* 
	`fûóŒoc
();

30 
	`fûe˛o£
(
fûe
*);

31 
fûe
* 
	`fûedup
(file*);

32 
	`fûeöô
();

33 
	`fûîód
(
fûe
*, *, 
n
);

34 
	`fûe°©
(
fûe
*, 
°©
*);

35 
	`fûewrôe
(
fûe
*, *, 
n
);

36 
	`pfûewrôe
(
fûe
*, *, 
n
, 
off
);

37 
	`pfûîód
(
fûe
*, *, 
n
, 
off
);

40 
	`ªadsb
(
dev
, 
su≥rblock
 *
sb
);

41 
	`dúlök
(
öode
*, *, 
uöt
);

42 
öode
* 
	`dúlookup
(öode*, *, 
uöt
*);

43 
öode
* 
	`üŒoc
(
uöt
, );

44 
öode
* 
	`idup
(inode*);

45 
	`iöô
(
dev
);

46 
	`ûock
(
öode
*);

47 
	`ùut
(
öode
*);

48 
	`iu∆ock
(
öode
*);

49 
	`iu∆ockput
(
öode
*);

50 
	`iupd©e
(
öode
*);

51 
	`«mecmp
(const *, const *);

52 
öode
* 
	`«mei
(*);

53 
öode
* 
	`«meù¨ít
(*, *);

54 
	`ªadi
(
öode
*, *, 
uöt
, uint);

55 
	`°©i
(
öode
*, 
°©
*);

56 
	`wrôei
(
öode
*, *, 
uöt
, uint);

59 
	`ideöô
();

60 
	`ideöå
();

61 
	`idîw
(
buf
*);

64 
	`iﬂpi˚«bÀ
(
úq
, 
˝u
);

65 
uch¨
 
iﬂpicid
;

66 
	`iﬂpicöô
();

69 * 
	`kÆloc
();

70 
	`k‰ì
(*);

71 
	`köô1
(*, *);

72 
	`köô2
(*, *);

75 
	`kbdöå
();

78 
	`cmo°ime
(
πcd©e
 *
r
);

79 
	`œpicid
();

80 vﬁ©ûê
uöt
* 
œpic
;

81 
	`œpi˚oi
();

82 
	`œpicöô
();

83 
	`œpic°¨èp
(
uch¨
, 
uöt
);

84 
	`mi¸odñay
();

87 
	`öôlog
(
dev
);

88 
	`log_wrôe
(
buf
*);

89 
	`begö_›
();

90 
	`íd_›
();

93 
ismp
;

94 
	`mpöô
();

97 
	`pi˚«bÀ
();

98 
	`picöô
();

101 
	`pùóŒoc
(
fûe
**, file**);

102 
	`pùe˛o£
(
pùe
*, );

103 
	`pùîód
(
pùe
*, *, );

104 
	`pùewrôe
(
pùe
*, *, );

108 
	`˝uid
();

109 
	`exô
();

110 
	`f‹k
();

111 
	`grow¥oc
();

112 
	`kûl
();

113 
˝u
* 
	`my˝u
();

114 
¥oc
* 
	`my¥oc
();

115 
	`pöô
();

116 
	`¥ocdump
();

117 
	`sched
();

118 
	`£çroc
(
¥oc
*);

119 
	`¶ìp
(*, 
•ölock
*);

120 
	`u£röô
();

121 
	`waô
();

122 
	`wakeup
(*);

123 
	`yõld
();

124 
	`söô
();

125 
	$scheduÀr
(Ë
	`__©åibuã__
((
n‹ëu∫
));

126 
	`MLFQ_Boo°
();

127 
	`˝u_sh¨e
();

128 
MLFQPassVÆ
;

129 
MLFQSåideVÆ
;

130 
	`thªad_¸óã
(
thªad_t
 *
thªad
, * (*
°¨t_routöe
)(*), *
¨g
);

131 
	`thªad_exô
(*
ªtvÆ
);

132 
	`thªad_joö
(
thªad_t
 
thªad
, **
ªtvÆ
);

133 
	`kûlßmïid
(
pid
);

134 
√xçid
;

135 
¥oc
* 
	`födMöPass
();

138 
	`swtch
(
c⁄ãxt
**, context*);

141 
	`acquúe
(
•ölock
*);

142 
	`gëˇŒîpcs
(*, 
uöt
*);

143 
	`hﬁdög
(
•ölock
*);

144 
	`öôlock
(
•ölock
*, *);

145 
	`ªÀa£
(
•ölock
*);

146 
	`push˛i
();

147 
	`p›˛i
();

150 
	`acquúe¶ìp
(
¶ì∂ock
*);

151 
	`ªÀa£¶ìp
(
¶ì∂ock
*);

152 
	`hﬁdög¶ìp
(
¶ì∂ock
*);

153 
	`öô¶ì∂ock
(
¶ì∂ock
*, *);

156 
	`memcmp
(c⁄° *, c⁄° *, 
uöt
);

157 * 
	`memmove
(*, c⁄° *, 
uöt
);

158 * 
	`mem£t
(*, , 
uöt
);

159 * 
	`ß„°r˝y
(*, const *, );

160 
	`°æí
(const *);

161 
	`°∫cmp
(c⁄° *, c⁄° *, 
uöt
);

162 * 
	`°∫˝y
(*, const *, );

165 
	`¨göt
(, *);

166 
	`¨g±r
(, **, );

167 
	`¨g°r
(, **);

168 
	`„tchöt
(
uöt
, *);

169 
	`„tch°r
(
uöt
, **);

170 
	`sysˇŒ
();

173 
	`timîöô
();

176 
	`idtöô
();

177 
uöt
 
ticks
;

178 
	`tvöô
();

179 
•ölock
 
tick¶ock
;

180 
uöt
 
MLFQ_ticks
;

181 
	`MLFQ_Check
();

184 
	`u¨töô
();

185 
	`u¨töå
();

186 
	`u¨çutc
();

189 
	`£göô
();

190 
	`kvmÆloc
();

191 
pde_t
* 
	`£tupkvm
();

192 * 
	`uva2ka
(
pde_t
*, *);

193 
	`Ælocuvm
(
pde_t
*, 
uöt
, uint);

194 
	`dóŒocuvm
(
pde_t
*, 
uöt
, uint);

195 
	`‰ìvm
(
pde_t
*);

196 
	`öôuvm
(
pde_t
*, *, 
uöt
);

197 
	`lﬂduvm
(
pde_t
*, *, 
öode
*, 
uöt
, uint);

198 
pde_t
* 
	`c›yuvm
’de_t*, 
uöt
);

199 
	`swôchuvm
(
¥oc
*);

200 
	`swôchkvm
();

201 
	`c›yout
(
pde_t
*, 
uöt
, *, uint);

202 
	`˛óΩãu
(
pde_t
 *
pgdú
, *
uva
);

205 
	`£t_˝u_sh¨e
();

206 
À·Sh¨e
;

209 
	#NELEM
(
x
Ë((x)/((x)[0]))

	)

	@echo.c

1 
	~"ty≥s.h
"

2 
	~"°©.h
"

3 
	~"u£r.h
"

6 
	$maö
(
¨gc
, *
¨gv
[])

8 
i
;

10 
i
 = 1; i < 
¨gc
; i++)

11 
	`¥ötf
(1, "%s%s", 
¨gv
[
i
], i+1 < 
¨gc
 ? " " : "\n");

12 
	`exô
();

13 
	}
}

	@elf.h

3 
	#ELF_MAGIC
 0x464C457FU

4 

	)

6 
	sñfhdr
 {

7 
uöt
 
	mmagic
;

8 
uch¨
 
	mñf
[12];

9 
ush‹t
 
	mty≥
;

10 
ush‹t
 
	mmachöe
;

11 
uöt
 
	mvîsi⁄
;

12 
uöt
 
	míåy
;

13 
uöt
 
	mphoff
;

14 
uöt
 
	mshoff
;

15 
uöt
 
	mÊags
;

16 
ush‹t
 
	mehsize
;

17 
ush‹t
 
	mphítsize
;

18 
ush‹t
 
	mphnum
;

19 
ush‹t
 
	mshítsize
;

20 
ush‹t
 
	mshnum
;

21 
ush‹t
 
	msh°∫dx
;

25 
	s¥oghdr
 {

26 
uöt
 
	mty≥
;

27 
uöt
 
	moff
;

28 
uöt
 
	mvaddr
;

29 
uöt
 
	m∑ddr
;

30 
uöt
 
	mfûesz
;

31 
uöt
 
	mmemsz
;

32 
uöt
 
	mÊags
;

33 
uöt
 
	mÆign
;

37 
	#ELF_PROG_LOAD
 1

	)

40 
	#ELF_PROG_FLAG_EXEC
 1

	)

41 
	#ELF_PROG_FLAG_WRITE
 2

	)

42 
	#ELF_PROG_FLAG_READ
 4

	)

	@exec.c

1 
	~"ty≥s.h
"

2 
	~"∑øm.h
"

3 
	~"memœyout.h
"

4 
	~"mmu.h
"

5 
	~"¥oc.h
"

6 
	~"defs.h
"

7 
	~"x86.h
"

8 
	~"ñf.h
"

9 
	~"•ölock.h
"

12 
•ölock
 
lock
;

13 
¥oc
Öroc[
NPROC
];

14 } 
±abÀ
;

17 
	$exec
(*
∑th
, **
¨gv
)

19 *
s
, *
œ°
;

20 
i
, 
off
;

21 
uöt
 
¨gc
, 
sz
, 
•
, 
u°ack
[3+
MAXARG
+1];

22 
ñfhdr
 
ñf
;

23 
öode
 *
ù
;

24 
¥oghdr
 
ph
;

25 
pde_t
 *
pgdú
, *
ﬁdpgdú
;

26 
¥oc
 *
cuΩroc
 = 
	`my¥oc
();

27 
¥oc
 *
p
;

29 
	`begö_›
();

31 if((
ù
 = 
	`«mei
(
∑th
)) == 0){

32 
	`íd_›
();

33 
	`˝rötf
("exec: fail\n");

36 
	`ûock
(
ù
);

37 
pgdú
 = 0;

40 if(
	`ªadi
(
ù
, (*)&
ñf
, 0, (elf)) != (elf))

41 
bad
;

42 if(
ñf
.
magic
 !
ELF_MAGIC
)

43 
bad
;

45 if((
pgdú
 = 
	`£tupkvm
()) == 0)

46 
bad
;

49 
sz
 = 0;

50 
i
=0, 
off
=
ñf
.
phoff
; i<ñf.
phnum
; i++, off+=(
ph
)){

51 if(
	`ªadi
(
ù
, (*)&
ph
, 
off
, (ph)) != (ph))

52 
bad
;

53 if(
ph
.
ty≥
 !
ELF_PROG_LOAD
)

55 if(
ph
.
memsz
 <Öh.
fûesz
)

56 
bad
;

57 if(
ph
.
vaddr
 +Öh.
memsz
 <Öh.vaddr)

58 
bad
;

59 if((
sz
 = 
	`Ælocuvm
(
pgdú
, sz, 
ph
.
vaddr
 +Öh.
memsz
)) == 0)

60 
bad
;

61 if(
ph
.
vaddr
 % 
PGSIZE
 != 0)

62 
bad
;

63 if(
	`lﬂduvm
(
pgdú
, (*)
ph
.
vaddr
, 
ù
,Öh.
off
,Öh.
fûesz
) < 0)

64 
bad
;

66 
	`iu∆ockput
(
ù
);

67 
	`íd_›
();

68 
ù
 = 0;

72 
sz
 = 
	`PGROUNDUP
(sz);

73 if((
sz
 = 
	`Ælocuvm
(
pgdú
, sz, sz + 2*
PGSIZE
)) == 0)

74 
bad
;

75 
	`˛óΩãu
(
pgdú
, (*)(
sz
 - 2*
PGSIZE
));

76 
•
 = 
sz
;

79 
¨gc
 = 0; 
¨gv
[argc];árgc++) {

80 if(
¨gc
 >
MAXARG
)

81 
bad
;

82 
•
 = (• - (
	`°æí
(
¨gv
[
¨gc
]) + 1)) & ~3;

83 if(
	`c›yout
(
pgdú
, 
•
, 
¨gv
[
¨gc
], 
	`°æí
(argv[argc]) + 1) < 0)

84 
bad
;

85 
u°ack
[3+
¨gc
] = 
•
;

87 
u°ack
[3+
¨gc
] = 0;

89 
u°ack
[0] = 0xffffffff;

90 
u°ack
[1] = 
¨gc
;

91 
u°ack
[2] = 
•
 - (
¨gc
+1)*4;

93 
•
 -(3+
¨gc
+1) * 4;

94 if(
	`c›yout
(
pgdú
, 
•
, 
u°ack
, (3+
¨gc
+1)*4) < 0)

95 
bad
;

98 
œ°
=
s
=
∑th
; *s; s++)

99 if(*
s
 == '/')

100 
œ°
 = 
s
+1;

101 
	`ß„°r˝y
(
cuΩroc
->
«me
, 
œ°
, (curproc->name));

104 
ﬁdpgdú
 = 
cuΩroc
->
pgdú
;

105 
cuΩroc
->
pgdú
 =Ögdir;

106 
cuΩroc
->
usz
 = 
sz
;

109 
i
=0; i<
NPROC
; i++)

112 if((
sz
 = 
	`Ælocuvm
(
cuΩroc
->
pgdú
, sz, sz + 2*
PGSIZE
)) == 0)

114 
	`˝rötf
("allocuvm\n");

118 
cuΩroc
->
sz
 = sz;

119 
cuΩroc
->
tf
->
eù
 = 
ñf
.
íåy
;

120 
cuΩroc
->
tf
->
e•
 = 
•
;

123 if(
cuΩroc
->
isThªad
)

125 
cuΩroc
->
∑ª¡
->
isMaöThªad
 = 0;

126 
cuΩroc
->
isMaöThªad
 = 1;

127 
cuΩroc
->
∑ª¡
->
isThîeExec
 = 1;

128 
cuΩroc
->
∑ª¡
 = curproc->parent->parent;

130 
cuΩroc
->
isThªad
 = 0;

137 
cuΩroc
->
tid
 = 0;

141 
	`acquúe
(&
±abÀ
.
lock
);

142 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Ö++)

144 if(
p
->
pid
 =
cuΩroc
->pid &&Ö != curproc)

146 if(
p
->
isMaöThªad
 != 1)

147 
p
->
∑ª¡
 =Ö->parent->parent;

148 
p
->
°©e
 = 
ZOMBIE
;

151 
	`ªÀa£
(&
±abÀ
.
lock
);

153 
	`swôchuvm
(
cuΩroc
);

154 
	`‰ìvm
(
ﬁdpgdú
);

157 
bad
:

158 if(
pgdú
)

159 
	`‰ìvm
(
pgdú
);

160 if(
ù
){

161 
	`iu∆ockput
(
ù
);

162 
	`íd_›
();

165 
	}
}

	@fcntl.h

1 
	#O_RDONLY
 0x000

	)

2 
	#O_WRONLY
 0x001

	)

3 
	#O_RDWR
 0x002

	)

4 
	#O_CREATE
 0x200

	)

	@file.c

5 
	~"ty≥s.h
"

6 
	~"defs.h
"

7 
	~"∑øm.h
"

8 
	~"fs.h
"

9 
	~"•ölock.h
"

10 
	~"¶ì∂ock.h
"

11 
	~"fûe.h
"

13 
devsw
 
	gdevsw
[
NDEV
];

15 
•ölock
 
	mlock
;

16 
fûe
 
	mfûe
[
NFILE
];

17 } 
	g·abÀ
;

20 
	$fûeöô
()

22 
	`öôlock
(&
·abÀ
.
lock
, "ftable");

23 
	}
}

26 
fûe
*

27 
	$fûóŒoc
()

29 
fûe
 *
f
;

31 
	`acquúe
(&
·abÀ
.
lock
);

32 
f
 = 
·abÀ
.
fûe
; f < fèbÀ.fûê+ 
NFILE
; f++){

33 if(
f
->
ªf
 == 0){

34 
f
->
ªf
 = 1;

35 
	`ªÀa£
(&
·abÀ
.
lock
);

36  
f
;

39 
	`ªÀa£
(&
·abÀ
.
lock
);

41 
	}
}

44 
fûe
*

45 
	$fûedup
(
fûe
 *
f
)

47 
	`acquúe
(&
·abÀ
.
lock
);

48 if(
f
->
ªf
 < 1)

49 
	`∑nic
("filedup");

50 
f
->
ªf
++;

51 
	`ªÀa£
(&
·abÀ
.
lock
);

52  
f
;

53 
	}
}

57 
	$fûe˛o£
(
fûe
 *
f
)

59 
fûe
 
ff
;

61 
	`acquúe
(&
·abÀ
.
lock
);

62 if(
f
->
ªf
 < 1)

63 
	`∑nic
("fileclose");

64 if(--
f
->
ªf
 > 0){

65 
	`ªÀa£
(&
·abÀ
.
lock
);

68 
ff
 = *
f
;

69 
f
->
ªf
 = 0;

70 
f
->
ty≥
 = 
FD_NONE
;

71 
	`ªÀa£
(&
·abÀ
.
lock
);

73 if(
ff
.
ty≥
 =
FD_PIPE
)

74 
	`pùe˛o£
(
ff
.
pùe
, ff.
wrôabÀ
);

75 if(
ff
.
ty≥
 =
FD_INODE
){

76 
	`begö_›
();

77 
	`ùut
(
ff
.
ù
);

78 
	`íd_›
();

80 
	}
}

84 
	$fûe°©
(
fûe
 *
f
, 
°©
 *
°
)

86 if(
f
->
ty≥
 =
FD_INODE
){

87 
	`ûock
(
f
->
ù
);

88 
	`°©i
(
f
->
ù
, 
°
);

89 
	`iu∆ock
(
f
->
ù
);

93 
	}
}

97 
	$fûîód
(
fûe
 *
f
, *
addr
, 
n
)

99 
r
;

101 if(
f
->
ªadabÀ
 == 0)

103 if(
f
->
ty≥
 =
FD_PIPE
)

104  
	`pùîód
(
f
->
pùe
, 
addr
, 
n
);

105 if(
f
->
ty≥
 =
FD_INODE
){

106 
	`ûock
(
f
->
ù
);

107 if((
r
 = 
	`ªadi
(
f
->
ù
, 
addr
, f->
off
, 
n
)) > 0)

108 
f
->
off
 +
r
;

109 
	`iu∆ock
(
f
->
ù
);

110  
r
;

112 
	`∑nic
("fileread");

113 
	}
}

118 
	$fûewrôe
(
fûe
 *
f
, *
addr
, 
n
)

120 
r
;

122 if(
f
->
wrôabÀ
 == 0)

124 if(
f
->
ty≥
 =
FD_PIPE
)

125  
	`pùewrôe
(
f
->
pùe
, 
addr
, 
n
);

126 if(
f
->
ty≥
 =
FD_INODE
){

133 
max
 = ((
MAXOPBLOCKS
-1-1-2) / 2) * 512;

134 
i
 = 0;

135 
i
 < 
n
){

136 
n1
 = 
n
 - 
i
;

137 if(
n1
 > 
max
)

138 
n1
 = 
max
;

140 
	`begö_›
();

141 
	`ûock
(
f
->
ù
);

142 i‡((
r
 = 
	`wrôei
(
f
->
ù
, 
addr
 + 
i
, f->
off
, 
n1
)) > 0)

143 
f
->
off
 +
r
;

144 
	`iu∆ock
(
f
->
ù
);

145 
	`íd_›
();

147 if(
r
 < 0)

149 if(
r
 !
n1
)

150 
	`∑nic
("short filewrite");

151 
i
 +
r
;

153  
i
 =
n
 ?Ç : -1;

155 
	`∑nic
("filewrite");

156 
	}
}

159 
	$pfûewrôe
(
fûe
 *
f
, *
addr
, 
n
, 
off
)

161 
r
;

163 if(
f
->
wrôabÀ
 == 0)

165 if(
f
->
ty≥
 =
FD_PIPE
)

166  
	`pùewrôe
(
f
->
pùe
, 
addr
, 
n
);

167 if(
f
->
ty≥
 =
FD_INODE
){

174 
max
 = ((
MAXOPBLOCKS
-1-1-2) / 2) * 512;

175 
i
 = 0;

176 
i
 < 
n
){

177 
n1
 = 
n
 - 
i
;

178 if(
n1
 > 
max
)

179 
n1
 = 
max
;

181 
	`begö_›
();

182 
	`ûock
(
f
->
ù
);

185 i‡((
r
 = 
	`wrôei
(
f
->
ù
, 
addr
 + 
i
, 
off
, 
n1
)) > 0);

187 
	`iu∆ock
(
f
->
ù
);

188 
	`íd_›
();

190 if(
r
 < 0)

192 if(
r
 !
n1
)

193 
	`∑nic
("short filewrite");

194 
i
 +
r
;

196  
i
 =
n
 ?Ç : -1;

198 
	`∑nic
("filewrite");

199 
	}
}

202 
	$pfûîód
(
fûe
 *
f
, *
addr
, 
n
, 
off
)

204 
r
;

206 if(
f
->
ªadabÀ
 == 0)

208 if(
f
->
ty≥
 =
FD_PIPE
)

209  
	`pùîód
(
f
->
pùe
, 
addr
, 
n
);

210 if(
f
->
ty≥
 =
FD_INODE
){

211 
	`ûock
(
f
->
ù
);

212 
f
->
off
 = (
uöt
)off;

213 if((
r
 = 
	`ªadi
(
f
->
ù
, 
addr
, f->
off
, 
n
)) > 0)

214 
f
->
off
 +
r
;

215 
	`iu∆ock
(
f
->
ù
);

216  
r
;

218 
	`∑nic
("fileread");

219 
	}
}

	@file.h

1 
	sfûe
 {

2 íum { 
	mFD_NONE
, 
	mFD_PIPE
, 
	mFD_INODE
 } 
	mty≥
;

3 
	mªf
;

4 
	mªadabÀ
;

5 
	mwrôabÀ
;

6 
pùe
 *
	mpùe
;

7 
öode
 *
	mù
;

8 
uöt
 
	moff
;

13 
	söode
 {

14 
uöt
 
	mdev
;

15 
uöt
 
	möum
;

16 
	mªf
;

17 
¶ì∂ock
 
	mlock
;

18 
	mvÆid
;

20 
	mty≥
;

21 
	mmaj‹
;

22 
	mmö‹
;

23 
	m∆ök
;

24 
uöt
 
	msize
;

25 
uöt
 
	maddrs
[
NDIRECT
+3];

30 
	sdevsw
 {

31 (*
	mªad
)(
	möode
*, *, );

32 (*
	mwrôe
)(
	möode
*, *, );

35 
devsw
 devsw[];

37 
	#CONSOLE
 1

	)

	@forktest.c

4 
	~"ty≥s.h
"

5 
	~"°©.h
"

6 
	~"u£r.h
"

8 
	#N
 1000

	)

11 
	$¥ötf
(
fd
, *
s
, ...)

13 
	`wrôe
(
fd
, 
s
, 
	`°æí
(s));

14 
	}
}

17 
	$f‹kã°
()

19 
n
, 
pid
;

21 
	`¥ötf
(1, "forkÅest\n");

23 
n
=0;Ç<
N
;Ç++){

24 
pid
 = 
	`f‹k
();

25 if(
pid
 < 0)

27 if(
pid
 == 0)

28 
	`exô
();

31 if(
n
 =
N
){

32 
	`¥ötf
(1, "f‹k cœimedÅÿw‹k NÅimes!\n", 
N
);

33 
	`exô
();

36 ; 
n
 > 0;Ç--){

37 if(
	`waô
() < 0){

38 
	`¥ötf
(1, "wait stoppedÉarly\n");

39 
	`exô
();

43 if(
	`waô
() != -1){

44 
	`¥ötf
(1, "wait gotÅoo many\n");

45 
	`exô
();

48 
	`¥ötf
(1, "forkÅest OK\n");

49 
	}
}

52 
	$maö
()

54 
	`f‹kã°
();

55 
	`exô
();

56 
	}
}

	@fs.c

12 
	~"ty≥s.h
"

13 
	~"defs.h
"

14 
	~"∑øm.h
"

15 
	~"°©.h
"

16 
	~"mmu.h
"

17 
	~"¥oc.h
"

18 
	~"•ölock.h
"

19 
	~"¶ì∂ock.h
"

20 
	~"fs.h
"

21 
	~"buf.h
"

22 
	~"fûe.h
"

24 
	#mö
(
a
, 
b
Ë(◊Ë< (bË? (aË: (b))

	)

25 
ôrunc
(
öode
*);

28 
su≥rblock
 
	gsb
;

32 
	$ªadsb
(
dev
, 
su≥rblock
 *
sb
)

34 
buf
 *
bp
;

36 
bp
 = 
	`bªad
(
dev
, 1);

37 
	`memmove
(
sb
, 
bp
->
d©a
, (*sb));

38 
	`bªl£
(
bp
);

39 
	}
}

43 
	$bzîo
(
dev
, 
bno
)

45 
buf
 *
bp
;

47 
bp
 = 
	`bªad
(
dev
, 
bno
);

48 
	`mem£t
(
bp
->
d©a
, 0, 
BSIZE
);

49 
	`log_wrôe
(
bp
);

50 
	`bªl£
(
bp
);

51 
	}
}

56 
uöt


57 
	$bÆloc
(
uöt
 
dev
)

59 
b
, 
bi
, 
m
;

60 
buf
 *
bp
;

62 
bp
 = 0;

63 
b
 = 0; b < 
sb
.
size
; b +
BPB
){

64 
bp
 = 
	`bªad
(
dev
, 
	`BBLOCK
(
b
, 
sb
));

65 
bi
 = 0; bò< 
BPB
 && 
b
 + bò< 
sb
.
size
; bi++){

66 
m
 = 1 << (
bi
 % 8);

67 if((
bp
->
d©a
[
bi
/8] & 
m
) == 0){

68 
bp
->
d©a
[
bi
/8] |
m
;

69 
	`log_wrôe
(
bp
);

70 
	`bªl£
(
bp
);

71 
	`bzîo
(
dev
, 
b
 + 
bi
);

72  
b
 + 
bi
;

75 
	`bªl£
(
bp
);

77 
	`∑nic
("balloc: out of blocks");

78 
	}
}

82 
	$b‰ì
(
dev
, 
uöt
 
b
)

84 
buf
 *
bp
;

85 
bi
, 
m
;

87 
	`ªadsb
(
dev
, &
sb
);

88 
bp
 = 
	`bªad
(
dev
, 
	`BBLOCK
(
b
, 
sb
));

89 
bi
 = 
b
 % 
BPB
;

90 
m
 = 1 << (
bi
 % 8);

91 if((
bp
->
d©a
[
bi
/8] & 
m
) == 0)

92 
	`∑nic
("freeing free block");

93 
bp
->
d©a
[
bi
/8] &~
m
;

94 
	`log_wrôe
(
bp
);

95 
	`bªl£
(
bp
);

96 
	}
}

168 
•ölock
 
	mlock
;

169 
öode
 
	möode
[
NINODE
];

170 } 
	giˇche
;

173 
	$iöô
(
dev
)

175 
i
 = 0;

177 
	`öôlock
(&
iˇche
.
lock
, "icache");

178 
i
 = 0; i < 
NINODE
; i++) {

179 
	`öô¶ì∂ock
(&
iˇche
.
öode
[
i
].
lock
, "inode");

182 
	`ªadsb
(
dev
, &
sb
);

183 
	`˝rötf
("sb: sizê%dÇblock†%dÇöode†%dÇlog %dÜog°¨à%d\
 %d bm≠ sèπ %d\n", 
sb
.
size
, sb.
nblocks
,

185 
sb
.
nöodes
, sb.
∆og
, sb.
log°¨t
, sb.
öode°¨t
,

186 
sb
.
bm≠°¨t
);

187 
	}
}

189 
öode
* 
igë
(
uöt
 
dev
, uöà
öum
);

195 
öode
*

196 
	$üŒoc
(
uöt
 
dev
, 
ty≥
)

198 
öum
;

199 
buf
 *
bp
;

200 
döode
 *
dù
;

202 
öum
 = 1; inum < 
sb
.
nöodes
; inum++){

203 
bp
 = 
	`bªad
(
dev
, 
	`IBLOCK
(
öum
, 
sb
));

204 
dù
 = (
döode
*)
bp
->
d©a
 + 
öum
%
IPB
;

205 if(
dù
->
ty≥
 == 0){

206 
	`mem£t
(
dù
, 0, (*dip));

207 
dù
->
ty≥
 =Åype;

208 
	`log_wrôe
(
bp
);

209 
	`bªl£
(
bp
);

210  
	`igë
(
dev
, 
öum
);

212 
	`bªl£
(
bp
);

214 
	`∑nic
("ialloc:Ço inodes");

215 
	}
}

222 
	$iupd©e
(
öode
 *
ù
)

224 
buf
 *
bp
;

225 
döode
 *
dù
;

227 
bp
 = 
	`bªad
(
ù
->
dev
, 
	`IBLOCK
(ù->
öum
, 
sb
));

228 
dù
 = (
döode
*)
bp
->
d©a
 + 
ù
->
öum
%
IPB
;

229 
dù
->
ty≥
 = 
ù
->type;

230 
dù
->
maj‹
 = 
ù
->major;

231 
dù
->
mö‹
 = 
ù
->minor;

232 
dù
->
∆ök
 = 
ù
->nlink;

233 
dù
->
size
 = 
ù
->size;

234 
	`memmove
(
dù
->
addrs
, 
ù
->addrs, (ip->addrs));

235 
	`log_wrôe
(
bp
);

236 
	`bªl£
(
bp
);

237 
	}
}

242 
öode
*

243 
	$igë
(
uöt
 
dev
, uöà
öum
)

245 
öode
 *
ù
, *
em±y
;

247 
	`acquúe
(&
iˇche
.
lock
);

250 
em±y
 = 0;

251 
ù
 = &
iˇche
.
öode
[0]; i∞< &iˇche.öode[
NINODE
]; ip++){

252 if(
ù
->
ªf
 > 0 && ip->
dev
 =dev && ip->
öum
 == inum){

253 
ù
->
ªf
++;

254 
	`ªÀa£
(&
iˇche
.
lock
);

255  
ù
;

257 if(
em±y
 =0 && 
ù
->
ªf
 == 0)

258 
em±y
 = 
ù
;

262 if(
em±y
 == 0)

263 
	`∑nic
("iget:Ço inodes");

265 
ù
 = 
em±y
;

266 
ù
->
dev
 = dev;

267 
ù
->
öum
 = inum;

268 
ù
->
ªf
 = 1;

269 
ù
->
vÆid
 = 0;

270 
	`ªÀa£
(&
iˇche
.
lock
);

272  
ù
;

273 
	}
}

277 
öode
*

278 
	$idup
(
öode
 *
ù
)

280 
	`acquúe
(&
iˇche
.
lock
);

281 
ù
->
ªf
++;

282 
	`ªÀa£
(&
iˇche
.
lock
);

283  
ù
;

284 
	}
}

289 
	$ûock
(
öode
 *
ù
)

291 
buf
 *
bp
;

292 
döode
 *
dù
;

294 if(
ù
 =0 || ip->
ªf
 < 1)

295 
	`∑nic
("ilock");

297 
	`acquúe¶ìp
(&
ù
->
lock
);

299 if(
ù
->
vÆid
 == 0){

300 
bp
 = 
	`bªad
(
ù
->
dev
, 
	`IBLOCK
(ù->
öum
, 
sb
));

301 
dù
 = (
döode
*)
bp
->
d©a
 + 
ù
->
öum
%
IPB
;

302 
ù
->
ty≥
 = 
dù
->type;

303 
ù
->
maj‹
 = 
dù
->major;

304 
ù
->
mö‹
 = 
dù
->minor;

305 
ù
->
∆ök
 = 
dù
->nlink;

306 
ù
->
size
 = 
dù
->size;

307 
	`memmove
(
ù
->
addrs
, 
dù
->addrs, (ip->addrs));

308 
	`bªl£
(
bp
);

309 
ù
->
vÆid
 = 1;

310 if(
ù
->
ty≥
 == 0)

311 
	`∑nic
("ilock:ÇoÅype");

313 
	}
}

317 
	$iu∆ock
(
öode
 *
ù
)

319 if(
ù
 =0 || !
	`hﬁdög¶ìp
(&ù->
lock
Ë|| ip->
ªf
 < 1)

320 
	`∑nic
("iunlock");

322 
	`ªÀa£¶ìp
(&
ù
->
lock
);

323 
	}
}

333 
	$ùut
(
öode
 *
ù
)

335 
	`acquúe¶ìp
(&
ù
->
lock
);

336 if(
ù
->
vÆid
 && ip->
∆ök
 == 0){

337 
	`acquúe
(&
iˇche
.
lock
);

338 
r
 = 
ù
->
ªf
;

339 
	`ªÀa£
(&
iˇche
.
lock
);

340 if(
r
 == 1){

342 
	`ôrunc
(
ù
);

343 
ù
->
ty≥
 = 0;

344 
	`iupd©e
(
ù
);

345 
ù
->
vÆid
 = 0;

348 
	`ªÀa£¶ìp
(&
ù
->
lock
);

350 
	`acquúe
(&
iˇche
.
lock
);

351 
ù
->
ªf
--;

352 
	`ªÀa£
(&
iˇche
.
lock
);

353 
	}
}

357 
	$iu∆ockput
(
öode
 *
ù
)

359 
	`iu∆ock
(
ù
);

360 
	`ùut
(
ù
);

361 
	}
}

373 
uöt


374 
	$bm≠
(
öode
 *
ù
, 
uöt
 
bn
)

376 
uöt
 
addr
, *
a
;

377 
buf
 *
bp
;

378 
uöt
 
tmp
;

381 if(
bn
 < 
NDIRECT
){

383 if((
addr
 = 
ù
->
addrs
[
bn
]) == 0)

384 
ù
->
addrs
[
bn
] = 
addr
 = 
	`bÆloc
(ù->
dev
);

385  
addr
;

387 
bn
 -
NDIRECT
;

390 if(
bn
 < 
NINDIRECT
){

392 if((
addr
 = 
ù
->
addrs
[
NDIRECT
]) == 0)

393 
ù
->
addrs
[
NDIRECT
] = 
addr
 = 
	`bÆloc
(ù->
dev
);

396 
bp
 = 
	`bªad
(
ù
->
dev
, 
addr
);

397 
a
 = (
uöt
*)
bp
->
d©a
;

398 if((
addr
 = 
a
[
bn
]) == 0){

399 
a
[
bn
] = 
addr
 = 
	`bÆloc
(
ù
->
dev
);

400 
	`log_wrôe
(
bp
);

402 
	`bªl£
(
bp
);

404  
addr
;

406 
bn
 -
NINDIRECT
;

410 if(
bn
 < 
NDOUBINDIRECT
)

413 if((
addr
 = 
ù
->
addrs
[
NDIRECT
+1]) == 0)

414 
ù
->
addrs
[
NDIRECT
+1] = 
addr
 = 
	`bÆloc
(ù->
dev
);

417 
bp
 = 
	`bªad
(
ù
->
dev
, 
addr
);

418 
a
 = (
uöt
*)
bp
->
d©a
;

419 if((
addr
 = 
a
[
bn
/
NINDIRECT
]) == 0)

421 
a
[
bn
/
NINDIRECT
] = 
addr
 = 
	`bÆloc
(
ù
->
dev
);

422 
	`log_wrôe
(
bp
);

424 
	`bªl£
(
bp
);

427 
bp
 = 
	`bªad
(
ù
->
dev
, 
addr
);

428 
a
 = (
uöt
*)
bp
->
d©a
;

429 if((
addr
 = 
a
[
bn
%
NINDIRECT
]) == 0)

431 
a
[
bn
%
NINDIRECT
] = 
addr
 = 
	`bÆloc
(
ù
->
dev
);

432 
	`log_wrôe
(
bp
);

434 
	`bªl£
(
bp
);

436  
addr
;

438 
bn
 -
NDOUBINDIRECT
;

442 if(
bn
 < 
NTRIPINDIRECT
)

445 if((
addr
 = 
ù
->
addrs
[
NDIRECT
+2]) == 0)

446 
ù
->
addrs
[
NDIRECT
+2] = 
addr
 = 
	`bÆloc
(ù->
dev
);

449 
bp
 = 
	`bªad
(
ù
->
dev
, 
addr
);

450 
a
 = (
uöt
*)
bp
->
d©a
;

451 if((
addr
 = 
a
[
bn
/
NDOUBINDIRECT
]) == 0)

453 
a
[
bn
/
NDOUBINDIRECT
] = 
addr
 = 
	`bÆloc
(
ù
->
dev
);

454 
	`log_wrôe
(
bp
);

456 
	`bªl£
(
bp
);

458 
tmp
 = 
bn
%
NDOUBINDIRECT
;

460 
bp
 = 
	`bªad
(
ù
->
dev
, 
addr
);

461 
a
 = (
uöt
*)
bp
->
d©a
;

462 if((
addr
 = 
a
[
tmp
/
NINDIRECT
]) == 0)

464 
a
[
tmp
/
NINDIRECT
] = 
addr
 = 
	`bÆloc
(
ù
->
dev
);

465 
	`log_wrôe
(
bp
);

467 
	`bªl£
(
bp
);

470 
bp
 = 
	`bªad
(
ù
->
dev
, 
addr
);

471 
a
 = (
uöt
*)
bp
->
d©a
;

472 if((
addr
 = 
a
[
tmp
%
NINDIRECT
]) == 0)

474 
a
[
tmp
%
NINDIRECT
] = 
addr
 = 
	`bÆloc
(
ù
->
dev
);

475 
	`log_wrôe
(
bp
);

477 
	`bªl£
(
bp
);

479  
addr
;

482 
	`∑nic
("bmap: out ofÑange");

483 
	}
}

491 
	$ôrunc
(
öode
 *
ù
)

493 
i
, 
j
, 
k
, 
l
, 
m
, 
n
, 
o
;

494 
buf
 *
bp
, *
tmp1
, *
tmp2
, *
tmp3
;

495 
uöt
 *
a
, *
b
, *
c
, *
d
;

499 
i
 = 0; i < 
NDIRECT
; i++){

500 if(
ù
->
addrs
[
i
]){

501 
	`b‰ì
(
ù
->
dev
, ip->
addrs
[
i
]);

502 
ù
->
addrs
[
i
] = 0;

508 if(
ù
->
addrs
[
NDIRECT
]){

509 
bp
 = 
	`bªad
(
ù
->
dev
, ip->
addrs
[
NDIRECT
]);

510 
a
 = (
uöt
*)
bp
->
d©a
;

513 
j
 = 0; j < 
NINDIRECT
; j++){

514 if(
a
[
j
])

515 
	`b‰ì
(
ù
->
dev
, 
a
[
j
]);

517 
	`bªl£
(
bp
);

518 
	`b‰ì
(
ù
->
dev
, ip->
addrs
[
NDIRECT
]);

519 
ù
->
addrs
[
NDIRECT
] = 0;

524 if(
ù
->
addrs
[
NDIRECT
+1])

526 
bp
 = 
	`bªad
(
ù
->
dev
, ip->
addrs
[
NDIRECT
+1]);

527 
a
 = (
uöt
*)
bp
->
d©a
;

530 
k
 = 0; k < 
NINDIRECT
; k++)

532 if(
a
[
k
])

534 
tmp1
 = 
	`bªad
(
ù
->
dev
, 
a
[
k
]);

535 
b
 = (
uöt
*)
tmp1
->
d©a
;

538 
l
 = 0;Ü < 
NINDIRECT
;Ü++)

539 if(
b
[
l
])

540 
	`b‰ì
(
ù
->
dev
, 
b
[
l
]);

542 
	`bªl£
(
tmp1
);

543 
	`b‰ì
(
ù
->
dev
, 
a
[
k
]);

546 
	`bªl£
(
bp
);

547 
	`b‰ì
(
ù
->
dev
, ip->
addrs
[
NDIRECT
+1]);

548 
ù
->
addrs
[
NDIRECT
+1] = 0;

553 if(
ù
->
addrs
[
NDIRECT
+2])

555 
bp
 = 
	`bªad
(
ù
->
dev
, ip->
addrs
[
NDIRECT
+2]);

556 
a
 = (
uöt
*)
bp
->
d©a
;

559 
m
 = 0; m < 
NINDIRECT
; m++)

561 if(
a
[
m
])

563 
tmp2
 = 
	`bªad
(
ù
->
dev
, 
a
[
m
]);

564 
c
 = (
uöt
*)
tmp2
->
d©a
;

567 
n
 = 0;Ç < 
NINDIRECT
;Ç++)

569 if(
c
[
n
])

571 
tmp3
 = 
	`bªad
(
ù
->
dev
, 
c
[
n
]);

572 
d
 = (
uöt
*)
tmp3
->
d©a
;

575 
o
 = 0; o < 
NINDIRECT
; o++)

576 if(
d
[
o
])

577 
	`b‰ì
(
ù
->
dev
, 
d
[
o
]);

579 
	`bªl£
(
tmp3
);

580 
	`b‰ì
(
ù
->
dev
, 
c
[
n
]);

583 
	`bªl£
(
tmp2
);

584 
	`b‰ì
(
ù
->
dev
, 
a
[
m
]);

587 
	`bªl£
(
bp
);

588 
	`b‰ì
(
ù
->
dev
, ip->
addrs
[
NDIRECT
+2]);

589 
ù
->
addrs
[
NDIRECT
+2] = 0;

592 
ù
->
size
 = 0;

593 
	`iupd©e
(
ù
);

594 
	}
}

599 
	$°©i
(
öode
 *
ù
, 
°©
 *
°
)

601 
°
->
dev
 = 
ù
->dev;

602 
°
->
öo
 = 
ù
->
öum
;

603 
°
->
ty≥
 = 
ù
->type;

604 
°
->
∆ök
 = 
ù
->nlink;

605 
°
->
size
 = 
ù
->size;

606 
	}
}

612 
	$ªadi
(
öode
 *
ù
, *
d°
, 
uöt
 
off
, uöà
n
)

614 
uöt
 
tŸ
, 
m
;

615 
buf
 *
bp
;

617 if(
ù
->
ty≥
 =
T_DEV
){

618 if(
ù
->
maj‹
 < 0 || ip->maj‹ >
NDEV
 || !
devsw
[ù->maj‹].
ªad
)

620  
devsw
[
ù
->
maj‹
].
	`ªad
(ù, 
d°
, 
n
);

623 if(
off
 > 
ù
->
size
 || of‡+ 
n
 < off)

625 if(
off
 + 
n
 > 
ù
->
size
)

626 
n
 = 
ù
->
size
 - 
off
;

628 
tŸ
=0;ÅŸ<
n
;ÅŸ+=
m
, 
off
+=m, 
d°
+=m){

629 
bp
 = 
	`bªad
(
ù
->
dev
, 
	`bm≠
(ù, 
off
/
BSIZE
));

630 
m
 = 
	`mö
(
n
 - 
tŸ
, 
BSIZE
 - 
off
%BSIZE);

631 
	`memmove
(
d°
, 
bp
->
d©a
 + 
off
%
BSIZE
, 
m
);

632 
	`bªl£
(
bp
);

634  
n
;

635 
	}
}

641 
	$wrôei
(
öode
 *
ù
, *
§c
, 
uöt
 
off
, uöà
n
)

643 
uöt
 
tŸ
, 
m
;

644 
buf
 *
bp
;

646 if(
ù
->
ty≥
 =
T_DEV
){

647 if(
ù
->
maj‹
 < 0 || ip->maj‹ >
NDEV
 || !
devsw
[ù->maj‹].
wrôe
)

649  
devsw
[
ù
->
maj‹
].
	`wrôe
(ù, 
§c
, 
n
);

652 if(
off
 > 
ù
->
size
)

654 
ù
->
size
 = 
off
;

655 
	`iupd©e
(
ù
);

658 if(
off
 > 
ù
->
size
 || of‡+ 
n
 < off)

664 if(
off
 + 
n
 > 
MAXFILE
*
BSIZE
)

667 
tŸ
=0;ÅŸ<
n
;ÅŸ+=
m
, 
off
+=m, 
§c
+=m){

668 
bp
 = 
	`bªad
(
ù
->
dev
, 
	`bm≠
(ù, 
off
/
BSIZE
));

669 
m
 = 
	`mö
(
n
 - 
tŸ
, 
BSIZE
 - 
off
%BSIZE);

670 
	`memmove
(
bp
->
d©a
 + 
off
%
BSIZE
, 
§c
, 
m
);

671 
	`log_wrôe
(
bp
);

672 
	`bªl£
(
bp
);

675 if(
n
 > 0 && 
off
 > 
ù
->
size
){

676 
ù
->
size
 = 
off
;

677 
	`iupd©e
(
ù
);

679  
n
;

680 
	}
}

686 
	$«mecmp
(c⁄° *
s
, c⁄° *
t
)

688  
	`°∫cmp
(
s
, 
t
, 
DIRSIZ
);

689 
	}
}

693 
öode
*

694 
	$dúlookup
(
öode
 *
dp
, *
«me
, 
uöt
 *
poff
)

696 
uöt
 
off
, 
öum
;

697 
dúít
 
de
;

699 if(
dp
->
ty≥
 !
T_DIR
)

700 
	`∑nic
("dirlookupÇot DIR");

702 
off
 = 0; of‡< 
dp
->
size
; of‡+(
de
)){

703 if(
	`ªadi
(
dp
, (*)&
de
, 
off
, (de)) != (de))

704 
	`∑nic
("dirlookupÑead");

705 if(
de
.
öum
 == 0)

707 if(
	`«mecmp
(
«me
, 
de
.name) == 0){

709 if(
poff
)

710 *
poff
 = 
off
;

711 
öum
 = 
de
.inum;

712  
	`igë
(
dp
->
dev
, 
öum
);

717 
	}
}

721 
	$dúlök
(
öode
 *
dp
, *
«me
, 
uöt
 
öum
)

723 
off
;

724 
dúít
 
de
;

725 
öode
 *
ù
;

728 if((
ù
 = 
	`dúlookup
(
dp
, 
«me
, 0)) != 0){

729 
	`ùut
(
ù
);

734 
off
 = 0; of‡< 
dp
->
size
; of‡+(
de
)){

735 if(
	`ªadi
(
dp
, (*)&
de
, 
off
, (de)) != (de))

736 
	`∑nic
("dirlinkÑead");

737 if(
de
.
öum
 == 0)

741 
	`°∫˝y
(
de
.
«me
,Çame, 
DIRSIZ
);

742 
de
.
öum
 = inum;

743 if(
	`wrôei
(
dp
, (*)&
de
, 
off
, (de)) != (de))

744 
	`∑nic
("dirlink");

747 
	}
}

765 
	$skùñem
(*
∑th
, *
«me
)

767 *
s
;

768 
Àn
;

770 *
∑th
 == '/')

771 
∑th
++;

772 if(*
∑th
 == 0)

774 
s
 = 
∑th
;

775 *
∑th
 != '/' && *path != 0)

776 
∑th
++;

777 
Àn
 = 
∑th
 - 
s
;

778 if(
Àn
 >
DIRSIZ
)

779 
	`memmove
(
«me
, 
s
, 
DIRSIZ
);

781 
	`memmove
(
«me
, 
s
, 
Àn
);

782 
«me
[
Àn
] = 0;

784 *
∑th
 == '/')

785 
∑th
++;

786  
∑th
;

787 
	}
}

793 
öode
*

794 
	$«mex
(*
∑th
, 
«meù¨ít
, *
«me
)

796 
öode
 *
ù
, *
√xt
;

798 if(*
∑th
 == '/')

799 
ù
 = 
	`igë
(
ROOTDEV
, 
ROOTINO
);

801 
ù
 = 
	`idup
(
	`my¥oc
()->
cwd
);

803 (
∑th
 = 
	`skùñem
’©h, 
«me
)) != 0){

804 
	`ûock
(
ù
);

805 if(
ù
->
ty≥
 !
T_DIR
){

806 
	`iu∆ockput
(
ù
);

809 if(
«meù¨ít
 && *
∑th
 == '\0'){

811 
	`iu∆ock
(
ù
);

812  
ù
;

814 if((
√xt
 = 
	`dúlookup
(
ù
, 
«me
, 0)) == 0){

815 
	`iu∆ockput
(
ù
);

818 
	`iu∆ockput
(
ù
);

819 
ù
 = 
√xt
;

821 if(
«meù¨ít
){

822 
	`ùut
(
ù
);

825  
ù
;

826 
	}
}

828 
öode
*

829 
	$«mei
(*
∑th
)

831 
«me
[
DIRSIZ
];

832  
	`«mex
(
∑th
, 0, 
«me
);

833 
	}
}

835 
öode
*

836 
	$«meù¨ít
(*
∑th
, *
«me
)

838  
	`«mex
(
∑th
, 1, 
«me
);

839 
	}
}

	@fs.h

5 
	#ROOTINO
 1

6 
	#BSIZE
 512

7 

	)

14 
	ssu≥rblock
 {

15 
uöt
 
	msize
;

16 
uöt
 
	mnblocks
;

17 
uöt
 
	mnöodes
;

18 
uöt
 
	m∆og
;

19 
uöt
 
	mlog°¨t
;

20 
uöt
 
	möode°¨t
;

21 
uöt
 
	mbm≠°¨t
;

25 
	#NDIRECT
 10

	)

26 
	#NINDIRECT
 (
BSIZE
 / (
uöt
))

	)

27 
	#NDOUBINDIRECT
 (
NINDIRECT
 * NINDIRECT)

	)

28 
	#NTRIPINDIRECT
 (
NDOUBINDIRECT
 * 
NINDIRECT
)

	)

30 
	#MAXFILE
 (
NDIRECT
 + 
NINDIRECT
 + 
NDOUBINDIRECT
 + 
NTRIPINDIRECT
)

	)

33 
	sdöode
 {

34 
	mty≥
;

35 
	mmaj‹
;

36 
	mmö‹
;

37 
	m∆ök
;

38 
uöt
 
	msize
;

39 
uöt
 
	maddrs
[
NDIRECT
+3];

43 
	#IPB
 (
BSIZE
 / (
döode
))

	)

46 
	#IBLOCK
(
i
, 
sb
Ë((iË/ 
IPB
 + sb.
öode°¨t
)

	)

49 
	#BPB
 (
BSIZE
*8)

	)

52 
	#BBLOCK
(
b
, 
sb
Ë(b/
BPB
 + sb.
bm≠°¨t
)

	)

55 
	#DIRSIZ
 14

	)

57 
	sdúít
 {

58 
ush‹t
 
	möum
;

59 
	m«me
[
DIRSIZ
];

	@grep.c

3 
	~"ty≥s.h
"

4 
	~"°©.h
"

5 
	~"u£r.h
"

7 
	gbuf
[1024];

8 
m©ch
(*, *);

11 
	$gªp
(*
∑âîn
, 
fd
)

13 
n
, 
m
;

14 *
p
, *
q
;

16 
m
 = 0;

17 (
n
 = 
	`ªad
(
fd
, 
buf
+
m
, (buf)-m-1)) > 0){

18 
m
 +
n
;

19 
buf
[
m
] = '\0';

20 
p
 = 
buf
;

21 (
q
 = 
	`°rchr
(
p
, '\n')) != 0){

22 *
q
 = 0;

23 if(
	`m©ch
(
∑âîn
, 
p
)){

24 *
q
 = '\n';

25 
	`wrôe
(1, 
p
, 
q
+1 -Ö);

27 
p
 = 
q
+1;

29 if(
p
 =
buf
)

30 
m
 = 0;

31 if(
m
 > 0){

32 
m
 -
p
 - 
buf
;

33 
	`memmove
(
buf
, 
p
, 
m
);

36 
	}
}

39 
	$maö
(
¨gc
, *
¨gv
[])

41 
fd
, 
i
;

42 *
∑âîn
;

44 if(
¨gc
 <= 1){

45 
	`¥ötf
(2, "usage: grepÖattern [file ...]\n");

46 
	`exô
();

48 
∑âîn
 = 
¨gv
[1];

50 if(
¨gc
 <= 2){

51 
	`gªp
(
∑âîn
, 0);

52 
	`exô
();

55 
i
 = 2; i < 
¨gc
; i++){

56 if((
fd
 = 
	`›í
(
¨gv
[
i
], 0)) < 0){

57 
	`¥ötf
(1, "gªp: c™nŸ o≥¿%s\n", 
¨gv
[
i
]);

58 
	`exô
();

60 
	`gªp
(
∑âîn
, 
fd
);

61 
	`˛o£
(
fd
);

63 
	`exô
();

64 
	}
}

69 
m©chhîe
(*, *);

70 
m©ch°¨
(, *, *);

73 
	$m©ch
(*
ª
, *
ãxt
)

75 if(
ª
[0] == '^')

76  
	`m©chhîe
(
ª
+1, 
ãxt
);

78 if(
	`m©chhîe
(
ª
, 
ãxt
))

80 }*
ãxt
++ != '\0');

82 
	}
}

85 
	$m©chhîe
(*
ª
, *
ãxt
)

87 if(
ª
[0] == '\0')

89 if(
ª
[1] == '*')

90  
	`m©ch°¨
(
ª
[0],Ñe+2, 
ãxt
);

91 if(
ª
[0] == '$' &&Ñe[1] == '\0')

92  *
ãxt
 == '\0';

93 if(*
ãxt
!='\0' && (
ª
[0]=='.' ||Ñe[0]==*text))

94  
	`m©chhîe
(
ª
+1, 
ãxt
+1);

96 
	}
}

99 
	$m©ch°¨
(
c
, *
ª
, *
ãxt
)

102 if(
	`m©chhîe
(
ª
, 
ãxt
))

104 }*
ãxt
!='\0' && (*ãxt++==
c
 || c=='.'));

106 
	}
}

	@hugefiletest.c

1 
	~"ty≥s.h
"

2 
	~"°©.h
"

3 
	~"u£r.h
"

4 
	~"fs.h
"

5 
	~"f˙é.h
"

7 
	#FILESIZE
 (16*1024*1024)

8 
	#BUFSIZE
 512

	)

9 
	#BUF_PER_FILE
 ((
FILESIZE
Ë/ (
BUFSIZE
))

	)

10 
	#NUM_STRESS
 4

	)

13 
	$maö
(
¨gc
, *
¨gv
[])

15 
fd
, 
i
, 
j
;

16 
r
;

17 
tŸÆ
;

18 *
∑th
 = (
¨gc
 > 1Ë? 
¨gv
[1] : "hugefile";

19 
d©a
[
BUFSIZE
];

20 
buf
[
BUFSIZE
];

22 
	`¥ötf
(1, "hugefiletest starting\n");

23 c⁄° 
sz
 = (
d©a
);

24 
i
 = 0; i < 
sz
; i++) {

25 
d©a
[
i
] = i % 128;

28 
	`¥ötf
(1, "1. createÅest\n");

29 
fd
 = 
	`›í
(
∑th
, 
O_CREATE
 | 
O_RDWR
);

30 
i
 = 0; i < 
BUF_PER_FILE
; i++){

31 i‡(
i
 % 100 == 0){

32 
	`¥ötf
(1, "%d byã†wrôãn\n", 
i
 * 
BUFSIZE
);

34 i‡((
r
 = 
	`wrôe
(
fd
, 
d©a
, (data))) != (data)){

35 
	`¥ötf
(1, "wrôêªtu∫ed %d : faûed\n", 
r
);

36 
	`exô
();

39 
	`¥ötf
(1, "%d byã†wrôãn\n", 
BUF_PER_FILE
 * 
BUFSIZE
);

40 
	`˛o£
(
fd
);

42 
	`¥ötf
(1, "2.ÑeadÅest\n");

43 
fd
 = 
	`›í
(
∑th
, 
O_RDONLY
);

44 
i
 = 0; i < 
BUF_PER_FILE
; i++){

45 i‡(
i
 % 100 == 0){

46 
	`¥ötf
(1, "%d byã†ªad\n", 
i
 * 
BUFSIZE
);

48 i‡((
r
 = 
	`ªad
(
fd
, 
buf
, (
d©a
))) != (data)){

49 
	`¥ötf
(1, "ªadÑëu∫ed %d : faûed\n", 
r
);

50 
	`exô
();

52 
j
 = 0; j < 
sz
; j++) {

53 i‡(
buf
[
j
] !
d©a
[j]) {

54 
	`¥ötf
(1, "data inconsistency detected\n");

55 
	`exô
();

59 
	`¥ötf
(1, "%d byã†ªad\n", 
BUF_PER_FILE
 * 
BUFSIZE
);

60 
	`˛o£
(
fd
);

62 
	`¥ötf
(1, "3. stressÅest\n");

63 
tŸÆ
 = 0;

64 
i
 = 0; i < 
NUM_STRESS
; i++) {

65 
	`¥ötf
(1, "°ªs†ã°...%d \n", 
i
);

66 if(
	`u∆ök
(
∑th
) < 0){

67 
	`¥ötf
(1, "rm: %†ÁûedÅÿdñëe\n", 
∑th
);

68 
	`exô
();

71 
fd
 = 
	`›í
(
∑th
, 
O_CREATE
 | 
O_RDWR
);

72 
j
 = 0; j < 
BUF_PER_FILE
; j++){

73 i‡(
j
 % 100 == 0){

74 
	`¥ötf
(1, "%d byã†tŸÆly wrôãn\n", 
tŸÆ
);

76 i‡((
r
 = 
	`wrôe
(
fd
, 
d©a
, (data))) != (data)){

77 
	`¥ötf
(1, "wrôêªtu∫ed %d : faûed\n", 
r
);

78 
	`exô
();

80 
tŸÆ
 +(
d©a
);

82 
	`¥ötf
(1, "%d byã†wrôãn\n", 
tŸÆ
);

83 
	`˛o£
(
fd
);

86 
	`exô
();

87 
	}
}

	@ide.c

3 
	~"ty≥s.h
"

4 
	~"defs.h
"

5 
	~"∑øm.h
"

6 
	~"memœyout.h
"

7 
	~"mmu.h
"

8 
	~"¥oc.h
"

9 
	~"x86.h
"

10 
	~"å≠s.h
"

11 
	~"•ölock.h
"

12 
	~"¶ì∂ock.h
"

13 
	~"fs.h
"

14 
	~"buf.h
"

16 
	#SECTOR_SIZE
 512

	)

17 
	#IDE_BSY
 0x80

	)

18 
	#IDE_DRDY
 0x40

	)

19 
	#IDE_DF
 0x20

	)

20 
	#IDE_ERR
 0x01

	)

22 
	#IDE_CMD_READ
 0x20

	)

23 
	#IDE_CMD_WRITE
 0x30

	)

24 
	#IDE_CMD_RDMUL
 0xc4

	)

25 
	#IDE_CMD_WRMUL
 0xc5

	)

31 
•ölock
 
	gidñock
;

32 
buf
 *
	gidequeue
;

34 
	ghavedisk1
;

35 
ide°¨t
(
buf
*);

39 
	$idewaô
(
checkîr
)

41 
r
;

43 ((
r
 = 
	`öb
(0x1f7)Ë& (
IDE_BSY
|
IDE_DRDY
)) != IDE_DRDY)

45 if(
checkîr
 && (
r
 & (
IDE_DF
|
IDE_ERR
)) != 0)

48 
	}
}

51 
	$ideöô
()

53 
i
;

55 
	`öôlock
(&
idñock
, "ide");

56 
	`iﬂpi˚«bÀ
(
IRQ_IDE
, 
n˝u
 - 1);

57 
	`idewaô
(0);

60 
	`outb
(0x1f6, 0xe0 | (1<<4));

61 
i
=0; i<1000; i++){

62 if(
	`öb
(0x1f7) != 0){

63 
havedisk1
 = 1;

69 
	`outb
(0x1f6, 0xe0 | (0<<4));

70 
	}
}

74 
	$ide°¨t
(
buf
 *
b
)

76 if(
b
 == 0)

77 
	`∑nic
("idestart");

78 if(
b
->
blockno
 >
FSSIZE
)

79 
	`∑nic
("incorrect blockno");

80 
£˘‹_≥r_block
 = 
BSIZE
/
SECTOR_SIZE
;

81 
£˘‹
 = 
b
->
blockno
 * 
£˘‹_≥r_block
;

82 
ªad_cmd
 = (
£˘‹_≥r_block
 =1Ë? 
IDE_CMD_READ
 : 
IDE_CMD_RDMUL
;

83 
wrôe_cmd
 = (
£˘‹_≥r_block
 =1Ë? 
IDE_CMD_WRITE
 : 
IDE_CMD_WRMUL
;

85 i‡(
£˘‹_≥r_block
 > 7Ë
	`∑nic
("idestart");

87 
	`idewaô
(0);

88 
	`outb
(0x3f6, 0);

89 
	`outb
(0x1f2, 
£˘‹_≥r_block
);

90 
	`outb
(0x1f3, 
£˘‹
 & 0xff);

91 
	`outb
(0x1f4, (
£˘‹
 >> 8) & 0xff);

92 
	`outb
(0x1f5, (
£˘‹
 >> 16) & 0xff);

93 
	`outb
(0x1f6, 0xe0 | ((
b
->
dev
&1)<<4Ë| ((
£˘‹
>>24)&0x0f));

94 if(
b
->
Êags
 & 
B_DIRTY
){

95 
	`outb
(0x1f7, 
wrôe_cmd
);

96 
	`out¶
(0x1f0, 
b
->
d©a
, 
BSIZE
/4);

98 
	`outb
(0x1f7, 
ªad_cmd
);

100 
	}
}

104 
	$ideöå
()

106 
buf
 *
b
;

109 
	`acquúe
(&
idñock
);

111 if((
b
 = 
idequeue
) == 0){

112 
	`ªÀa£
(&
idñock
);

115 
idequeue
 = 
b
->
q√xt
;

118 if(!(
b
->
Êags
 & 
B_DIRTY
Ë&& 
	`idewaô
(1) >= 0)

119 
	`ö¶
(0x1f0, 
b
->
d©a
, 
BSIZE
/4);

122 
b
->
Êags
 |
B_VALID
;

123 
b
->
Êags
 &~
B_DIRTY
;

124 
	`wakeup
(
b
);

127 if(
idequeue
 != 0)

128 
	`ide°¨t
(
idequeue
);

130 
	`ªÀa£
(&
idñock
);

131 
	}
}

138 
	$idîw
(
buf
 *
b
)

140 
buf
 **
µ
;

142 if(!
	`hﬁdög¶ìp
(&
b
->
lock
))

143 
	`∑nic
("iderw: bufÇotÜocked");

144 if((
b
->
Êags
 & (
B_VALID
|
B_DIRTY
)) == B_VALID)

145 
	`∑nic
("iderw:ÇothingÅo do");

146 if(
b
->
dev
 !0 && !
havedisk1
)

147 
	`∑nic
("iderw: ide disk 1ÇotÖresent");

149 
	`acquúe
(&
idñock
);

152 
b
->
q√xt
 = 0;

153 
µ
=&
idequeue
; *µ;Öp=&(*µ)->
q√xt
)

155 *
µ
 = 
b
;

158 if(
idequeue
 =
b
)

159 
	`ide°¨t
(
b
);

162 (
b
->
Êags
 & (
B_VALID
|
B_DIRTY
)) != B_VALID){

163 
	`¶ìp
(
b
, &
idñock
);

167 
	`ªÀa£
(&
idñock
);

168 
	}
}

	@init.c

3 
	~"ty≥s.h
"

4 
	~"°©.h
"

5 
	~"u£r.h
"

6 
	~"f˙é.h
"

8 *
	g¨gv
[] = { "sh", 0 };

11 
	$maö
()

13 
pid
, 
wpid
;

15 if(
	`›í
("c⁄sﬁe", 
O_RDWR
) < 0){

16 
	`mknod
("console", 1, 1);

17 
	`›í
("c⁄sﬁe", 
O_RDWR
);

19 
	`dup
(0);

20 
	`dup
(0);

23 
	`¥ötf
(1, "init: starting sh\n");

24 
pid
 = 
	`f‹k
();

25 if(
pid
 < 0){

26 
	`¥ötf
(1, "init: fork failed\n");

27 
	`exô
();

29 if(
pid
 == 0){

30 
	`exec
("sh", 
¨gv
);

31 
	`¥ötf
(1, "init:Éxec sh failed\n");

32 
	`exô
();

34 (
wpid
=
	`waô
()Ë>0 && wpid !
pid
)

35 
	`¥ötf
(1, "zombie!\n");

37 
	}
}

	@ioapic.c

5 
	~"ty≥s.h
"

6 
	~"defs.h
"

7 
	~"å≠s.h
"

9 
	#IOAPIC
 0xFEC00000

10 

	)

11 
	#REG_ID
 0x00

12 
	#REG_VER
 0x01

13 
	#REG_TABLE
 0x10

14 

	)

20 
	#INT_DISABLED
 0x00010000

21 
	#INT_LEVEL
 0x00008000

22 
	#INT_ACTIVELOW
 0x00002000

23 
	#INT_LOGICAL
 0x00000800

24 

	)

25 vﬁ©ûê
iﬂpic
 *
	giﬂpic
;

28 
	siﬂpic
 {

29 
uöt
 
	mªg
;

30 
uöt
 
	m∑d
[3];

31 
uöt
 
	md©a
;

34 
uöt


35 
	$iﬂpi¸ód
(
ªg
)

37 
iﬂpic
->
ªg
 =Ñeg;

38  
iﬂpic
->
d©a
;

39 
	}
}

42 
	$iﬂpicwrôe
(
ªg
, 
uöt
 
d©a
)

44 
iﬂpic
->
ªg
 =Ñeg;

45 
iﬂpic
->
d©a
 = data;

46 
	}
}

49 
	$iﬂpicöô
()

51 
i
, 
id
, 
maxöå
;

53 
iﬂpic
 = (vﬁ©ûêiﬂpic*)
IOAPIC
;

54 
maxöå
 = (
	`iﬂpi¸ód
(
REG_VER
) >> 16) & 0xFF;

55 
id
 = 
	`iﬂpi¸ód
(
REG_ID
) >> 24;

56 if(
id
 !
iﬂpicid
)

57 
	`˝rötf
("ioapicinit: id isn'tÉqualÅo ioapicid;Çotá MP\n");

61 
i
 = 0; i <
maxöå
; i++){

62 
	`iﬂpicwrôe
(
REG_TABLE
+2*
i
, 
INT_DISABLED
 | (
T_IRQ0
 + i));

63 
	`iﬂpicwrôe
(
REG_TABLE
+2*
i
+1, 0);

65 
	}
}

68 
	$iﬂpi˚«bÀ
(
úq
, 
˝unum
)

73 
	`iﬂpicwrôe
(
REG_TABLE
+2*
úq
, 
T_IRQ0
 + irq);

74 
	`iﬂpicwrôe
(
REG_TABLE
+2*
úq
+1, 
˝unum
 << 24);

75 
	}
}

	@kalloc.c

5 
	~"ty≥s.h
"

6 
	~"defs.h
"

7 
	~"∑øm.h
"

8 
	~"memœyout.h
"

9 
	~"mmu.h
"

10 
	~"•ölock.h
"

12 
‰ìønge
(*
v°¨t
, *
víd
);

13 
íd
[];

16 
	srun
 {

17 
run
 *
	m√xt
;

21 
•ölock
 
	mlock
;

22 
	mu£_lock
;

23 
run
 *
	m‰ìli°
;

24 } 
	gkmem
;

32 
	$köô1
(*
v°¨t
, *
víd
)

34 
	`öôlock
(&
kmem
.
lock
, "kmem");

35 
kmem
.
u£_lock
 = 0;

36 
	`‰ìønge
(
v°¨t
, 
víd
);

37 
	}
}

40 
	$köô2
(*
v°¨t
, *
víd
)

42 
	`‰ìønge
(
v°¨t
, 
víd
);

43 
kmem
.
u£_lock
 = 1;

44 
	}
}

47 
	$‰ìønge
(*
v°¨t
, *
víd
)

49 *
p
;

50 
p
 = (*)
	`PGROUNDUP
((
uöt
)
v°¨t
);

51 ; 
p
 + 
PGSIZE
 <(*)
víd
;Ö += PGSIZE)

52 
	`k‰ì
(
p
);

53 
	}
}

60 
	$k‰ì
(*
v
)

62 
run
 *
r
;

64 if((
uöt
)
v
 % 
PGSIZE
 || v < 
íd
 || 
	`V2P
(vË>
PHYSTOP
)

65 
	`∑nic
("kfree");

68 
	`mem£t
(
v
, 1, 
PGSIZE
);

70 if(
kmem
.
u£_lock
)

71 
	`acquúe
(&
kmem
.
lock
);

72 
r
 = (
run
*)
v
;

73 
r
->
√xt
 = 
kmem
.
‰ìli°
;

74 
kmem
.
‰ìli°
 = 
r
;

75 if(
kmem
.
u£_lock
)

76 
	`ªÀa£
(&
kmem
.
lock
);

77 
	}
}

83 
	$kÆloc
()

85 
run
 *
r
;

87 if(
kmem
.
u£_lock
)

88 
	`acquúe
(&
kmem
.
lock
);

89 
r
 = 
kmem
.
‰ìli°
;

90 if(
r
)

91 
kmem
.
‰ìli°
 = 
r
->
√xt
;

92 if(
kmem
.
u£_lock
)

93 
	`ªÀa£
(&
kmem
.
lock
);

94  (*)
r
;

95 
	}
}

	@kbd.c

1 
	~"ty≥s.h
"

2 
	~"x86.h
"

3 
	~"defs.h
"

4 
	~"kbd.h
"

7 
	$kbdgëc
()

9 
uöt
 
shi·
;

10 
uch¨
 *
ch¨code
[4] = {

11 
n‹mÆm≠
, 
shi·m≠
, 
˘lm≠
, ctlmap

13 
uöt
 
°
, 
d©a
, 
c
;

15 
°
 = 
	`öb
(
KBSTATP
);

16 if((
°
 & 
KBS_DIB
) == 0)

18 
d©a
 = 
	`öb
(
KBDATAP
);

20 if(
d©a
 == 0xE0){

21 
shi·
 |
E0ESC
;

23 } if(
d©a
 & 0x80){

25 
d©a
 = (
shi·
 & 
E0ESC
 ? data : data & 0x7F);

26 
shi·
 &~(
shi·code
[
d©a
] | 
E0ESC
);

28 } if(
shi·
 & 
E0ESC
){

30 
d©a
 |= 0x80;

31 
shi·
 &~
E0ESC
;

34 
shi·
 |
shi·code
[
d©a
];

35 
shi·
 ^
toggÀcode
[
d©a
];

36 
c
 = 
ch¨code
[
shi·
 & (
CTL
 | 
SHIFT
)][
d©a
];

37 if(
shi·
 & 
CAPSLOCK
){

38 if('a' <
c
 && c <= 'z')

39 
c
 += 'A' - 'a';

40 if('A' <
c
 && c <= 'Z')

41 
c
 += 'a' - 'A';

43  
c
;

44 
	}
}

47 
	$kbdöå
()

49 
	`c⁄sﬁeöå
(
kbdgëc
);

50 
	}
}

	@kbd.h

3 
	#KBSTATP
 0x64

4 
	#KBS_DIB
 0x01

5 
	#KBDATAP
 0x60

6 

	)

7 
	#NO
 0

	)

9 
	#SHIFT
 (1<<0)

	)

10 
	#CTL
 (1<<1)

	)

11 
	#ALT
 (1<<2)

	)

13 
	#CAPSLOCK
 (1<<3)

	)

14 
	#NUMLOCK
 (1<<4)

	)

15 
	#SCROLLLOCK
 (1<<5)

	)

17 
	#E0ESC
 (1<<6)

	)

20 
	#KEY_HOME
 0xE0

	)

21 
	#KEY_END
 0xE1

	)

22 
	#KEY_UP
 0xE2

	)

23 
	#KEY_DN
 0xE3

	)

24 
	#KEY_LF
 0xE4

	)

25 
	#KEY_RT
 0xE5

	)

26 
	#KEY_PGUP
 0xE6

	)

27 
	#KEY_PGDN
 0xE7

	)

28 
	#KEY_INS
 0xE8

	)

29 
	#KEY_DEL
 0xE9

	)

32 
	#C
(
x
Ë(x - '@')

	)

34 
uch¨
 
	gshi·code
[256] =

36 [0x1D] 
CTL
,

37 [0x2A] 
SHIFT
,

38 [0x36] 
SHIFT
,

39 [0x38] 
ALT
,

40 [0x9D] 
CTL
,

41 [0xB8] 
ALT


44 
uch¨
 
	gtoggÀcode
[256] =

46 [0x3A] 
CAPSLOCK
,

47 [0x45] 
NUMLOCK
,

48 [0x46] 
SCROLLLOCK


51 
uch¨
 
	gn‹mÆm≠
[256] =

53 
NO
, 0x1B, '1', '2', '3', '4', '5', '6',

56 'o', 'p', '[', ']', '\n', 
NO
, 'a', 's',

58 '\'', '`', 
NO
, '\\', 'z', 'x', 'c', 'v',

59 'b', 'n', 'm', ',', '.', '/', 
NO
, '*',

60 
NO
, ' ', NO, NO, NO, NO, NO, NO,

61 
NO
, NO, NO, NO, NO, NO, NO, '7',

63 '2', '3', '0', '.', 
NO
, NO, NO, NO,

66 [0xC8] 
KEY_UP
, [0xD0] 
KEY_DN
,

67 [0xC9] 
KEY_PGUP
, [0xD1] 
KEY_PGDN
,

68 [0xCB] 
KEY_LF
, [0xCD] 
KEY_RT
,

69 [0x97] 
KEY_HOME
, [0xCF] 
KEY_END
,

70 [0xD2] 
KEY_INS
, [0xD3] 
KEY_DEL


73 
uch¨
 
	gshi·m≠
[256] =

75 
NO
, 033, '!', '@', '#', '$', '%', '^',

78 'O', 'P', '{', '}', '\n', 
NO
, 'A', 'S',

80 '"', '~', 
NO
, '|', 'Z', 'X', 'C', 'V',

81 'B', 'N', 'M', '<', '>', '?', 
NO
, '*',

82 
NO
, ' ', NO, NO, NO, NO, NO, NO,

83 
NO
, NO, NO, NO, NO, NO, NO, '7',

85 '2', '3', '0', '.', 
NO
, NO, NO, NO,

88 [0xC8] 
KEY_UP
, [0xD0] 
KEY_DN
,

89 [0xC9] 
KEY_PGUP
, [0xD1] 
KEY_PGDN
,

90 [0xCB] 
KEY_LF
, [0xCD] 
KEY_RT
,

91 [0x97] 
KEY_HOME
, [0xCF] 
KEY_END
,

92 [0xD2] 
KEY_INS
, [0xD3] 
KEY_DEL


95 
uch¨
 
	g˘lm≠
[256] =

97 
NO
, NO, NO, NO, NO, NO, NO, NO,

98 
NO
, NO, NO, NO, NO, NO, NO, NO,

99 
C
('Q'), C('W'), C('E'), C('R'), C('T'), C('Y'), C('U'), C('I'),

100 
C
('O'), C('P'), 
NO
, NO, '\r', NO, C('A'), C('S'),

101 
C
('D'), C('F'), C('G'), C('H'), C('J'), C('K'), C('L'), 
NO
,

102 
NO
, NO, NO, 
C
('\\'), C('Z'), C('X'), C('C'), C('V'),

103 
C
('B'), C('N'), C('M'), 
NO
, NO, C('/'), NO, NO,

105 [0xB5] 
C
('/'),

106 [0xC8] 
KEY_UP
, [0xD0] 
KEY_DN
,

107 [0xC9] 
KEY_PGUP
, [0xD1] 
KEY_PGDN
,

108 [0xCB] 
KEY_LF
, [0xCD] 
KEY_RT
,

109 [0x97] 
KEY_HOME
, [0xCF] 
KEY_END
,

110 [0xD2] 
KEY_INS
, [0xD3] 
KEY_DEL


	@kill.c

1 
	~"ty≥s.h
"

2 
	~"°©.h
"

3 
	~"u£r.h
"

6 
	$maö
(
¨gc
, **
¨gv
)

8 
i
;

10 if(
¨gc
 < 2){

11 
	`¥ötf
(2, "usage: killÖid...\n");

12 
	`exô
();

14 
i
=1; i<
¨gc
; i++)

15 
	`kûl
(
	`©oi
(
¨gv
[
i
]));

16 
	`exô
();

17 
	}
}

	@lapic.c

4 
	~"∑øm.h
"

5 
	~"ty≥s.h
"

6 
	~"defs.h
"

7 
	~"d©e.h
"

8 
	~"memœyout.h
"

9 
	~"å≠s.h
"

10 
	~"mmu.h
"

11 
	~"x86.h
"

14 
	#ID
 (0x0020/4)

15 
	#VER
 (0x0030/4)

16 
	#TPR
 (0x0080/4)

17 
	#EOI
 (0x00B0/4)

18 
	#SVR
 (0x00F0/4)

19 
	#ENABLE
 0x00000100

20 
	#ESR
 (0x0280/4)

21 
	#ICRLO
 (0x0300/4)

22 
	#INIT
 0x00000500

23 
	#STARTUP
 0x00000600

24 
	#DELIVS
 0x00001000

25 
	#ASSERT
 0x00004000

26 
	#DEASSERT
 0x00000000

	)

27 
	#LEVEL
 0x00008000

28 
	#BCAST
 0x00080000

29 
	#BUSY
 0x00001000

	)

30 
	#FIXED
 0x00000000

	)

31 
	#ICRHI
 (0x0310/4)

32 
	#TIMER
 (0x0320/4)

33 
	#X1
 0x0000000B

34 
	#PERIODIC
 0x00020000

35 
	#PCINT
 (0x0340/4)

36 
	#LINT0
 (0x0350/4)

37 
	#LINT1
 (0x0360/4)

38 
	#ERROR
 (0x0370/4)

39 
	#MASKED
 0x00010000

40 
	#TICR
 (0x0380/4)

41 
	#TCCR
 (0x0390/4)

42 
	#TDCR
 (0x03E0/4)

43 

	)

44 vﬁ©ûê
uöt
 *
	gœpic
;

48 
	$œpicw
(
ödex
, 
vÆue
)

50 
œpic
[
ödex
] = 
vÆue
;

51 
œpic
[
ID
];

52 
	}
}

55 
	$œpicöô
()

57 if(!
œpic
)

61 
	`œpicw
(
SVR
, 
ENABLE
 | (
T_IRQ0
 + 
IRQ_SPURIOUS
));

67 
	`œpicw
(
TDCR
, 
X1
);

68 
	`œpicw
(
TIMER
, 
PERIODIC
 | (
T_IRQ0
 + 
IRQ_TIMER
));

69 
	`œpicw
(
TICR
, 10000000);

72 
	`œpicw
(
LINT0
, 
MASKED
);

73 
	`œpicw
(
LINT1
, 
MASKED
);

77 if(((
œpic
[
VER
]>>16) & 0xFF) >= 4)

78 
	`œpicw
(
PCINT
, 
MASKED
);

81 
	`œpicw
(
ERROR
, 
T_IRQ0
 + 
IRQ_ERROR
);

84 
	`œpicw
(
ESR
, 0);

85 
	`œpicw
(
ESR
, 0);

88 
	`œpicw
(
EOI
, 0);

91 
	`œpicw
(
ICRHI
, 0);

92 
	`œpicw
(
ICRLO
, 
BCAST
 | 
INIT
 | 
LEVEL
);

93 
œpic
[
ICRLO
] & 
DELIVS
)

97 
	`œpicw
(
TPR
, 0);

98 
	}
}

101 
	$œpicid
()

103 i‡(!
œpic
)

105  
œpic
[
ID
] >> 24;

106 
	}
}

110 
	$œpi˚oi
()

112 if(
œpic
)

113 
	`œpicw
(
EOI
, 0);

114 
	}
}

119 
	$mi¸odñay
(
us
)

121 
	}
}

123 
	#CMOS_PORT
 0x70

	)

124 
	#CMOS_RETURN
 0x71

	)

129 
	$œpic°¨èp
(
uch¨
 
≠icid
, 
uöt
 
addr
)

131 
i
;

132 
ush‹t
 *
wrv
;

137 
	`outb
(
CMOS_PORT
, 0xF);

138 
	`outb
(
CMOS_PORT
+1, 0x0A);

139 
wrv
 = (
ush‹t
*)
	`P2V
((0x40<<4 | 0x67));

140 
wrv
[0] = 0;

141 
wrv
[1] = 
addr
 >> 4;

145 
	`œpicw
(
ICRHI
, 
≠icid
<<24);

146 
	`œpicw
(
ICRLO
, 
INIT
 | 
LEVEL
 | 
ASSERT
);

147 
	`mi¸odñay
(200);

148 
	`œpicw
(
ICRLO
, 
INIT
 | 
LEVEL
);

149 
	`mi¸odñay
(100);

156 
i
 = 0; i < 2; i++){

157 
	`œpicw
(
ICRHI
, 
≠icid
<<24);

158 
	`œpicw
(
ICRLO
, 
STARTUP
 | (
addr
>>12));

159 
	`mi¸odñay
(200);

161 
	}
}

163 
	#CMOS_STATA
 0x0a

	)

164 
	#CMOS_STATB
 0x0b

	)

165 
	#CMOS_UIP
 (1 << 7)

166 

	)

167 
	#SECS
 0x00

	)

168 
	#MINS
 0x02

	)

169 
	#HOURS
 0x04

	)

170 
	#DAY
 0x07

	)

171 
	#MONTH
 0x08

	)

172 
	#YEAR
 0x09

	)

174 
uöt
 
	$cmos_ªad
(
uöt
 
ªg
)

176 
	`outb
(
CMOS_PORT
, 
ªg
);

177 
	`mi¸odñay
(200);

179  
	`öb
(
CMOS_RETURN
);

180 
	}
}

182 
	$fûl_πcd©e
(
πcd©e
 *
r
)

184 
r
->
£c⁄d
 = 
	`cmos_ªad
(
SECS
);

185 
r
->
möuã
 = 
	`cmos_ªad
(
MINS
);

186 
r
->
hour
 = 
	`cmos_ªad
(
HOURS
);

187 
r
->
day
 = 
	`cmos_ªad
(
DAY
);

188 
r
->
m⁄th
 = 
	`cmos_ªad
(
MONTH
);

189 
r
->
yór
 = 
	`cmos_ªad
(
YEAR
);

190 
	}
}

193 
	$cmo°ime
(
πcd©e
 *
r
)

195 
πcd©e
 
t1
, 
t2
;

196 
sb
, 
bcd
;

198 
sb
 = 
	`cmos_ªad
(
CMOS_STATB
);

200 
bcd
 = (
sb
 & (1 << 2)) == 0;

204 
	`fûl_πcd©e
(&
t1
);

205 if(
	`cmos_ªad
(
CMOS_STATA
Ë& 
CMOS_UIP
)

207 
	`fûl_πcd©e
(&
t2
);

208 if(
	`memcmp
(&
t1
, &
t2
, (t1)) == 0)

213 if(
bcd
) {

214 
	#CONV
(
x
Ë(
t1
.x = (—1.x >> 4Ë* 10Ë+ (t1.x & 0xf))

	)

215 
	`CONV
(
£c⁄d
);

216 
	`CONV
(
möuã
);

217 
	`CONV
(
hour
 );

218 
	`CONV
(
day
 );

219 
	`CONV
(
m⁄th
 );

220 
	`CONV
(
yór
 );

221 #unde‡
CONV


224 *
r
 = 
t1
;

225 
r
->
yór
 += 2000;

226 
	}
}

	@ln.c

1 
	~"ty≥s.h
"

2 
	~"°©.h
"

3 
	~"u£r.h
"

6 
	$maö
(
¨gc
, *
¨gv
[])

8 if(
¨gc
 != 3){

9 
	`¥ötf
(2, "Usage:Ün oldÇew\n");

10 
	`exô
();

12 if(
	`lök
(
¨gv
[1],árgv[2]) < 0)

13 
	`¥ötf
(2, "lök %†%s: faûed\n", 
¨gv
[1],árgv[2]);

14 
	`exô
();

15 
	}
}

	@log.c

1 
	~"ty≥s.h
"

2 
	~"defs.h
"

3 
	~"∑øm.h
"

4 
	~"•ölock.h
"

5 
	~"¶ì∂ock.h
"

6 
	~"fs.h
"

7 
	~"buf.h
"

34 
	sloghódî
 {

35 
	mn
;

36 
	mblock
[
LOGSIZE
];

39 
	slog
 {

40 
•ölock
 
	mlock
;

41 
	m°¨t
;

42 
	msize
;

43 
	mout°™dög
;

44 
	mcommôtög
;

45 
	mdev
;

46 
loghódî
 
	mlh
;

48 
log
 
	glog
;

50 
ªcovî_‰om_log
();

51 
commô
();

54 
	$öôlog
(
dev
)

56 i‡((
loghódî
Ë>
BSIZE
)

57 
	`∑nic
("initlog:Åoo bigÜogheader");

59 
su≥rblock
 
sb
;

60 
	`öôlock
(&
log
.
lock
, "log");

61 
	`ªadsb
(
dev
, &
sb
);

62 
log
.
°¨t
 = 
sb
.
log°¨t
;

63 
log
.
size
 = 
sb
.
∆og
;

64 
log
.
dev
 = dev;

65 
	`ªcovî_‰om_log
();

66 
	}
}

70 
	$ö°Æl_å™s
()

72 
èû
;

74 
èû
 = 0;Åaû < 
log
.
lh
.
n
;Åail++) {

75 
buf
 *
lbuf
 = 
	`bªad
(
log
.
dev
,Üog.
°¨t
+
èû
+1);

76 
buf
 *
dbuf
 = 
	`bªad
(
log
.
dev
,Üog.
lh
.
block
[
èû
]);

77 
	`memmove
(
dbuf
->
d©a
, 
lbuf
->d©a, 
BSIZE
);

78 
	`bwrôe
(
dbuf
);

79 
	`bªl£
(
lbuf
);

80 
	`bªl£
(
dbuf
);

82 
	}
}

86 
	$ªad_hód
()

88 
buf
 *bu‡
	`bªad
(
log
.
dev
,Üog.
°¨t
);

89 
loghódî
 *
lh
 = (loghódî *Ë(
buf
->
d©a
);

90 
i
;

91 
log
.
lh
.
n
 =Üh->n;

92 
i
 = 0; i < 
log
.
lh
.
n
; i++) {

93 
log
.
lh
.
block
[
i
] =Üh->block[i];

95 
	`bªl£
(
buf
);

96 
	}
}

102 
	$wrôe_hód
()

104 
buf
 *bu‡
	`bªad
(
log
.
dev
,Üog.
°¨t
);

105 
loghódî
 *
hb
 = (loghódî *Ë(
buf
->
d©a
);

106 
i
;

107 
hb
->
n
 = 
log
.
lh
.n;

108 
i
 = 0; i < 
log
.
lh
.
n
; i++) {

109 
hb
->
block
[
i
] = 
log
.
lh
.block[i];

111 
	`bwrôe
(
buf
);

112 
	`bªl£
(
buf
);

113 
	}
}

116 
	$ªcovî_‰om_log
()

118 
	`ªad_hód
();

119 
	`ö°Æl_å™s
();

120 
log
.
lh
.
n
 = 0;

121 
	`wrôe_hód
();

122 
	}
}

126 
	$begö_›
()

128 
	`acquúe
(&
log
.
lock
);

130 if(
log
.
commôtög
){

131 
	`¶ìp
(&
log
, &log.
lock
);

132 } if(
log
.
lh
.
n
 + (log.
out°™dög
+1)*
MAXOPBLOCKS
 > 
LOGSIZE
){

134 
	`¶ìp
(&
log
, &log.
lock
);

136 
log
.
out°™dög
 += 1;

137 
	`ªÀa£
(&
log
.
lock
);

141 
	}
}

146 
	$íd_›
()

148 
do_commô
 = 0;

150 
	`acquúe
(&
log
.
lock
);

151 
log
.
out°™dög
 -= 1;

152 if(
log
.
commôtög
)

153 
	`∑nic
("log.committing");

154 if(
log
.
out°™dög
 == 0){

155 
do_commô
 = 1;

156 
log
.
commôtög
 = 1;

161 
	`wakeup
(&
log
);

163 
	`ªÀa£
(&
log
.
lock
);

165 if(
do_commô
){

168 
	`commô
();

169 
	`acquúe
(&
log
.
lock
);

170 
log
.
commôtög
 = 0;

171 
	`wakeup
(&
log
);

172 
	`ªÀa£
(&
log
.
lock
);

174 
	}
}

178 
	$wrôe_log
()

180 
èû
;

182 
èû
 = 0;Åaû < 
log
.
lh
.
n
;Åail++) {

183 
buf
 *
to
 = 
	`bªad
(
log
.
dev
,Üog.
°¨t
+
èû
+1);

184 
buf
 *
‰om
 = 
	`bªad
(
log
.
dev
,Üog.
lh
.
block
[
èû
]);

185 
	`memmove
(
to
->
d©a
, 
‰om
->d©a, 
BSIZE
);

186 
	`bwrôe
(
to
);

187 
	`bªl£
(
‰om
);

188 
	`bªl£
(
to
);

190 
	}
}

193 
	$commô
()

195 i‡(
log
.
lh
.
n
 > 0) {

196 
	`wrôe_log
();

197 
	`wrôe_hód
();

198 
	`ö°Æl_å™s
();

199 
log
.
lh
.
n
 = 0;

200 
	`wrôe_hód
();

202 
	}
}

214 
	$log_wrôe
(
buf
 *
b
)

216 
i
;

218 i‡(
log
.
lh
.
n
 >
LOGSIZE
 ||Üog.lh.¿>log.
size
 - 1)

219 
	`∑nic
("too bigáÅransaction");

220 i‡(
log
.
out°™dög
 < 1)

221 
	`∑nic
("log_write outside ofÅrans");

223 
	`acquúe
(&
log
.
lock
);

224 
i
 = 0; i < 
log
.
lh
.
n
; i++) {

225 i‡(
log
.
lh
.
block
[
i
] =
b
->
blockno
)

228 
log
.
lh
.
block
[
i
] = 
b
->
blockno
;

229 i‡(
i
 =
log
.
lh
.
n
)

230 
log
.
lh
.
n
++;

231 
b
->
Êags
 |
B_DIRTY
;

232 
	`ªÀa£
(&
log
.
lock
);

233 
	}
}

	@ls.c

1 
	~"ty≥s.h
"

2 
	~"°©.h
"

3 
	~"u£r.h
"

4 
	~"fs.h
"

7 
	$fmäame
(*
∑th
)

9 
buf
[
DIRSIZ
+1];

10 *
p
;

13 
p
=
∑th
+
	`°æí
(path);Ö >=Öath && *p != '/';Ö--)

15 
p
++;

18 if(
	`°æí
(
p
Ë>
DIRSIZ
)

19  
p
;

20 
	`memmove
(
buf
, 
p
, 
	`°æí
(p));

21 
	`mem£t
(
buf
+
	`°æí
(
p
), ' ', 
DIRSIZ
-strlen(p));

22  
buf
;

23 
	}
}

26 
	$ls
(*
∑th
)

28 
buf
[512], *
p
;

29 
fd
;

30 
dúít
 
de
;

31 
°©
 
°
;

33 if((
fd
 = 
	`›í
(
∑th
, 0)) < 0){

34 
	`¥ötf
(2, "ls: c™nŸ o≥¿%s\n", 
∑th
);

38 if(
	`f°©
(
fd
, &
°
) < 0){

39 
	`¥ötf
(2, "ls: c™nŸ sèà%s\n", 
∑th
);

40 
	`˛o£
(
fd
);

44 
°
.
ty≥
){

45 
T_FILE
:

46 
	`¥ötf
(1, "%†%d %d %d\n", 
	`fmäame
(
∑th
), 
°
.
ty≥
, st.
öo
, st.
size
);

49 
T_DIR
:

50 if(
	`°æí
(
∑th
Ë+ 1 + 
DIRSIZ
 + 1 >  
buf
){

51 
	`¥ötf
(1, "ls:ÖathÅooÜong\n");

54 
	`°r˝y
(
buf
, 
∑th
);

55 
p
 = 
buf
+
	`°æí
(buf);

56 *
p
++ = '/';

57 
	`ªad
(
fd
, &
de
, (de)) == (de)){

58 if(
de
.
öum
 == 0)

60 
	`memmove
(
p
, 
de
.
«me
, 
DIRSIZ
);

61 
p
[
DIRSIZ
] = 0;

62 if(
	`°©
(
buf
, &
°
) < 0){

63 
	`¥ötf
(1, "ls: c™nŸ sèà%s\n", 
buf
);

66 
	`¥ötf
(1, "%†%d %d %d\n", 
	`fmäame
(
buf
), 
°
.
ty≥
, st.
öo
, st.
size
);

70 
	`˛o£
(
fd
);

71 
	}
}

74 
	$maö
(
¨gc
, *
¨gv
[])

76 
i
;

78 if(
¨gc
 < 2){

79 
	`ls
(".");

80 
	`exô
();

82 
i
=1; i<
¨gc
; i++)

83 
	`ls
(
¨gv
[
i
]);

84 
	`exô
();

85 
	}
}

	@main.c

1 
	~"ty≥s.h
"

2 
	~"defs.h
"

3 
	~"∑øm.h
"

4 
	~"memœyout.h
"

5 
	~"mmu.h
"

6 
	~"¥oc.h
"

7 
	~"x86.h
"

9 
°¨tŸhîs
();

10 
	$mpmaö
(Ë
	`__©åibuã__
((
n‹ëu∫
));

11 
pde_t
 *
kpgdú
;

12 
íd
[];

18 
	$maö
()

20 
	`köô1
(
íd
, 
	`P2V
(4*1024*1024));

21 
	`kvmÆloc
();

22 
	`mpöô
();

23 
	`œpicöô
();

24 
	`£göô
();

25 
	`picöô
();

26 
	`iﬂpicöô
();

27 
	`c⁄sﬁeöô
();

28 
	`u¨töô
();

29 
	`pöô
();

30 
	`tvöô
();

31 
	`böô
();

32 
	`fûeöô
();

33 
	`ideöô
();

34 
	`°¨tŸhîs
();

35 
	`köô2
(
	`P2V
(4*1024*1024), P2V(
PHYSTOP
));

36 
	`u£röô
();

37 
	`mpmaö
();

38 
	}
}

42 
	$m≥¡î
()

44 
	`swôchkvm
();

45 
	`£göô
();

46 
	`œpicöô
();

47 
	`mpmaö
();

48 
	}
}

52 
	$mpmaö
()

54 
	`˝rötf
("˝u%d: sèπög %d\n", 
	`˝uid
(), cpuid());

55 
	`idtöô
();

56 
	`xchg
(&(
	`my˝u
()->
°¨ãd
), 1);

57 
	`scheduÀr
();

58 
	}
}

60 
pde_t
 
	gíåypgdú
[];

64 
	$°¨tŸhîs
()

66 
uch¨
 
_bö¨y_íåyŸhî_°¨t
[], 
_bö¨y_íåyŸhî_size
[];

67 
uch¨
 *
code
;

68 
˝u
 *
c
;

69 *
°ack
;

74 
code
 = 
	`P2V
(0x7000);

75 
	`memmove
(
code
, 
_bö¨y_íåyŸhî_°¨t
, (
uöt
)
_bö¨y_íåyŸhî_size
);

77 
c
 = 
˝us
; c < cpus+
n˝u
; c++){

78 if(
c
 =
	`my˝u
())

84 
°ack
 = 
	`kÆloc
();

85 *(**)(
code
-4Ë
°ack
 + 
KSTACKSIZE
;

86 *(**)(
code
-8Ë
m≥¡î
;

87 *(**)(
code
-12Ë(*Ë
	`V2P
(
íåypgdú
);

89 
	`œpic°¨èp
(
c
->
≠icid
, 
	`V2P
(
code
));

92 
c
->
°¨ãd
 == 0)

95 
	}
}

102 
__©åibuã__
((
	$__Æig√d__
(
PGSIZE
)))

103 
pde_t
 
íåypgdú
[
NPDENTRIES
] = {

105 [0] = (0Ë| 
PTE_P
 | 
PTE_W
 | 
PTE_PS
,

107 [
KERNBASE
>>
PDXSHIFT
] = (0Ë| 
PTE_P
 | 
PTE_W
 | 
PTE_PS
,

108 
	}
};

	@memide.c

4 
	~"ty≥s.h
"

5 
	~"defs.h
"

6 
	~"∑øm.h
"

7 
	~"mmu.h
"

8 
	~"¥oc.h
"

9 
	~"x86.h
"

10 
	~"å≠s.h
"

11 
	~"•ölock.h
"

12 
	~"¶ì∂ock.h
"

13 
	~"fs.h
"

14 
	~"buf.h
"

16 
uch¨
 
_bö¨y_fs_img_°¨t
[], 
_bö¨y_fs_img_size
[];

18 
	gdisksize
;

19 
uch¨
 *
	gmemdisk
;

22 
	$ideöô
()

24 
memdisk
 = 
_bö¨y_fs_img_°¨t
;

25 
disksize
 = (
uöt
)
_bö¨y_fs_img_size
/
BSIZE
;

26 
	}
}

30 
	$ideöå
()

33 
	}
}

39 
	$idîw
(
buf
 *
b
)

41 
uch¨
 *
p
;

43 if(!
	`hﬁdög¶ìp
(&
b
->
lock
))

44 
	`∑nic
("iderw: bufÇotÜocked");

45 if((
b
->
Êags
 & (
B_VALID
|
B_DIRTY
)) == B_VALID)

46 
	`∑nic
("iderw:ÇothingÅo do");

47 if(
b
->
dev
 != 1)

48 
	`∑nic
("iderw:ÑequestÇot for disk 1");

49 if(
b
->
blockno
 >
disksize
)

50 
	`∑nic
("iderw: block out ofÑange");

52 
p
 = 
memdisk
 + 
b
->
blockno
*
BSIZE
;

54 if(
b
->
Êags
 & 
B_DIRTY
){

55 
b
->
Êags
 &~
B_DIRTY
;

56 
	`memmove
(
p
, 
b
->
d©a
, 
BSIZE
);

58 
	`memmove
(
b
->
d©a
, 
p
, 
BSIZE
);

59 
b
->
Êags
 |
B_VALID
;

60 
	}
}

	@memlayout.h

3 
	#EXTMEM
 0x100000

4 
	#PHYSTOP
 0xE000000

5 
	#DEVSPACE
 0xFE000000

6 

	)

8 
	#KERNBASE
 0x80000000

9 
	#KERNLINK
 (
KERNBASE
+
EXTMEM
)

10 

	)

11 
	#V2P
(
a
Ë(((
uöt
Ë◊)Ë- 
KERNBASE
)

	)

12 
	#P2V
(
a
Ë(((*Ë◊)Ë+ 
KERNBASE
)

	)

14 
	#V2P_WO
(
x
Ë((xË- 
KERNBASE
)

15 
	#P2V_WO
(
x
Ë((xË+ 
KERNBASE
)

	@mkdir.c

1 
	~"ty≥s.h
"

2 
	~"°©.h
"

3 
	~"u£r.h
"

6 
	$maö
(
¨gc
, *
¨gv
[])

8 
i
;

10 if(
¨gc
 < 2){

11 
	`¥ötf
(2, "Usage: mkdir files...\n");

12 
	`exô
();

15 
i
 = 1; i < 
¨gc
; i++){

16 if(
	`mkdú
(
¨gv
[
i
]) < 0){

17 
	`¥ötf
(2, "mkdú: %†ÁûedÅÿ¸óã\n", 
¨gv
[
i
]);

22 
	`exô
();

23 
	}
}

	@mkfs.c

1 
	~<°dio.h
>

2 
	~<uni°d.h
>

3 
	~<°dlib.h
>

4 
	~<°rög.h
>

5 
	~<f˙é.h
>

6 
	~<as£π.h
>

8 
	#°©
 
xv6_°©


9 
	~"ty≥s.h
"

	)

10 
	~"fs.h
"

11 
	~"°©.h
"

12 
	~"∑øm.h
"

14 #i‚de‡
°©ic_as£π


15 
	#°©ic_as£π
(
a
, 
b
Ëdÿ{ 0Ë0: ◊): ; } 0)

	)

18 
	#NINODES
 200

	)

23 
	gnbôm≠
 = 
FSSIZE
/(
BSIZE
*8) + 1;

24 
	gnöodeblocks
 = 
NINODES
 / 
IPB
 + 1;

25 
	g∆og
 = 
LOGSIZE
;

26 
	gnmëa
;

27 
	gnblocks
;

29 
	gfsfd
;

30 
su≥rblock
 
	gsb
;

31 
	gzî€s
[
BSIZE
];

32 
uöt
 
	g‰ìöode
 = 1;

33 
uöt
 
	g‰ìblock
;

36 
bÆloc
();

37 
w£˘
(
uöt
, *);

38 
wöode
(
uöt
, 
döode
*);

39 
röode
(
uöt
 
öum
, 
döode
 *
ù
);

40 
r£˘
(
uöt
 
£c
, *
buf
);

41 
uöt
 
üŒoc
(
ush‹t
 
ty≥
);

42 
üµíd
(
uöt
 
öum
, *
p
, 
n
);

45 
ush‹t


46 
	$xsh‹t
(
ush‹t
 
x
)

48 
ush‹t
 
y
;

49 
uch¨
 *
a
 = (uch¨*)&
y
;

50 
a
[0] = 
x
;

51 
a
[1] = 
x
 >> 8;

52  
y
;

53 
	}
}

55 
uöt


56 
	$xöt
(
uöt
 
x
)

58 
uöt
 
y
;

59 
uch¨
 *
a
 = (uch¨*)&
y
;

60 
a
[0] = 
x
;

61 
a
[1] = 
x
 >> 8;

62 
a
[2] = 
x
 >> 16;

63 
a
[3] = 
x
 >> 24;

64  
y
;

65 
	}
}

68 
	$maö
(
¨gc
, *
¨gv
[])

70 
i
, 
cc
, 
fd
;

71 
uöt
 
roŸöo
, 
öum
, 
off
;

72 
dúít
 
de
;

73 
buf
[
BSIZE
];

74 
döode
 
dö
;

77 
	`°©ic_as£π
(() == 4, "Integers must be 4 bytes!");

79 if(
¨gc
 < 2){

80 
	`Ârötf
(
°dîr
, "Usage: mkfs fs.img files...\n");

81 
	`exô
(1);

84 
	`as£π
((
BSIZE
 % (
döode
)) == 0);

85 
	`as£π
((
BSIZE
 % (
dúít
)) == 0);

87 
fsfd
 = 
	`›í
(
¨gv
[1], 
O_RDWR
|
O_CREAT
|
O_TRUNC
, 0666);

88 if(
fsfd
 < 0){

89 
	`≥º‹
(
¨gv
[1]);

90 
	`exô
(1);

94 
nmëa
 = 2 + 
∆og
 + 
nöodeblocks
 + 
nbôm≠
;

95 
nblocks
 = 
FSSIZE
 - 
nmëa
;

97 
sb
.
size
 = 
	`xöt
(
FSSIZE
);

98 
sb
.
nblocks
 = 
	`xöt
(nblocks);

99 
sb
.
nöodes
 = 
	`xöt
(
NINODES
);

100 
sb
.
∆og
 = 
	`xöt
(nlog);

101 
sb
.
log°¨t
 = 
	`xöt
(2);

102 
sb
.
öode°¨t
 = 
	`xöt
(2+
∆og
);

103 
sb
.
bm≠°¨t
 = 
	`xöt
(2+
∆og
+
nöodeblocks
);

105 
	`¥ötf
("nmeta %d (boot, super,Üog blocks %u inode blocks %u, bitmap blocks %u) blocks %dÅotal %d\n",

106 
nmëa
, 
∆og
, 
nöodeblocks
, 
nbôm≠
, 
nblocks
, 
FSSIZE
);

108 
‰ìblock
 = 
nmëa
;

110 
i
 = 0; i < 
FSSIZE
; i++)

111 
	`w£˘
(
i
, 
zî€s
);

113 
	`mem£t
(
buf
, 0, (buf));

114 
	`memmove
(
buf
, &
sb
, (sb));

115 
	`w£˘
(1, 
buf
);

117 
roŸöo
 = 
	`üŒoc
(
T_DIR
);

118 
	`as£π
(
roŸöo
 =
ROOTINO
);

120 
	`bzîo
(&
de
, (de));

121 
de
.
öum
 = 
	`xsh‹t
(
roŸöo
);

122 
	`°r˝y
(
de
.
«me
, ".");

123 
	`üµíd
(
roŸöo
, &
de
, (de));

125 
	`bzîo
(&
de
, (de));

126 
de
.
öum
 = 
	`xsh‹t
(
roŸöo
);

127 
	`°r˝y
(
de
.
«me
, "..");

128 
	`üµíd
(
roŸöo
, &
de
, (de));

130 
i
 = 2; i < 
¨gc
; i++){

131 
	`as£π
(
	`ödex
(
¨gv
[
i
], '/') == 0);

133 if((
fd
 = 
	`›í
(
¨gv
[
i
], 0)) < 0){

134 
	`≥º‹
(
¨gv
[
i
]);

135 
	`exô
(1);

142 if(
¨gv
[
i
][0] == '_')

143 ++
¨gv
[
i
];

145 
öum
 = 
	`üŒoc
(
T_FILE
);

147 
	`bzîo
(&
de
, (de));

148 
de
.
öum
 = 
	`xsh‹t
(inum);

149 
	`°∫˝y
(
de
.
«me
, 
¨gv
[
i
], 
DIRSIZ
);

150 
	`üµíd
(
roŸöo
, &
de
, (de));

152 (
cc
 = 
	`ªad
(
fd
, 
buf
, (buf))) > 0)

153 
	`üµíd
(
öum
, 
buf
, 
cc
);

155 
	`˛o£
(
fd
);

159 
	`röode
(
roŸöo
, &
dö
);

160 
off
 = 
	`xöt
(
dö
.
size
);

161 
off
 = ((off/
BSIZE
) + 1) * BSIZE;

162 
dö
.
size
 = 
	`xöt
(
off
);

163 
	`wöode
(
roŸöo
, &
dö
);

165 
	`bÆloc
(
‰ìblock
);

167 
	`exô
(0);

168 
	}
}

171 
	$w£˘
(
uöt
 
£c
, *
buf
)

173 if(
	`l£ek
(
fsfd
, 
£c
 * 
BSIZE
, 0) != sec * BSIZE){

174 
	`≥º‹
("lseek");

175 
	`exô
(1);

177 if(
	`wrôe
(
fsfd
, 
buf
, 
BSIZE
) != BSIZE){

178 
	`≥º‹
("write");

179 
	`exô
(1);

181 
	}
}

184 
	$wöode
(
uöt
 
öum
, 
döode
 *
ù
)

186 
buf
[
BSIZE
];

187 
uöt
 
bn
;

188 
döode
 *
dù
;

190 
bn
 = 
	`IBLOCK
(
öum
, 
sb
);

191 
	`r£˘
(
bn
, 
buf
);

192 
dù
 = ((
döode
*)
buf
Ë+ (
öum
 % 
IPB
);

193 *
dù
 = *
ù
;

194 
	`w£˘
(
bn
, 
buf
);

195 
	}
}

198 
	$röode
(
uöt
 
öum
, 
döode
 *
ù
)

200 
buf
[
BSIZE
];

201 
uöt
 
bn
;

202 
döode
 *
dù
;

204 
bn
 = 
	`IBLOCK
(
öum
, 
sb
);

205 
	`r£˘
(
bn
, 
buf
);

206 
dù
 = ((
döode
*)
buf
Ë+ (
öum
 % 
IPB
);

207 *
ù
 = *
dù
;

208 
	}
}

211 
	$r£˘
(
uöt
 
£c
, *
buf
)

213 if(
	`l£ek
(
fsfd
, 
£c
 * 
BSIZE
, 0) != sec * BSIZE){

214 
	`≥º‹
("lseek");

215 
	`exô
(1);

217 if(
	`ªad
(
fsfd
, 
buf
, 
BSIZE
) != BSIZE){

218 
	`≥º‹
("read");

219 
	`exô
(1);

221 
	}
}

223 
uöt


224 
	$üŒoc
(
ush‹t
 
ty≥
)

226 
uöt
 
öum
 = 
‰ìöode
++;

227 
döode
 
dö
;

229 
	`bzîo
(&
dö
, (din));

230 
dö
.
ty≥
 = 
	`xsh‹t
(type);

231 
dö
.
∆ök
 = 
	`xsh‹t
(1);

232 
dö
.
size
 = 
	`xöt
(0);

233 
	`wöode
(
öum
, &
dö
);

234  
öum
;

235 
	}
}

238 
	$bÆloc
(
u£d
)

240 
uch¨
 
buf
[
BSIZE
];

241 
i
;

243 
	`¥ötf
("bÆloc: fú° %d block†havêbì¿Æloˇãd\n", 
u£d
);

244 
	`as£π
(
u£d
 < 
BSIZE
*8);

245 
	`bzîo
(
buf
, 
BSIZE
);

246 
i
 = 0; i < 
u£d
; i++){

247 
buf
[
i
/8] = buf[i/8] | (0x1 << (i%8));

249 
	`¥ötf
("bÆloc: wrôêbôm≠ blockáà£˘‹ %d\n", 
sb
.
bm≠°¨t
);

250 
	`w£˘
(
sb
.
bm≠°¨t
, 
buf
);

251 
	}
}

253 
	#mö
(
a
, 
b
Ë(◊Ë< (bË? (aË: (b))

	)

256 
	$üµíd
(
uöt
 
öum
, *
xp
, 
n
)

258 *
p
 = (*)
xp
;

259 
uöt
 
fbn
, 
off
, 
n1
;

260 
döode
 
dö
;

261 
buf
[
BSIZE
];

262 
uöt
 
ödúe˘
[
NINDIRECT
];

263 
uöt
 
x
;

265 
	`röode
(
öum
, &
dö
);

266 
off
 = 
	`xöt
(
dö
.
size
);

268 
n
 > 0){

269 
fbn
 = 
off
 / 
BSIZE
;

270 
	`as£π
(
fbn
 < 
MAXFILE
);

271 if(
fbn
 < 
NDIRECT
){

272 if(
	`xöt
(
dö
.
addrs
[
fbn
]) == 0){

273 
dö
.
addrs
[
fbn
] = 
	`xöt
(
‰ìblock
++);

275 
x
 = 
	`xöt
(
dö
.
addrs
[
fbn
]);

277 if(
	`xöt
(
dö
.
addrs
[
NDIRECT
]) == 0){

278 
dö
.
addrs
[
NDIRECT
] = 
	`xöt
(
‰ìblock
++);

280 
	`r£˘
(
	`xöt
(
dö
.
addrs
[
NDIRECT
]), (*)
ödúe˘
);

281 if(
ödúe˘
[
fbn
 - 
NDIRECT
] == 0){

282 
ödúe˘
[
fbn
 - 
NDIRECT
] = 
	`xöt
(
‰ìblock
++);

283 
	`w£˘
(
	`xöt
(
dö
.
addrs
[
NDIRECT
]), (*)
ödúe˘
);

285 
x
 = 
	`xöt
(
ödúe˘
[
fbn
-
NDIRECT
]);

287 
n1
 = 
	`mö
(
n
, (
fbn
 + 1Ë* 
BSIZE
 - 
off
);

288 
	`r£˘
(
x
, 
buf
);

289 
	`bc›y
(
p
, 
buf
 + 
off
 - (
fbn
 * 
BSIZE
), 
n1
);

290 
	`w£˘
(
x
, 
buf
);

291 
n
 -
n1
;

292 
off
 +
n1
;

293 
p
 +
n1
;

295 
dö
.
size
 = 
	`xöt
(
off
);

296 
	`wöode
(
öum
, &
dö
);

297 
	}
}

	@mmu.h

5 
	#FL_CF
 0x00000001

6 
	#FL_PF
 0x00000004

7 
	#FL_AF
 0x00000010

8 
	#FL_ZF
 0x00000040

9 
	#FL_SF
 0x00000080

10 
	#FL_TF
 0x00000100

11 
	#FL_IF
 0x00000200

12 
	#FL_DF
 0x00000400

13 
	#FL_OF
 0x00000800

14 
	#FL_IOPL_MASK
 0x00003000

15 
	#FL_IOPL_0
 0x00000000

16 
	#FL_IOPL_1
 0x00001000

17 
	#FL_IOPL_2
 0x00002000

18 
	#FL_IOPL_3
 0x00003000

19 
	#FL_NT
 0x00004000

20 
	#FL_RF
 0x00010000

21 
	#FL_VM
 0x00020000

22 
	#FL_AC
 0x00040000

23 
	#FL_VIF
 0x00080000

24 
	#FL_VIP
 0x00100000

25 
	#FL_ID
 0x00200000

26 

	)

28 
	#CR0_PE
 0x00000001

29 
	#CR0_MP
 0x00000002

30 
	#CR0_EM
 0x00000004

31 
	#CR0_TS
 0x00000008

32 
	#CR0_ET
 0x00000010

33 
	#CR0_NE
 0x00000020

34 
	#CR0_WP
 0x00010000

35 
	#CR0_AM
 0x00040000

36 
	#CR0_NW
 0x20000000

37 
	#CR0_CD
 0x40000000

38 
	#CR0_PG
 0x80000000

39 

	)

40 
	#CR4_PSE
 0x00000010

41 

	)

43 
	#SEG_KCODE
 1

44 
	#SEG_KDATA
 2

45 
	#SEG_UCODE
 3

46 
	#SEG_UDATA
 4

47 
	#SEG_TSS
 5

48 

	)

50 
	#NSEGS
 6

	)

52 #i‚de‡
__ASSEMBLER__


54 
	s£gdesc
 {

55 
uöt
 
	mlim_15_0
 : 16;

56 
uöt
 
	mba£_15_0
 : 16;

57 
uöt
 
	mba£_23_16
 : 8;

58 
uöt
 
	mty≥
 : 4;

59 
uöt
 
	ms
 : 1;

60 
uöt
 
	md∂
 : 2;

61 
uöt
 
	mp
 : 1;

62 
uöt
 
	mlim_19_16
 : 4;

63 
uöt
 
	mavl
 : 1;

64 
uöt
 
	mrsv1
 : 1;

65 
uöt
 
	mdb
 : 1;

66 
uöt
 
	mg
 : 1;

67 
uöt
 
	mba£_31_24
 : 8;

71 
	#SEG
(
ty≥
, 
ba£
, 
lim
, 
d∂
Ë(
£gdesc
) \

72 { ((
lim
Ë>> 12Ë& 0xffff, (
uöt
)(
ba£
) & 0xffff, \

73 ((
uöt
)(
ba£
Ë>> 16Ë& 0xff, 
ty≥
, 1, 
d∂
, 1, \

74 (
uöt
)(
lim
Ë>> 28, 0, 0, 1, 1, (uöt)(
ba£
Ë>> 24 }

	)

75 
	#SEG16
(
ty≥
, 
ba£
, 
lim
, 
d∂
Ë(
£gdesc
) \

76 { (
lim
Ë& 0xffff, (
uöt
)(
ba£
) & 0xffff, \

77 ((
uöt
)(
ba£
Ë>> 16Ë& 0xff, 
ty≥
, 1, 
d∂
, 1, \

78 (
uöt
)(
lim
Ë>> 16, 0, 0, 1, 0, (uöt)(
ba£
Ë>> 24 }

	)

81 
	#DPL_USER
 0x3

82 

	)

84 
	#STA_X
 0x8

85 
	#STA_E
 0x4

86 
	#STA_C
 0x4

87 
	#STA_W
 0x2

88 
	#STA_R
 0x2

89 
	#STA_A
 0x1

90 

	)

92 
	#STS_T16A
 0x1

93 
	#STS_LDT
 0x2

94 
	#STS_T16B
 0x3

95 
	#STS_CG16
 0x4

96 
	#STS_TG
 0x5

97 
	#STS_IG16
 0x6

98 
	#STS_TG16
 0x7

99 
	#STS_T32A
 0x9

100 
	#STS_T32B
 0xB

101 
	#STS_CG32
 0xC

102 
	#STS_IG32
 0xE

103 
	#STS_TG32
 0xF

104 

	)

114 
	#PDX
(
va
Ë(((
uöt
)(vaË>> 
PDXSHIFT
Ë& 0x3FF)

	)

117 
	#PTX
(
va
Ë(((
uöt
)(vaË>> 
PTXSHIFT
Ë& 0x3FF)

	)

120 
	#PGADDR
(
d
, 
t
, 
o
Ë((
uöt
)((dË<< 
PDXSHIFT
 | (tË<< 
PTXSHIFT
 | (o)))

	)

123 
	#NPDENTRIES
 1024

124 
	#NPTENTRIES
 1024

125 
	#PGSIZE
 4096

126 

	)

127 
	#PGSHIFT
 12

128 
	#PTXSHIFT
 12

129 
	#PDXSHIFT
 22

130 

	)

131 
	#PGROUNDUP
(
sz
Ë(((sz)+
PGSIZE
-1Ë& ~(PGSIZE-1))

	)

132 
	#PGROUNDDOWN
(
a
Ë((◊)Ë& ~(
PGSIZE
-1))

	)

135 
	#PTE_P
 0x001

136 
	#PTE_W
 0x002

137 
	#PTE_U
 0x004

138 
	#PTE_PWT
 0x008

139 
	#PTE_PCD
 0x010

140 
	#PTE_A
 0x020

141 
	#PTE_D
 0x040

142 
	#PTE_PS
 0x080

143 
	#PTE_MBZ
 0x180

144 

	)

146 
	#PTE_ADDR
(
±e
Ë((
uöt
)’ãË& ~0xFFF)

	)

147 
	#PTE_FLAGS
(
±e
Ë((
uöt
)’ãË& 0xFFF)

	)

149 #i‚de‡
__ASSEMBLER__


150 
uöt
 
	t±e_t
;

153 
	sèsk°©e
 {

154 
uöt
 
	mlök
;

155 
uöt
 
	me•0
;

156 
ush‹t
 
	mss0
;

157 
ush‹t
 
	m∑ddög1
;

158 
uöt
 *
	me•1
;

159 
ush‹t
 
	mss1
;

160 
ush‹t
 
	m∑ddög2
;

161 
uöt
 *
	me•2
;

162 
ush‹t
 
	mss2
;

163 
ush‹t
 
	m∑ddög3
;

164 *
	m¸3
;

165 
uöt
 *
	meù
;

166 
uöt
 
	meÊags
;

167 
uöt
 
	móx
;

168 
uöt
 
	mecx
;

169 
uöt
 
	medx
;

170 
uöt
 
	mebx
;

171 
uöt
 *
	me•
;

172 
uöt
 *
	mebp
;

173 
uöt
 
	mesi
;

174 
uöt
 
	medi
;

175 
ush‹t
 
	mes
;

176 
ush‹t
 
	m∑ddög4
;

177 
ush‹t
 
	mcs
;

178 
ush‹t
 
	m∑ddög5
;

179 
ush‹t
 
	mss
;

180 
ush‹t
 
	m∑ddög6
;

181 
ush‹t
 
	mds
;

182 
ush‹t
 
	m∑ddög7
;

183 
ush‹t
 
	mfs
;

184 
ush‹t
 
	m∑ddög8
;

185 
ush‹t
 
	mgs
;

186 
ush‹t
 
	m∑ddög9
;

187 
ush‹t
 
	mldt
;

188 
ush‹t
 
	m∑ddög10
;

189 
ush‹t
 
	mt
;

190 
ush‹t
 
	miomb
;

195 
	sg©edesc
 {

196 
uöt
 
	moff_15_0
 : 16;

197 
uöt
 
	mcs
 : 16;

198 
uöt
 
	m¨gs
 : 5;

199 
uöt
 
	mrsv1
 : 3;

200 
uöt
 
	mty≥
 : 4;

201 
uöt
 
	ms
 : 1;

202 
uöt
 
	md∂
 : 2;

203 
uöt
 
	mp
 : 1;

204 
uöt
 
	moff_31_16
 : 16;

215 
	#SETGATE
(
g©e
, 
i°øp
, 
£l
, 
off
, 
d
) \

217 (
g©e
).
off_15_0
 = (
uöt
)(
off
) & 0xffff; \

218 (
g©e
).
cs
 = (
£l
); \

219 (
g©e
).
¨gs
 = 0; \

220 (
g©e
).
rsv1
 = 0; \

221 (
g©e
).
ty≥
 = (
i°øp
Ë? 
STS_TG32
 : 
STS_IG32
; \

222 (
g©e
).
s
 = 0; \

223 (
g©e
).
d∂
 = (
d
); \

224 (
g©e
).
p
 = 1; \

225 (
g©e
).
off_31_16
 = (
uöt
)(
off
) >> 16; \

226 }

	)

	@mp.c

5 
	~"ty≥s.h
"

6 
	~"defs.h
"

7 
	~"∑øm.h
"

8 
	~"memœyout.h
"

9 
	~"mp.h
"

10 
	~"x86.h
"

11 
	~"mmu.h
"

12 
	~"¥oc.h
"

14 
˝u
 
	g˝us
[
NCPU
];

15 
	gn˝u
;

16 
uch¨
 
	giﬂpicid
;

18 
uch¨


19 
	$sum
(
uch¨
 *
addr
, 
Àn
)

21 
i
, 
sum
;

23 
sum
 = 0;

24 
i
=0; i<
Àn
; i++)

25 
sum
 +
addr
[
i
];

26  
sum
;

27 
	}
}

30 
mp
*

31 
	$mp£¨ch1
(
uöt
 
a
, 
Àn
)

33 
uch¨
 *
e
, *
p
, *
addr
;

35 
addr
 = 
	`P2V
(
a
);

36 
e
 = 
addr
+
Àn
;

37 
p
 = 
addr
;Ö < 
e
;Ö +(
mp
))

38 if(
	`memcmp
(
p
, "_MP_", 4Ë=0 && 
	`sum
’, (
mp
)) == 0)

39  (
mp
*)
p
;

41 
	}
}

48 
mp
*

49 
	$mp£¨ch
()

51 
uch¨
 *
bda
;

52 
uöt
 
p
;

53 
mp
 *mp;

55 
bda
 = (
uch¨
 *Ë
	`P2V
(0x400);

56 if((
p
 = ((
bda
[0x0F]<<8)| bda[0x0E]) << 4)){

57 if((
mp
 = 
	`mp£¨ch1
(
p
, 1024)))

58  
mp
;

60 
p
 = ((
bda
[0x14]<<8)|bda[0x13])*1024;

61 if((
mp
 = 
	`mp£¨ch1
(
p
-1024, 1024)))

62  
mp
;

64  
	`mp£¨ch1
(0xF0000, 0x10000);

65 
	}
}

72 
mpc⁄f
*

73 
	$mpc⁄fig
(
mp
 **
pmp
)

75 
mpc⁄f
 *
c⁄f
;

76 
mp
 *mp;

78 if((
mp
 = 
	`mp£¨ch
()Ë=0 || mp->
phyßddr
 == 0)

80 
c⁄f
 = (
mpc⁄f
*Ë
	`P2V
((
uöt
Ë
mp
->
phyßddr
);

81 if(
	`memcmp
(
c⁄f
, "PCMP", 4) != 0)

83 if(
c⁄f
->
vîsi⁄
 != 1 && conf->version != 4)

85 if(
	`sum
((
uch¨
*)
c⁄f
, c⁄f->
Àngth
) != 0)

87 *
pmp
 = 
mp
;

88  
c⁄f
;

89 
	}
}

92 
	$mpöô
()

94 
uch¨
 *
p
, *
e
;

95 
ismp
;

96 
mp
 *mp;

97 
mpc⁄f
 *
c⁄f
;

98 
mµroc
 *
¥oc
;

99 
mpiﬂpic
 *
iﬂpic
;

101 if((
c⁄f
 = 
	`mpc⁄fig
(&
mp
)) == 0)

102 
	`∑nic
("ExpectÅoÑun onán SMP");

103 
ismp
 = 1;

104 
œpic
 = (
uöt
*)
c⁄f
->
œpiˇddr
;

105 
p
=(
uch¨
*)(
c⁄f
+1), 
e
=(uch¨*)c⁄f+c⁄f->
Àngth
;Ö<e; ){

106 *
p
){

107 
MPPROC
:

108 
¥oc
 = (
mµroc
*)
p
;

109 if(
n˝u
 < 
NCPU
) {

110 
˝us
[
n˝u
].
≠icid
 = 
¥oc
->apicid;

111 
n˝u
++;

113 
p
 +(
mµroc
);

115 
MPIOAPIC
:

116 
iﬂpic
 = (
mpiﬂpic
*)
p
;

117 
iﬂpicid
 = 
iﬂpic
->
≠i˙o
;

118 
p
 +(
mpiﬂpic
);

120 
MPBUS
:

121 
MPIOINTR
:

122 
MPLINTR
:

123 
p
 += 8;

126 
ismp
 = 0;

130 if(!
ismp
)

131 
	`∑nic
("Didn't findá suitable machine");

133 if(
mp
->
im¸p
){

136 
	`outb
(0x22, 0x70);

137 
	`outb
(0x23, 
	`öb
(0x23) | 1);

139 
	}
}

	@mp.h

3 
	smp
 {

4 
uch¨
 
	msig«tuª
[4];

5 *
	mphyßddr
;

6 
uch¨
 
	mÀngth
;

7 
uch¨
 
	m•e¸ev
;

8 
uch¨
 
	mchecksum
;

9 
uch¨
 
	mty≥
;

10 
uch¨
 
	mim¸p
;

11 
uch¨
 
	mª£rved
[3];

14 
	smpc⁄f
 {

15 
uch¨
 
	msig«tuª
[4];

16 
ush‹t
 
	mÀngth
;

17 
uch¨
 
	mvîsi⁄
;

18 
uch¨
 
	mchecksum
;

19 
uch¨
 
	m¥odu˘
[20];

20 
uöt
 *
	m€mèbÀ
;

21 
ush‹t
 
	m€mÀngth
;

22 
ush‹t
 
	míåy
;

23 
uöt
 *
	mœpiˇddr
;

24 
ush‹t
 
	mxÀngth
;

25 
uch¨
 
	mxchecksum
;

26 
uch¨
 
	mª£rved
;

29 
	smµroc
 {

30 
uch¨
 
	mty≥
;

31 
uch¨
 
	m≠icid
;

32 
uch¨
 
	mvîsi⁄
;

33 
uch¨
 
	mÊags
;

34 
	#MPBOOT
 0x02

35 
uch¨
 
sig«tuª
[4];

36 
uöt
 
„©uª
;

37 
uch¨
 
ª£rved
[8];

	)

40 
	smpiﬂpic
 {

41 
uch¨
 
	mty≥
;

42 
uch¨
 
	m≠i˙o
;

43 
uch¨
 
	mvîsi⁄
;

44 
uch¨
 
	mÊags
;

45 
uöt
 *
	maddr
;

49 
	#MPPROC
 0x00

50 
	#MPBUS
 0x01

51 
	#MPIOAPIC
 0x02

52 
	#MPIOINTR
 0x03

53 
	#MPLINTR
 0x04

54 

	)

	@param.h

1 
	#NPROC
 64

2 
	#KSTACKSIZE
 4096

3 
	#NCPU
 8

4 
	#NOFILE
 16

5 
	#NFILE
 100

6 
	#NINODE
 50

7 
	#NDEV
 10

8 
	#ROOTDEV
 1

9 
	#MAXARG
 32

10 
	#MAXOPBLOCKS
 10

11 
	#LOGSIZE
 (
MAXOPBLOCKS
*3)

12 
	#NBUF
 (
MAXOPBLOCKS
*3)

13 
	#FSSIZE
 40000

14 
	#STRIDENUM
 100

	@picirq.c

1 
	~"ty≥s.h
"

2 
	~"x86.h
"

3 
	~"å≠s.h
"

6 
	#IO_PIC1
 0x20

7 
	#IO_PIC2
 0xA0

8 

	)

11 
	$picöô
()

14 
	`outb
(
IO_PIC1
+1, 0xFF);

15 
	`outb
(
IO_PIC2
+1, 0xFF);

16 
	}
}

	@pipe.c

1 
	~"ty≥s.h
"

2 
	~"defs.h
"

3 
	~"∑øm.h
"

4 
	~"mmu.h
"

5 
	~"¥oc.h
"

6 
	~"fs.h
"

7 
	~"•ölock.h
"

8 
	~"¶ì∂ock.h
"

9 
	~"fûe.h
"

11 
	#PIPESIZE
 512

	)

13 
	spùe
 {

14 
•ölock
 
	mlock
;

15 
	md©a
[
PIPESIZE
];

16 
uöt
 
	mƒód
;

17 
uöt
 
	mnwrôe
;

18 
	mªad›í
;

19 
	mwrôe›í
;

23 
	$pùóŒoc
(
fûe
 **
f0
, fûê**
f1
)

25 
pùe
 *
p
;

27 
p
 = 0;

28 *
f0
 = *
f1
 = 0;

29 if((*
f0
 = 
	`fûóŒoc
()Ë=0 || (*
f1
 = filealloc()) == 0)

30 
bad
;

31 if((
p
 = (
pùe
*)
	`kÆloc
()) == 0)

32 
bad
;

33 
p
->
ªad›í
 = 1;

34 
p
->
wrôe›í
 = 1;

35 
p
->
nwrôe
 = 0;

36 
p
->
ƒód
 = 0;

37 
	`öôlock
(&
p
->
lock
, "pipe");

38 (*
f0
)->
ty≥
 = 
FD_PIPE
;

39 (*
f0
)->
ªadabÀ
 = 1;

40 (*
f0
)->
wrôabÀ
 = 0;

41 (*
f0
)->
pùe
 = 
p
;

42 (*
f1
)->
ty≥
 = 
FD_PIPE
;

43 (*
f1
)->
ªadabÀ
 = 0;

44 (*
f1
)->
wrôabÀ
 = 1;

45 (*
f1
)->
pùe
 = 
p
;

49 
bad
:

50 if(
p
)

51 
	`k‰ì
((*)
p
);

52 if(*
f0
)

53 
	`fûe˛o£
(*
f0
);

54 if(*
f1
)

55 
	`fûe˛o£
(*
f1
);

57 
	}
}

60 
	$pùe˛o£
(
pùe
 *
p
, 
wrôabÀ
)

62 
	`acquúe
(&
p
->
lock
);

63 if(
wrôabÀ
){

64 
p
->
wrôe›í
 = 0;

65 
	`wakeup
(&
p
->
ƒód
);

67 
p
->
ªad›í
 = 0;

68 
	`wakeup
(&
p
->
nwrôe
);

70 if(
p
->
ªad›í
 =0 &&Ö->
wrôe›í
 == 0){

71 
	`ªÀa£
(&
p
->
lock
);

72 
	`k‰ì
((*)
p
);

74 
	`ªÀa£
(&
p
->
lock
);

75 
	}
}

79 
	$pùewrôe
(
pùe
 *
p
, *
addr
, 
n
)

81 
i
;

83 
	`acquúe
(&
p
->
lock
);

84 
i
 = 0; i < 
n
; i++){

85 
p
->
nwrôe
 =p->
ƒód
 + 
PIPESIZE
){

86 if(
p
->
ªad›í
 =0 || 
	`my¥oc
()->
kûÀd
){

87 
	`ªÀa£
(&
p
->
lock
);

90 
	`wakeup
(&
p
->
ƒód
);

91 
	`¶ìp
(&
p
->
nwrôe
, &p->
lock
);

93 
p
->
d©a
[p->
nwrôe
++ % 
PIPESIZE
] = 
addr
[
i
];

95 
	`wakeup
(&
p
->
ƒód
);

96 
	`ªÀa£
(&
p
->
lock
);

97  
n
;

98 
	}
}

101 
	$pùîód
(
pùe
 *
p
, *
addr
, 
n
)

103 
i
;

105 
	`acquúe
(&
p
->
lock
);

106 
p
->
ƒód
 =p->
nwrôe
 &&Ö->
wrôe›í
){

107 if(
	`my¥oc
()->
kûÀd
){

108 
	`ªÀa£
(&
p
->
lock
);

111 
	`¶ìp
(&
p
->
ƒód
, &p->
lock
);

113 
i
 = 0; i < 
n
; i++){

114 if(
p
->
ƒód
 =p->
nwrôe
)

116 
addr
[
i
] = 
p
->
d©a
[p->
ƒód
++ % 
PIPESIZE
];

118 
	`wakeup
(&
p
->
nwrôe
);

119 
	`ªÀa£
(&
p
->
lock
);

120  
i
;

121 
	}
}

	@printf.c

1 
	~"ty≥s.h
"

2 
	~"°©.h
"

3 
	~"u£r.h
"

6 
	$putc
(
fd
, 
c
)

8 
	`wrôe
(
fd
, &
c
, 1);

9 
	}
}

12 
	$¥ötöt
(
fd
, 
xx
, 
ba£
, 
sgn
)

14 
digôs
[] = "0123456789ABCDEF";

15 
buf
[16];

16 
i
, 
√g
;

17 
uöt
 
x
;

19 
√g
 = 0;

20 if(
sgn
 && 
xx
 < 0){

21 
√g
 = 1;

22 
x
 = -
xx
;

24 
x
 = 
xx
;

27 
i
 = 0;

29 
buf
[
i
++] = 
digôs
[
x
 % 
ba£
];

30 }(
x
 /
ba£
) != 0);

31 if(
√g
)

32 
buf
[
i
++] = '-';

34 --
i
 >= 0)

35 
	`putc
(
fd
, 
buf
[
i
]);

36 
	}
}

40 
	$¥ötf
(
fd
, *
fmt
, ...)

42 *
s
;

43 
c
, 
i
, 
°©e
;

44 
uöt
 *
≠
;

46 
°©e
 = 0;

47 
≠
 = (
uöt
*)(*)&
fmt
 + 1;

48 
i
 = 0; 
fmt
[i]; i++){

49 
c
 = 
fmt
[
i
] & 0xff;

50 if(
°©e
 == 0){

51 if(
c
 == '%'){

52 
°©e
 = '%';

54 
	`putc
(
fd
, 
c
);

56 } if(
°©e
 == '%'){

57 if(
c
 == 'd'){

58 
	`¥ötöt
(
fd
, *
≠
, 10, 1);

59 
≠
++;

60 } if(
c
 == 'x' || c == 'p'){

61 
	`¥ötöt
(
fd
, *
≠
, 16, 0);

62 
≠
++;

63 } if(
c
 == 's'){

64 
s
 = (*)*
≠
;

65 
≠
++;

66 if(
s
 == 0)

67 
s
 = "(null)";

68 *
s
 != 0){

69 
	`putc
(
fd
, *
s
);

70 
s
++;

72 } if(
c
 == 'c'){

73 
	`putc
(
fd
, *
≠
);

74 
≠
++;

75 } if(
c
 == '%'){

76 
	`putc
(
fd
, 
c
);

79 
	`putc
(
fd
, '%');

80 
	`putc
(
fd
, 
c
);

82 
°©e
 = 0;

85 
	}
}

	@proc.c

1 
	~"ty≥s.h
"

2 
	~"defs.h
"

3 
	~"∑øm.h
"

4 
	~"memœyout.h
"

5 
	~"mmu.h
"

6 
	~"x86.h
"

7 
	~"¥oc.h
"

8 
	~"•ölock.h
"

10 
	gMLFQPassVÆ
;

11 
	gMLFQSåideVÆ
;

13 
	gcheckpoöt
;

14 
	gÀvtu∫
;

17 
•ölock
 
	mlock
;

18 
¥oc
 
	m¥oc
[
NPROC
];

19 } 
	g±abÀ
;

22 
•ölock
 
	mlock
;

23 
tid
 
	mtid
[
NPROC
];

24 } 
	gâabÀ
;

26 
¥oc
 *
	göô¥oc
;

28 
	g√xçid
 = 1;

29 
	g√xâid
 = 0;

30 
f‹kªt
();

31 
å≠ªt
();

33 
wakeup1
(*
ch™
);

36 
	$pöô
()

38 
	`öôlock
(&
±abÀ
.
lock
, "ptable");

39 
	}
}

43 
	$˝uid
() {

44  
	`my˝u
()-
˝us
;

45 
	}
}

49 
˝u
*

50 
	$my˝u
()

52 
≠icid
, 
i
;

54 if(
	`ªadeÊags
()&
FL_IF
)

55 
	`∑nic
("mycpu called with interruptsÉnabled\n");

57 
≠icid
 = 
	`œpicid
();

60 
i
 = 0; i < 
n˝u
; ++i) {

61 i‡(
˝us
[
i
].
≠icid
 ==ápicid)

62  &
˝us
[
i
];

64 
	`∑nic
("unknownápicid\n");

65 
	}
}

69 
¥oc
*

70 
	$my¥oc
() {

71 
˝u
 *
c
;

72 
¥oc
 *
p
;

73 
	`push˛i
();

74 
c
 = 
	`my˝u
();

75 
p
 = 
c
->
¥oc
;

76 
	`p›˛i
();

77  
p
;

78 
	}
}

85 
¥oc
*

86 
	$Ælo˝roc
()

88 
¥oc
 *
p
;

89 
tid
 *
t
;

90 
ödex
;

91 *
•
;

93 
	`acquúe
(&
±abÀ
.
lock
);

95 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Ö++)

96 if(
p
->
°©e
 =
UNUSED
)

97 
found
;

99 
	`ªÀa£
(&
±abÀ
.
lock
);

102 
found
:

103 
p
->
°©e
 = 
EMBRYO
;

104 
p
->
pid
 = 
√xçid
++;

107 
p
->
isMLFQ
 = 1;

108 
p
->
±icks
 = 0;

109 
p
->
±ŸÆticks
 = 0;

110 
p
->
¥i‹ôy
 = 0;

112 
p
->
sh¨e
 = 0;

113 
p
->
°ride
 = 0;

114 
p
->
∑ss
 = 0;

116 
p
->
isThªad
 = 0;

117 
p
->
tid
 = 0;

121 
	`acquúe
(&
âabÀ
.
lock
);

122 
ödex
 = 0, 
t
 = 
âabÀ
.
tid
;Å < &âabÀ.tid[
NPROC
];Å++, index++)

123 if(
t
->
°©e
 =
UNUSED
)

126 
p
->
tid
 = 
t
->
ödex
 = index;

127 
t
->
°©e
 = 
EMBRYO
;

130 
	`ªÀa£
(&
âabÀ
.
lock
);

131 
p
->
isMaöThªad
 = 1;

132 
p
->
˙tThªad
 = 1;

133 
	`ªÀa£
(&
±abÀ
.
lock
);

136 if((
p
->
k°ack
 = 
	`kÆloc
()) == 0){

137 
p
->
°©e
 = 
UNUSED
;

140 
•
 = 
p
->
k°ack
 + 
KSTACKSIZE
;

143 
•
 - *
p
->
tf
;

144 
p
->
tf
 = (
å≠‰ame
*)
•
;

148 
•
 -= 4;

149 *(
uöt
*)
•
 = (uöt)
å≠ªt
;

151 
•
 - *
p
->
c⁄ãxt
;

152 
p
->
c⁄ãxt
 = (c⁄ãxt*)
•
;

153 
	`mem£t
(
p
->
c⁄ãxt
, 0,  *p->context);

154 
p
->
c⁄ãxt
->
eù
 = (
uöt
)
f‹kªt
;

156  
p
;

157 
	}
}

162 
	$u£röô
()

164 
¥oc
 *
p
;

165 
_bö¨y_öôcode_°¨t
[], 
_bö¨y_öôcode_size
[];

167 
p
 = 
	`Ælo˝roc
();

169 
öô¥oc
 = 
p
;

170 if((
p
->
pgdú
 = 
	`£tupkvm
()) == 0)

171 
	`∑nic
("userinit: out of memory?");

172 
	`öôuvm
(
p
->
pgdú
, 
_bö¨y_öôcode_°¨t
, ()
_bö¨y_öôcode_size
);

173 
p
->
sz
 = 
PGSIZE
;

174 
	`mem£t
(
p
->
tf
, 0, (*p->tf));

175 
p
->
tf
->
cs
 = (
SEG_UCODE
 << 3Ë| 
DPL_USER
;

176 
p
->
tf
->
ds
 = (
SEG_UDATA
 << 3Ë| 
DPL_USER
;

177 
p
->
tf
->
es
 =Ö->tf->
ds
;

178 
p
->
tf
->
ss
 =Ö->tf->
ds
;

179 
p
->
tf
->
eÊags
 = 
FL_IF
;

180 
p
->
tf
->
e•
 = 
PGSIZE
;

181 
p
->
tf
->
eù
 = 0;

183 
	`ß„°r˝y
(
p
->
«me
, "initcode", (p->name));

184 
p
->
cwd
 = 
	`«mei
("/");

190 
	`acquúe
(&
±abÀ
.
lock
);

192 
p
->
°©e
 = 
RUNNABLE
;

194 
	`ªÀa£
(&
±abÀ
.
lock
);

195 
	}
}

200 
	$grow¥oc
(
n
)

202 
uöt
 
sz
;

203 
¥oc
 *
p
;

204 
¥oc
 *
cuΩroc
 = 
	`my¥oc
();

206 
sz
 = 
cuΩroc
->sz;

208 if(
n
 > 0){

209 if((
sz
 = 
	`Ælocuvm
(
cuΩroc
->
pgdú
, sz, sz + 
n
)) == 0)

211 } if(
n
 < 0){

212 if((
sz
 = 
	`dóŒocuvm
(
cuΩroc
->
pgdú
, sz, sz + 
n
)) == 0)

217 
	`acquúe
(&
±abÀ
.
lock
);

218 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Ö++)

220 if(
p
 =
cuΩroc
)

222 if(
p
->
pid
 =
cuΩroc
->pid)

223 
p
->
sz
 +
n
;

225 
	`ªÀa£
(&
±abÀ
.
lock
);

227 
cuΩroc
->
sz
 = sz;

229 
	`swôchuvm
(
cuΩroc
);

231 
	}
}

237 
	$f‹k
()

239 
i
, 
pid
;

240 
¥oc
 *
≈
;

241 
¥oc
 *
cuΩroc
 = 
	`my¥oc
();

244 if((
≈
 = 
	`Ælo˝roc
()) == 0){

249 if((
≈
->
pgdú
 = 
	`c›yuvm
(
cuΩroc
->pgdú, cuΩroc->
sz
)) == 0){

250 
	`k‰ì
(
≈
->
k°ack
);

251 
≈
->
k°ack
 = 0;

252 
≈
->
°©e
 = 
UNUSED
;

255 
≈
->
sz
 = 
cuΩroc
->sz;

256 
≈
->
usz
 = 
cuΩroc
->usz;

257 
≈
->
∑ª¡
 = 
cuΩroc
;

258 *
≈
->
tf
 = *
cuΩroc
->tf;

261 
≈
->
tf
->
óx
 = 0;

263 
i
 = 0; i < 
NOFILE
; i++)

264 if(
cuΩroc
->
ofûe
[
i
])

265 
≈
->
ofûe
[
i
] = 
	`fûedup
(
cuΩroc
->ofile[i]);

266 
≈
->
cwd
 = 
	`idup
(
cuΩroc
->cwd);

268 
	`ß„°r˝y
(
≈
->
«me
, 
cuΩroc
->name, (curproc->name));

270 
pid
 = 
≈
->pid;

272 
	`acquúe
(&
±abÀ
.
lock
);

274 
≈
->
°©e
 = 
RUNNABLE
;

276 
	`ªÀa£
(&
±abÀ
.
lock
);

278  
pid
;

279 
	}
}

282 
	$thªad_¸óã
(
thªad_t
 *
thªad
, * (*
°¨t_routöe
)(*), *
¨g
)

284 
¥oc
 *
≈
;

285 
¥oc
 *
cuΩroc
 = 
	`my¥oc
();

287 
¥oc
 *
p
;

288 
uöt
 
sz
, 
•
, 
u°ack
[2];

290 
¥oc
 *
tmp
;

292 
tmp
 = 
	`födMöPass
();

295 if(
cuΩroc
->
isThªad
)

299 if((
≈
 = 
	`Ælo˝roc
()) == 0)

301 
≈
->
pid
 = 
cuΩroc
->pid;

316 
cuΩroc
->
˙tThªad
++;

319 if(
cuΩroc
->
isMLFQ
 == 0)

321 
	`acquúe
(&
±abÀ
.
lock
);

322 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Ö++)

323 if(
p
->
pid
 =
cuΩroc
->pid)

325 
p
->
isMLFQ
 = 0;

326 
p
->
sh¨e
 = 
cuΩroc
->
tŸÆsh¨e
 / ()cuΩroc->
˙tThªad
;

327 
p
->
°ride
 = 
STRIDENUM
 /Ö->
sh¨e
;

328 
p
->
∑ss
 = 
tmp
->pass;

331 
	`ªÀa£
(&
±abÀ
.
lock
);

334 
≈
->
isThªad
 = 1;

335 
≈
->
isMaöThªad
 = 0;

337 
≈
->
pgdú
 = 
cuΩroc
->pgdir;

338 
≈
->
∑ª¡
 = 
cuΩroc
;

339 *
≈
->
tf
 = *
cuΩroc
->tf;

342 
≈
->
tf
->
óx
 = 0;

344 
i
 = 0; i < 
NOFILE
; i++)

345 if(
cuΩroc
->
ofûe
[
i
])

346 
≈
->
ofûe
[
i
] = 
	`fûedup
(
cuΩroc
->ofile[i]);

348 
≈
->
cwd
 = 
	`idup
(
cuΩroc
->cwd);

350 
	`ß„°r˝y
(
≈
->
«me
, 
cuΩroc
->name, (curproc->name));

352 
sz
 = 
cuΩroc
->
usz
 + (
≈
->
tid
Ë* 2 * 
PGSIZE
;

360 
•
 = 
sz
;

365 
u°ack
[0] = 0xffffffff;

366 
u°ack
[1] = (
uöt
)
¨g
;

367 
•
 -= 8;

369 if(
	`c›yout
(
≈
->
pgdú
, 
•
, 
u°ack
, 8) <0)

371 
	`˝rötf
("copyout\n");

372 
≈
->
°©e
 = 
UNUSED
;

373 
≈
->
k°ack
 = 0;

374 
√xâid
--;

378 *
≈
->
tf
 = *
cuΩroc
->tf;

380 
≈
->
usz
 = 
sz
;

381 
≈
->
sz
 = 
cuΩroc
->sz;

382 
≈
->
tf
->
e•
 = 
•
;

383 
≈
->
tf
->
eù
 = (
uöt
)
°¨t_routöe
;

385 
≈
->
°©e
 = 
RUNNABLE
;

386 *
thªad
 = 
≈
->
tid
;

390 
	}
}

396 
	$exô
()

398 
¥oc
 *
cuΩroc
 = 
	`my¥oc
();

399 
¥oc
 *
p
;

400 
fd
, 
check
;

403 if(
cuΩroc
 =
öô¥oc
)

404 
	`∑nic
("initÉxiting");

407 
fd
 = 0; fd < 
NOFILE
; fd++){

408 if(
cuΩroc
->
ofûe
[
fd
]){

409 
	`fûe˛o£
(
cuΩroc
->
ofûe
[
fd
]);

410 
cuΩroc
->
ofûe
[
fd
] = 0;

414 
	`begö_›
();

415 
	`ùut
(
cuΩroc
->
cwd
);

416 
	`íd_›
();

417 
cuΩroc
->
cwd
 = 0;

421 
check
 = 0, 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Ö++)

427 if(
p
->
pid
 =
cuΩroc
->pid)

429 if(
p
 !
cuΩroc
)

432 
fd
 = 0; fd < 
NOFILE
; fd++){

433 if(
p
->
ofûe
[
fd
]){

434 
	`fûe˛o£
(
p
->
ofûe
[
fd
]);

435 
p
->
ofûe
[
fd
] = 0;

438 
	`begö_›
();

439 
	`ùut
(
p
->
cwd
);

440 
	`íd_›
();

441 
p
->
cwd
 = 0;

442 
p
->
°©e
 = 
ZOMBIE
;

443 
check
++;

462 
cuΩroc
->
°©e
 = 
ZOMBIE
;

464 
	`acquúe
(&
±abÀ
.
lock
);

469 if(
cuΩroc
->
isThªad
)

470 
	`wakeup1
(
cuΩroc
->
∑ª¡
->parent);

472 
	`wakeup1
(
cuΩroc
->
∑ª¡
);

476 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Ö++){

478 if(
p
->
∑ª¡
 =
cuΩroc
){

479 
p
->
∑ª¡
 = 
öô¥oc
;

480 if(
p
->
°©e
 =
ZOMBIE
)

481 
	`wakeup1
(
öô¥oc
);

501 
	`sched
();

502 
	`∑nic
("zombieÉxit");

503 
	}
}

506 
	$thªad_exô
(*
ªtvÆ
)

508 
¥oc
 *
cuΩroc
 = 
	`my¥oc
();

509 
¥oc
 *
p
;

510 
fd
;

512 if(
cuΩroc
 =
öô¥oc
)

513 
	`∑nic
("initÉxiting");

515 
fd
 = 0; fd < 
NOFILE
; fd++)

517 if(
cuΩroc
->
ofûe
[
fd
])

519 
	`fûe˛o£
(
cuΩroc
->
ofûe
[
fd
]);

520 
cuΩroc
->
ofûe
[
fd
] = 0;

524 
	`begö_›
();

525 
	`ùut
(
cuΩroc
->
cwd
);

526 
	`íd_›
();

527 
cuΩroc
->
cwd
 = 0;

529 
	`acquúe
(&
±abÀ
.
lock
);

530 
cuΩroc
->
ªtvÆ
 = ()retval;

542 
	`wakeup1
(
cuΩroc
->
∑ª¡
);

544 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Ö++)

546 if(
p
->
∑ª¡
 =
cuΩroc
)

548 
p
->
∑ª¡
 = 
öô¥oc
;

549 if(
p
->
°©e
 =
ZOMBIE
)

550 
	`wakeup1
(
öô¥oc
);

555 
cuΩroc
->
°©e
 = 
ZOMBIE
;

556 
	`sched
();

557 
	`∑nic
("zombieÉxit");

559 
	}
}

562 
	$kûlßmïid
(
pid
)

564 
¥oc
 *
p
;

568 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Ö++)

570 if(
p
->
pid
 !=Öid)

572 if(
p
->
isMaöThªad
)

578 if(
p
->
°©e
 =
ZOMBIE
)

582 
âabÀ
.
tid
[
p
->tid].
°©e
 = 
UNUSED
;

599 
p
->
∑ss
 = 0;

600 
p
->
°ride
 = 0;

601 
p
->
sh¨e
 = 0;

603 
p
->
±icks
 = 0;

604 
p
->
±ŸÆticks
 = 0;

605 
p
->
¥i‹ôy
 = 0;

606 
p
->
isMLFQ
 = 0;

608 
p
->
tid
 = 0;

610 
	`k‰ì
(
p
->
k°ack
);

612 
p
->
k°ack
 = 0;

615 
p
->
pid
 = 0;

616 
p
->
∑ª¡
 = 0;

617 
p
->
«me
[0] = 0;

618 
p
->
kûÀd
 = 0;

619 
p
->
°©e
 = 
UNUSED
;

626 
	}
}

630 
	$waô
()

632 
¥oc
 *
p
;

633 
havekids
, 
pid
;

634 
¥oc
 *
cuΩroc
 = 
	`my¥oc
();

637 
	`acquúe
(&
±abÀ
.
lock
);

640 
havekids
 = 0;

641 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Ö++){

642 if(
p
->
∑ª¡
 !
cuΩroc
)

644 if(
p
->
isThîeExec
)

646 
p
->
isThîeExec
 = 0;

651 
havekids
 = 1;

652 if(
p
->
°©e
 =
ZOMBIE
){

658 if(
	`kûlßmïid
(
p
->
pid
) != 0)

659 
	`∑nic
("killsamepidÉrror");

660 if(
p
->
isThªad
 && !p->
isMaöThªad
)

663 
âabÀ
.
tid
[
p
->tid].
°©e
 = 
UNUSED
;

668 if(
p
->
isMLFQ
 == 0)

670 
À·Sh¨e
 +
p
->
tŸÆsh¨e
;

671 
MLFQSåideVÆ
 = 
STRIDENUM
 / 
À·Sh¨e
;

677 
p
->
tŸÆsh¨e
 = 0;

681 
p
->
∑ss
 = 0;

682 
p
->
°ride
 = 0;

683 
p
->
sh¨e
 = 0;

685 
p
->
±icks
 = 0;

686 
p
->
±ŸÆticks
 = 0;

687 
p
->
¥i‹ôy
 = 0;

688 
p
->
isMLFQ
 = 0;

690 
p
->
tid
 = 0;

692 
pid
 = 
p
->pid;

693 
	`k‰ì
(
p
->
k°ack
);

694 
p
->
k°ack
 = 0;

695 if(
p
->
isMaöThªad
)

696 
	`‰ìvm
(
p
->
pgdú
);

697 
p
->
pid
 = 0;

698 
p
->
∑ª¡
 = 0;

699 
p
->
«me
[0] = 0;

700 
p
->
kûÀd
 = 0;

701 
p
->
°©e
 = 
UNUSED
;

704 
	`ªÀa£
(&
±abÀ
.
lock
);

705  
pid
;

710 if(!
havekids
 || 
cuΩroc
->
kûÀd
){

711 
	`ªÀa£
(&
±abÀ
.
lock
);

716 
	`¶ìp
(
cuΩroc
, &
±abÀ
.
lock
);

718 
	}
}

721 
	$thªad_joö
(
thªad_t
 
thªad
, **
ªtvÆ
)

723 
¥oc
 *
p
;

724 
havekids
;

725 
¥oc
 *
cuΩroc
 = 
	`my¥oc
();

727 
	`acquúe
(&
±abÀ
.
lock
);

730 
havekids
 = 0;

731 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Ö++){

732 if(
p
->
∑ª¡
 !
cuΩroc
)

734 
havekids
 = 1;

735 
p
->
°©e
 !
ZOMBIE
 &&Ö->
pid
 =
cuΩroc
->pid &&Ö->
tid
 =
thªad
)

736 
	`¶ìp
(
cuΩroc
, &
±abÀ
.
lock
);

740 *
ªtvÆ
 = (*)
p
->retval;

745 
âabÀ
.
tid
[
p
->tid].
°©e
 = 
UNUSED
;

751 if(
p
->
isMLFQ
 == 0)

754 
À·Sh¨e
 +
p
->
sh¨e
;

755 
MLFQSåideVÆ
 = ()
STRIDENUM
 / 
À·Sh¨e
;

759 
p
->
∑ss
 = 0;

760 
p
->
°ride
 = 0;

761 
p
->
sh¨e
 = 0;

763 
p
->
±icks
 = 0;

764 
p
->
±ŸÆticks
 = 0;

765 
p
->
¥i‹ôy
 = 0;

766 
p
->
isMLFQ
 = 0;

768 
p
->
tid
 = 0;

771 
	`k‰ì
(
p
->
k°ack
);

772 
p
->
k°ack
 = 0;

774 
p
->
pid
 = 0;

775 
p
->
∑ª¡
 = 0;

776 
p
->
«me
[0] = 0;

777 
p
->
kûÀd
 = 0;

778 
p
->
°©e
 = 
UNUSED
;

779 
	`ªÀa£
(&
±abÀ
.
lock
);

785 if(!
havekids
 || 
cuΩroc
->
kûÀd
){

786 
	`˝rötf
("havekids\n");

787 
	`ªÀa£
(&
±abÀ
.
lock
);

794 
	}
}

800 
	$MLFQ_Boo°
()

802 
¥oc
 *
p
;

806 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Ö++)

808 if(!
p
->
isMLFQ
)

810 
p
->
¥i‹ôy
 = 0;

811 
p
->
±icks
 = 0;

812 
p
->
±ŸÆticks
 = 0;

815 
MLFQ_ticks
 = 0;

816 
	}
}

820 
	$MLFQ_ScheduÀr
()

822 
¥oc
 *
p
 = 
	`my¥oc
();

823 
˝u
 *
c
 = 
	`my˝u
();

825 
c
->
¥oc
 = 0;

827 
checkpoöt
 = 0, 
Àvtu∫
 = 0, 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Üevturn++, checkpoint++,Ö++)

830 if(
MLFQ_ticks
 >= 100)

831 
	`MLFQ_Boo°
();

835 if(
Àvtu∫
 == 63)

840 if((
checkpoöt
 % 63) == 0)

841 
p
 = 
±abÀ
.
¥oc
;

844 if(
p
->
isMLFQ
 != 1)

848 if(
p
->
°©e
 !
RUNNABLE
 ||Ö->
¥i‹ôy
 != 0)

852 if(
À·Sh¨e
 < 100)

853 
MLFQPassVÆ
 +
MLFQSåideVÆ
;

856 
Àvtu∫
 = 0;

858 
c
->
¥oc
 = 
p
;

859 
	`swôchuvm
(
p
);

861 
p
->
°©e
 = 
RUNNING
;

862 
	`swtch
(&(
c
->
scheduÀr
), 
p
->
c⁄ãxt
);

863 
	`swôchkvm
();

864 
c
->
¥oc
 = 0;

867 
checkpoöt
 = 0, 
Àvtu∫
 = 0, 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Üevturn++, checkpoint++,Ö++)

870 if(
MLFQ_ticks
 >= 100)

871 
	`MLFQ_Boo°
();

875 if(
Àvtu∫
 == 63)

880 if((
checkpoöt
 % 63) == 0)

881 
p
 = 
±abÀ
.
¥oc
;

884 if(
p
->
isMLFQ
 != 1)

888 if(
p
->
°©e
 !
RUNNABLE
 ||Ö->
¥i‹ôy
 != 1)

892 if(
À·Sh¨e
 < 100)

893 
MLFQPassVÆ
 +(
MLFQSåideVÆ
 * 2);

896 
Àvtu∫
 = 0;

897 
c
->
¥oc
 = 
p
;

898 
	`swôchuvm
(
p
);

899 
p
->
°©e
 = 
RUNNING
;

900 
	`swtch
(&(
c
->
scheduÀr
), 
p
->
c⁄ãxt
);

901 
	`swôchkvm
();

902 
c
->
¥oc
 = 0;

905 
checkpoöt
 = 0, 
Àvtu∫
 = 0, 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Üevturn++, checkpoint++,Ö++)

908 if(
MLFQ_ticks
 >= 100)

909 
	`MLFQ_Boo°
();

913 if(
Àvtu∫
 == 63)

918 if((
checkpoöt
 % 63) == 0)

919 
p
 = 
±abÀ
.
¥oc
;

922 if(
p
->
isMLFQ
 != 1)

926 if(
p
->
°©e
 !
RUNNABLE
 ||Ö->
¥i‹ôy
 != 2)

930 if(
À·Sh¨e
 < 100)

931 
MLFQPassVÆ
 +(
MLFQSåideVÆ
 * 4);

934 
Àvtu∫
 = 0;

935 
c
->
¥oc
 = 
p
;

936 
	`swôchuvm
(
p
);

937 
p
->
°©e
 = 
RUNNING
;

938 
	`swtch
(&(
c
->
scheduÀr
), 
p
->
c⁄ãxt
);

939 
	`swôchkvm
();

940 
c
->
¥oc
 = 0;

947 if(
À·Sh¨e
 < 100)

948 
MLFQPassVÆ
 +
MLFQSåideVÆ
;

950 
	}
}

954 
¥oc
*

955 
	$födMöPass
()

957 
¥oc
 *
p
, *
mö
 = 0;

958 
uöt
 
max
 = 3000000000;

963 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Ö++)

965 if(
p
->
isMLFQ
 == 1)

967 if(
p
->
°©e
 !
RUNNABLE
)

969 if(
p
->
∑ss
 < 
max
)

971 
max
 = 
p
->
∑ss
;

972 
mö
 = 
p
;

979 if(
MLFQPassVÆ
 < 
max
)

982  
mö
;

983 
	}
}

987 
	$Såide_ScheduÀr
(
¥oc
* 
p
)

989 
˝u
 *
c
 = 
	`my˝u
();

991 
c
->
¥oc
 = 0;

993 
p
->
∑ss
 +p->
°ride
;

995 
c
->
¥oc
 = 
p
;

996 
	`swôchuvm
(
p
);

997 
p
->
°©e
 = 
RUNNING
;

998 
	`swtch
(&(
c
->
scheduÀr
), 
p
->
c⁄ãxt
);

999 
	`swôchkvm
();

1000 
c
->
¥oc
 = 0;

1002 
	}
}

1006 
	$˝u_sh¨e
(
sh¨e
)

1008 
¥oc
 *
p
 = 
	`my¥oc
();

1009 
¥oc
 *
t
;

1010 
¥oc
 *
tmp
;

1012 if(
p
->
isMaöThªad
){

1013 
p
->
tŸÆsh¨e
 +
sh¨e
;

1014 if(
p
->
tŸÆsh¨e
 > 100)

1015 
	`∑nic
("cpu share overflow");

1016 
À·Sh¨e
 -
p
->
tŸÆsh¨e
;

1019 
p
->
∑ª¡
->
tŸÆsh¨e
 +
sh¨e
;

1021 if(
p
->
∑ª¡
->
tŸÆsh¨e
 > 100)

1022 
	`∑nic
("cpu share overflow");

1023 
À·Sh¨e
 -
p
->
∑ª¡
->
tŸÆsh¨e
;

1025 
MLFQSåideVÆ
 = 
STRIDENUM
 / 
À·Sh¨e
;

1027 
tmp
 = 
	`födMöPass
();

1029 if(
p
->
isMaöThªad
 &&Ö->
˙tThªad
 > 1)

1031 
t
 = 
±abÀ
.
¥oc
;Å < &±abÀ.¥oc[
NPROC
];Å++)

1032 if(
t
->
pid
 =
p
->pid)

1034 
t
->
isMLFQ
 = 0;

1035 
t
->
sh¨e
 = 
p
->
tŸÆsh¨e
 /Ö->
˙tThªad
;

1036 
t
->
°ride
 = ()
STRIDENUM
 /Å->
sh¨e
;

1040 if(
tmp
 == 0)

1041 
t
->
∑ss
 = 
MLFQPassVÆ
;

1043 
t
->
∑ss
 = 
tmp
->pass;

1047 if(
p
->
isThªad
)

1049 
t
 = 
±abÀ
.
¥oc
;Å < &±abÀ.¥oc[
NPROC
];Å++)

1050 if(
t
->
pid
 =
p
->pid)

1052 
t
->
isMLFQ
 = 0;

1053 
t
->
sh¨e
 = sh¨ê/ 
p
->
∑ª¡
->
˙tThªad
;

1054 
t
->
°ride
 = 
STRIDENUM
 /Å->
sh¨e
;

1058 if(
tmp
 == 0)

1059 
t
->
∑ss
 = 
MLFQPassVÆ
;

1061 
t
->
∑ss
 = 
tmp
->pass;

1066 
p
->
isMLFQ
 = 0;

1067 
p
->
sh¨e
 = share;

1068 
p
->
°ride
 = 
STRIDENUM
 / 
sh¨e
;

1072 if(
tmp
 == 0)

1073 
p
->
∑ss
 = 
MLFQPassVÆ
;

1075 
p
->
∑ss
 = 
tmp
->pass;

1084 
	}
}

1095 
	$scheduÀr
()

1097 
¥oc
 *
mö
;

1098 
˝u
 *
c
 = 
	`my˝u
();

1101 
c
->
¥oc
 = 0;

1105 if(
MLFQ_ticks
 >= 100)

1106 
	`MLFQ_Boo°
();

1108 
	`°i
();

1110 
	`acquúe
(&
±abÀ
.
lock
);

1112 if(
À·Sh¨e
 >= 100)

1113 
	`MLFQ_ScheduÀr
();

1114 if(
À·Sh¨e
 < 100)

1116 if((
mö
 = 
	`födMöPass
()) == 0)

1117 
	`MLFQ_ScheduÀr
();

1119 
	`Såide_ScheduÀr
(
mö
);

1122 
	`ªÀa£
(&
±abÀ
.
lock
);

1125 
	}
}

1135 
	$sched
()

1137 
öã«
;

1138 
¥oc
 *
p
 = 
	`my¥oc
();

1140 if(!
	`hﬁdög
(&
±abÀ
.
lock
))

1141 
	`∑nic
("schedÖtable.lock");

1142 if(
	`my˝u
()->
n˛i
 != 1)

1143 
	`∑nic
("schedÜocks");

1144 if(
p
->
°©e
 =
RUNNING
)

1145 
	`∑nic
("schedÑunning");

1146 if(
	`ªadeÊags
()&
FL_IF
)

1147 
	`∑nic
("sched interruptible");

1148 
öã«
 = 
	`my˝u
()->intena;

1151 
	`swtch
(&
p
->
c⁄ãxt
, 
	`my˝u
()->
scheduÀr
);

1152 
	`my˝u
()->
öã«
 = intena;

1153 
	}
}

1157 
	$yõld
()

1159 
	`acquúe
(&
±abÀ
.
lock
);

1160 
	`my¥oc
()->
°©e
 = 
RUNNABLE
;

1161 
	`sched
();

1162 
	`ªÀa£
(&
±abÀ
.
lock
);

1163 
	}
}

1168 
	$f‹kªt
()

1170 
fú°
 = 1;

1172 
	`ªÀa£
(&
±abÀ
.
lock
);

1174 i‡(
fú°
) {

1178 
fú°
 = 0;

1179 
	`iöô
(
ROOTDEV
);

1180 
	`öôlog
(
ROOTDEV
);

1184 
	}
}

1189 
	$¶ìp
(*
ch™
, 
•ölock
 *
lk
)

1191 
¥oc
 *
p
 = 
	`my¥oc
();

1193 if(
p
 == 0)

1194 
	`∑nic
("sleep");

1196 if(
lk
 == 0)

1197 
	`∑nic
("sleep withoutÜk");

1205 if(
lk
 !&
±abÀ
.
lock
){

1206 
	`acquúe
(&
±abÀ
.
lock
);

1207 
	`ªÀa£
(
lk
);

1210 
p
->
ch™
 = chan;

1211 
p
->
°©e
 = 
SLEEPING
;

1213 
	`sched
();

1216 
p
->
ch™
 = 0;

1219 if(
lk
 !&
±abÀ
.
lock
){

1220 
	`ªÀa£
(&
±abÀ
.
lock
);

1221 
	`acquúe
(
lk
);

1223 
	}
}

1229 
	$wakeup1
(*
ch™
)

1231 
¥oc
 *
p
;

1232 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Ö++)

1233 if(
p
->
°©e
 =
SLEEPING
 &&Ö->
ch™
 == chan){

1235 
p
->
°©e
 = 
RUNNABLE
;

1237 
	}
}

1241 
	$wakeup
(*
ch™
)

1243 
	`acquúe
(&
±abÀ
.
lock
);

1244 
	`wakeup1
(
ch™
);

1245 
	`ªÀa£
(&
±abÀ
.
lock
);

1246 
	}
}

1252 
	$kûl
(
pid
)

1254 
¥oc
 *
p
;

1256 
	`acquúe
(&
±abÀ
.
lock
);

1257 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Ö++){

1258 if(
p
->
pid
 ==Öid){

1259 
p
->
kûÀd
 = 1;

1261 if(
p
->
°©e
 =
SLEEPING
)

1262 
p
->
°©e
 = 
RUNNABLE
;

1267 
	`ªÀa£
(&
±abÀ
.
lock
);

1269 
	`ªÀa£
(&
±abÀ
.
lock
);

1271 
	}
}

1278 
	$¥ocdump
()

1280 *
°©es
[] = {

1281 [
UNUSED
] "unused",

1282 [
EMBRYO
] "embryo",

1283 [
SLEEPING
] "sleep ",

1284 [
RUNNABLE
] "runble",

1285 [
RUNNING
] "run ",

1286 [
ZOMBIE
] "zombie"

1288 
i
;

1289 
¥oc
 *
p
;

1290 *
°©e
;

1291 
uöt
 
pc
[10];

1293 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Ö++){

1294 if(
p
->
°©e
 =
UNUSED
)

1296 if(
p
->
°©e
 >0 &&Ö->°©ê< 
	`NELEM
(
°©es
) && states[p->state])

1297 
°©e
 = 
°©es
[
p
->state];

1299 
°©e
 = "???";

1300 
	`˝rötf
("%d %†%†%d", 
p
->
pid
, 
°©e
,Ö->
«me
,Ö->
kûÀd
);

1301 if(
p
->
°©e
 =
ZOMBIE
)

1302 
	`˝rötf
(" %d", 
p
->
∑ª¡
->
pid
);

1303 if(
p
->
°©e
 =
SLEEPING
){

1304 
	`gëˇŒîpcs
((
uöt
*)
p
->
c⁄ãxt
->
ebp
+2, 
pc
);

1305 
i
=0; i<10 && 
pc
[i] != 0; i++)

1306 
	`˝rötf
(" %p", 
pc
[
i
]);

1308 
	`˝rötf
("\n");

1310 
	}
}

	@proc.h

2 
	s˝u
 {

3 
uch¨
 
	m≠icid
;

4 
c⁄ãxt
 *
	mscheduÀr
;

5 
èsk°©e
 
	mts
;

6 
£gdesc
 
	mgdt
[
NSEGS
];

7 vﬁ©ûê
uöt
 
	m°¨ãd
;

8 
	mn˛i
;

9 
	möã«
;

10 
¥oc
 *
	m¥oc
;

13 
˝u
 
˝us
[
NCPU
];

14 
n˝u
;

27 
	sc⁄ãxt
 {

28 
uöt
 
	medi
;

29 
uöt
 
	mesi
;

30 
uöt
 
	mebx
;

31 
uöt
 
	mebp
;

32 
uöt
 
	meù
;

35 
	e¥oc°©e
 { 
	mUNUSED
, 
	mEMBRYO
, 
	mSLEEPING
, 
	mRUNNABLE
, 
	mRUNNING
, 
	mZOMBIE
 };

38 
	s¥oc
 {

39 
uöt
 
	msz
;

40 
pde_t
* 
	mpgdú
;

41 *
	mk°ack
;

42 
¥oc°©e
 
	m°©e
;

43 
	mpid
;

44 
¥oc
 *
	m∑ª¡
;

45 
å≠‰ame
 *
	mtf
;

46 
c⁄ãxt
 *
	mc⁄ãxt
;

47 *
	mch™
;

48 
	mkûÀd
;

49 
fûe
 *
	mofûe
[
NOFILE
];

50 
öode
 *
	mcwd
;

51 
	m«me
[16];

54 
	m¥i‹ôy
;

55 
	m±icks
;

56 
	m±ŸÆticks
;

57 
	misMLFQ
;

60 
	msh¨e
;

61 
	m°ride
;

62 
	m∑ss
;

65 
	mtid
;

66 
	mªtvÆ
;

67 
	misThªad
;

68 
	misMaöThªad
;

69 
uöt
 
	musz
;

70 
	misThîeExec
;

71 
	m˙tThªad
;

72 
	mtŸÆsh¨e
;

76 
	stid
 {

77 
	mödex
;

78 
¥oc°©e
 
	m°©e
;

	@pwritetest.c

1 
	~"ty≥s.h
"

2 
	~"°©.h
"

3 
	~"u£r.h
"

4 
	~"fs.h
"

5 
	~"f˙é.h
"

7 
	#NUM_THREAD
 10

	)

8 
	#FILESIZE
 (1600*1024)

9 
	#BUFSIZE
 512

	)

10 
	#FSIZE_PER_THREAD
 ((
FILESIZE
Ë/ (
NUM_THREAD
))

	)

12 *
	gfûï©h
 = "myfile";

13 
	gfd
;

15 
pwrôëe°
();

16 
¥ódã°
();

19 
	$maö
(
¨gc
, *
¨gv
[])

22 
	`¥ötf
(1, "1. StartÖwriteÅest\n");

23 
	`pwrôëe°
();

24 
	`¥ötf
(1, "Finished\n");

27 
	`¥ötf
(1, "2. StartÖreadÅest\n");

28 
	`¥ódã°
();

29 
	`¥ötf
(1, "Finished\n");

31 
	`exô
();

32 
	}
}

36 
	$pwrôëe°maö
(*
¨g
)

38 
tid
 = (Ë
¨g
;

39 
r
, 
i
, 
off
;

40 
d©a
[
BUFSIZE
];

42 
°¨t
 = 
FSIZE_PER_THREAD
 * 
tid
;

43 
íd
 = 
°¨t
 + 
FSIZE_PER_THREAD
;

45 
i
 = 0; i < 
BUFSIZE
; i++)

46 
d©a
[
i
] = (
tid
 + i) % 128;

48 
	`¥ötf
(1, "Thªad #%d i†wrôög (%d ~ %d)\n", 
tid
, 
°¨t
, 
íd
);

50 
off
 = 
°¨t
; of‡< 
íd
; off+=
BUFSIZE
){

51 i‡((
off
 / 
BUFSIZE
) % 300 == 0){

52 
	`¥ötf
(1, "Thªad %d: %d byã†wrôãn\n", 
tid
, 
off
 - 
°¨t
);

54 i‡((
r
 = 
	`pwrôe
(
fd
, 
d©a
, (d©a), 
off
)) != (data)){

55 
	`¥ötf
(1, "pwrôêªtu∫ed %d : faûed\n", 
r
);

56 
	`exô
();

60 
	`¥ötf
(1, "Thªad %d: wrôög föished\n", 
tid
);

61 
	`thªad_exô
((*)0);

62 
	}
}

65 
	$pwrôëe°
()

67 
thªad_t
 
thªads
[
NUM_THREAD
];

68 
i
;

69 * 
ªtvÆ
;

72 
fd
 = 
	`›í
(
fûï©h
, 
O_CREATE
 | 
O_RDWR
);

74 
i
 = 0; i < 
NUM_THREAD
; i++){

75 if(
	`thªad_¸óã
(&
thªads
[
i
], 
pwrôëe°maö
, (*)i) != 0){

76 
	`¥ötf
(1, "panicátÅhread_create\n");

77 
	`˛o£
(
fd
);

82 
i
 = 0; i < 
NUM_THREAD
; i++){

83 i‡(
	`thªad_joö
(
thªads
[
i
], &
ªtvÆ
) != 0){

84 
	`¥ötf
(1, "panicátÅhread_join\n");

85 
	`˛o£
(
fd
);

89 
	`˛o£
(
fd
);

90 
	}
}

93 
	$¥ódã°maö
(*
¨g
)

95 
tid
 = (Ë
¨g
;

96 
r
, 
off
, 
i
;

97 
buf
[
BUFSIZE
];

99 
°¨t
 = 
FSIZE_PER_THREAD
 * 
tid
;

100 
íd
 = 
°¨t
 + 
FSIZE_PER_THREAD
;

102 
	`¥ötf
(1, "Thªad #%d i†ªadög (%d ~ %d)\n", 
tid
, 
°¨t
, 
íd
);

104 
off
 = 
°¨t
; of‡< 
íd
; off+=
BUFSIZE
){

105 i‡((
r
 = 
	`¥ód
(
fd
, 
buf
, (buf), 
off
)) != (buf)){

106 
	`¥ötf
(1, "¥ódÑëu∫ed %d : faûed\n", 
r
);

107 
	`exô
();

109 
i
 = 0; i < 
BUFSIZE
; i++) {

110 i‡(
buf
[
i
] !(
tid
 + i) % 128) {

111 
	`¥ötf
(1, "data inconsistency detected\n");

112 
	`exô
();

116 
	`thªad_exô
((*)0);

117 
	}
}

120 
	$¥ódã°
()

122 
thªad_t
 
thªads
[
NUM_THREAD
];

123 
i
;

124 * 
ªtvÆ
;

127 
fd
 = 
	`›í
(
fûï©h
, 
O_RDONLY
);

129 
i
 = 0; i < 
NUM_THREAD
; i++){

130 if(
	`thªad_¸óã
(&
thªads
[
i
], 
¥ódã°maö
, (*)i) != 0){

131 
	`¥ötf
(1, "panicátÅhread_create\n");

132 
	`˛o£
(
fd
);

137 
i
 = 0; i < 
NUM_THREAD
; i++){

138 i‡(
	`thªad_joö
(
thªads
[
i
], &
ªtvÆ
) != 0){

139 
	`¥ötf
(1, "panicátÅhread_join\n");

140 
	`˛o£
(
fd
);

144 
	`˛o£
(
fd
);

145 
	}
}

	@rm.c

1 
	~"ty≥s.h
"

2 
	~"°©.h
"

3 
	~"u£r.h
"

6 
	$maö
(
¨gc
, *
¨gv
[])

8 
i
;

10 if(
¨gc
 < 2){

11 
	`¥ötf
(2, "Usage:Ñm files...\n");

12 
	`exô
();

15 
i
 = 1; i < 
¨gc
; i++){

16 if(
	`u∆ök
(
¨gv
[
i
]) < 0){

17 
	`¥ötf
(2, "rm: %†ÁûedÅÿdñëe\n", 
¨gv
[
i
]);

22 
	`exô
();

23 
	}
}

	@set_cpu_share.c

1 
	~"ty≥s.h
"

2 
	~"defs.h
"

3 
	~"∑øm.h
"

4 
	~"memœyout.h
"

5 
	~"mmu.h
"

6 
	~"¥oc.h
"

7 
	~"x86.h
"

8 
	~"å≠s.h
"

9 
	~"•ölock.h
"

11 
	gÀ·Sh¨e
 = 100;

14 
	$£t_˝u_sh¨e
(
sh¨e
)

17 if((
À·Sh¨e
 - 
sh¨e
) < 20)

19 if(
sh¨e
 == 0)

23 
	`˝u_sh¨e
(
sh¨e
);

25  
sh¨e
;

26 
	}
}

31 
	$sys_£t_˝u_sh¨e
()

33 
sh¨e
;

36 if(
	`¨göt
(0, &
sh¨e
) < 0)

39  
	`£t_˝u_sh¨e
(
sh¨e
);

40 
	}
}

	@sh.c

3 
	~"ty≥s.h
"

4 
	~"u£r.h
"

5 
	~"f˙é.h
"

8 
	#EXEC
 1

	)

9 
	#REDIR
 2

	)

10 
	#PIPE
 3

	)

11 
	#LIST
 4

	)

12 
	#BACK
 5

	)

14 
	#MAXARGS
 10

	)

16 
	scmd
 {

17 
	mty≥
;

20 
	sexeccmd
 {

21 
	mty≥
;

22 *
	m¨gv
[
MAXARGS
];

23 *
	mórgv
[
MAXARGS
];

26 
	sªdúcmd
 {

27 
	mty≥
;

28 
cmd
 *
	mcmd
;

29 *
	mfûe
;

30 *
	mefûe
;

31 
	mmode
;

32 
	mfd
;

35 
	spùecmd
 {

36 
	mty≥
;

37 
cmd
 *
	mÀ·
;

38 
cmd
 *
	mright
;

41 
	sli°cmd
 {

42 
	mty≥
;

43 
cmd
 *
	mÀ·
;

44 
cmd
 *
	mright
;

47 
	sbackcmd
 {

48 
	mty≥
;

49 
cmd
 *
	mcmd
;

52 
f‹k1
();

53 
∑nic
(*);

54 
cmd
 *
∑r£cmd
(*);

58 
	$runcmd
(
cmd
 *cmd)

60 
p
[2];

61 
backcmd
 *
bcmd
;

62 
execcmd
 *
ecmd
;

63 
li°cmd
 *
lcmd
;

64 
pùecmd
 *
pcmd
;

65 
ªdúcmd
 *
rcmd
;

67 if(
cmd
 == 0)

68 
	`exô
();

70 
cmd
->
ty≥
){

72 
	`∑nic
("runcmd");

74 
EXEC
:

75 
ecmd
 = (
execcmd
*)
cmd
;

76 if(
ecmd
->
¨gv
[0] == 0)

77 
	`exô
();

78 
	`exec
(
ecmd
->
¨gv
[0],Écmd->argv);

79 
	`¥ötf
(2, "exe¯%†Áûed\n", 
ecmd
->
¨gv
[0]);

82 
REDIR
:

83 
rcmd
 = (
ªdúcmd
*)
cmd
;

84 
	`˛o£
(
rcmd
->
fd
);

85 if(
	`›í
(
rcmd
->
fûe
,Ñcmd->
mode
) < 0){

86 
	`¥ötf
(2, "›í %†Áûed\n", 
rcmd
->
fûe
);

87 
	`exô
();

89 
	`runcmd
(
rcmd
->
cmd
);

92 
LIST
:

93 
lcmd
 = (
li°cmd
*)
cmd
;

94 if(
	`f‹k1
() == 0)

95 
	`runcmd
(
lcmd
->
À·
);

96 
	`waô
();

97 
	`runcmd
(
lcmd
->
right
);

100 
PIPE
:

101 
pcmd
 = (
pùecmd
*)
cmd
;

102 if(
	`pùe
(
p
) < 0)

103 
	`∑nic
("pipe");

104 if(
	`f‹k1
() == 0){

105 
	`˛o£
(1);

106 
	`dup
(
p
[1]);

107 
	`˛o£
(
p
[0]);

108 
	`˛o£
(
p
[1]);

109 
	`runcmd
(
pcmd
->
À·
);

111 if(
	`f‹k1
() == 0){

112 
	`˛o£
(0);

113 
	`dup
(
p
[0]);

114 
	`˛o£
(
p
[0]);

115 
	`˛o£
(
p
[1]);

116 
	`runcmd
(
pcmd
->
right
);

118 
	`˛o£
(
p
[0]);

119 
	`˛o£
(
p
[1]);

120 
	`waô
();

121 
	`waô
();

124 
BACK
:

125 
bcmd
 = (
backcmd
*)
cmd
;

126 if(
	`f‹k1
() == 0)

127 
	`runcmd
(
bcmd
->
cmd
);

130 
	`exô
();

131 
	}
}

134 
	$gëcmd
(*
buf
, 
nbuf
)

136 
	`¥ötf
(2, "$ ");

137 
	`mem£t
(
buf
, 0, 
nbuf
);

138 
	`gës
(
buf
, 
nbuf
);

139 if(
buf
[0] == 0)

142 
	}
}

145 
	$maö
()

147 
buf
[100];

148 
fd
;

151 (
fd
 = 
	`›í
("c⁄sﬁe", 
O_RDWR
)) >= 0){

152 if(
fd
 >= 3){

153 
	`˛o£
(
fd
);

159 
	`gëcmd
(
buf
, (buf)) >= 0){

160 if(
buf
[0] == 'c' && buf[1] == 'd' && buf[2] == ' '){

162 
buf
[
	`°æí
(buf)-1] = 0;

163 if(
	`chdú
(
buf
+3) < 0)

164 
	`¥ötf
(2, "ˇ¬Ÿ cd %s\n", 
buf
+3);

167 if(
	`f‹k1
() == 0)

168 
	`runcmd
(
	`∑r£cmd
(
buf
));

169 
	`waô
();

171 
	`exô
();

172 
	}
}

175 
	$∑nic
(*
s
)

177 
	`¥ötf
(2, "%s\n", 
s
);

178 
	`exô
();

179 
	}
}

182 
	$f‹k1
()

184 
pid
;

186 
pid
 = 
	`f‹k
();

187 if(
pid
 == -1)

188 
	`∑nic
("fork");

189  
pid
;

190 
	}
}

195 
cmd
*

196 
	$execcmd
()

198 
execcmd
 *
cmd
;

200 
cmd
 = 
	`mÆloc
((*cmd));

201 
	`mem£t
(
cmd
, 0, (*cmd));

202 
cmd
->
ty≥
 = 
EXEC
;

203  (
cmd
*)cmd;

204 
	}
}

206 
cmd
*

207 
	$ªdúcmd
(
cmd
 *
subcmd
, *
fûe
, *
efûe
, 
mode
, 
fd
)

209 
ªdúcmd
 *
cmd
;

211 
cmd
 = 
	`mÆloc
((*cmd));

212 
	`mem£t
(
cmd
, 0, (*cmd));

213 
cmd
->
ty≥
 = 
REDIR
;

214 
cmd
->cmd = 
subcmd
;

215 
cmd
->
fûe
 = file;

216 
cmd
->
efûe
 =Éfile;

217 
cmd
->
mode
 = mode;

218 
cmd
->
fd
 = fd;

219  (
cmd
*)cmd;

220 
	}
}

222 
cmd
*

223 
	$pùecmd
(
cmd
 *
À·
, cmd *
right
)

225 
pùecmd
 *
cmd
;

227 
cmd
 = 
	`mÆloc
((*cmd));

228 
	`mem£t
(
cmd
, 0, (*cmd));

229 
cmd
->
ty≥
 = 
PIPE
;

230 
cmd
->
À·
 =Üeft;

231 
cmd
->
right
 =Ñight;

232  (
cmd
*)cmd;

233 
	}
}

235 
cmd
*

236 
	$li°cmd
(
cmd
 *
À·
, cmd *
right
)

238 
li°cmd
 *
cmd
;

240 
cmd
 = 
	`mÆloc
((*cmd));

241 
	`mem£t
(
cmd
, 0, (*cmd));

242 
cmd
->
ty≥
 = 
LIST
;

243 
cmd
->
À·
 =Üeft;

244 
cmd
->
right
 =Ñight;

245  (
cmd
*)cmd;

246 
	}
}

248 
cmd
*

249 
	$backcmd
(
cmd
 *
subcmd
)

251 
backcmd
 *
cmd
;

253 
cmd
 = 
	`mÆloc
((*cmd));

254 
	`mem£t
(
cmd
, 0, (*cmd));

255 
cmd
->
ty≥
 = 
BACK
;

256 
cmd
->cmd = 
subcmd
;

257  (
cmd
*)cmd;

258 
	}
}

262 
	gwhôe•a˚
[] = " \t\r\n\v";

263 
	gsymbﬁs
[] = "<|>&;()";

266 
	$gëtokí
(**
ps
, *
es
, **
q
, **
eq
)

268 *
s
;

269 
ªt
;

271 
s
 = *
ps
;

272 
s
 < 
es
 && 
	`°rchr
(
whôe•a˚
, *s))

273 
s
++;

274 if(
q
)

275 *
q
 = 
s
;

276 
ªt
 = *
s
;

277 *
s
){

286 
s
++;

289 
s
++;

290 if(*
s
 == '>'){

291 
ªt
 = '+';

292 
s
++;

296 
ªt
 = 'a';

297 
s
 < 
es
 && !
	`°rchr
(
whôe•a˚
, *sË&& !°rchr(
symbﬁs
, *s))

298 
s
++;

301 if(
eq
)

302 *
eq
 = 
s
;

304 
s
 < 
es
 && 
	`°rchr
(
whôe•a˚
, *s))

305 
s
++;

306 *
ps
 = 
s
;

307  
ªt
;

308 
	}
}

311 
	$≥ek
(**
ps
, *
es
, *
toks
)

313 *
s
;

315 
s
 = *
ps
;

316 
s
 < 
es
 && 
	`°rchr
(
whôe•a˚
, *s))

317 
s
++;

318 *
ps
 = 
s
;

319  *
s
 && 
	`°rchr
(
toks
, *s);

320 
	}
}

322 
cmd
 *
∑r£löe
(**, *);

323 
cmd
 *
∑r£pùe
(**, *);

324 
cmd
 *
∑r£exec
(**, *);

325 
cmd
 *
nu…îmö©e
(cmd*);

327 
cmd
*

328 
	$∑r£cmd
(*
s
)

330 *
es
;

331 
cmd
 *cmd;

333 
es
 = 
s
 + 
	`°æí
(s);

334 
cmd
 = 
	`∑r£löe
(&
s
, 
es
);

335 
	`≥ek
(&
s
, 
es
, "");

336 if(
s
 !
es
){

337 
	`¥ötf
(2, "À·ovîs: %s\n", 
s
);

338 
	`∑nic
("syntax");

340 
	`nu…îmö©e
(
cmd
);

341  
cmd
;

342 
	}
}

344 
cmd
*

345 
	$∑r£löe
(**
ps
, *
es
)

347 
cmd
 *cmd;

349 
cmd
 = 
	`∑r£pùe
(
ps
, 
es
);

350 
	`≥ek
(
ps
, 
es
, "&")){

351 
	`gëtokí
(
ps
, 
es
, 0, 0);

352 
cmd
 = 
	`backcmd
(cmd);

354 if(
	`≥ek
(
ps
, 
es
, ";")){

355 
	`gëtokí
(
ps
, 
es
, 0, 0);

356 
cmd
 = 
	`li°cmd
(cmd, 
	`∑r£löe
(
ps
, 
es
));

358  
cmd
;

359 
	}
}

361 
cmd
*

362 
	$∑r£pùe
(**
ps
, *
es
)

364 
cmd
 *cmd;

366 
cmd
 = 
	`∑r£exec
(
ps
, 
es
);

367 if(
	`≥ek
(
ps
, 
es
, "|")){

368 
	`gëtokí
(
ps
, 
es
, 0, 0);

369 
cmd
 = 
	`pùecmd
(cmd, 
	`∑r£pùe
(
ps
, 
es
));

371  
cmd
;

372 
	}
}

374 
cmd
*

375 
	$∑r£ªdús
(
cmd
 *cmd, **
ps
, *
es
)

377 
tok
;

378 *
q
, *
eq
;

380 
	`≥ek
(
ps
, 
es
, "<>")){

381 
tok
 = 
	`gëtokí
(
ps
, 
es
, 0, 0);

382 if(
	`gëtokí
(
ps
, 
es
, &
q
, &
eq
) != 'a')

383 
	`∑nic
("missing file forÑedirection");

384 
tok
){

386 
cmd
 = 
	`ªdúcmd
(cmd, 
q
, 
eq
, 
O_RDONLY
, 0);

389 
cmd
 = 
	`ªdúcmd
(cmd, 
q
, 
eq
, 
O_WRONLY
|
O_CREATE
, 1);

392 
cmd
 = 
	`ªdúcmd
(cmd, 
q
, 
eq
, 
O_WRONLY
|
O_CREATE
, 1);

396  
cmd
;

397 
	}
}

399 
cmd
*

400 
	$∑r£block
(**
ps
, *
es
)

402 
cmd
 *cmd;

404 if(!
	`≥ek
(
ps
, 
es
, "("))

405 
	`∑nic
("parseblock");

406 
	`gëtokí
(
ps
, 
es
, 0, 0);

407 
cmd
 = 
	`∑r£löe
(
ps
, 
es
);

408 if(!
	`≥ek
(
ps
, 
es
, ")"))

409 
	`∑nic
("syntax - missing )");

410 
	`gëtokí
(
ps
, 
es
, 0, 0);

411 
cmd
 = 
	`∑r£ªdús
(cmd, 
ps
, 
es
);

412  
cmd
;

413 
	}
}

415 
cmd
*

416 
	$∑r£exec
(**
ps
, *
es
)

418 *
q
, *
eq
;

419 
tok
, 
¨gc
;

420 
execcmd
 *
cmd
;

421 
cmd
 *
ªt
;

423 if(
	`≥ek
(
ps
, 
es
, "("))

424  
	`∑r£block
(
ps
, 
es
);

426 
ªt
 = 
	`execcmd
();

427 
cmd
 = (
execcmd
*)
ªt
;

429 
¨gc
 = 0;

430 
ªt
 = 
	`∑r£ªdús
‘ë, 
ps
, 
es
);

431 !
	`≥ek
(
ps
, 
es
, "|)&;")){

432 if((
tok
=
	`gëtokí
(
ps
, 
es
, &
q
, &
eq
)) == 0)

434 if(
tok
 != 'a')

435 
	`∑nic
("syntax");

436 
cmd
->
¨gv
[
¨gc
] = 
q
;

437 
cmd
->
órgv
[
¨gc
] = 
eq
;

438 
¨gc
++;

439 if(
¨gc
 >
MAXARGS
)

440 
	`∑nic
("too manyárgs");

441 
ªt
 = 
	`∑r£ªdús
‘ë, 
ps
, 
es
);

443 
cmd
->
¨gv
[
¨gc
] = 0;

444 
cmd
->
órgv
[
¨gc
] = 0;

445  
ªt
;

446 
	}
}

449 
cmd
*

450 
	$nu…îmö©e
(
cmd
 *cmd)

452 
i
;

453 
backcmd
 *
bcmd
;

454 
execcmd
 *
ecmd
;

455 
li°cmd
 *
lcmd
;

456 
pùecmd
 *
pcmd
;

457 
ªdúcmd
 *
rcmd
;

459 if(
cmd
 == 0)

462 
cmd
->
ty≥
){

463 
EXEC
:

464 
ecmd
 = (
execcmd
*)
cmd
;

465 
i
=0; 
ecmd
->
¨gv
[i]; i++)

466 *
ecmd
->
órgv
[
i
] = 0;

469 
REDIR
:

470 
rcmd
 = (
ªdúcmd
*)
cmd
;

471 
	`nu…îmö©e
(
rcmd
->
cmd
);

472 *
rcmd
->
efûe
 = 0;

475 
PIPE
:

476 
pcmd
 = (
pùecmd
*)
cmd
;

477 
	`nu…îmö©e
(
pcmd
->
À·
);

478 
	`nu…îmö©e
(
pcmd
->
right
);

481 
LIST
:

482 
lcmd
 = (
li°cmd
*)
cmd
;

483 
	`nu…îmö©e
(
lcmd
->
À·
);

484 
	`nu…îmö©e
(
lcmd
->
right
);

487 
BACK
:

488 
bcmd
 = (
backcmd
*)
cmd
;

489 
	`nu…îmö©e
(
bcmd
->
cmd
);

492  
cmd
;

493 
	}
}

	@sleeplock.c

3 
	~"ty≥s.h
"

4 
	~"defs.h
"

5 
	~"∑øm.h
"

6 
	~"x86.h
"

7 
	~"memœyout.h
"

8 
	~"mmu.h
"

9 
	~"¥oc.h
"

10 
	~"•ölock.h
"

11 
	~"¶ì∂ock.h
"

14 
	$öô¶ì∂ock
(
¶ì∂ock
 *
lk
, *
«me
)

16 
	`öôlock
(&
lk
->lk, "sleepÜock");

17 
lk
->
«me
 =Çame;

18 
lk
->
locked
 = 0;

19 
lk
->
pid
 = 0;

20 
	}
}

23 
	$acquúe¶ìp
(
¶ì∂ock
 *
lk
)

25 
	`acquúe
(&
lk
->lk);

26 
lk
->
locked
) {

27 
	`¶ìp
(
lk
, &lk->lk);

29 
lk
->
locked
 = 1;

30 
lk
->
pid
 = 
	`my¥oc
()->pid;

31 
	`ªÀa£
(&
lk
->lk);

32 
	}
}

35 
	$ªÀa£¶ìp
(
¶ì∂ock
 *
lk
)

37 
	`acquúe
(&
lk
->lk);

38 
lk
->
locked
 = 0;

39 
lk
->
pid
 = 0;

40 
	`wakeup
(
lk
);

41 
	`ªÀa£
(&
lk
->lk);

42 
	}
}

45 
	$hﬁdög¶ìp
(
¶ì∂ock
 *
lk
)

47 
r
;

49 
	`acquúe
(&
lk
->lk);

50 
r
 = 
lk
->
locked
;

51 
	`ªÀa£
(&
lk
->lk);

52  
r
;

53 
	}
}

	@sleeplock.h

2 
	s¶ì∂ock
 {

3 
uöt
 
	mlocked
;

4 
•ölock
 
	mlk
;

7 *
	m«me
;

8 
	mpid
;

	@spinlock.c

3 
	~"ty≥s.h
"

4 
	~"defs.h
"

5 
	~"∑øm.h
"

6 
	~"x86.h
"

7 
	~"memœyout.h
"

8 
	~"mmu.h
"

9 
	~"¥oc.h
"

10 
	~"•ölock.h
"

13 
	$öôlock
(
•ölock
 *
lk
, *
«me
)

15 
lk
->
«me
 =Çame;

16 
lk
->
locked
 = 0;

17 
lk
->
˝u
 = 0;

18 
	}
}

25 
	$acquúe
(
•ölock
 *
lk
)

27 
	`push˛i
();

28 if(
	`hﬁdög
(
lk
))

29 
	`∑nic
("acquire");

32 
	`xchg
(&
lk
->
locked
, 1) != 0)

38 
	`__sync_synchr⁄ize
();

41 
lk
->
˝u
 = 
	`my˝u
();

42 
	`gëˇŒîpcs
(&
lk
,Ük->
pcs
);

43 
	}
}

47 
	$ªÀa£
(
•ölock
 *
lk
)

49 if(!
	`hﬁdög
(
lk
))

50 
	`∑nic
("release");

52 
lk
->
pcs
[0] = 0;

53 
lk
->
˝u
 = 0;

60 
	`__sync_synchr⁄ize
();

65 
asm
 vﬁ©ûe("mov»$0, %0" : "+m" (
lk
->
locked
) : );

67 
	`p›˛i
();

68 
	}
}

72 
	$gëˇŒîpcs
(*
v
, 
uöt
 
pcs
[])

74 
uöt
 *
ebp
;

75 
i
;

77 
ebp
 = (
uöt
*)
v
 - 2;

78 
i
 = 0; i < 10; i++){

79 if(
ebp
 =0 ||Éb∞< (
uöt
*)
KERNBASE
 ||Ébp == (uint*)0xffffffff)

81 
pcs
[
i
] = 
ebp
[1];

82 
ebp
 = (
uöt
*)ebp[0];

84 ; 
i
 < 10; i++)

85 
pcs
[
i
] = 0;

86 
	}
}

90 
	$hﬁdög
(
•ölock
 *
lock
)

92  
lock
->
locked
 &&Üock->
˝u
 =
	`my˝u
();

93 
	}
}

101 
	$push˛i
()

103 
eÊags
;

105 
eÊags
 = 
	`ªadeÊags
();

106 
	`˛i
();

107 if(
	`my˝u
()->
n˛i
 == 0)

108 
	`my˝u
()->
öã«
 = 
eÊags
 & 
FL_IF
;

109 
	`my˝u
()->
n˛i
 += 1;

110 
	}
}

113 
	$p›˛i
()

115 if(
	`ªadeÊags
()&
FL_IF
)

116 
	`∑nic
("popcli - interruptible");

117 if(--
	`my˝u
()->
n˛i
 < 0)

118 
	`∑nic
("popcli");

119 if(
	`my˝u
()->
n˛i
 =0 && my˝u()->
öã«
)

120 
	`°i
();

121 
	}
}

	@spinlock.h

2 
	s•ölock
 {

3 
uöt
 
	mlocked
;

6 *
	m«me
;

7 
˝u
 *
	m˝u
;

8 
uöt
 
	mpcs
[10];

	@stat.h

1 
	#T_DIR
 1

2 
	#T_FILE
 2

3 
	#T_DEV
 3

4 

	)

5 
	s°©
 {

6 
	mty≥
;

7 
	mdev
;

8 
uöt
 
	möo
;

9 
	m∆ök
;

10 
uöt
 
	msize
;

	@stressfs.c

10 
	~"ty≥s.h
"

11 
	~"°©.h
"

12 
	~"u£r.h
"

13 
	~"fs.h
"

14 
	~"f˙é.h
"

17 
	$maö
(
¨gc
, *
¨gv
[])

19 
fd
, 
i
;

20 
∑th
[] = "stressfs0";

21 
d©a
[512];

23 
	`¥ötf
(1, "stressfs starting\n");

24 
	`mem£t
(
d©a
, 'a', (data));

26 
i
 = 0; i < 4; i++)

27 if(
	`f‹k
() > 0)

30 
	`¥ötf
(1, "wrôê%d\n", 
i
);

32 
∑th
[8] +
i
;

33 
fd
 = 
	`›í
(
∑th
, 
O_CREATE
 | 
O_RDWR
);

34 
i
 = 0; i < 20; i++)

36 
	`wrôe
(
fd
, 
d©a
, (data));

37 
	`˛o£
(
fd
);

39 
	`¥ötf
(1, "read\n");

41 
fd
 = 
	`›í
(
∑th
, 
O_RDONLY
);

42 
i
 = 0; i < 20; i++)

43 
	`ªad
(
fd
, 
d©a
, (data));

44 
	`˛o£
(
fd
);

46 
	`waô
();

48 
	`exô
();

49 
	}
}

	@string.c

1 
	~"ty≥s.h
"

2 
	~"x86.h
"

5 
	$mem£t
(*
d°
, 
c
, 
uöt
 
n
)

7 i‡(()
d°
%4 =0 && 
n
%4 == 0){

8 
c
 &= 0xFF;

9 
	`°o¶
(
d°
, (
c
<<24)|(c<<16)|(c<<8)|c, 
n
/4);

11 
	`°osb
(
d°
, 
c
, 
n
);

12  
d°
;

13 
	}
}

16 
	$memcmp
(c⁄° *
v1
, c⁄° *
v2
, 
uöt
 
n
)

18 c⁄° 
uch¨
 *
s1
, *
s2
;

20 
s1
 = 
v1
;

21 
s2
 = 
v2
;

22 
n
-- > 0){

23 if(*
s1
 !*
s2
)

24  *
s1
 - *
s2
;

25 
s1
++, 
s2
++;

29 
	}
}

32 
	$memmove
(*
d°
, c⁄° *
§c
, 
uöt
 
n
)

34 c⁄° *
s
;

35 *
d
;

37 
s
 = 
§c
;

38 
d
 = 
d°
;

39 if(
s
 < 
d
 && s + 
n
 > d){

40 
s
 +
n
;

41 
d
 +
n
;

42 
n
-- > 0)

43 *--
d
 = *--
s
;

45 
n
-- > 0)

46 *
d
++ = *
s
++;

48  
d°
;

49 
	}
}

53 
	$mem˝y
(*
d°
, c⁄° *
§c
, 
uöt
 
n
)

55  
	`memmove
(
d°
, 
§c
, 
n
);

56 
	}
}

59 
	$°∫cmp
(c⁄° *
p
, c⁄° *
q
, 
uöt
 
n
)

61 
n
 > 0 && *
p
 && *∞=*
q
)

62 
n
--, 
p
++, 
q
++;

63 if(
n
 == 0)

65  (
uch¨
)*
p
 - (uch¨)*
q
;

66 
	}
}

69 
	$°∫˝y
(*
s
, c⁄° *
t
, 
n
)

71 *
os
;

73 
os
 = 
s
;

74 
n
-- > 0 && (*
s
++ = *
t
++) != 0)

76 
n
-- > 0)

77 *
s
++ = 0;

78  
os
;

79 
	}
}

83 
	$ß„°r˝y
(*
s
, c⁄° *
t
, 
n
)

85 *
os
;

87 
os
 = 
s
;

88 if(
n
 <= 0)

89  
os
;

90 --
n
 > 0 && (*
s
++ = *
t
++) != 0)

92 *
s
 = 0;

93  
os
;

94 
	}
}

97 
	$°æí
(c⁄° *
s
)

99 
n
;

101 
n
 = 0; 
s
[n];Ç++)

103  
n
;

104 
	}
}

	@syscall.c

1 
	~"ty≥s.h
"

2 
	~"defs.h
"

3 
	~"∑øm.h
"

4 
	~"memœyout.h
"

5 
	~"mmu.h
"

6 
	~"¥oc.h
"

7 
	~"x86.h
"

8 
	~"sysˇŒ.h
"

18 
	$„tchöt
(
uöt
 
addr
, *
ù
)

20 
¥oc
 *
cuΩroc
 = 
	`my¥oc
();

22 if(
addr
 >
cuΩroc
->
sz
 ||áddr+4 > curproc->sz)

24 *
ù
 = *(*)(
addr
);

26 
	}
}

32 
	$„tch°r
(
uöt
 
addr
, **
µ
)

34 *
s
, *
ï
;

35 
¥oc
 *
cuΩroc
 = 
	`my¥oc
();

37 if(
addr
 >
cuΩroc
->
sz
)

39 *
µ
 = (*)
addr
;

40 
ï
 = (*)
cuΩroc
->
sz
;

41 
s
 = *
µ
; s < 
ï
; s++){

42 if(*
s
 == 0)

43  
s
 - *
µ
;

46 
	}
}

50 
	$¨göt
(
n
, *
ù
)

52  
	`„tchöt
((
	`my¥oc
()->
tf
->
e•
Ë+ 4 + 4*
n
, 
ù
);

53 
	}
}

59 
	$¨g±r
(
n
, **
µ
, 
size
)

61 
i
;

62 
¥oc
 *
cuΩroc
 = 
	`my¥oc
();

64 if(
	`¨göt
(
n
, &
i
) < 0)

66 if(
size
 < 0 || (
uöt
)
i
 >
cuΩroc
->
sz
 || (uint)i+size > curproc->sz)

68 *
µ
 = (*)
i
;

70 
	}
}

77 
	$¨g°r
(
n
, **
µ
)

79 
addr
;

80 if(
	`¨göt
(
n
, &
addr
) < 0)

82  
	`„tch°r
(
addr
, 
µ
);

83 
	}
}

85 
sys_chdú
();

86 
sys_˛o£
();

87 
sys_dup
();

88 
sys_exec
();

89 
sys_exô
();

90 
sys_f‹k
();

91 
sys_f°©
();

92 
sys_gëpid
();

93 
sys_kûl
();

94 
sys_lök
();

95 
sys_mkdú
();

96 
sys_mknod
();

97 
sys_›í
();

98 
sys_pùe
();

99 
sys_ªad
();

100 
sys_sbrk
();

101 
sys_¶ìp
();

102 
sys_u∆ök
();

103 
sys_waô
();

104 
sys_wrôe
();

105 
sys_u±ime
();

106 
sys_gëÀv
();

107 
sys_yõld
();

108 
sys_£t_˝u_sh¨e
();

109 
sys_thªad_¸óã
();

110 
sys_thªad_exô
();

111 
sys_thªad_joö
();

112 
sys_pwrôe
();

113 
sys_¥ód
();

115 (*
sysˇŒs
[])() = {

116 [
SYS_f‹k
] 
sys_f‹k
,

117 [
SYS_exô
] 
sys_exô
,

118 [
SYS_waô
] 
sys_waô
,

119 [
SYS_pùe
] 
sys_pùe
,

120 [
SYS_ªad
] 
sys_ªad
,

121 [
SYS_kûl
] 
sys_kûl
,

122 [
SYS_exec
] 
sys_exec
,

123 [
SYS_f°©
] 
sys_f°©
,

124 [
SYS_chdú
] 
sys_chdú
,

125 [
SYS_dup
] 
sys_dup
,

126 [
SYS_gëpid
] 
sys_gëpid
,

127 [
SYS_sbrk
] 
sys_sbrk
,

128 [
SYS_¶ìp
] 
sys_¶ìp
,

129 [
SYS_u±ime
] 
sys_u±ime
,

130 [
SYS_›í
] 
sys_›í
,

131 [
SYS_wrôe
] 
sys_wrôe
,

132 [
SYS_mknod
] 
sys_mknod
,

133 [
SYS_u∆ök
] 
sys_u∆ök
,

134 [
SYS_lök
] 
sys_lök
,

135 [
SYS_mkdú
] 
sys_mkdú
,

136 [
SYS_˛o£
] 
sys_˛o£
,

137 [
SYS_gëÀv
] 
sys_gëÀv
,

138 [
SYS_yõld
] 
sys_yõld
,

139 [
SYS_£t_˝u_sh¨e
] 
sys_£t_˝u_sh¨e
,

140 [
SYS_thªad_¸óã
] 
sys_thªad_¸óã
,

141 [
SYS_thªad_exô
] 
sys_thªad_exô
,

142 [
SYS_thªad_joö
] 
sys_thªad_joö
,

143 [
SYS_pwrôe
] 
sys_pwrôe
,

144 [
SYS_¥ód
] 
sys_¥ód
,

145 
	}
};

148 
	$sysˇŒ
()

150 
num
;

151 
¥oc
 *
cuΩroc
 = 
	`my¥oc
();

153 
num
 = 
cuΩroc
->
tf
->
óx
;

154 if(
num
 > 0 &&Çum < 
	`NELEM
(
sysˇŒs
) && syscalls[num]) {

155 
cuΩroc
->
tf
->
óx
 = 
sysˇŒs
[
num
]();

157 
	`˝rötf
("%d %s: unknown sys call %d\n",

158 
cuΩroc
->
pid
, cuΩroc->
«me
, 
num
);

159 
cuΩroc
->
tf
->
óx
 = -1;

161 
	}
}

	@syscall.h

2 
	#SYS_f‹k
 1

	)

3 
	#SYS_exô
 2

	)

4 
	#SYS_waô
 3

	)

5 
	#SYS_pùe
 4

	)

6 
	#SYS_ªad
 5

	)

7 
	#SYS_kûl
 6

	)

8 
	#SYS_exec
 7

	)

9 
	#SYS_f°©
 8

	)

10 
	#SYS_chdú
 9

	)

11 
	#SYS_dup
 10

	)

12 
	#SYS_gëpid
 11

	)

13 
	#SYS_sbrk
 12

	)

14 
	#SYS_¶ìp
 13

	)

15 
	#SYS_u±ime
 14

	)

16 
	#SYS_›í
 15

	)

17 
	#SYS_wrôe
 16

	)

18 
	#SYS_mknod
 17

	)

19 
	#SYS_u∆ök
 18

	)

20 
	#SYS_lök
 19

	)

21 
	#SYS_mkdú
 20

	)

22 
	#SYS_˛o£
 21

	)

23 
	#SYS_gëÀv
 22

	)

24 
	#SYS_yõld
 23

	)

25 
	#SYS_£t_˝u_sh¨e
 24

	)

26 
	#SYS_thªad_¸óã
 25

	)

27 
	#SYS_thªad_exô
 26

	)

28 
	#SYS_thªad_joö
 27

	)

29 
	#SYS_pwrôe
 28

	)

30 
	#SYS_¥ód
 29

	)

	@sysfile.c

7 
	~"ty≥s.h
"

8 
	~"defs.h
"

9 
	~"∑øm.h
"

10 
	~"°©.h
"

11 
	~"mmu.h
"

12 
	~"¥oc.h
"

13 
	~"fs.h
"

14 
	~"•ölock.h
"

15 
	~"¶ì∂ock.h
"

16 
	~"fûe.h
"

17 
	~"f˙é.h
"

22 
	$¨gfd
(
n
, *
pfd
, 
fûe
 **
pf
)

24 
fd
;

25 
fûe
 *
f
;

27 if(
	`¨göt
(
n
, &
fd
) < 0)

29 if(
fd
 < 0 || fd >
NOFILE
 || (
f
=
	`my¥oc
()->
ofûe
[fd]) == 0)

31 if(
pfd
)

32 *
pfd
 = 
fd
;

33 if(
pf
)

34 *
pf
 = 
f
;

36 
	}
}

41 
	$fdÆloc
(
fûe
 *
f
)

43 
fd
;

44 
¥oc
 *
cuΩroc
 = 
	`my¥oc
();

46 
fd
 = 0; fd < 
NOFILE
; fd++){

47 if(
cuΩroc
->
ofûe
[
fd
] == 0){

48 
cuΩroc
->
ofûe
[
fd
] = 
f
;

49  
fd
;

53 
	}
}

56 
	$sys_dup
()

58 
fûe
 *
f
;

59 
fd
;

61 if(
	`¨gfd
(0, 0, &
f
) < 0)

63 if((
fd
=
	`fdÆloc
(
f
)) < 0)

65 
	`fûedup
(
f
);

66  
fd
;

67 
	}
}

70 
	$sys_ªad
()

72 
fûe
 *
f
;

73 
n
;

74 *
p
;

76 if(
	`¨gfd
(0, 0, &
f
Ë< 0 || 
	`¨göt
(2, &
n
Ë< 0 || 
	`¨g±r
(1, &
p
,Ç) < 0)

78  
	`fûîód
(
f
, 
p
, 
n
);

79 
	}
}

82 
	$sys_wrôe
()

84 
fûe
 *
f
;

85 
n
;

86 *
p
;

88 if(
	`¨gfd
(0, 0, &
f
Ë< 0 || 
	`¨göt
(2, &
n
Ë< 0 || 
	`¨g±r
(1, &
p
,Ç) < 0)

90  
	`fûewrôe
(
f
, 
p
, 
n
);

91 
	}
}

94 
	$sys_pwrôe
()

96 
fûe
 *
f
;

97 
n
;

98 *
p
;

99 
off
;

101 if(
	`¨gfd
(0, 0, &
f
Ë< 0 || 
	`¨göt
(2, &
n
Ë< 0 || 
	`¨g±r
(1, &
p
,Ç) < 0)

104 if(
	`¨göt
(3, &
off
) < 0)

107  
	`pfûewrôe
(
f
, 
p
, 
n
, 
off
);

108 
	}
}

111 
	$sys_¥ód
()

113 
fûe
 *
f
;

114 
n
;

115 *
p
;

116 
off
;

118 if(
	`¨gfd
(0, 0, &
f
Ë< 0 || 
	`¨göt
(2, &
n
Ë< 0 || 
	`¨g±r
(1, &
p
,Ç) < 0)

121 if(
	`¨göt
(3, &
off
) < 0)

124  
	`pfûîód
(
f
, 
p
, 
n
, 
off
);

125 
	}
}

128 
	$sys_˛o£
()

130 
fd
;

131 
fûe
 *
f
;

133 if(
	`¨gfd
(0, &
fd
, &
f
) < 0)

135 
	`my¥oc
()->
ofûe
[
fd
] = 0;

136 
	`fûe˛o£
(
f
);

138 
	}
}

141 
	$sys_f°©
()

143 
fûe
 *
f
;

144 
°©
 *
°
;

146 if(
	`¨gfd
(0, 0, &
f
Ë< 0 || 
	`¨g±r
(1, (*)&
°
, (*st)) < 0)

148  
	`fûe°©
(
f
, 
°
);

149 
	}
}

153 
	$sys_lök
()

155 
«me
[
DIRSIZ
], *
√w
, *
ﬁd
;

156 
öode
 *
dp
, *
ù
;

158 if(
	`¨g°r
(0, &
ﬁd
Ë< 0 ||árg°r(1, &
√w
) < 0)

161 
	`begö_›
();

162 if((
ù
 = 
	`«mei
(
ﬁd
)) == 0){

163 
	`íd_›
();

167 
	`ûock
(
ù
);

168 if(
ù
->
ty≥
 =
T_DIR
){

169 
	`iu∆ockput
(
ù
);

170 
	`íd_›
();

174 
ù
->
∆ök
++;

175 
	`iupd©e
(
ù
);

176 
	`iu∆ock
(
ù
);

178 if((
dp
 = 
	`«meù¨ít
(
√w
, 
«me
)) == 0)

179 
bad
;

180 
	`ûock
(
dp
);

181 if(
dp
->
dev
 !
ù
->dev || 
	`dúlök
(dp, 
«me
, ip->
öum
) < 0){

182 
	`iu∆ockput
(
dp
);

183 
bad
;

185 
	`iu∆ockput
(
dp
);

186 
	`ùut
(
ù
);

188 
	`íd_›
();

192 
bad
:

193 
	`ûock
(
ù
);

194 
ù
->
∆ök
--;

195 
	`iupd©e
(
ù
);

196 
	`iu∆ockput
(
ù
);

197 
	`íd_›
();

199 
	}
}

203 
	$isdúem±y
(
öode
 *
dp
)

205 
off
;

206 
dúít
 
de
;

208 
off
=2*(
de
); off<
dp
->
size
; off+=(de)){

209 if(
	`ªadi
(
dp
, (*)&
de
, 
off
, (de)) != (de))

210 
	`∑nic
("isdirempty:Ñeadi");

211 if(
de
.
öum
 != 0)

215 
	}
}

219 
	$sys_u∆ök
()

221 
öode
 *
ù
, *
dp
;

222 
dúít
 
de
;

223 
«me
[
DIRSIZ
], *
∑th
;

224 
uöt
 
off
;

226 if(
	`¨g°r
(0, &
∑th
) < 0)

229 
	`begö_›
();

230 if((
dp
 = 
	`«meù¨ít
(
∑th
, 
«me
)) == 0){

231 
	`íd_›
();

235 
	`ûock
(
dp
);

238 if(
	`«mecmp
(
«me
, ".") == 0 ||Çamecmp(name, "..") == 0)

239 
bad
;

241 if((
ù
 = 
	`dúlookup
(
dp
, 
«me
, &
off
)) == 0)

242 
bad
;

243 
	`ûock
(
ù
);

245 if(
ù
->
∆ök
 < 1)

246 
	`∑nic
("unlink:Çlink < 1");

247 if(
ù
->
ty≥
 =
T_DIR
 && !
	`isdúem±y
(ip)){

248 
	`iu∆ockput
(
ù
);

249 
bad
;

252 
	`mem£t
(&
de
, 0, (de));

253 if(
	`wrôei
(
dp
, (*)&
de
, 
off
, (de)) != (de))

254 
	`∑nic
("unlink: writei");

255 if(
ù
->
ty≥
 =
T_DIR
){

256 
dp
->
∆ök
--;

257 
	`iupd©e
(
dp
);

259 
	`iu∆ockput
(
dp
);

261 
ù
->
∆ök
--;

262 
	`iupd©e
(
ù
);

263 
	`iu∆ockput
(
ù
);

265 
	`íd_›
();

269 
bad
:

270 
	`iu∆ockput
(
dp
);

271 
	`íd_›
();

273 
	}
}

275 
öode
*

276 
	$¸óã
(*
∑th
, 
ty≥
, 
maj‹
, 
mö‹
)

278 
uöt
 
off
;

279 
öode
 *
ù
, *
dp
;

280 
«me
[
DIRSIZ
];

282 if((
dp
 = 
	`«meù¨ít
(
∑th
, 
«me
)) == 0)

284 
	`ûock
(
dp
);

286 if((
ù
 = 
	`dúlookup
(
dp
, 
«me
, &
off
)) != 0){

287 
	`iu∆ockput
(
dp
);

288 
	`ûock
(
ù
);

289 if(
ty≥
 =
T_FILE
 && 
ù
->type == T_FILE)

290  
ù
;

291 
	`iu∆ockput
(
ù
);

295 if((
ù
 = 
	`üŒoc
(
dp
->
dev
, 
ty≥
)) == 0)

296 
	`∑nic
("create: ialloc");

298 
	`ûock
(
ù
);

299 
ù
->
maj‹
 = major;

300 
ù
->
mö‹
 = minor;

301 
ù
->
∆ök
 = 1;

302 
	`iupd©e
(
ù
);

304 if(
ty≥
 =
T_DIR
){

305 
dp
->
∆ök
++;

306 
	`iupd©e
(
dp
);

308 if(
	`dúlök
(
ù
, ".", ip->
öum
Ë< 0 || dúlök(ù, "..", 
dp
->inum) < 0)

309 
	`∑nic
("create dots");

312 if(
	`dúlök
(
dp
, 
«me
, 
ù
->
öum
) < 0)

313 
	`∑nic
("create: dirlink");

315 
	`iu∆ockput
(
dp
);

317  
ù
;

318 
	}
}

321 
	$sys_›í
()

323 *
∑th
;

324 
fd
, 
omode
;

325 
fûe
 *
f
;

326 
öode
 *
ù
;

328 if(
	`¨g°r
(0, &
∑th
Ë< 0 || 
	`¨göt
(1, &
omode
) < 0)

331 
	`begö_›
();

333 if(
omode
 & 
O_CREATE
){

334 
ù
 = 
	`¸óã
(
∑th
, 
T_FILE
, 0, 0);

335 if(
ù
 == 0){

336 
	`íd_›
();

340 if((
ù
 = 
	`«mei
(
∑th
)) == 0){

341 
	`íd_›
();

344 
	`ûock
(
ù
);

345 if(
ù
->
ty≥
 =
T_DIR
 && 
omode
 !
O_RDONLY
){

346 
	`iu∆ockput
(
ù
);

347 
	`íd_›
();

352 if((
f
 = 
	`fûóŒoc
()Ë=0 || (
fd
 = 
	`fdÆloc
(f)) < 0){

353 if(
f
)

354 
	`fûe˛o£
(
f
);

355 
	`iu∆ockput
(
ù
);

356 
	`íd_›
();

359 
	`iu∆ock
(
ù
);

360 
	`íd_›
();

362 
f
->
ty≥
 = 
FD_INODE
;

363 
f
->
ù
 = ip;

364 
f
->
off
 = 0;

365 
f
->
ªadabÀ
 = !(
omode
 & 
O_WRONLY
);

366 
f
->
wrôabÀ
 = (
omode
 & 
O_WRONLY
Ë|| (omodê& 
O_RDWR
);

367  
fd
;

368 
	}
}

371 
	$sys_mkdú
()

373 *
∑th
;

374 
öode
 *
ù
;

376 
	`begö_›
();

377 if(
	`¨g°r
(0, &
∑th
Ë< 0 || (
ù
 = 
	`¸óã
’©h, 
T_DIR
, 0, 0)) == 0){

378 
	`íd_›
();

381 
	`iu∆ockput
(
ù
);

382 
	`íd_›
();

384 
	}
}

387 
	$sys_mknod
()

389 
öode
 *
ù
;

390 *
∑th
;

391 
maj‹
, 
mö‹
;

393 
	`begö_›
();

394 if((
	`¨g°r
(0, &
∑th
)) < 0 ||

395 
	`¨göt
(1, &
maj‹
) < 0 ||

396 
	`¨göt
(2, &
mö‹
) < 0 ||

397 (
ù
 = 
	`¸óã
(
∑th
, 
T_DEV
, 
maj‹
, 
mö‹
)) == 0){

398 
	`íd_›
();

401 
	`iu∆ockput
(
ù
);

402 
	`íd_›
();

404 
	}
}

407 
	$sys_chdú
()

409 *
∑th
;

410 
öode
 *
ù
;

411 
¥oc
 *
cuΩroc
 = 
	`my¥oc
();

413 
	`begö_›
();

414 if(
	`¨g°r
(0, &
∑th
Ë< 0 || (
ù
 = 
	`«mei
(path)) == 0){

415 
	`íd_›
();

418 
	`ûock
(
ù
);

419 if(
ù
->
ty≥
 !
T_DIR
){

420 
	`iu∆ockput
(
ù
);

421 
	`íd_›
();

424 
	`iu∆ock
(
ù
);

425 
	`ùut
(
cuΩroc
->
cwd
);

426 
	`íd_›
();

427 
cuΩroc
->
cwd
 = 
ù
;

429 
	}
}

432 
	$sys_exec
()

434 *
∑th
, *
¨gv
[
MAXARG
];

435 
i
;

436 
uöt
 
u¨gv
, 
u¨g
;

438 if(
	`¨g°r
(0, &
∑th
Ë< 0 || 
	`¨göt
(1, (*)&
u¨gv
) < 0){

441 
	`mem£t
(
¨gv
, 0, (argv));

442 
i
=0;; i++){

443 if(
i
 >
	`NELEM
(
¨gv
))

445 if(
	`„tchöt
(
u¨gv
+4*
i
, (*)&
u¨g
) < 0)

447 if(
u¨g
 == 0){

448 
¨gv
[
i
] = 0;

451 if(
	`„tch°r
(
u¨g
, &
¨gv
[
i
]) < 0)

454  
	`exec
(
∑th
, 
¨gv
);

455 
	}
}

458 
	$sys_pùe
()

460 *
fd
;

461 
fûe
 *
rf
, *
wf
;

462 
fd0
, 
fd1
;

464 if(
	`¨g±r
(0, (*)&
fd
, 2*(fd[0])) < 0)

466 if(
	`pùóŒoc
(&
rf
, &
wf
) < 0)

468 
fd0
 = -1;

469 if((
fd0
 = 
	`fdÆloc
(
rf
)Ë< 0 || (
fd1
 = fdÆloc(
wf
)) < 0){

470 if(
fd0
 >= 0)

471 
	`my¥oc
()->
ofûe
[
fd0
] = 0;

472 
	`fûe˛o£
(
rf
);

473 
	`fûe˛o£
(
wf
);

476 
fd
[0] = 
fd0
;

477 
fd
[1] = 
fd1
;

479 
	}
}

	@sysproc.c

1 
	~"ty≥s.h
"

2 
	~"x86.h
"

3 
	~"defs.h
"

4 
	~"d©e.h
"

5 
	~"∑øm.h
"

6 
	~"memœyout.h
"

7 
	~"mmu.h
"

8 
	~"¥oc.h
"

10 
uöt
 
	gi
;

13 
	$sys_thªad_¸óã
()

15 
thªad_t
 *
thªad
;

16 *(*
°¨t_routöe
)(*);

17 * 
¨g
;

18 
n
, 
§
, 
a
;

20 if(
	`¨göt
(0, &
n
) < 0)

23 
thªad
 = (
thªad_t
 *)
n
;

25 if(
	`¨göt
(1, &
§
) < 0)

28 
°¨t_routöe
 = (*)
§
;

30 if(
	`¨göt
(2, &
a
) < 0)

33 
¨g
 = (*)
a
;

35  
	`thªad_¸óã
(
thªad
, 
°¨t_routöe
, 
¨g
);

36 
	}
}

39 
	$sys_thªad_exô
()

41 
ªtvÆ
;

43 if(
	`¨göt
(0, &
ªtvÆ
))

46 
	`thªad_exô
((*)
ªtvÆ
);

49 
	}
}

52 
	$sys_thªad_joö
()

54 
thªad
, 
ªtvÆ
;

56 if(
	`¨göt
(0, &
thªad
Ë||árgöt(1, &
ªtvÆ
))

59  
	`thªad_joö
((
thªad_t
)
thªad
, (**)
ªtvÆ
);

60 
	}
}

63 
	$sys_gëÀv
()

65  
	`my¥oc
()->
¥i‹ôy
;

66 
	}
}

69 
	$sys_yõld
()

71 if(++
i
 % 20 == 0)

73 
MLFQ_ticks
++;

74 
	`my¥oc
()->
±icks
++;

75 
	`my¥oc
()->
±ŸÆticks
++;

77 
	`yõld
();

79 
	}
}

82 
	$sys_f‹k
()

84  
	`f‹k
();

85 
	}
}

88 
	$sys_exô
()

90 
	`exô
();

92 
	}
}

95 
	$sys_waô
()

97  
	`waô
();

98 
	}
}

101 
	$sys_kûl
()

103 
pid
;

105 if(
	`¨göt
(0, &
pid
) < 0)

107  
	`kûl
(
pid
);

108 
	}
}

111 
	$sys_gëpid
()

113  
	`my¥oc
()->
pid
;

114 
	}
}

117 
	$sys_sbrk
()

119 
addr
;

120 
n
;

122 if(
	`¨göt
(0, &
n
) < 0)

125 
addr
 = 
	`my¥oc
()->
sz
;

126 if(
	`grow¥oc
(
n
) < 0)

128  
addr
;

129 
	}
}

132 
	$sys_¶ìp
()

134 
n
;

135 
uöt
 
ticks0
;

137 if(
	`¨göt
(0, &
n
) < 0)

139 
	`acquúe
(&
tick¶ock
);

140 
ticks0
 = 
ticks
;

141 
ticks
 - 
ticks0
 < 
n
){

142 if(
	`my¥oc
()->
kûÀd
){

143 
	`ªÀa£
(&
tick¶ock
);

146 
	`¶ìp
(&
ticks
, &
tick¶ock
);

148 
	`ªÀa£
(&
tick¶ock
);

150 
	}
}

155 
	$sys_u±ime
()

157 
uöt
 
xticks
;

159 
	`acquúe
(&
tick¶ock
);

160 
xticks
 = 
ticks
;

161 
	`ªÀa£
(&
tick¶ock
);

162  
xticks
;

163 
	}
}

	@temp.c

2 
	$exô
()

4 
¥oc
 *
cuΩroc
 = 
	`my¥oc
();

5 
¥oc
 *
p
;

6 
fd
, 
check
;

8 if(
cuΩroc
 =
öô¥oc
)

9 
	`∑nic
("initÉxiting");

12 
fd
 = 0; fd < 
NOFILE
; fd++){

13 if(
cuΩroc
->
ofûe
[
fd
]){

14 
	`fûe˛o£
(
cuΩroc
->
ofûe
[
fd
]);

15 
cuΩroc
->
ofûe
[
fd
] = 0;

19 
	`begö_›
();

20 
	`ùut
(
cuΩroc
->
cwd
);

21 
	`íd_›
();

22 
cuΩroc
->
cwd
 = 0;

26 
check
 = 0, 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Ö++)

32 if(
p
->
pid
 =
cuΩroc
->pid)

34 if(
p
 !
cuΩroc
)

37 
fd
 = 0; fd < 
NOFILE
; fd++){

38 if(
p
->
ofûe
[
fd
]){

39 
	`fûe˛o£
(
p
->
ofûe
[
fd
]);

40 
p
->
ofûe
[
fd
] = 0;

43 
	`begö_›
();

44 
	`ùut
(
p
->
cwd
);

45 
	`íd_›
();

46 
p
->
cwd
 = 0;

47 
p
->
°©e
 = 
ZOMBIE
;

48 
check
++;

54 
	`˝rötf
("%d %d\n", 
cuΩroc
->
pid
, 
check
);

56 
cuΩroc
->
°©e
 = 
ZOMBIE
;

58 
	`acquúe
(&
±abÀ
.
lock
);

61 
	`˝rötf
("init\n");

63 if(
cuΩroc
->
isThªad
)

64 
	`wakeup1
(
cuΩroc
->
∑ª¡
->parent);

66 
	`wakeup1
(
cuΩroc
->
∑ª¡
);

70 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Ö++){

72 if(
p
->
∑ª¡
 =
cuΩroc
){

73 
p
->
∑ª¡
 = 
öô¥oc
;

74 if(
p
->
°©e
 =
ZOMBIE
)

75 
	`wakeup1
(
öô¥oc
);

79 
	`sched
();

80 
	`∑nic
("zombieÉxit");

81 
	}
}

84 
	$waô
()

86 
¥oc
 *
p
;

87 
havekids
, 
pid
;

88 
¥oc
 *
cuΩroc
 = 
	`my¥oc
();

90 
	`acquúe
(&
±abÀ
.
lock
);

93 
havekids
 = 0;

94 
p
 = 
±abÀ
.
¥oc
;Ö < &±abÀ.¥oc[
NPROC
];Ö++){

95 if(
p
->
∑ª¡
 !
cuΩroc
)

97 if(
p
->
isThîeExec
)

99 
p
->
isThîeExec
 = 0;

101 
	`˝rötf
("a\n");

102 
	`¥ocdump
();

105 
havekids
 = 1;

106 if(
p
->
°©e
 =
ZOMBIE
){

112 if(
	`kûlßmïid
(
p
->
pid
) != 0)

113 
	`∑nic
("killsamepidÉrror");

114 if(
p
->
isThªad
 && !p->
isMaöThªad
)

120 if(
p
->
isMLFQ
 == 0)

122 
À·Sh¨e
 +
p
->
sh¨e
;

123 
MLFQSåideVÆ
 = 
STRIDENUM
 / 
À·Sh¨e
;

129 
p
->
∑ss
 = 0;

130 
p
->
°ride
 = 0;

131 
p
->
sh¨e
 = 0;

133 
p
->
±icks
 = 0;

134 
p
->
±ŸÆticks
 = 0;

135 
p
->
¥i‹ôy
 = 0;

136 
p
->
isMLFQ
 = 0;

138 
p
->
tid
 = 0;

140 
pid
 = 
p
->pid;

141 
	`k‰ì
(
p
->
k°ack
);

142 
p
->
k°ack
 = 0;

143 if(
p
->
isMaöThªad
)

144 
	`‰ìvm
(
p
->
pgdú
);

145 
p
->
pid
 = 0;

146 
p
->
∑ª¡
 = 0;

147 
p
->
«me
[0] = 0;

148 
p
->
kûÀd
 = 0;

149 
p
->
°©e
 = 
UNUSED
;

150 
âabÀ
.
tid
[
p
->tid].
°©e
 = 
UNUSED
;

152 
	`¥ocdump
();

153 
	`ªÀa£
(&
±abÀ
.
lock
);

154  
pid
;

159 if(!
havekids
 || 
cuΩroc
->
kûÀd
){

160 
	`ªÀa£
(&
±abÀ
.
lock
);

165 
	`¶ìp
(
cuΩroc
, &
±abÀ
.
lock
);

167 
	}
}

170 
	$exec
(*
∑th
, **
¨gv
)

172 *
s
, *
œ°
;

173 
i
, 
off
;

174 
uöt
 
¨gc
, 
sz
, 
•
, 
u°ack
[3+
MAXARG
+1];

175 
ñfhdr
 
ñf
;

176 
öode
 *
ù
;

177 
¥oghdr
 
ph
;

178 
pde_t
 *
pgdú
, *
ﬁdpgdú
;

179 
¥oc
 *
cuΩroc
 = 
	`my¥oc
();

181 
	`begö_›
();

183 if((
ù
 = 
	`«mei
(
∑th
)) == 0){

184 
	`íd_›
();

185 
	`˝rötf
("exec: fail\n");

188 
	`ûock
(
ù
);

189 
pgdú
 = 0;

192 if(
	`ªadi
(
ù
, (*)&
ñf
, 0, (elf)) != (elf))

193 
bad
;

194 if(
ñf
.
magic
 !
ELF_MAGIC
)

195 
bad
;

197 if((
pgdú
 = 
	`£tupkvm
()) == 0)

198 
bad
;

201 
sz
 = 0;

202 
i
=0, 
off
=
ñf
.
phoff
; i<ñf.
phnum
; i++, off+=(
ph
)){

203 if(
	`ªadi
(
ù
, (*)&
ph
, 
off
, (ph)) != (ph))

204 
bad
;

205 if(
ph
.
ty≥
 !
ELF_PROG_LOAD
)

207 if(
ph
.
memsz
 <Öh.
fûesz
)

208 
bad
;

209 if(
ph
.
vaddr
 +Öh.
memsz
 <Öh.vaddr)

210 
bad
;

211 if((
sz
 = 
	`Ælocuvm
(
pgdú
, sz, 
ph
.
vaddr
 +Öh.
memsz
)) == 0)

212 
bad
;

213 if(
ph
.
vaddr
 % 
PGSIZE
 != 0)

214 
bad
;

215 if(
	`lﬂduvm
(
pgdú
, (*)
ph
.
vaddr
, 
ù
,Öh.
off
,Öh.
fûesz
) < 0)

216 
bad
;

218 
	`iu∆ockput
(
ù
);

219 
	`íd_›
();

220 
ù
 = 0;

224 
sz
 = 
	`PGROUNDUP
(sz);

225 if((
sz
 = 
	`Ælocuvm
(
pgdú
, sz, sz + 2*
PGSIZE
)) == 0)

226 
bad
;

227 
	`˛óΩãu
(
pgdú
, (*)(
sz
 - 2*
PGSIZE
));

228 
•
 = 
sz
;

231 
¨gc
 = 0; 
¨gv
[argc];árgc++) {

232 if(
¨gc
 >
MAXARG
)

233 
bad
;

234 
•
 = (• - (
	`°æí
(
¨gv
[
¨gc
]) + 1)) & ~3;

235 if(
	`c›yout
(
pgdú
, 
•
, 
¨gv
[
¨gc
], 
	`°æí
(argv[argc]) + 1) < 0)

236 
bad
;

237 
u°ack
[3+
¨gc
] = 
•
;

239 
u°ack
[3+
¨gc
] = 0;

241 
u°ack
[0] = 0xffffffff;

242 
u°ack
[1] = 
¨gc
;

243 
u°ack
[2] = 
•
 - (
¨gc
+1)*4;

245 
•
 -(3+
¨gc
+1) * 4;

246 if(
	`c›yout
(
pgdú
, 
•
, 
u°ack
, (3+
¨gc
+1)*4) < 0)

247 
bad
;

250 
œ°
=
s
=
∑th
; *s; s++)

251 if(*
s
 == '/')

252 
œ°
 = 
s
+1;

253 
	`ß„°r˝y
(
cuΩroc
->
«me
, 
œ°
, (curproc->name));

256 
ﬁdpgdú
 = 
cuΩroc
->
pgdú
;

257 
cuΩroc
->
pgdú
 =Ögdir;

258 
cuΩroc
->
usz
 = 
sz
;

259 
i
=0; i<
NPROC
; i++)

262 if((
sz
 = 
	`Ælocuvm
(
cuΩroc
->
pgdú
, sz, sz + 2*
PGSIZE
)) == 0)

264 
	`˝rötf
("allocuvm\n");

268 
cuΩroc
->
sz
 = sz;

269 
cuΩroc
->
tf
->
eù
 = 
ñf
.
íåy
;

270 
cuΩroc
->
tf
->
e•
 = 
•
;

271 if(
cuΩroc
->
isThªad
)

274 
cuΩroc
->
isMaöThªad
 = 1;

275 
cuΩroc
->
∑ª¡
->
isThîeExec
 = 1;

276 
cuΩroc
->
∑ª¡
 = curproc->parent->parent;

277 
	`˝rötf
("%d\n", 
cuΩroc
->
∑ª¡
->
pid
);

278 
cuΩroc
->
isThªad
 = 0;

282 
cuΩroc
->
tid
 = 0;

285 
	`swôchuvm
(
cuΩroc
);

286 
	`‰ìvm
(
ﬁdpgdú
);

289 
bad
:

290 if(
pgdú
)

291 
	`‰ìvm
(
pgdú
);

292 if(
ù
){

293 
	`iu∆ockput
(
ù
);

294 
	`íd_›
();

297 
	}
}

	@test_master.c

5 
	~"ty≥s.h
"

6 
	~"°©.h
"

7 
	~"u£r.h
"

10 
	#CNT_CHILD
 4

	)

13 
	#NAME_CHILD_STRIDE
 "ã°_°ride"

	)

15 
	#NAME_CHILD_MLFQ
 "ã°_mlfq"

	)

17 *
	gchûd_¨gv
[
CNT_CHILD
][3] = {

19 {
NAME_CHILD_STRIDE
, "10", 0},

21 {
NAME_CHILD_STRIDE
, "40", 0},

23 {
NAME_CHILD_MLFQ
, "0", 0},

25 {
NAME_CHILD_MLFQ
, "1", 0},

29 
	$maö
(
¨gc
, *
¨gv
[])

31 
pid
;

32 
i
;

34 
i
 = 0; i < 
CNT_CHILD
; i++) {

35 
pid
 = 
	`f‹k
();

36 i‡(
pid
 > 0) {

39 } i‡(
pid
 == 0) {

41 
	`exec
(
chûd_¨gv
[
i
][0], child_argv[i]);

42 
	`¥ötf
(1, "exec failed!!\n");

43 
	`exô
();

45 
	`¥ötf
(1, "fork failed!!\n");

46 
	`exô
();

50 
i
 = 0; i < 
CNT_CHILD
; i++) {

51 
	`waô
();

54 
	`exô
();

55 
	}
}

	@test_master_DI.c

5 
	~"ty≥s.h
"

6 
	~"°©.h
"

7 
	~"u£r.h
"

9 
	#CNT_TEST
 15

	)

11 
	#CNT_CHILD
 10

	)

12 
	#CNT_EXCEED
 5

	)

15 
	#NAME_CHILD_STRIDE
 "ã°_°ride"

	)

17 
	#NAME_CHILD_MLFQ
 "ã°_mlfq"

	)

18 
	#NOOP
 "NOOP"

	)

20 *
	gchûd_¨gv
[
CNT_TEST
][
CNT_CHILD
][3] = {

22 { {
NAME_CHILD_MLFQ
, "0", 0},

23 {
NOOP
, 0, 0} },

24 { {
NAME_CHILD_MLFQ
, "1", 0},

25 {
NOOP
, 0, 0} },

26 { {
NAME_CHILD_MLFQ
, "0", 0},

27 {
NAME_CHILD_MLFQ
, "1", 0},

28 {
NOOP
, 0, 0} },

29 { {
NAME_CHILD_MLFQ
, "0", 0},

30 {
NAME_CHILD_MLFQ
, "0", 0},

31 {
NAME_CHILD_MLFQ
, "0", 0},

32 {
NAME_CHILD_MLFQ
, "0", 0},

33 {
NAME_CHILD_MLFQ
, "0", 0},

34 {
NAME_CHILD_MLFQ
, "0", 0},

35 {
NAME_CHILD_MLFQ
, "0", 0},

36 {
NAME_CHILD_MLFQ
, "0", 0},

37 {
NAME_CHILD_MLFQ
, "0", 0},

38 {
NAME_CHILD_MLFQ
, "0", 0} },

39 { {
NAME_CHILD_MLFQ
, "1", 0},

40 {
NAME_CHILD_MLFQ
, "1", 0},

41 {
NAME_CHILD_MLFQ
, "1", 0},

42 {
NAME_CHILD_MLFQ
, "1", 0},

43 {
NAME_CHILD_MLFQ
, "1", 0},

44 {
NAME_CHILD_MLFQ
, "1", 0},

45 {
NAME_CHILD_MLFQ
, "1", 0},

46 {
NAME_CHILD_MLFQ
, "1", 0},

47 {
NAME_CHILD_MLFQ
, "1", 0},

48 {
NAME_CHILD_MLFQ
, "1", 0} },

49 { {
NAME_CHILD_MLFQ
, "0", 0},

50 {
NAME_CHILD_MLFQ
, "1", 0},

51 {
NAME_CHILD_MLFQ
, "0", 0},

52 {
NAME_CHILD_MLFQ
, "1", 0},

53 {
NAME_CHILD_MLFQ
, "0", 0},

54 {
NAME_CHILD_MLFQ
, "1", 0},

55 {
NAME_CHILD_MLFQ
, "0", 0},

56 {
NAME_CHILD_MLFQ
, "1", 0},

57 {
NAME_CHILD_MLFQ
, "0", 0},

58 {
NAME_CHILD_MLFQ
, "1", 0} },

61 { {
NAME_CHILD_STRIDE
, "40", 0},

62 {
NOOP
, 0, 0} },

63 { {
NAME_CHILD_STRIDE
, "10", 0},

64 {
NAME_CHILD_STRIDE
, "30", 0},

65 {
NAME_CHILD_STRIDE
, "40", 0},

66 {
NOOP
, 0, 0} },

67 { {
NAME_CHILD_STRIDE
, "1", 0},

68 {
NAME_CHILD_STRIDE
, "2", 0},

69 {
NAME_CHILD_STRIDE
, "3", 0},

70 {
NAME_CHILD_STRIDE
, "4", 0},

71 {
NAME_CHILD_STRIDE
, "5", 0},

72 {
NAME_CHILD_STRIDE
, "6", 0},

73 {
NAME_CHILD_STRIDE
, "7", 0},

74 {
NAME_CHILD_STRIDE
, "8", 0},

75 {
NAME_CHILD_STRIDE
, "9", 0},

76 {
NAME_CHILD_STRIDE
, "10", 0} },

77 { {
NAME_CHILD_STRIDE
, "80", 0},

78 {
NOOP
, 0, 0} },

81 { {
NAME_CHILD_STRIDE
, "10", 0},

82 {
NAME_CHILD_STRIDE
, "20", 0},

83 {
NAME_CHILD_STRIDE
, "30", 0},

84 {
NAME_CHILD_STRIDE
, "15", 0},

85 {
NAME_CHILD_STRIDE
, "6", 0},

86 {
NOOP
, 0, 0} },

87 { {
NAME_CHILD_STRIDE
, "81", 0},

88 {
NOOP
, 0, 0} },

90 { {
NAME_CHILD_MLFQ
, "0", 0},

91 {
NAME_CHILD_MLFQ
, "1", 0},

92 {
NAME_CHILD_STRIDE
, "10", 0},

93 {
NAME_CHILD_MLFQ
, "0", 0},

94 {
NAME_CHILD_MLFQ
, "1", 0},

95 {
NAME_CHILD_STRIDE
, "10", 0},

96 {
NAME_CHILD_MLFQ
, "1", 0},

97 {
NAME_CHILD_STRIDE
, "20", 0},

98 {
NAME_CHILD_MLFQ
, "0", 0},

99 {
NAME_CHILD_STRIDE
, "30", 0} },

100 { {
NAME_CHILD_STRIDE
, "81", 0},

101 {
NAME_CHILD_MLFQ
, "1", 0},

102 {
NAME_CHILD_MLFQ
, "0", 0},

103 {
NOOP
, 0, 0} },

104 { {
NAME_CHILD_MLFQ
, "1", 0},

105 {
NAME_CHILD_MLFQ
, "0", 0},

106 {
NAME_CHILD_STRIDE
, "10", 0},

107 {
NAME_CHILD_STRIDE
, "20", 0},

108 {
NAME_CHILD_STRIDE
, "30", 0},

109 {
NAME_CHILD_STRIDE
, "15", 0},

110 {
NAME_CHILD_STRIDE
, "6", 0},

111 {
NOOP
, 0, 0} },

115 
	$maö
(
¨gc
, *
¨gv
[])

117 
pid
;

118 
i
, 
j
, 
k
;

119 
i
 = 0; i < 
CNT_TEST
; i++) {

120 
k
 = 0;

121 
j
 = 0; j < 
CNT_CHILD
; j++) {

122 i‡(!
	`°rcmp
(
chûd_¨gv
[
i
][
j
][0], 
NOOP
))

124 
k
++;

125 
pid
 = 
	`f‹k
();

126 i‡(
pid
 > 0) {

129 } i‡(
pid
 == 0) {

131 
	`exec
(
chûd_¨gv
[
i
][
j
][0], child_argv[i][j]);

132 
	`¥ötf
(1, "exec failed!!\n");

133 
	`exô
();

135 
	`¥ötf
(1, "fork failed!!\n");

136 
	`exô
();

140 
j
 = 0; j < 
k
; j++) {

141 
	`waô
();

143 
	`¥ötf
(1, "\n%dÅe° d⁄e\n\n", 
i
+1);

146 
	`exô
();

147 
	}
}

	@test_mlfq.c

8 
	~"ty≥s.h
"

9 
	~"°©.h
"

10 
	~"u£r.h
"

12 
	#LIFETIME
 200000000

13 
	#YIELD_PERIOD
 10000

14 

	)

16 
	#MLFQ_LEVEL
 3

	)

19 
	$maö
(
¨gc
, *
¨gv
[])

21 
uöt
 
i
;

22 
˙t_Àvñ
[
MLFQ_LEVEL
] = {0, 0, 0};

23 
do_yõld
;

24 
cuº_mlfq_Àvñ
;

26 i‡(
¨gc
 < 2) {

27 
	`¥ötf
(1, "usage: sched_test_mlfq do_yield_or_not(0|1)\n");

28 
	`exô
();

31 
do_yõld
 = 
	`©oi
(
¨gv
[1]);

33 
i
 = 0;

35 
i
++;

38 
	`__sync_synchr⁄ize
();

40 i‡(
i
 % 
YIELD_PERIOD
 == 0) {

42 
cuº_mlfq_Àvñ
 = 
	`gëÀv
();

43 
˙t_Àvñ
[
cuº_mlfq_Àvñ
]++;

45 i‡(
i
 > 
LIFETIME
) {

46 
	`¥ötf
(1, "MLFQ(%s),Üev[0]: %d,Üev[1]: %d,Üev[2]: %d\n",

47 
do_yõld
==0 ? "compute" : "yield",

48 
˙t_Àvñ
[0], cnt_level[1], cnt_level[2]);

52 i‡(
do_yõld
) {

54 
	`yõld
();

59 
	`exô
();

60 
	}
}

	@test_stride.c

7 
	~"ty≥s.h
"

8 
	~"°©.h
"

9 
	~"u£r.h
"

11 
	#LIFETIME
 1000

12 
	#COUNT_PERIOD
 1000000

13 

	)

15 
	$maö
(
¨gc
, *
¨gv
[])

17 
uöt
 
i
;

18 
˙t
 = 0;

19 
˝u_sh¨e
;

20 
uöt
 
°¨t_tick
;

21 
uöt
 
cuº_tick
;

23 i‡(
¨gc
 < 2) {

24 
	`¥ötf
(1, "usage: sched_test_stride cpu_share(%)\n");

25 
	`exô
();

28 
˝u_sh¨e
 = 
	`©oi
(
¨gv
[1]);

31 i‡(
	`£t_˝u_sh¨e
(
˝u_sh¨e
) < 0) {

32 
	`¥ötf
(1, "cannot set cpu share\n");

33 
	`exô
();

37 
°¨t_tick
 = 
	`u±ime
();

39 
i
 = 0;

41 
i
++;

44 
	`__sync_synchr⁄ize
();

46 i‡(
i
 =
COUNT_PERIOD
) {

47 
˙t
++;

50 
cuº_tick
 = 
	`u±ime
();

52 i‡(
cuº_tick
 - 
°¨t_tick
 > 
LIFETIME
) {

54 
	`¥ötf
(1, "STRIDE(%d%%), c¡: %d\n", 
˝u_sh¨e
, 
˙t
);

57 
i
 = 0;

61 
	`exô
();

62 
	}
}

	@thread_fork_1.c

1 
	~"ty≥s.h
"

2 
	~"°©.h
"

3 
	~"u£r.h
"

5 
	#NUM_THREAD
 10

	)

8 
	$f‹kthªad
(*
¨g
)

10 
pid
;

11 i‡((
pid
 = 
	`f‹k
()) == -1) {

12 
	`¥ötf
(1, "panicát fork in forktest\n");

13 
	`exô
();

14 } i‡(
pid
 == 0) {

15 
	`¥ötf
(1, "child\n");

16 
	`exô
();

18 
	`¥ötf
(1, "parent\n");

19 i‡(
	`waô
() == -1) {

20 
	`¥ötf
(1, "panicát wait in forktest\n");

21 
	`exô
();

24 
	`thªad_exô
(0);

25 
	}
}

28 
	$maö
(
¨gc
, *
¨gv
[])

30 
thªad_t
 
thªads
[
NUM_THREAD
];

31 
i
;

32 *
ªtvÆ
;

34 
i
 = 0; i < 
NUM_THREAD
; i++) {

35 i‡(
	`thªad_¸óã
(&
thªads
[
i
], 
f‹kthªad
, (*)0) != 0) {

36 
	`¥ötf
(1, "panicátÅhread_create\n");

37 
	`exô
();

40 
i
 = 0; i < 
NUM_THREAD
; i++) {

41 i‡(
	`thªad_joö
(
thªads
[
i
], &
ªtvÆ
) != 0) {

42 
	`¥ötf
(1, "panicátÅhread_join\n");

43 
	`exô
();

46 
	`exô
();

47 
	}
}

	@threadtest.c

1 
	~"ty≥s.h
"

2 
	~"°©.h
"

3 
	~"u£r.h
"

5 
	#NUM_THREAD
 10

	)

6 
	#NTEST
 14

	)

9 
øcögã°
();

12 
basi˘e°
();

13 
joöã°1
();

14 
joöã°2
();

17 
°ªs°e°
();

20 
exôã°1
();

21 
exôã°2
();

27 
exe˘e°
();

30 
sbrkã°
();

33 
kû…e°
();

36 
pùëe°
();

39 
¶ì±e°
();

42 
°ridëe°1
();

43 
°ridëe°2
();

45 
	gg˙t
;

46 
	ggpùe
[2];

48 (*
ã°func
[
NTEST
])() = {

49 
øcögã°
,

50 
basi˘e°
,

51 
joöã°1
,

52 
joöã°2
,

53 
°ªs°e°
,

54 
exôã°1
,

55 
exôã°2
,

56 
exe˘e°
,

57 
sbrkã°
,

58 
kû…e°
,

59 
pùëe°
,

60 
¶ì±e°
,

61 
°ridëe°1
,

62 
°ridëe°2
,

63 
	}
};

64 *
	gã°«me
[
NTEST
] = {

82 
	$maö
(
¨gc
, *
¨gv
[])

84 
i
;

85 
ªt
;

86 
pid
;

87 
°¨t
 = 0;

88 
íd
 = 
NTEST
-1;

89 i‡(
¨gc
 >= 2)

90 
°¨t
 = 
	`©oi
(
¨gv
[1]);

91 i‡(
¨gc
 >= 3)

92 
íd
 = 
	`©oi
(
¨gv
[2]);

94 
i
 = 
°¨t
; i <
íd
; i++){

95 
	`¥ötf
(1,"%d. %†°¨t\n", 
i
, 
ã°«me
[i]);

96 i‡(
	`pùe
(
gpùe
) < 0){

97 
	`¥ötf
(1,"pipeÖanic\n");

98 
	`exô
();

100 
ªt
 = 0;

102 i‡((
pid
 = 
	`f‹k
()) < 0){

103 
	`¥ötf
(1,"forkÖanic\n");

104 
	`exô
();

106 i‡(
pid
 == 0){

107 
	`˛o£
(
gpùe
[0]);

109 
ªt
 = 
ã°func
[
i
]();

111 
	`wrôe
(
gpùe
[1], (*)&
ªt
, (ret));

113 
	`˛o£
(
gpùe
[1]);

115 
	`exô
();

117 
	`˛o£
(
gpùe
[1]);

120 i‡(
	`waô
(Ë=-1 || 
	`ªad
(
gpùe
[0], (*)&
ªt
, (ret)) == -1 ||Ñet != 0){

121 
	`¥ötf
(1,"%d. %†∑nic\n", 
i
, 
ã°«me
[i]);

122 
	`exô
();

125 
	`˛o£
(
gpùe
[0]);

127 
	`¥ötf
(1,"%d. %†föish\n", 
i
, 
ã°«me
[i]);

128 
	`¶ìp
(100);

130 
	`exô
();

131 
	}
}

134 
	$n›
(){ 
	}
}

137 
	$øcögthªadmaö
(*
¨g
)

140 
tid
 = (Ë
¨g
;

141 
i
;

142 
tmp
;

143 
i
 = 0; i < 10000000; i++){

144 
tmp
 = 
g˙t
;

145 
tmp
++;

146 
	`n›
();

147 
g˙t
 = 
tmp
;

149 
	`thªad_exô
((*)(
tid
+1));

150 
	}
}

153 
	$øcögã°
()

155 
thªad_t
 
thªads
[
NUM_THREAD
];

156 
i
;

157 *
ªtvÆ
;

158 
g˙t
 = 0;

160 
i
 = 0; i < 
NUM_THREAD
; i++){

162 i‡(
	`thªad_¸óã
(&
thªads
[
i
], 
øcögthªadmaö
, (*)i) != 0){

163 
	`¥ötf
(1, "panicátÅhread_create\n");

168 
i
 = 0; i < 
NUM_THREAD
; i++){

169 i‡(
	`thªad_joö
(
thªads
[
i
], &
ªtvÆ
) != 0 || ()retval != i+1){

172 
	`¥ötf
(1, "panicátÅhread_join\n");

177 
	`¥ötf
(1,"%d\n", 
g˙t
);

179 
	}
}

183 
	$basi˘hªadmaö
(*
¨g
)

185 
tid
 = (Ë
¨g
;

186 
i
;

187 
i
 = 0; i < 100000000; i++){

188 i‡(
i
 % 20000000 == 0){

189 
	`¥ötf
(1, "%d", 
tid
);

192 
	`thªad_exô
((*)(
tid
+1));

193 
	}
}

196 
	$basi˘e°
()

198 
thªad_t
 
thªads
[
NUM_THREAD
];

199 
i
;

200 *
ªtvÆ
;

202 
i
 = 0; i < 
NUM_THREAD
; i++){

203 i‡(
	`thªad_¸óã
(&
thªads
[
i
], 
basi˘hªadmaö
, (*)i) != 0){

204 
	`¥ötf
(1, "panicátÅhread_create\n");

209 
i
 = 0; i < 
NUM_THREAD
; i++){

210 i‡(
	`thªad_joö
(
thªads
[
i
], &
ªtvÆ
) != 0 || ()retval != i+1){

211 
	`¥ötf
(1, "panicátÅhread_join\n");

215 
	`¥ötf
(1,"\n");

217 
	}
}

222 
	$joöthªadmaö
(*
¨g
)

224 
vÆ
 = ()
¨g
;

225 
	`¶ìp
(200);

226 
	`¥ötf
(1, "thread_exit...\n");

227 
	`thªad_exô
((*)(
vÆ
*2));

228 
	}
}

231 
	$joöã°1
()

233 
thªad_t
 
thªads
[
NUM_THREAD
];

234 
i
;

235 *
ªtvÆ
;

237 
i
 = 1; i <
NUM_THREAD
; i++){

238 i‡(
	`thªad_¸óã
(&
thªads
[
i
-1], 
joöthªadmaö
, (*)i) != 0){

239 
	`¥ötf
(1, "panicátÅhread_create\n");

243 
	`¥ötf
(1, "thread_join!!!\n");

244 
i
 = 1; i <
NUM_THREAD
; i++){

245 i‡(
	`thªad_joö
(
thªads
[
i
-1], &
ªtvÆ
) != 0 || ()retval != i * 2 ){

246 
	`¥ötf
(1, "panicátÅhread_join\n");

250 
	`¥ötf
(1,"\n");

252 
	}
}

255 
	$joöã°2
()

257 
thªad_t
 
thªads
[
NUM_THREAD
];

258 
i
;

259 *
ªtvÆ
;

261 
i
 = 1; i <
NUM_THREAD
; i++){

262 i‡(
	`thªad_¸óã
(&
thªads
[
i
-1], 
joöthªadmaö
, (*)(i)) != 0){

263 
	`¥ötf
(1, "panicátÅhread_create\n");

267 
	`¶ìp
(500);

268 
	`¥ötf
(1, "thread_join!!!\n");

269 
i
 = 1; i <
NUM_THREAD
; i++){

270 i‡(
	`thªad_joö
(
thªads
[
i
-1], &
ªtvÆ
) != 0 || ()retval != i * 2 ){

271 
	`¥ötf
(1, "panicátÅhread_join\n");

275 
	`¥ötf
(1,"\n");

277 
	}
}

282 
	$°ªs°hªadmaö
(*
¨g
)

284 
	`thªad_exô
(0);

285 
	}
}

288 
	$°ªs°e°
()

290 c⁄° 
n°ªss
 = 35000;

291 
thªad_t
 
thªads
[
NUM_THREAD
];

292 
i
, 
n
;

293 *
ªtvÆ
;

295 
n
 = 1;Ç <
n°ªss
;Ç++){

296 i‡(
n
 % 1000 == 0)

297 
	`¥ötf
(1, "%d\n", 
n
);

298 
i
 = 0; i < 
NUM_THREAD
; i++){

299 i‡(
	`thªad_¸óã
(&
thªads
[
i
], 
°ªs°hªadmaö
, (*)i) != 0){

300 
	`¥ötf
(1, "panicátÅhread_create\n");

304 
i
 = 0; i < 
NUM_THREAD
; i++){

305 i‡(
	`thªad_joö
(
thªads
[
i
], &
ªtvÆ
) != 0){

306 
	`¥ötf
(1, "panicátÅhread_join\n");

311 
	`¥ötf
(1, "\n");

313 
	}
}

318 
	$exôthªadmaö
(*
¨g
)

320 
i
;

321 i‡(()
¨g
 == 1){

323 
	`¥ötf
(1, "thread_exit ...\n");

324 
i
 = 0; i < 5000000; i++);

326 } i‡(()
¨g
 == 2){

327 
	`exô
();

329 
	`¥ötf
(1,"%d ",()
¨g
);

330 
	`thªad_exô
(0);

331 
	}
}

334 
	$exôã°1
()

336 
thªad_t
 
thªads
[
NUM_THREAD
];

337 
i
;

339 
i
 = 0; i < 
NUM_THREAD
; i++){

340 i‡(
	`thªad_¸óã
(&
thªads
[
i
], 
exôthªadmaö
, (*)1) != 0){

341 
	`¥ötf
(1, "panicátÅhread_create\n");

345 
	`¶ìp
(1);

347 
	}
}

350 
	$exôã°2
()

352 
thªad_t
 
thªads
[
NUM_THREAD
];

353 
i
;

355 
i
 = 0; i < 
NUM_THREAD
; i++){

356 i‡(
	`thªad_¸óã
(&
thªads
[
i
], 
exôthªadmaö
, (*)2) != 0){

357 
	`¥ötf
(1, "panicátÅhread_create\n");

364 
	}
}

369 
	$exe˘hªadmaö
(*
¨g
)

371 *
¨gs
[3] = {"echo", "echo isÉxecuted!", 0};

372 
	`¶ìp
(1);

373 
	`exec
("echo", 
¨gs
);

375 
	`¥ötf
(1, "panicátÉxecthreadmain\n");

376 
	`exô
();

377 
	}
}

380 
	$exe˘e°
()

382 
thªad_t
 
thªads
[
NUM_THREAD
];

383 
i
;

384 *
ªtvÆ
;

388 
i
 = 0; i < 
NUM_THREAD
; i++){

389 i‡(
	`thªad_¸óã
(&
thªads
[
i
], 
exe˘hªadmaö
, (*)0) != 0){

390 
	`¥ötf
(1, "panicátÅhread_create\n");

395 
i
 = 0; i < 
NUM_THREAD
; i++){

396 i‡(
	`thªad_joö
(
thªads
[
i
], &
ªtvÆ
) != 0){

397 
	`¥ötf
(1, "panicátÅhread_join\n");

401 
	`¥ötf
(1, "panicátÉxectest\n");

403 
	}
}

408 
	$sbrkthªadmaö
(*
¨g
)

410 
tid
 = ()
¨g
;

411 *
ﬁdbrk
;

412 *
íd
;

413 *
c
;

414 
ﬁdbrk
 = 
	`sbrk
(1000);

415 
íd
 = 
ﬁdbrk
 + 1000;

416 
c
 = 
ﬁdbrk
; c < 
íd
; c++){

417 *
c
 = 
tid
+1;

419 
	`¶ìp
(1);

420 
c
 = 
ﬁdbrk
; c < 
íd
; c++){

421 i‡(*
c
 !
tid
+1){

422 
	`¥ötf
(1, "panicát sbrkthreadmain\n");

423 
	`exô
();

426 
	`thªad_exô
(0);

427 
	}
}

430 
	$sbrkã°
()

432 
thªad_t
 
thªads
[
NUM_THREAD
];

433 
i
;

434 *
ªtvÆ
;

436 
i
 = 0; i < 
NUM_THREAD
; i++){

437 i‡(
	`thªad_¸óã
(&
thªads
[
i
], 
sbrkthªadmaö
, (*)i) != 0){

438 
	`¥ötf
(1, "panicátÅhread_create\n");

442 
i
 = 0; i < 
NUM_THREAD
; i++){

443 i‡(
	`thªad_joö
(
thªads
[
i
], &
ªtvÆ
) != 0){

444 
	`¥ötf
(1, "panicátÅhread_join\n");

450 
	}
}

455 
	$kû…hªadmaö
(*
¨g
)

458 
	`kûl
(
	`gëpid
());

460 
	}
}

463 
	$kû…e°
()

465 
thªad_t
 
thªads
[
NUM_THREAD
];

466 
i
;

467 *
ªtvÆ
;

469 
i
 = 0; i < 
NUM_THREAD
; i++){

470 i‡(
	`thªad_¸óã
(&
thªads
[
i
], 
kû…hªadmaö
, (*)i) != 0){

471 
	`¥ötf
(1, "panicátÅhread_create\n");

475 
i
 = 0; i < 
NUM_THREAD
; i++){

476 i‡(
	`thªad_joö
(
thªads
[
i
], &
ªtvÆ
) != 0){

477 
	`¥ötf
(1, "panicátÅhread_join\n");

483 
	}
}

488 
	$pùëhªadmaö
(*
¨g
)

490 
ty≥
 = ((*)
¨g
)[0];

491 *
fd
 = (*)
¨g
+1;

492 
i
;

493 
öput
;

494 
i
 = -5; i <= 5; i++){

495 i‡(
ty≥
){

496 
	`ªad
(
fd
[0], &
öput
, ());

497 
	`__sync_„tch_™d_add
(&
g˙t
, 
öput
);

500 
	`wrôe
(
fd
[1], &
i
, ());

503 
	`thªad_exô
(0);

504 
	}
}

507 
	$pùëe°
()

509 
thªad_t
 
thªads
[
NUM_THREAD
];

510 
¨g
[3];

511 
fd
[2];

512 
i
;

513 *
ªtvÆ
;

514 
pid
;

516 i‡(
	`pùe
(
fd
) < 0){

517 
	`¥ötf
(1, "panicátÖipe inÖipetest\n");

520 
¨g
[1] = 
fd
[0];

521 
¨g
[2] = 
fd
[1];

522 i‡((
pid
 = 
	`f‹k
()) < 0){

523 
	`¥ötf
(1, "panicát fork inÖipetest\n");

525 } i‡(
pid
 == 0){

526 
	`˛o£
(
fd
[0]);

527 
¨g
[0] = 0;

528 
i
 = 0; i < 
NUM_THREAD
; i++){

529 i‡(
	`thªad_¸óã
(&
thªads
[
i
], 
pùëhªadmaö
, (*)
¨g
) != 0){

530 
	`¥ötf
(1, "panicátÅhread_create\n");

534 
i
 = 0; i < 
NUM_THREAD
; i++){

535 i‡(
	`thªad_joö
(
thªads
[
i
], &
ªtvÆ
) != 0){

536 
	`¥ötf
(1, "panicátÅhread_join\n");

540 
	`˛o£
(
fd
[1]);

541 
	`exô
();

543 
	`˛o£
(
fd
[1]);

544 
¨g
[0] = 1;

545 
g˙t
 = 0;

546 
i
 = 0; i < 
NUM_THREAD
; i++){

547 i‡(
	`thªad_¸óã
(&
thªads
[
i
], 
pùëhªadmaö
, (*)
¨g
) != 0){

548 
	`¥ötf
(1, "panicátÅhread_create\n");

552 
i
 = 0; i < 
NUM_THREAD
; i++){

553 i‡(
	`thªad_joö
(
thªads
[
i
], &
ªtvÆ
) != 0){

554 
	`¥ötf
(1, "panicátÅhread_join\n");

558 
	`˛o£
(
fd
[0]);

560 i‡(
	`waô
() == -1){

561 
	`¥ötf
(1, "panicát wait inÖipetest\n");

564 i‡(
g˙t
 != 0)

565 
	`¥ötf
(1,"∑ni¯© vÆid©i⁄ i¿pùëe° : %d\n", 
g˙t
);

568 
	}
}

573 
	$¶ì±hªadmaö
(*
¨g
)

576 
	`¶ìp
(10000000);

577 
	`thªad_exô
(0);

578 
	}
}

581 
	$¶ì±e°
()

583 
thªad_t
 
thªads
[
NUM_THREAD
];

584 
i
;

586 
i
 = 0; i < 
NUM_THREAD
; i++){

587 i‡(
	`thªad_¸óã
(&
thªads
[
i
], 
¶ì±hªadmaö
, (*)i) != 0){

588 
	`¥ötf
(1, "panicátÅhread_create\n");

593 
	`¶ìp
(100);

596 
	}
}

601 
	$°ridëhªadmaö
(*
¨g
)

603 *
Êag
 = (*)
¨g
;

604 
t
;

605 *
Êag
){

606 *
Êag
 == 1){

607 
t
 = 0;Å < 5;Å++);

608 
	`__sync_„tch_™d_add
(&
g˙t
, 1);

611 
	`thªad_exô
(0);

612 
	}
}

615 
	$°ridëe°1
()

617 
thªad_t
 
thªads
[
NUM_THREAD
];

618 
i
;

619 
pid
;

620 
Êag
;

621 *
ªtvÆ
;

623 
g˙t
 = 0;

624 
Êag
 = 2;

625 i‡((
pid
 = 
	`f‹k
()) == -1){

626 
	`¥ötf
(1, "panicát fork in forktest\n");

627 
	`exô
();

628 } i‡(
pid
 == 0){

629 
	`£t_˝u_sh¨e
(50);

631 
	`£t_˝u_sh¨e
(10);

634 
i
 = 0; i < 
NUM_THREAD
; i++){

636 i‡(
	`thªad_¸óã
(&
thªads
[
i
], 
°ridëhªadmaö
, (*)&
Êag
) != 0){

637 
	`¥ötf
(1, "panicátÅhread_create\n");

641 
Êag
 = 1;

642 
	`¶ìp
(500);

644 
Êag
 = 0;

645 
i
 = 0; i < 
NUM_THREAD
; i++){

646 i‡(
	`thªad_joö
(
thªads
[
i
], &
ªtvÆ
) != 0){

647 
	`¥ötf
(1, "panicátÅhread_join\n");

652 i‡(
pid
 == 0){

653 
	`¥ötf
(1, "50% : %d\n", 
g˙t
);

654 
	`exô
();

656 
	`¥ötf
(1, "10% : %d\n", 
g˙t
);

657 i‡(
	`waô
() == -1){

658 
	`¥ötf
(1, "panicát wait in forktest\n");

659 
	`exô
();

662 
	`¥ötf
(1,"end\n");

664 
	}
}

667 
	$°ridëe°2
()

669 
thªad_t
 
thªads
[
NUM_THREAD
];

670 
i
;

671 
pid
;

672 
Êag
;

673 *
ªtvÆ
;

675 
g˙t
 = 0;

676 
Êag
 = 2;

677 i‡((
pid
 = 
	`f‹k
()) == -1){

678 
	`¥ötf
(1, "panicát fork in forktest\n");

679 
	`exô
();

682 
i
 = 0; i < 
NUM_THREAD
; i++){

683 i‡(
	`thªad_¸óã
(&
thªads
[
i
], 
°ridëhªadmaö
, (*)&
Êag
) != 0){

684 
	`¥ötf
(1, "panicátÅhread_create\n");

688 i‡(
pid
 == 0){

689 
	`£t_˝u_sh¨e
(60);

691 
	`£t_˝u_sh¨e
(20);

693 
Êag
 = 1;

694 
	`¶ìp
(500);

695 
Êag
 = 0;

696 
i
 = 0; i < 
NUM_THREAD
; i++){

697 i‡(
	`thªad_joö
(
thªads
[
i
], &
ªtvÆ
) != 0){

698 
	`¥ötf
(1, "panicátÅhread_join\n");

703 i‡(
pid
 == 0){

704 
	`¥ötf
(1, "60% : %d\n", 
g˙t
);

705 
	`exô
();

707 
	`¥ötf
(1, "20% : %d\n", 
g˙t
);

708 i‡(
	`waô
() == -1){

709 
	`¥ötf
(1, "panicát wait in forktest\n");

710 
	`exô
();

715 
	}
}

	@trap.c

1 
	~"ty≥s.h
"

2 
	~"defs.h
"

3 
	~"∑øm.h
"

4 
	~"memœyout.h
"

5 
	~"mmu.h
"

6 
	~"¥oc.h
"

7 
	~"x86.h
"

8 
	~"å≠s.h
"

9 
	~"•ölock.h
"

12 
g©edesc
 
	gidt
[256];

13 
uöt
 
ve˘‹s
[];

14 
•ölock
 
	gtick¶ock
;

15 
uöt
 
	gticks
;

17 
uöt
 
	gMLFQ_ticks
;

18 
	gtimeQu™tumPîQ
[3] = {1,2,4};

19 
	gtimeAŒŸmítPîQ
[2] = {5,10};

22 
	$tvöô
()

24 
i
;

26 
i
 = 0; i < 256; i++)

27 
	`SETGATE
(
idt
[
i
], 0, 
SEG_KCODE
<<3, 
ve˘‹s
[i], 0);

28 
	`SETGATE
(
idt
[
T_SYSCALL
], 1, 
SEG_KCODE
<<3, 
ve˘‹s
[T_SYSCALL], 
DPL_USER
);

30 
	`öôlock
(&
tick¶ock
, "time");

31 
	}
}

34 
	$idtöô
()

36 
	`lidt
(
idt
, (idt));

37 
	}
}

41 
	$MLFQ_Check
()

45 if(
	`my¥oc
()->
±icks
 < 
timeQu™tumPîQ
[my¥oc()->
¥i‹ôy
]);

49 if(
	`my¥oc
()->
±icks
 >
timeQu™tumPîQ
[my¥oc()->
¥i‹ôy
])

51 
	`my¥oc
()->
±icks
 = 0;

54 if(
	`my¥oc
()->
¥i‹ôy
 < 2 && my¥oc()->
±ŸÆticks
 >
timeAŒŸmítPîQ
[myproc()->priority])

56 
	`my¥oc
()->
±ŸÆticks
 = 0;

57 
	`my¥oc
()->
¥i‹ôy
++;

60 
	`yõld
();

62 
	}
}

66 
	$å≠
(
å≠‰ame
 *
tf
)

68 if(
tf
->
å≠no
 =
T_SYSCALL
){

69 if(
	`my¥oc
()->
kûÀd
)

70 
	`exô
();

71 
	`my¥oc
()->
tf
 =Åf;

72 
	`sysˇŒ
();

73 if(
	`my¥oc
()->
kûÀd
)

74 
	`exô
();

78 
tf
->
å≠no
){

79 
T_IRQ0
 + 
IRQ_TIMER
:

80 if(
	`˝uid
() == 0){

81 
	`acquúe
(&
tick¶ock
);

82 
ticks
++;

83 
	`wakeup
(&
ticks
);

84 
	`ªÀa£
(&
tick¶ock
);

86 
	`œpi˚oi
();

88 
T_IRQ0
 + 
IRQ_IDE
:

89 
	`ideöå
();

90 
	`œpi˚oi
();

92 
T_IRQ0
 + 
IRQ_IDE
+1:

95 
T_IRQ0
 + 
IRQ_KBD
:

96 
	`kbdöå
();

97 
	`œpi˚oi
();

99 
T_IRQ0
 + 
IRQ_COM1
:

100 
	`u¨töå
();

101 
	`œpi˚oi
();

103 
T_IRQ0
 + 7:

104 
T_IRQ0
 + 
IRQ_SPURIOUS
:

105 
	`˝rötf
("cpu%d: spurious interruptát %x:%x\n",

106 
	`˝uid
(), 
tf
->
cs
,Åf->
eù
);

107 
	`œpi˚oi
();

112 if(
	`my¥oc
(Ë=0 || (
tf
->
cs
&3) == 0){

114 
	`˝rötf
("unexpectedÅrap %d from cpu %dÉip %x (cr2=0x%x)\n",

115 
tf
->
å≠no
, 
	`˝uid
(),Åf->
eù
, 
	`r¸2
());

116 
	`∑nic
("trap");

119 
	`˝rötf
("pid %d %s:Årap %dÉrr %d on cpu %d "

121 
	`my¥oc
()->
pid
, my¥oc()->
«me
, 
tf
->
å≠no
,

122 
tf
->
îr
, 
	`˝uid
(),Åf->
eù
, 
	`r¸2
());

123 
	`my¥oc
()->
kûÀd
 = 1;

129 if(
	`my¥oc
(Ë&& my¥oc()->
kûÀd
 && (
tf
->
cs
&3Ë=
DPL_USER
)

130 
	`exô
();

134 if(
	`my¥oc
(Ë&& my¥oc()->
°©e
 =
RUNNING
 &&

135 
tf
->
å≠no
 =
T_IRQ0
+
IRQ_TIMER
)

138 if(
	`my¥oc
()->
isMLFQ
)

140 
MLFQ_ticks
++;

141 
	`my¥oc
()->
±icks
++;

142 
	`my¥oc
()->
±ŸÆticks
++;

143 
	`MLFQ_Check
();

148 
	`yõld
();

152 if(
	`my¥oc
(Ë&& my¥oc()->
kûÀd
 && (
tf
->
cs
&3Ë=
DPL_USER
)

153 
	`exô
();

154 
	}
}

	@traps.h

4 
	#T_DIVIDE
 0

5 
	#T_DEBUG
 1

6 
	#T_NMI
 2

7 
	#T_BRKPT
 3

8 
	#T_OFLOW
 4

9 
	#T_BOUND
 5

10 
	#T_ILLOP
 6

11 
	#T_DEVICE
 7

12 
	#T_DBLFLT
 8

14 
	#T_TSS
 10

15 
	#T_SEGNP
 11

16 
	#T_STACK
 12

17 
	#T_GPFLT
 13

18 
	#T_PGFLT
 14

20 
	#T_FPERR
 16

21 
	#T_ALIGN
 17

22 
	#T_MCHK
 18

23 
	#T_SIMDERR
 19

24 

	)

27 
	#T_SYSCALL
 64

28 
	#T_DEFAULT
 500

29 

	)

30 
	#T_IRQ0
 32

31 

	)

32 
	#IRQ_TIMER
 0

	)

33 
	#IRQ_KBD
 1

	)

34 
	#IRQ_COM1
 4

	)

35 
	#IRQ_IDE
 14

	)

36 
	#IRQ_ERROR
 19

	)

37 
	#IRQ_SPURIOUS
 31

	)

	@types.h

1 
	tuöt
;

2 
	tush‹t
;

3 
	tuch¨
;

4 
uöt
 
	tpde_t
;

5 
uöt
 
	tthªad_t
;

	@uart.c

3 
	~"ty≥s.h
"

4 
	~"defs.h
"

5 
	~"∑øm.h
"

6 
	~"å≠s.h
"

7 
	~"•ölock.h
"

8 
	~"¶ì∂ock.h
"

9 
	~"fs.h
"

10 
	~"fûe.h
"

11 
	~"mmu.h
"

12 
	~"¥oc.h
"

13 
	~"x86.h
"

15 
	#COM1
 0x3f8

	)

17 
	gu¨t
;

20 
	$u¨töô
()

22 *
p
;

25 
	`outb
(
COM1
+2, 0);

28 
	`outb
(
COM1
+3, 0x80);

29 
	`outb
(
COM1
+0, 115200/9600);

30 
	`outb
(
COM1
+1, 0);

31 
	`outb
(
COM1
+3, 0x03);

32 
	`outb
(
COM1
+4, 0);

33 
	`outb
(
COM1
+1, 0x01);

36 if(
	`öb
(
COM1
+5) == 0xFF)

38 
u¨t
 = 1;

42 
	`öb
(
COM1
+2);

43 
	`öb
(
COM1
+0);

44 
	`iﬂpi˚«bÀ
(
IRQ_COM1
, 0);

47 
p
="xv6...\n"; *p;Ö++)

48 
	`u¨çutc
(*
p
);

49 
	}
}

52 
	$u¨çutc
(
c
)

54 
i
;

56 if(!
u¨t
)

58 
i
 = 0; i < 128 && !(
	`öb
(
COM1
+5) & 0x20); i++)

59 
	`mi¸odñay
(10);

60 
	`outb
(
COM1
+0, 
c
);

61 
	}
}

64 
	$u¨tgëc
()

66 if(!
u¨t
)

68 if(!(
	`öb
(
COM1
+5) & 0x01))

70  
	`öb
(
COM1
+0);

71 
	}
}

74 
	$u¨töå
()

76 
	`c⁄sﬁeöå
(
u¨tgëc
);

77 
	}
}

	@ulib.c

1 
	~"ty≥s.h
"

2 
	~"°©.h
"

3 
	~"f˙é.h
"

4 
	~"u£r.h
"

5 
	~"x86.h
"

8 
	$°r˝y
(*
s
, *
t
)

10 *
os
;

12 
os
 = 
s
;

13 (*
s
++ = *
t
++) != 0)

15  
os
;

16 
	}
}

19 
	$°rcmp
(c⁄° *
p
, c⁄° *
q
)

21 *
p
 && *∞=*
q
)

22 
p
++, 
q
++;

23  (
uch¨
)*
p
 - (uch¨)*
q
;

24 
	}
}

26 
uöt


27 
	$°æí
(*
s
)

29 
n
;

31 
n
 = 0; 
s
[n];Ç++)

33  
n
;

34 
	}
}

37 
	$mem£t
(*
d°
, 
c
, 
uöt
 
n
)

39 
	`°osb
(
d°
, 
c
, 
n
);

40  
d°
;

41 
	}
}

44 
	$°rchr
(c⁄° *
s
, 
c
)

46 ; *
s
; s++)

47 if(*
s
 =
c
)

48  (*)
s
;

50 
	}
}

53 
	$gës
(*
buf
, 
max
)

55 
i
, 
cc
;

56 
c
;

58 
i
=0; i+1 < 
max
; ){

59 
cc
 = 
	`ªad
(0, &
c
, 1);

60 if(
cc
 < 1)

62 
buf
[
i
++] = 
c
;

63 if(
c
 == '\n' || c == '\r')

66 
buf
[
i
] = '\0';

67  
buf
;

68 
	}
}

71 
	$°©
(*
n
, 
°©
 *
°
)

73 
fd
;

74 
r
;

76 
fd
 = 
	`›í
(
n
, 
O_RDONLY
);

77 if(
fd
 < 0)

79 
r
 = 
	`f°©
(
fd
, 
°
);

80 
	`˛o£
(
fd
);

81  
r
;

82 
	}
}

85 
	$©oi
(c⁄° *
s
)

87 
n
;

89 
n
 = 0;

90 '0' <*
s
 && *s <= '9')

91 
n
 =Ç*10 + *
s
++ - '0';

92  
n
;

93 
	}
}

96 
	$memmove
(*
vd°
, *
v§c
, 
n
)

98 *
d°
, *
§c
;

100 
d°
 = 
vd°
;

101 
§c
 = 
v§c
;

102 
n
-- > 0)

103 *
d°
++ = *
§c
++;

104  
vd°
;

105 
	}
}

	@umalloc.c

1 
	~"ty≥s.h
"

2 
	~"°©.h
"

3 
	~"u£r.h
"

4 
	~"∑øm.h
"

9 
	tAlign
;

11 
	uhódî
 {

13 
hódî
 *
	m±r
;

14 
uöt
 
	msize
;

15 } 
	ms
;

16 
Align
 
	mx
;

19 
hódî
 
	tHódî
;

21 
Hódî
 
	gba£
;

22 
Hódî
 *
	g‰ìp
;

25 
	$‰ì
(*
≠
)

27 
Hódî
 *
bp
, *
p
;

29 
bp
 = (
Hódî
*)
≠
 - 1;

30 
p
 = 
‰ìp
; !(
bp
 >Ö && b∞<Ö->
s
.
±r
);Ö =Ö->s.ptr)

31 if(
p
 >p->
s
.
±r
 && (
bp
 >Ö || bp <Ö->s.ptr))

33 if(
bp
 + bp->
s
.
size
 =
p
->s.
±r
){

34 
bp
->
s
.
size
 +
p
->s.
±r
->s.size;

35 
bp
->
s
.
±r
 = 
p
->s.ptr->s.ptr;

37 
bp
->
s
.
±r
 = 
p
->s.ptr;

38 if(
p
 +Ö->
s
.
size
 =
bp
){

39 
p
->
s
.
size
 +
bp
->s.size;

40 
p
->
s
.
±r
 = 
bp
->s.ptr;

42 
p
->
s
.
±r
 = 
bp
;

43 
‰ìp
 = 
p
;

44 
	}
}

46 
Hódî
*

47 
	$m‹ec‹e
(
uöt
 
nu
)

49 *
p
;

50 
Hódî
 *
hp
;

52 if(
nu
 < 4096)

53 
nu
 = 4096;

54 
p
 = 
	`sbrk
(
nu
 * (
Hódî
));

55 if(
p
 == (*)-1)

57 
hp
 = (
Hódî
*)
p
;

58 
hp
->
s
.
size
 = 
nu
;

59 
	`‰ì
((*)(
hp
 + 1));

60  
‰ìp
;

61 
	}
}

64 
	$mÆloc
(
uöt
 
nbyãs
)

66 
Hódî
 *
p
, *
¥evp
;

67 
uöt
 
nunôs
;

69 
nunôs
 = (
nbyãs
 + (
Hódî
) - 1)/(Header) + 1;

70 if((
¥evp
 = 
‰ìp
) == 0){

71 
ba£
.
s
.
±r
 = 
‰ìp
 = 
¥evp
 = &base;

72 
ba£
.
s
.
size
 = 0;

74 
p
 = 
¥evp
->
s
.
±r
; ;Örevp =Ö,Ö =Ö->s.ptr){

75 if(
p
->
s
.
size
 >
nunôs
){

76 if(
p
->
s
.
size
 =
nunôs
)

77 
¥evp
->
s
.
±r
 = 
p
->s.ptr;

79 
p
->
s
.
size
 -
nunôs
;

80 
p
 +p->
s
.
size
;

81 
p
->
s
.
size
 = 
nunôs
;

83 
‰ìp
 = 
¥evp
;

84  (*)(
p
 + 1);

86 if(
p
 =
‰ìp
)

87 if((
p
 = 
	`m‹ec‹e
(
nunôs
)) == 0)

90 
	}
}

	@user.h

1 
	g°©
;

2 
	gπcd©e
;

5 
f‹k
();

6 
	$exô
(Ë
	`__©åibuã__
((
n‹ëu∫
));

7 
	`waô
();

8 
	`pùe
(*);

9 
	`wrôe
(, *, );

10 
	`ªad
(, *, );

11 
	`˛o£
();

12 
	`kûl
();

13 
	`exec
(*, **);

14 
	`›í
(*, );

15 
	`mknod
(*, , );

16 
	`u∆ök
(*);

17 
	`f°©
(
fd
, 
°©
*);

18 
	`lök
(*, *);

19 
	`mkdú
(*);

20 
	`chdú
(*);

21 
	`dup
();

22 
	`gëpid
();

23 * 
	`sbrk
();

24 
	`¶ìp
();

25 
	`u±ime
();

26 
	`gëÀv
();

27 
	`yõld
();

28 
	`£t_˝u_sh¨e
();

29 
	`thªad_¸óã
(
thªad_t
* 
thªad
, * (*
°¨t_routöe
)(*), *
¨g
);

30 
	$thªad_exô
(*Ë
	`__©åibuã__
((
n‹ëu∫
));

31 
	`thªad_joö
(
thªad_t
 
thªad
, **
ªtvÆ
);

32 
	`pwrôe
(
fd
, * 
addr
, 
n
, 
off
);

33 
	`¥ód
(
fd
, * 
addr
, 
n
, 
off
);

36 
	`°©
(*, 
°©
*);

37 * 
	`°r˝y
(*, *);

38 *
	`memmove
(*, *, );

39 * 
	`°rchr
(c⁄° *, 
c
);

40 
	`°rcmp
(const *, const *);

41 
	`¥ötf
(, *, ...);

42 * 
	`gës
(*, 
max
);

43 
uöt
 
	`°æí
(*);

44 * 
	`mem£t
(*, , 
uöt
);

45 * 
	`mÆloc
(
uöt
);

46 
	`‰ì
(*);

47 
	`©oi
(const *);

	@usertests.c

1 
	~"∑øm.h
"

2 
	~"ty≥s.h
"

3 
	~"°©.h
"

4 
	~"u£r.h
"

5 
	~"fs.h
"

6 
	~"f˙é.h
"

7 
	~"sysˇŒ.h
"

8 
	~"å≠s.h
"

9 
	~"memœyout.h
"

11 
	gbuf
[8192];

12 
	g«me
[3];

13 *
	gechﬂrgv
[] = { "echo", "ALL", "TESTS", "PASSED", 0 };

14 
	g°dout
 = 1;

18 
	$ùuâe°
()

20 
	`¥ötf
(
°dout
, "iputÅest\n");

22 if(
	`mkdú
("iputdir") < 0){

23 
	`¥ötf
(
°dout
, "mkdir failed\n");

24 
	`exô
();

26 if(
	`chdú
("iputdir") < 0){

27 
	`¥ötf
(
°dout
, "chdir iputdir failed\n");

28 
	`exô
();

30 if(
	`u∆ök
("../iputdir") < 0){

31 
	`¥ötf
(
°dout
, "unlink ../iputdir failed\n");

32 
	`exô
();

34 if(
	`chdú
("/") < 0){

35 
	`¥ötf
(
°dout
, "chdir / failed\n");

36 
	`exô
();

38 
	`¥ötf
(
°dout
, "iputÅest ok\n");

39 
	}
}

43 
	$exôùuâe°
()

45 
pid
;

47 
	`¥ötf
(
°dout
, "exitiputÅest\n");

49 
pid
 = 
	`f‹k
();

50 if(
pid
 < 0){

51 
	`¥ötf
(
°dout
, "fork failed\n");

52 
	`exô
();

54 if(
pid
 == 0){

55 if(
	`mkdú
("iputdir") < 0){

56 
	`¥ötf
(
°dout
, "mkdir failed\n");

57 
	`exô
();

59 if(
	`chdú
("iputdir") < 0){

60 
	`¥ötf
(
°dout
, "child chdir failed\n");

61 
	`exô
();

63 if(
	`u∆ök
("../iputdir") < 0){

64 
	`¥ötf
(
°dout
, "unlink ../iputdir failed\n");

65 
	`exô
();

67 
	`exô
();

69 
	`waô
();

70 
	`¥ötf
(
°dout
, "exitiputÅest ok\n");

71 
	}
}

85 
	$›íùuâe°
()

87 
pid
;

89 
	`¥ötf
(
°dout
, "openiputÅest\n");

90 if(
	`mkdú
("oidir") < 0){

91 
	`¥ötf
(
°dout
, "mkdir oidir failed\n");

92 
	`exô
();

94 
pid
 = 
	`f‹k
();

95 if(
pid
 < 0){

96 
	`¥ötf
(
°dout
, "fork failed\n");

97 
	`exô
();

99 if(
pid
 == 0){

100 
fd
 = 
	`›í
("oidú", 
O_RDWR
);

101 if(
fd
 >= 0){

102 
	`¥ötf
(
°dout
, "open directory for write succeeded\n");

103 
	`exô
();

105 
	`exô
();

107 
	`¶ìp
(1);

108 if(
	`u∆ök
("oidir") != 0){

109 
	`¥ötf
(
°dout
, "unlink failed\n");

110 
	`exô
();

112 
	`waô
();

113 
	`¥ötf
(
°dout
, "openiputÅest ok\n");

114 
	}
}

119 
	$›íã°
()

121 
fd
;

123 
	`¥ötf
(
°dout
, "openÅest\n");

124 
fd
 = 
	`›í
("echo", 0);

125 if(
fd
 < 0){

126 
	`¥ötf
(
°dout
, "openÉcho failed!\n");

127 
	`exô
();

129 
	`˛o£
(
fd
);

130 
fd
 = 
	`›í
("doesnotexist", 0);

131 if(
fd
 >= 0){

132 
	`¥ötf
(
°dout
, "open doesnotexist succeeded!\n");

133 
	`exô
();

135 
	`¥ötf
(
°dout
, "openÅest ok\n");

136 
	}
}

139 
	$wrôëe°
()

141 
fd
;

142 
i
;

144 
	`¥ötf
(
°dout
, "small fileÅest\n");

145 
fd
 = 
	`›í
("smÆl", 
O_CREATE
|
O_RDWR
);

146 if(
fd
 >= 0){

147 
	`¥ötf
(
°dout
, "creat small succeeded; ok\n");

149 
	`¥ötf
(
°dout
, "error: creat small failed!\n");

150 
	`exô
();

152 
i
 = 0; i < 100; i++){

153 if(
	`wrôe
(
fd
, "aaaaaaaaaa", 10) != 10){

154 
	`¥ötf
(
°dout
, "îr‹: wrôêØ %dÇew fûêÁûed\n", 
i
);

155 
	`exô
();

157 if(
	`wrôe
(
fd
, "bbbbbbbbbb", 10) != 10){

158 
	`¥ötf
(
°dout
, "îr‹: wrôêbb %dÇew fûêÁûed\n", 
i
);

159 
	`exô
();

162 
	`¥ötf
(
°dout
, "writes ok\n");

163 
	`˛o£
(
fd
);

164 
fd
 = 
	`›í
("smÆl", 
O_RDONLY
);

165 if(
fd
 >= 0){

166 
	`¥ötf
(
°dout
, "open small succeeded ok\n");

168 
	`¥ötf
(
°dout
, "error: open small failed!\n");

169 
	`exô
();

171 
i
 = 
	`ªad
(
fd
, 
buf
, 2000);

172 if(
i
 == 2000){

173 
	`¥ötf
(
°dout
, "read succeeded ok\n");

175 
	`¥ötf
(
°dout
, "read failed\n");

176 
	`exô
();

178 
	`˛o£
(
fd
);

180 if(
	`u∆ök
("small") < 0){

181 
	`¥ötf
(
°dout
, "unlink small failed\n");

182 
	`exô
();

184 
	`¥ötf
(
°dout
, "small fileÅest ok\n");

185 
	}
}

188 
	$wrôëe°1
()

190 
i
, 
fd
, 
n
;

192 
	`¥ötf
(
°dout
, "big filesÅest\n");

194 
fd
 = 
	`›í
("big", 
O_CREATE
|
O_RDWR
);

195 if(
fd
 < 0){

196 
	`¥ötf
(
°dout
, "error: creat big failed!\n");

197 
	`exô
();

200 
i
 = 0; i < 
MAXFILE
; i++){

201 ((*)
buf
)[0] = 
i
;

202 if(
	`wrôe
(
fd
, 
buf
, 512) != 512){

203 
	`¥ötf
(
°dout
, "îr‹: wrôêbig fûêÁûed\n", 
i
);

204 
	`exô
();

208 
	`˛o£
(
fd
);

210 
fd
 = 
	`›í
("big", 
O_RDONLY
);

211 if(
fd
 < 0){

212 
	`¥ötf
(
°dout
, "error: open big failed!\n");

213 
	`exô
();

216 
n
 = 0;

218 
i
 = 
	`ªad
(
fd
, 
buf
, 512);

219 if(
i
 == 0){

220 if(
n
 =
MAXFILE
 - 1){

221 
	`¥ötf
(
°dout
, "ªad o∆y %d block†‰om big", 
n
);

222 
	`exô
();

225 } if(
i
 != 512){

226 
	`¥ötf
(
°dout
, "ªad faûed %d\n", 
i
);

227 
	`exô
();

229 if(((*)
buf
)[0] !
n
){

230 
	`¥ötf
(
°dout
, "read content of block %d is %d\n",

231 
n
, ((*)
buf
)[0]);

232 
	`exô
();

234 
n
++;

236 
	`˛o£
(
fd
);

237 if(
	`u∆ök
("big") < 0){

238 
	`¥ötf
(
°dout
, "unlink big failed\n");

239 
	`exô
();

241 
	`¥ötf
(
°dout
, "big files ok\n");

242 
	}
}

245 
	$¸óãã°
()

247 
i
, 
fd
;

249 
	`¥ötf
(
°dout
, "many creates, followed by unlinkÅest\n");

251 
«me
[0] = 'a';

252 
«me
[2] = '\0';

253 
i
 = 0; i < 52; i++){

254 
«me
[1] = '0' + 
i
;

255 
fd
 = 
	`›í
(
«me
, 
O_CREATE
|
O_RDWR
);

256 
	`˛o£
(
fd
);

258 
«me
[0] = 'a';

259 
«me
[2] = '\0';

260 
i
 = 0; i < 52; i++){

261 
«me
[1] = '0' + 
i
;

262 
	`u∆ök
(
«me
);

264 
	`¥ötf
(
°dout
, "many creates, followed by unlink; ok\n");

265 
	}
}

267 
	$dúã°
()

269 
	`¥ötf
(
°dout
, "mkdirÅest\n");

271 if(
	`mkdú
("dir0") < 0){

272 
	`¥ötf
(
°dout
, "mkdir failed\n");

273 
	`exô
();

276 if(
	`chdú
("dir0") < 0){

277 
	`¥ötf
(
°dout
, "chdir dir0 failed\n");

278 
	`exô
();

281 if(
	`chdú
("..") < 0){

282 
	`¥ötf
(
°dout
, "chdir .. failed\n");

283 
	`exô
();

286 if(
	`u∆ök
("dir0") < 0){

287 
	`¥ötf
(
°dout
, "unlink dir0 failed\n");

288 
	`exô
();

290 
	`¥ötf
(
°dout
, "mkdirÅest ok\n");

291 
	}
}

294 
	$exe˘e°
()

296 
	`¥ötf
(
°dout
, "execÅest\n");

297 if(
	`exec
("echo", 
echﬂrgv
) < 0){

298 
	`¥ötf
(
°dout
, "execÉcho failed\n");

299 
	`exô
();

301 
	}
}

306 
	$pùe1
()

308 
fds
[2], 
pid
;

309 
£q
, 
i
, 
n
, 
cc
, 
tŸÆ
;

311 if(
	`pùe
(
fds
) != 0){

312 
	`¥ötf
(1, "pipe() failed\n");

313 
	`exô
();

315 
pid
 = 
	`f‹k
();

316 
£q
 = 0;

317 if(
pid
 == 0){

318 
	`˛o£
(
fds
[0]);

319 
n
 = 0;Ç < 5;Ç++){

320 
i
 = 0; i < 1033; i++)

321 
buf
[
i
] = 
£q
++;

322 if(
	`wrôe
(
fds
[1], 
buf
, 1033) != 1033){

323 
	`¥ötf
(1, "pipe1 oops 1\n");

324 
	`exô
();

327 
	`exô
();

328 } if(
pid
 > 0){

329 
	`˛o£
(
fds
[1]);

330 
tŸÆ
 = 0;

331 
cc
 = 1;

332 (
n
 = 
	`ªad
(
fds
[0], 
buf
, 
cc
)) > 0){

333 
i
 = 0; i < 
n
; i++){

334 if((
buf
[
i
] & 0xffË!(
£q
++ & 0xff)){

335 
	`¥ötf
(1, "pipe1 oops 2\n");

339 
tŸÆ
 +
n
;

340 
cc
 = cc * 2;

341 if(
cc
 > (
buf
))

342 
cc
 = (
buf
);

344 if(
tŸÆ
 != 5 * 1033){

345 
	`¥ötf
(1, "pùe1 o›†3ÅŸÆ %d\n", 
tŸÆ
);

346 
	`exô
();

348 
	`˛o£
(
fds
[0]);

349 
	`waô
();

351 
	`¥ötf
(1, "fork() failed\n");

352 
	`exô
();

354 
	`¥ötf
(1, "pipe1 ok\n");

355 
	}
}

359 
	$¥ìm±
()

361 
pid1
, 
pid2
, 
pid3
;

362 
pfds
[2];

364 
	`¥ötf
(1, "preempt: ");

365 
pid1
 = 
	`f‹k
();

366 if(
pid1
 == 0)

370 
pid2
 = 
	`f‹k
();

371 if(
pid2
 == 0)

375 
	`pùe
(
pfds
);

376 
pid3
 = 
	`f‹k
();

377 if(
pid3
 == 0){

378 
	`˛o£
(
pfds
[0]);

379 if(
	`wrôe
(
pfds
[1], "x", 1) != 1)

380 
	`¥ötf
(1, "preempt writeÉrror");

381 
	`˛o£
(
pfds
[1]);

386 
	`˛o£
(
pfds
[1]);

387 if(
	`ªad
(
pfds
[0], 
buf
, (buf)) != 1){

388 
	`¥ötf
(1, "preemptÑeadÉrror");

391 
	`˛o£
(
pfds
[0]);

392 
	`¥ötf
(1, "kill... ");

393 
	`kûl
(
pid1
);

394 
	`kûl
(
pid2
);

395 
	`kûl
(
pid3
);

396 
	`¥ötf
(1, "wait... ");

397 
	`waô
();

398 
	`waô
();

399 
	`waô
();

400 
	`¥ötf
(1, "preempt ok\n");

401 
	}
}

405 
	$exôwaô
()

407 
i
, 
pid
;

409 
i
 = 0; i < 100; i++){

410 
pid
 = 
	`f‹k
();

411 if(
pid
 < 0){

412 
	`¥ötf
(1, "fork failed\n");

415 if(
pid
){

416 if(
	`waô
(Ë!
pid
){

417 
	`¥ötf
(1, "wait wrongÖid\n");

421 
	`exô
();

424 
	`¥ötf
(1, "exitwait ok\n");

425 
	}
}

428 
	$mem
()

430 *
m1
, *
m2
;

431 
pid
, 
µid
;

433 
	`¥ötf
(1, "memÅest\n");

434 
µid
 = 
	`gëpid
();

435 if((
pid
 = 
	`f‹k
()) == 0){

436 
m1
 = 0;

437 (
m2
 = 
	`mÆloc
(10001)) != 0){

438 *(**)
m2
 = 
m1
;

439 
m1
 = 
m2
;

441 
m1
){

442 
m2
 = *(**)
m1
;

443 
	`‰ì
(
m1
);

444 
m1
 = 
m2
;

446 
m1
 = 
	`mÆloc
(1024*20);

447 if(
m1
 == 0){

448 
	`¥ötf
(1, "couldn'tállocate mem?!!\n");

449 
	`kûl
(
µid
);

450 
	`exô
();

452 
	`‰ì
(
m1
);

453 
	`¥ötf
(1, "mem ok\n");

454 
	`exô
();

456 
	`waô
();

458 
	}
}

465 
	$sh¨edfd
()

467 
fd
, 
pid
, 
i
, 
n
, 
nc
, 
≈
;

468 
buf
[10];

470 
	`¥ötf
(1, "sharedfdÅest\n");

472 
	`u∆ök
("sharedfd");

473 
fd
 = 
	`›í
("sh¨edfd", 
O_CREATE
|
O_RDWR
);

474 if(
fd
 < 0){

475 
	`¥ötf
(1, "fstests: cannot open sharedfd for writing");

478 
pid
 = 
	`f‹k
();

479 
	`mem£t
(
buf
, 
pid
==0?'c':'p', (buf));

480 
i
 = 0; i < 1000; i++){

481 if(
	`wrôe
(
fd
, 
buf
, (buf)) != (buf)){

482 
	`¥ötf
(1, "fstests: write sharedfd failed\n");

486 if(
pid
 == 0)

487 
	`exô
();

489 
	`waô
();

490 
	`˛o£
(
fd
);

491 
fd
 = 
	`›í
("sharedfd", 0);

492 if(
fd
 < 0){

493 
	`¥ötf
(1, "fstests: cannot open sharedfd forÑeading\n");

496 
nc
 = 
≈
 = 0;

497 (
n
 = 
	`ªad
(
fd
, 
buf
, (buf))) > 0){

498 
i
 = 0; i < (
buf
); i++){

499 if(
buf
[
i
] == 'c')

500 
nc
++;

501 if(
buf
[
i
] == 'p')

502 
≈
++;

505 
	`˛o£
(
fd
);

506 
	`u∆ök
("sharedfd");

507 if(
nc
 =10000 && 
≈
 == 10000){

508 
	`¥ötf
(1, "sharedfd ok\n");

510 
	`¥ötf
(1, "sh¨edfd o›†%d %d\n", 
nc
, 
≈
);

511 
	`exô
();

513 
	}
}

518 
	$fourfûes
()

520 
fd
, 
pid
, 
i
, 
j
, 
n
, 
tŸÆ
, 
pi
;

521 *
«mes
[] = { "f0", "f1", "f2", "f3" };

522 *
‚ame
;

524 
	`¥ötf
(1, "fourfilesÅest\n");

526 
pi
 = 0;Öi < 4;Öi++){

527 
‚ame
 = 
«mes
[
pi
];

528 
	`u∆ök
(
‚ame
);

530 
pid
 = 
	`f‹k
();

531 if(
pid
 < 0){

532 
	`¥ötf
(1, "fork failed\n");

533 
	`exô
();

536 if(
pid
 == 0){

537 
fd
 = 
	`›í
(
‚ame
, 
O_CREATE
 | 
O_RDWR
);

538 if(
fd
 < 0){

539 
	`¥ötf
(1, "create failed\n");

540 
	`exô
();

543 
	`mem£t
(
buf
, '0'+
pi
, 512);

544 
i
 = 0; i < 12; i++){

545 if((
n
 = 
	`wrôe
(
fd
, 
buf
, 500)) != 500){

546 
	`¥ötf
(1, "wrôêÁûed %d\n", 
n
);

547 
	`exô
();

550 
	`exô
();

554 
pi
 = 0;Öi < 4;Öi++){

555 
	`waô
();

558 
i
 = 0; i < 2; i++){

559 
‚ame
 = 
«mes
[
i
];

560 
fd
 = 
	`›í
(
‚ame
, 0);

561 
tŸÆ
 = 0;

562 (
n
 = 
	`ªad
(
fd
, 
buf
, (buf))) > 0){

563 
j
 = 0; j < 
n
; j++){

564 if(
buf
[
j
] !'0'+
i
){

565 
	`¥ötf
(1, "wrong char\n");

566 
	`exô
();

569 
tŸÆ
 +
n
;

571 
	`˛o£
(
fd
);

572 if(
tŸÆ
 != 12*500){

573 
	`¥ötf
(1, "wr⁄gÜígth %d\n", 
tŸÆ
);

574 
	`exô
();

576 
	`u∆ök
(
‚ame
);

579 
	`¥ötf
(1, "fourfiles ok\n");

580 
	}
}

584 
	$¸óãdñëe
()

586 íum { 
N
 = 20 };

587 
pid
, 
i
, 
fd
, 
pi
;

588 
«me
[32];

590 
	`¥ötf
(1, "createdeleteÅest\n");

592 
pi
 = 0;Öi < 4;Öi++){

593 
pid
 = 
	`f‹k
();

594 if(
pid
 < 0){

595 
	`¥ötf
(1, "fork failed\n");

596 
	`exô
();

599 if(
pid
 == 0){

600 
«me
[0] = 'p' + 
pi
;

601 
«me
[2] = '\0';

602 
i
 = 0; i < 
N
; i++){

603 
«me
[1] = '0' + 
i
;

604 
fd
 = 
	`›í
(
«me
, 
O_CREATE
 | 
O_RDWR
);

605 if(
fd
 < 0){

606 
	`¥ötf
(1, "create failed\n");

607 
	`exô
();

609 
	`˛o£
(
fd
);

610 if(
i
 > 0 && (i % 2 ) == 0){

611 
«me
[1] = '0' + (
i
 / 2);

612 if(
	`u∆ök
(
«me
) < 0){

613 
	`¥ötf
(1, "unlink failed\n");

614 
	`exô
();

618 
	`exô
();

622 
pi
 = 0;Öi < 4;Öi++){

623 
	`waô
();

626 
«me
[0] =Çame[1] =Çame[2] = 0;

627 
i
 = 0; i < 
N
; i++){

628 
pi
 = 0;Öi < 4;Öi++){

629 
«me
[0] = 'p' + 
pi
;

630 
«me
[1] = '0' + 
i
;

631 
fd
 = 
	`›í
(
«me
, 0);

632 if((
i
 =0 || i >
N
/2Ë&& 
fd
 < 0){

633 
	`¥ötf
(1, "o›†¸óãdñëê%†didn'àexi°\n", 
«me
);

634 
	`exô
();

635 } if((
i
 >1 && i < 
N
/2Ë&& 
fd
 >= 0){

636 
	`¥ötf
(1, "o›†¸óãdñëê%†didÉxi°\n", 
«me
);

637 
	`exô
();

639 if(
fd
 >= 0)

640 
	`˛o£
(
fd
);

644 
i
 = 0; i < 
N
; i++){

645 
pi
 = 0;Öi < 4;Öi++){

646 
«me
[0] = 'p' + 
i
;

647 
«me
[1] = '0' + 
i
;

648 
	`u∆ök
(
«me
);

652 
	`¥ötf
(1, "createdelete ok\n");

653 
	}
}

657 
	$u∆ökªad
()

659 
fd
, 
fd1
;

661 
	`¥ötf
(1, "unlinkreadÅest\n");

662 
fd
 = 
	`›í
("u∆ökªad", 
O_CREATE
 | 
O_RDWR
);

663 if(
fd
 < 0){

664 
	`¥ötf
(1, "create unlinkread failed\n");

665 
	`exô
();

667 
	`wrôe
(
fd
, "hello", 5);

668 
	`˛o£
(
fd
);

670 
fd
 = 
	`›í
("u∆ökªad", 
O_RDWR
);

671 if(
fd
 < 0){

672 
	`¥ötf
(1, "open unlinkread failed\n");

673 
	`exô
();

675 if(
	`u∆ök
("unlinkread") != 0){

676 
	`¥ötf
(1, "unlink unlinkread failed\n");

677 
	`exô
();

680 
fd1
 = 
	`›í
("u∆ökªad", 
O_CREATE
 | 
O_RDWR
);

681 
	`wrôe
(
fd1
, "yyy", 3);

682 
	`˛o£
(
fd1
);

684 if(
	`ªad
(
fd
, 
buf
, (buf)) != 5){

685 
	`¥ötf
(1, "unlinkreadÑead failed");

686 
	`exô
();

688 if(
buf
[0] != 'h'){

689 
	`¥ötf
(1, "unlinkread wrong data\n");

690 
	`exô
();

692 if(
	`wrôe
(
fd
, 
buf
, 10) != 10){

693 
	`¥ötf
(1, "unlinkread write failed\n");

694 
	`exô
();

696 
	`˛o£
(
fd
);

697 
	`u∆ök
("unlinkread");

698 
	`¥ötf
(1, "unlinkread ok\n");

699 
	}
}

702 
	$lökã°
()

704 
fd
;

706 
	`¥ötf
(1, "linktest\n");

708 
	`u∆ök
("lf1");

709 
	`u∆ök
("lf2");

711 
fd
 = 
	`›í
("lf1", 
O_CREATE
|
O_RDWR
);

712 if(
fd
 < 0){

713 
	`¥ötf
(1, "createÜf1 failed\n");

714 
	`exô
();

716 if(
	`wrôe
(
fd
, "hello", 5) != 5){

717 
	`¥ötf
(1, "writeÜf1 failed\n");

718 
	`exô
();

720 
	`˛o£
(
fd
);

722 if(
	`lök
("lf1", "lf2") < 0){

723 
	`¥ötf
(1, "linkÜf1Üf2 failed\n");

724 
	`exô
();

726 
	`u∆ök
("lf1");

728 if(
	`›í
("lf1", 0) >= 0){

729 
	`¥ötf
(1, "unlinkedÜf1 but it is stillÅhere!\n");

730 
	`exô
();

733 
fd
 = 
	`›í
("lf2", 0);

734 if(
fd
 < 0){

735 
	`¥ötf
(1, "openÜf2 failed\n");

736 
	`exô
();

738 if(
	`ªad
(
fd
, 
buf
, (buf)) != 5){

739 
	`¥ötf
(1, "readÜf2 failed\n");

740 
	`exô
();

742 
	`˛o£
(
fd
);

744 if(
	`lök
("lf2", "lf2") >= 0){

745 
	`¥ötf
(1, "linkÜf2Üf2 succeeded! oops\n");

746 
	`exô
();

749 
	`u∆ök
("lf2");

750 if(
	`lök
("lf2", "lf1") >= 0){

751 
	`¥ötf
(1, "linkÇon-existant succeeded! oops\n");

752 
	`exô
();

755 if(
	`lök
(".", "lf1") >= 0){

756 
	`¥ötf
(1, "link .Üf1 succeeded! oops\n");

757 
	`exô
();

760 
	`¥ötf
(1, "linktest ok\n");

761 
	}
}

765 
	$c⁄¸óã
()

767 
fûe
[3];

768 
i
, 
pid
, 
n
, 
fd
;

769 
Á
[40];

771 
ush‹t
 
öum
;

772 
«me
[14];

773 } 
de
;

775 
	`¥ötf
(1, "concreateÅest\n");

776 
fûe
[0] = 'C';

777 
fûe
[2] = '\0';

778 
i
 = 0; i < 40; i++){

779 
fûe
[1] = '0' + 
i
;

780 
	`u∆ök
(
fûe
);

781 
pid
 = 
	`f‹k
();

782 if(
pid
 && (
i
 % 3) == 1){

783 
	`lök
("C0", 
fûe
);

784 } if(
pid
 =0 && (
i
 % 5) == 1){

785 
	`lök
("C0", 
fûe
);

787 
fd
 = 
	`›í
(
fûe
, 
O_CREATE
 | 
O_RDWR
);

788 if(
fd
 < 0){

789 
	`¥ötf
(1, "c⁄¸óã cª©ê%†Áûed\n", 
fûe
);

790 
	`exô
();

792 
	`˛o£
(
fd
);

794 if(
pid
 == 0)

795 
	`exô
();

797 
	`waô
();

800 
	`mem£t
(
Á
, 0, (fa));

801 
fd
 = 
	`›í
(".", 0);

802 
n
 = 0;

803 
	`ªad
(
fd
, &
de
, (de)) > 0){

804 if(
de
.
öum
 == 0)

806 if(
de
.
«me
[0] == 'C' && de.name[2] == '\0'){

807 
i
 = 
de
.
«me
[1] - '0';

808 if(
i
 < 0 || i >(
Á
)){

809 
	`¥ötf
(1, "c⁄¸óã weúd fûê%s\n", 
de
.
«me
);

810 
	`exô
();

812 if(
Á
[
i
]){

813 
	`¥ötf
(1, "c⁄¸óã du∂iˇã fûê%s\n", 
de
.
«me
);

814 
	`exô
();

816 
Á
[
i
] = 1;

817 
n
++;

820 
	`˛o£
(
fd
);

822 if(
n
 != 40){

823 
	`¥ötf
(1, "concreateÇotÉnough files in directoryÜisting\n");

824 
	`exô
();

827 
i
 = 0; i < 40; i++){

828 
fûe
[1] = '0' + 
i
;

829 
pid
 = 
	`f‹k
();

830 if(
pid
 < 0){

831 
	`¥ötf
(1, "fork failed\n");

832 
	`exô
();

834 if(((
i
 % 3Ë=0 && 
pid
 == 0) ||

835 ((
i
 % 3Ë=1 && 
pid
 != 0)){

836 
	`˛o£
(
	`›í
(
fûe
, 0));

837 
	`˛o£
(
	`›í
(
fûe
, 0));

838 
	`˛o£
(
	`›í
(
fûe
, 0));

839 
	`˛o£
(
	`›í
(
fûe
, 0));

841 
	`u∆ök
(
fûe
);

842 
	`u∆ök
(
fûe
);

843 
	`u∆ök
(
fûe
);

844 
	`u∆ök
(
fûe
);

846 if(
pid
 == 0)

847 
	`exô
();

849 
	`waô
();

852 
	`¥ötf
(1, "concreate ok\n");

853 
	}
}

858 
	$löku∆ök
()

860 
pid
, 
i
;

862 
	`¥ötf
(1, "linkunlinkÅest\n");

864 
	`u∆ök
("x");

865 
pid
 = 
	`f‹k
();

866 if(
pid
 < 0){

867 
	`¥ötf
(1, "fork failed\n");

868 
	`exô
();

871 
x
 = (
pid
 ? 1 : 97);

872 
i
 = 0; i < 100; i++){

873 
x
 = x * 1103515245 + 12345;

874 if((
x
 % 3) == 0){

875 
	`˛o£
(
	`›í
("x", 
O_RDWR
 | 
O_CREATE
));

876 } if((
x
 % 3) == 1){

877 
	`lök
("cat", "x");

879 
	`u∆ök
("x");

883 if(
pid
)

884 
	`waô
();

886 
	`exô
();

888 
	`¥ötf
(1, "linkunlink ok\n");

889 
	}
}

893 
	$bigdú
()

895 
i
, 
fd
;

896 
«me
[10];

898 
	`¥ötf
(1, "bigdirÅest\n");

899 
	`u∆ök
("bd");

901 
fd
 = 
	`›í
("bd", 
O_CREATE
);

902 if(
fd
 < 0){

903 
	`¥ötf
(1, "bigdir create failed\n");

904 
	`exô
();

906 
	`˛o£
(
fd
);

908 
i
 = 0; i < 500; i++){

909 
«me
[0] = 'x';

910 
«me
[1] = '0' + (
i
 / 64);

911 
«me
[2] = '0' + (
i
 % 64);

912 
«me
[3] = '\0';

913 if(
	`lök
("bd", 
«me
) != 0){

914 
	`¥ötf
(1, "bigdirÜink failed\n");

915 
	`exô
();

919 
	`u∆ök
("bd");

920 
i
 = 0; i < 500; i++){

921 
«me
[0] = 'x';

922 
«me
[1] = '0' + (
i
 / 64);

923 
«me
[2] = '0' + (
i
 % 64);

924 
«me
[3] = '\0';

925 if(
	`u∆ök
(
«me
) != 0){

926 
	`¥ötf
(1, "bigdir unlink failed");

927 
	`exô
();

931 
	`¥ötf
(1, "bigdir ok\n");

932 
	}
}

935 
	$subdú
()

937 
fd
, 
cc
;

939 
	`¥ötf
(1, "subdirÅest\n");

941 
	`u∆ök
("ff");

942 if(
	`mkdú
("dd") != 0){

943 
	`¥ötf
(1, "subdir mkdir dd failed\n");

944 
	`exô
();

947 
fd
 = 
	`›í
("dd/ff", 
O_CREATE
 | 
O_RDWR
);

948 if(
fd
 < 0){

949 
	`¥ötf
(1, "create dd/ff failed\n");

950 
	`exô
();

952 
	`wrôe
(
fd
, "ff", 2);

953 
	`˛o£
(
fd
);

955 if(
	`u∆ök
("dd") >= 0){

956 
	`¥ötf
(1, "unlink dd (non-empty dir) succeeded!\n");

957 
	`exô
();

960 if(
	`mkdú
("/dd/dd") != 0){

961 
	`¥ötf
(1, "subdir mkdir dd/dd failed\n");

962 
	`exô
();

965 
fd
 = 
	`›í
("dd/dd/ff", 
O_CREATE
 | 
O_RDWR
);

966 if(
fd
 < 0){

967 
	`¥ötf
(1, "create dd/dd/ff failed\n");

968 
	`exô
();

970 
	`wrôe
(
fd
, "FF", 2);

971 
	`˛o£
(
fd
);

973 
fd
 = 
	`›í
("dd/dd/../ff", 0);

974 if(
fd
 < 0){

975 
	`¥ötf
(1, "open dd/dd/../ff failed\n");

976 
	`exô
();

978 
cc
 = 
	`ªad
(
fd
, 
buf
, (buf));

979 if(
cc
 !2 || 
buf
[0] != 'f'){

980 
	`¥ötf
(1, "dd/dd/../ff wrong content\n");

981 
	`exô
();

983 
	`˛o£
(
fd
);

985 if(
	`lök
("dd/dd/ff", "dd/dd/ffff") != 0){

986 
	`¥ötf
(1, "link dd/dd/ff dd/dd/ffff failed\n");

987 
	`exô
();

990 if(
	`u∆ök
("dd/dd/ff") != 0){

991 
	`¥ötf
(1, "unlink dd/dd/ff failed\n");

992 
	`exô
();

994 if(
	`›í
("dd/dd/ff", 
O_RDONLY
) >= 0){

995 
	`¥ötf
(1, "open (unlinked) dd/dd/ff succeeded\n");

996 
	`exô
();

999 if(
	`chdú
("dd") != 0){

1000 
	`¥ötf
(1, "chdir dd failed\n");

1001 
	`exô
();

1003 if(
	`chdú
("dd/../../dd") != 0){

1004 
	`¥ötf
(1, "chdir dd/../../dd failed\n");

1005 
	`exô
();

1007 if(
	`chdú
("dd/../../../dd") != 0){

1008 
	`¥ötf
(1, "chdir dd/../../dd failed\n");

1009 
	`exô
();

1011 if(
	`chdú
("./..") != 0){

1012 
	`¥ötf
(1, "chdir ./.. failed\n");

1013 
	`exô
();

1016 
fd
 = 
	`›í
("dd/dd/ffff", 0);

1017 if(
fd
 < 0){

1018 
	`¥ötf
(1, "open dd/dd/ffff failed\n");

1019 
	`exô
();

1021 if(
	`ªad
(
fd
, 
buf
, (buf)) != 2){

1022 
	`¥ötf
(1, "read dd/dd/ffff wrongÜen\n");

1023 
	`exô
();

1025 
	`˛o£
(
fd
);

1027 if(
	`›í
("dd/dd/ff", 
O_RDONLY
) >= 0){

1028 
	`¥ötf
(1, "open (unlinked) dd/dd/ff succeeded!\n");

1029 
	`exô
();

1032 if(
	`›í
("dd/ff/ff", 
O_CREATE
|
O_RDWR
) >= 0){

1033 
	`¥ötf
(1, "create dd/ff/ff succeeded!\n");

1034 
	`exô
();

1036 if(
	`›í
("dd/xx/ff", 
O_CREATE
|
O_RDWR
) >= 0){

1037 
	`¥ötf
(1, "create dd/xx/ff succeeded!\n");

1038 
	`exô
();

1040 if(
	`›í
("dd", 
O_CREATE
) >= 0){

1041 
	`¥ötf
(1, "create dd succeeded!\n");

1042 
	`exô
();

1044 if(
	`›í
("dd", 
O_RDWR
) >= 0){

1045 
	`¥ötf
(1, "open ddÑdwr succeeded!\n");

1046 
	`exô
();

1048 if(
	`›í
("dd", 
O_WRONLY
) >= 0){

1049 
	`¥ötf
(1, "open dd wronly succeeded!\n");

1050 
	`exô
();

1052 if(
	`lök
("dd/ff/ff", "dd/dd/xx") == 0){

1053 
	`¥ötf
(1, "link dd/ff/ff dd/dd/xx succeeded!\n");

1054 
	`exô
();

1056 if(
	`lök
("dd/xx/ff", "dd/dd/xx") == 0){

1057 
	`¥ötf
(1, "link dd/xx/ff dd/dd/xx succeeded!\n");

1058 
	`exô
();

1060 if(
	`lök
("dd/ff", "dd/dd/ffff") == 0){

1061 
	`¥ötf
(1, "link dd/ff dd/dd/ffff succeeded!\n");

1062 
	`exô
();

1064 if(
	`mkdú
("dd/ff/ff") == 0){

1065 
	`¥ötf
(1, "mkdir dd/ff/ff succeeded!\n");

1066 
	`exô
();

1068 if(
	`mkdú
("dd/xx/ff") == 0){

1069 
	`¥ötf
(1, "mkdir dd/xx/ff succeeded!\n");

1070 
	`exô
();

1072 if(
	`mkdú
("dd/dd/ffff") == 0){

1073 
	`¥ötf
(1, "mkdir dd/dd/ffff succeeded!\n");

1074 
	`exô
();

1076 if(
	`u∆ök
("dd/xx/ff") == 0){

1077 
	`¥ötf
(1, "unlink dd/xx/ff succeeded!\n");

1078 
	`exô
();

1080 if(
	`u∆ök
("dd/ff/ff") == 0){

1081 
	`¥ötf
(1, "unlink dd/ff/ff succeeded!\n");

1082 
	`exô
();

1084 if(
	`chdú
("dd/ff") == 0){

1085 
	`¥ötf
(1, "chdir dd/ff succeeded!\n");

1086 
	`exô
();

1088 if(
	`chdú
("dd/xx") == 0){

1089 
	`¥ötf
(1, "chdir dd/xx succeeded!\n");

1090 
	`exô
();

1093 if(
	`u∆ök
("dd/dd/ffff") != 0){

1094 
	`¥ötf
(1, "unlink dd/dd/ff failed\n");

1095 
	`exô
();

1097 if(
	`u∆ök
("dd/ff") != 0){

1098 
	`¥ötf
(1, "unlink dd/ff failed\n");

1099 
	`exô
();

1101 if(
	`u∆ök
("dd") == 0){

1102 
	`¥ötf
(1, "unlinkÇon-empty dd succeeded!\n");

1103 
	`exô
();

1105 if(
	`u∆ök
("dd/dd") < 0){

1106 
	`¥ötf
(1, "unlink dd/dd failed\n");

1107 
	`exô
();

1109 if(
	`u∆ök
("dd") < 0){

1110 
	`¥ötf
(1, "unlink dd failed\n");

1111 
	`exô
();

1114 
	`¥ötf
(1, "subdir ok\n");

1115 
	}
}

1119 
	$bigwrôe
()

1121 
fd
, 
sz
;

1123 
	`¥ötf
(1, "bigwriteÅest\n");

1125 
	`u∆ök
("bigwrite");

1126 
sz
 = 499; sz < 12*512; sz += 471){

1127 
fd
 = 
	`›í
("bigwrôe", 
O_CREATE
 | 
O_RDWR
);

1128 if(
fd
 < 0){

1129 
	`¥ötf
(1, "cannot create bigwrite\n");

1130 
	`exô
();

1132 
i
;

1133 
i
 = 0; i < 2; i++){

1134 
cc
 = 
	`wrôe
(
fd
, 
buf
, 
sz
);

1135 if(
cc
 !
sz
){

1136 
	`¥ötf
(1, "wrôe(%dËªà%d\n", 
sz
, 
cc
);

1137 
	`exô
();

1140 
	`˛o£
(
fd
);

1141 
	`u∆ök
("bigwrite");

1144 
	`¥ötf
(1, "bigwrite ok\n");

1145 
	}
}

1148 
	$bigfûe
()

1150 
fd
, 
i
, 
tŸÆ
, 
cc
;

1152 
	`¥ötf
(1, "bigfileÅest\n");

1154 
	`u∆ök
("bigfile");

1155 
fd
 = 
	`›í
("bigfûe", 
O_CREATE
 | 
O_RDWR
);

1156 if(
fd
 < 0){

1157 
	`¥ötf
(1, "cannot create bigfile");

1158 
	`exô
();

1160 
i
 = 0; i < 20; i++){

1161 
	`mem£t
(
buf
, 
i
, 600);

1162 if(
	`wrôe
(
fd
, 
buf
, 600) != 600){

1163 
	`¥ötf
(1, "write bigfile failed\n");

1164 
	`exô
();

1167 
	`˛o£
(
fd
);

1169 
fd
 = 
	`›í
("bigfile", 0);

1170 if(
fd
 < 0){

1171 
	`¥ötf
(1, "cannot open bigfile\n");

1172 
	`exô
();

1174 
tŸÆ
 = 0;

1175 
i
 = 0; ; i++){

1176 
cc
 = 
	`ªad
(
fd
, 
buf
, 300);

1177 if(
cc
 < 0){

1178 
	`¥ötf
(1, "read bigfile failed\n");

1179 
	`exô
();

1181 if(
cc
 == 0)

1183 if(
cc
 != 300){

1184 
	`¥ötf
(1, "shortÑead bigfile\n");

1185 
	`exô
();

1187 if(
buf
[0] !
i
/2 || buf[299] != i/2){

1188 
	`¥ötf
(1, "read bigfile wrong data\n");

1189 
	`exô
();

1191 
tŸÆ
 +
cc
;

1193 
	`˛o£
(
fd
);

1194 if(
tŸÆ
 != 20*600){

1195 
	`¥ötf
(1, "read bigfile wrongÅotal\n");

1196 
	`exô
();

1198 
	`u∆ök
("bigfile");

1200 
	`¥ötf
(1, "bigfileÅest ok\n");

1201 
	}
}

1204 
	$fouπìn
()

1206 
fd
;

1209 
	`¥ötf
(1, "fourteenÅest\n");

1211 if(
	`mkdú
("12345678901234") != 0){

1212 
	`¥ötf
(1, "mkdir 12345678901234 failed\n");

1213 
	`exô
();

1215 if(
	`mkdú
("12345678901234/123456789012345") != 0){

1216 
	`¥ötf
(1, "mkdir 12345678901234/123456789012345 failed\n");

1217 
	`exô
();

1219 
fd
 = 
	`›í
("123456789012345/123456789012345/123456789012345", 
O_CREATE
);

1220 if(
fd
 < 0){

1221 
	`¥ötf
(1, "create 123456789012345/123456789012345/123456789012345 failed\n");

1222 
	`exô
();

1224 
	`˛o£
(
fd
);

1225 
fd
 = 
	`›í
("12345678901234/12345678901234/12345678901234", 0);

1226 if(
fd
 < 0){

1227 
	`¥ötf
(1, "open 12345678901234/12345678901234/12345678901234 failed\n");

1228 
	`exô
();

1230 
	`˛o£
(
fd
);

1232 if(
	`mkdú
("12345678901234/12345678901234") == 0){

1233 
	`¥ötf
(1, "mkdir 12345678901234/12345678901234 succeeded!\n");

1234 
	`exô
();

1236 if(
	`mkdú
("123456789012345/12345678901234") == 0){

1237 
	`¥ötf
(1, "mkdir 12345678901234/123456789012345 succeeded!\n");

1238 
	`exô
();

1241 
	`¥ötf
(1, "fourteen ok\n");

1242 
	}
}

1245 
	$rmdŸ
()

1247 
	`¥ötf
(1, "rmdotÅest\n");

1248 if(
	`mkdú
("dots") != 0){

1249 
	`¥ötf
(1, "mkdir dots failed\n");

1250 
	`exô
();

1252 if(
	`chdú
("dots") != 0){

1253 
	`¥ötf
(1, "chdir dots failed\n");

1254 
	`exô
();

1256 if(
	`u∆ök
(".") == 0){

1257 
	`¥ötf
(1, "rm . worked!\n");

1258 
	`exô
();

1260 if(
	`u∆ök
("..") == 0){

1261 
	`¥ötf
(1, "rm .. worked!\n");

1262 
	`exô
();

1264 if(
	`chdú
("/") != 0){

1265 
	`¥ötf
(1, "chdir / failed\n");

1266 
	`exô
();

1268 if(
	`u∆ök
("dots/.") == 0){

1269 
	`¥ötf
(1, "unlink dots/. worked!\n");

1270 
	`exô
();

1272 if(
	`u∆ök
("dots/..") == 0){

1273 
	`¥ötf
(1, "unlink dots/.. worked!\n");

1274 
	`exô
();

1276 if(
	`u∆ök
("dots") != 0){

1277 
	`¥ötf
(1, "unlink dots failed!\n");

1278 
	`exô
();

1280 
	`¥ötf
(1, "rmdot ok\n");

1281 
	}
}

1284 
	$dúfûe
()

1286 
fd
;

1288 
	`¥ötf
(1, "dir vs file\n");

1290 
fd
 = 
	`›í
("dúfûe", 
O_CREATE
);

1291 if(
fd
 < 0){

1292 
	`¥ötf
(1, "create dirfile failed\n");

1293 
	`exô
();

1295 
	`˛o£
(
fd
);

1296 if(
	`chdú
("dirfile") == 0){

1297 
	`¥ötf
(1, "chdir dirfile succeeded!\n");

1298 
	`exô
();

1300 
fd
 = 
	`›í
("dirfile/xx", 0);

1301 if(
fd
 >= 0){

1302 
	`¥ötf
(1, "create dirfile/xx succeeded!\n");

1303 
	`exô
();

1305 
fd
 = 
	`›í
("dúfûe/xx", 
O_CREATE
);

1306 if(
fd
 >= 0){

1307 
	`¥ötf
(1, "create dirfile/xx succeeded!\n");

1308 
	`exô
();

1310 if(
	`mkdú
("dirfile/xx") == 0){

1311 
	`¥ötf
(1, "mkdir dirfile/xx succeeded!\n");

1312 
	`exô
();

1314 if(
	`u∆ök
("dirfile/xx") == 0){

1315 
	`¥ötf
(1, "unlink dirfile/xx succeeded!\n");

1316 
	`exô
();

1318 if(
	`lök
("README", "dirfile/xx") == 0){

1319 
	`¥ötf
(1, "linkÅo dirfile/xx succeeded!\n");

1320 
	`exô
();

1322 if(
	`u∆ök
("dirfile") != 0){

1323 
	`¥ötf
(1, "unlink dirfile failed!\n");

1324 
	`exô
();

1327 
fd
 = 
	`›í
(".", 
O_RDWR
);

1328 if(
fd
 >= 0){

1329 
	`¥ötf
(1, "open . for writing succeeded!\n");

1330 
	`exô
();

1332 
fd
 = 
	`›í
(".", 0);

1333 if(
	`wrôe
(
fd
, "x", 1) > 0){

1334 
	`¥ötf
(1, "write . succeeded!\n");

1335 
	`exô
();

1337 
	`˛o£
(
fd
);

1339 
	`¥ötf
(1, "dir vs file OK\n");

1340 
	}
}

1344 
	$úef
()

1346 
i
, 
fd
;

1348 
	`¥ötf
(1, "empty fileÇame\n");

1351 
i
 = 0; i < 50 + 1; i++){

1352 if(
	`mkdú
("irefd") != 0){

1353 
	`¥ötf
(1, "mkdir irefd failed\n");

1354 
	`exô
();

1356 if(
	`chdú
("irefd") != 0){

1357 
	`¥ötf
(1, "chdir irefd failed\n");

1358 
	`exô
();

1361 
	`mkdú
("");

1362 
	`lök
("README", "");

1363 
fd
 = 
	`›í
("", 
O_CREATE
);

1364 if(
fd
 >= 0)

1365 
	`˛o£
(
fd
);

1366 
fd
 = 
	`›í
("xx", 
O_CREATE
);

1367 if(
fd
 >= 0)

1368 
	`˛o£
(
fd
);

1369 
	`u∆ök
("xx");

1372 
	`chdú
("/");

1373 
	`¥ötf
(1, "empty fileÇame OK\n");

1374 
	}
}

1380 
	$f‹kã°
()

1382 
n
, 
pid
;

1384 
	`¥ötf
(1, "forkÅest\n");

1386 
n
=0;Ç<1000;Ç++){

1387 
pid
 = 
	`f‹k
();

1388 if(
pid
 < 0)

1390 if(
pid
 == 0)

1391 
	`exô
();

1394 if(
n
 == 1000){

1395 
	`¥ötf
(1, "fork claimedÅo work 1000Åimes!\n");

1396 
	`exô
();

1399 ; 
n
 > 0;Ç--){

1400 if(
	`waô
() < 0){

1401 
	`¥ötf
(1, "wait stoppedÉarly\n");

1402 
	`exô
();

1406 if(
	`waô
() != -1){

1407 
	`¥ötf
(1, "wait gotÅoo many\n");

1408 
	`exô
();

1411 
	`¥ötf
(1, "forkÅest OK\n");

1412 
	}
}

1415 
	$sbrkã°
()

1417 
fds
[2], 
pid
, 
pids
[10], 
µid
;

1418 *
a
, *
b
, *
c
, *
œ°addr
, *
ﬁdbrk
, *
p
, 
s¸©ch
;

1419 
uöt
 
amt
;

1421 
	`¥ötf
(
°dout
, "sbrkÅest\n");

1422 
ﬁdbrk
 = 
	`sbrk
(0);

1425 
a
 = 
	`sbrk
(0);

1426 
i
;

1427 
i
 = 0; i < 5000; i++){

1428 
b
 = 
	`sbrk
(1);

1429 if(
b
 !
a
){

1430 
	`¥ötf
(
°dout
, "sbrkÅe° faûed %d %x %x\n", 
i
, 
a
, 
b
);

1431 
	`exô
();

1433 *
b
 = 1;

1434 
a
 = 
b
 + 1;

1436 
pid
 = 
	`f‹k
();

1437 if(
pid
 < 0){

1438 
	`¥ötf
(
°dout
, "sbrkÅest fork failed\n");

1439 
	`exô
();

1441 
c
 = 
	`sbrk
(1);

1442 
c
 = 
	`sbrk
(1);

1443 if(
c
 !
a
 + 1){

1444 
	`¥ötf
(
°dout
, "sbrkÅest failedÖost-fork\n");

1445 
	`exô
();

1447 if(
pid
 == 0)

1448 
	`exô
();

1449 
	`waô
();

1452 
	#BIG
 (100*1024*1024)

	)

1453 
a
 = 
	`sbrk
(0);

1454 
amt
 = (
BIG
Ë- (
uöt
)
a
;

1455 
p
 = 
	`sbrk
(
amt
);

1456 i‡(
p
 !
a
) {

1457 
	`¥ötf
(
°dout
, "sbrkÅest failedÅo grow bigáddress space;ÉnoughÖhys mem?\n");

1458 
	`exô
();

1460 
œ°addr
 = (*Ë(
BIG
-1);

1461 *
œ°addr
 = 99;

1464 
a
 = 
	`sbrk
(0);

1465 
c
 = 
	`sbrk
(-4096);

1466 if(
c
 == (*)0xffffffff){

1467 
	`¥ötf
(
°dout
, "sbrk couldÇot deallocate\n");

1468 
	`exô
();

1470 
c
 = 
	`sbrk
(0);

1471 if(
c
 !
a
 - 4096){

1472 
	`¥ötf
(
°dout
, "sbrk dóŒoˇti⁄Örodu˚d wr⁄gáddªss,á %x c %x\n", 
a
, 
c
);

1473 
	`exô
();

1477 
a
 = 
	`sbrk
(0);

1478 
c
 = 
	`sbrk
(4096);

1479 if(
c
 !
a
 || 
	`sbrk
(0) !=á + 4096){

1480 
	`¥ötf
(
°dout
, "sbrkÑe-Æloˇti⁄ faûed,á %x c %x\n", 
a
, 
c
);

1481 
	`exô
();

1483 if(*
œ°addr
 == 99){

1485 
	`¥ötf
(
°dout
, "sbrk de-allocation didn'tÑeally deallocate\n");

1486 
	`exô
();

1489 
a
 = 
	`sbrk
(0);

1490 
c
 = 
	`sbrk
(-(sbrk(0Ë- 
ﬁdbrk
));

1491 if(
c
 !
a
){

1492 
	`¥ötf
(
°dout
, "sbrk downsizêÁûed,á %x c %x\n", 
a
, 
c
);

1493 
	`exô
();

1497 
a
 = (*)(
KERNBASE
);á < (*) (KERNBASE+2000000);á += 50000){

1498 
µid
 = 
	`gëpid
();

1499 
pid
 = 
	`f‹k
();

1500 if(
pid
 < 0){

1501 
	`¥ötf
(
°dout
, "fork failed\n");

1502 
	`exô
();

1504 if(
pid
 == 0){

1505 
	`¥ötf
(
°dout
, "o›†couldÑód %x = %x\n", 
a
, *a);

1506 
	`kûl
(
µid
);

1507 
	`exô
();

1509 
	`waô
();

1514 if(
	`pùe
(
fds
) != 0){

1515 
	`¥ötf
(1, "pipe() failed\n");

1516 
	`exô
();

1518 
i
 = 0; i < (
pids
)/(pids[0]); i++){

1519 if((
pids
[
i
] = 
	`f‹k
()) == 0){

1521 
	`sbrk
(
BIG
 - (
uöt
)sbrk(0));

1522 
	`wrôe
(
fds
[1], "x", 1);

1524 ;;Ë
	`¶ìp
(1000);

1526 if(
pids
[
i
] != -1)

1527 
	`ªad
(
fds
[0], &
s¸©ch
, 1);

1531 
c
 = 
	`sbrk
(4096);

1532 
i
 = 0; i < (
pids
)/(pids[0]); i++){

1533 if(
pids
[
i
] == -1)

1535 
	`kûl
(
pids
[
i
]);

1536 
	`waô
();

1538 if(
c
 == (*)0xffffffff){

1539 
	`¥ötf
(
°dout
, "failed sbrkÜeaked memory\n");

1540 
	`exô
();

1543 if(
	`sbrk
(0Ë> 
ﬁdbrk
)

1544 
	`sbrk
(-(sbrk(0Ë- 
ﬁdbrk
));

1546 
	`¥ötf
(
°dout
, "sbrkÅest OK\n");

1547 
	}
}

1550 
	$vÆid©eöt
(*
p
)

1552 
ªs
;

1553 
	`asm
("mov %%esp, %%ebx\n\t"

1557 "˜" (
ªs
) :

1558 "a" (
SYS_¶ìp
), "n" (
T_SYSCALL
), "c" (
p
) :

1560 
	}
}

1563 
	$vÆid©ëe°
()

1565 
hi
, 
pid
;

1566 
uöt
 
p
;

1568 
	`¥ötf
(
°dout
, "validateÅest\n");

1569 
hi
 = 1100*1024;

1571 
p
 = 0;Ö <(
uöt
)
hi
;Ö += 4096){

1572 if((
pid
 = 
	`f‹k
()) == 0){

1574 
	`vÆid©eöt
((*)
p
);

1575 
	`exô
();

1577 
	`¶ìp
(0);

1578 
	`¶ìp
(0);

1579 
	`kûl
(
pid
);

1580 
	`waô
();

1583 if(
	`lök
("nosuchfûe", (*)
p
) != -1){

1584 
	`¥ötf
(
°dout
, "link shouldÇot succeed\n");

1585 
	`exô
();

1589 
	`¥ötf
(
°dout
, "validate ok\n");

1590 
	}
}

1593 
	gunöô
[10000];

1595 
	$bs°e°
()

1597 
i
;

1599 
	`¥ötf
(
°dout
, "bssÅest\n");

1600 
i
 = 0; i < (
unöô
); i++){

1601 if(
unöô
[
i
] != '\0'){

1602 
	`¥ötf
(
°dout
, "bssÅest failed\n");

1603 
	`exô
();

1606 
	`¥ötf
(
°dout
, "bssÅest ok\n");

1607 
	}
}

1613 
	$big¨gã°
()

1615 
pid
, 
fd
;

1617 
	`u∆ök
("bigarg-ok");

1618 
pid
 = 
	`f‹k
();

1619 if(
pid
 == 0){

1620 *
¨gs
[
MAXARG
];

1621 
i
;

1622 
i
 = 0; i < 
MAXARG
-1; i++)

1623 
¨gs
[
i
] = "bigargsÅest: failed\n ";

1624 
¨gs
[
MAXARG
-1] = 0;

1625 
	`¥ötf
(
°dout
, "bigargÅest\n");

1626 
	`exec
("echo", 
¨gs
);

1627 
	`¥ötf
(
°dout
, "bigargÅest ok\n");

1628 
fd
 = 
	`›í
("big¨g-ok", 
O_CREATE
);

1629 
	`˛o£
(
fd
);

1630 
	`exô
();

1631 } if(
pid
 < 0){

1632 
	`¥ötf
(
°dout
, "bigargtest: fork failed\n");

1633 
	`exô
();

1635 
	`waô
();

1636 
fd
 = 
	`›í
("bigarg-ok", 0);

1637 if(
fd
 < 0){

1638 
	`¥ötf
(
°dout
, "bigargÅest failed!\n");

1639 
	`exô
();

1641 
	`˛o£
(
fd
);

1642 
	`u∆ök
("bigarg-ok");

1643 
	}
}

1648 
	$fsfuŒ
()

1650 
nfûes
;

1651 
fsblocks
 = 0;

1653 
	`¥ötf
(1, "fsfullÅest\n");

1655 
nfûes
 = 0; ;Çfiles++){

1656 
«me
[64];

1657 
«me
[0] = 'f';

1658 
«me
[1] = '0' + 
nfûes
 / 1000;

1659 
«me
[2] = '0' + (
nfûes
 % 1000) / 100;

1660 
«me
[3] = '0' + (
nfûes
 % 100) / 10;

1661 
«me
[4] = '0' + (
nfûes
 % 10);

1662 
«me
[5] = '\0';

1663 
	`¥ötf
(1, "wrôög %s\n", 
«me
);

1664 
fd
 = 
	`›í
(
«me
, 
O_CREATE
|
O_RDWR
);

1665 if(
fd
 < 0){

1666 
	`¥ötf
(1, "›í %†Áûed\n", 
«me
);

1669 
tŸÆ
 = 0;

1671 
cc
 = 
	`wrôe
(
fd
, 
buf
, 512);

1672 if(
cc
 < 512)

1674 
tŸÆ
 +
cc
;

1675 
fsblocks
++;

1677 
	`¥ötf
(1, "wrŸê%d byãs\n", 
tŸÆ
);

1678 
	`˛o£
(
fd
);

1679 if(
tŸÆ
 == 0)

1683 
nfûes
 >= 0){

1684 
«me
[64];

1685 
«me
[0] = 'f';

1686 
«me
[1] = '0' + 
nfûes
 / 1000;

1687 
«me
[2] = '0' + (
nfûes
 % 1000) / 100;

1688 
«me
[3] = '0' + (
nfûes
 % 100) / 10;

1689 
«me
[4] = '0' + (
nfûes
 % 10);

1690 
«me
[5] = '\0';

1691 
	`u∆ök
(
«me
);

1692 
nfûes
--;

1695 
	`¥ötf
(1, "fsfullÅest finished\n");

1696 
	}
}

1699 
	$uio
()

1701 
	#RTC_ADDR
 0x70

	)

1702 
	#RTC_DATA
 0x71

	)

1704 
ush‹t
 
p‹t
 = 0;

1705 
uch¨
 
vÆ
 = 0;

1706 
pid
;

1708 
	`¥ötf
(1, "uioÅest\n");

1709 
pid
 = 
	`f‹k
();

1710 if(
pid
 == 0){

1711 
p‹t
 = 
RTC_ADDR
;

1712 
vÆ
 = 0x09;

1714 
asm
 vﬁ©ûe("outb %0,%1"::"a"(
vÆ
), "d" (
p‹t
));

1715 
p‹t
 = 
RTC_DATA
;

1716 
asm
 vﬁ©ûe("öb %1,%0" : "˜" (
vÆ
Ë: "d" (
p‹t
));

1717 
	`¥ötf
(1, "uio: uio succeeded;Åest FAILED\n");

1718 
	`exô
();

1719 } if(
pid
 < 0){

1720 
	`¥ötf
 (1, "fork failed\n");

1721 
	`exô
();

1723 
	`waô
();

1724 
	`¥ötf
(1, "uioÅest done\n");

1725 
	}
}

1727 
	$¨g±e°
()

1729 
fd
;

1730 
fd
 = 
	`›í
("öô", 
O_RDONLY
);

1731 i‡(
fd
 < 0) {

1732 
	`¥ötf
(2, "open failed\n");

1733 
	`exô
();

1735 
	`ªad
(
fd
, 
	`sbrk
(0) - 1, -1);

1736 
	`˛o£
(
fd
);

1737 
	`¥ötf
(1, "argÅestÖassed\n");

1738 
	}
}

1740 
	gønd°©e
 = 1;

1742 
	$ønd
()

1744 
ønd°©e
 =Ñandstate * 1664525 + 1013904223;

1745  
ønd°©e
;

1746 
	}
}

1749 
	$maö
(
¨gc
, *
¨gv
[])

1751 
	`¥ötf
(1, "usertests starting\n");

1753 if(
	`›í
("usertests.ran", 0) >= 0){

1754 
	`¥ötf
(1, "alreadyÑan userÅests --Ñebuild fs.img\n");

1755 
	`exô
();

1757 
	`˛o£
(
	`›í
("u£πe°s.øn", 
O_CREATE
));

1759 
	`¨g±e°
();

1760 
	`¸óãdñëe
();

1761 
	`löku∆ök
();

1762 
	`c⁄¸óã
();

1763 
	`fourfûes
();

1764 
	`sh¨edfd
();

1766 
	`big¨gã°
();

1767 
	`bigwrôe
();

1768 
	`big¨gã°
();

1769 
	`bs°e°
();

1770 
	`sbrkã°
();

1771 
	`vÆid©ëe°
();

1773 
	`›íã°
();

1774 
	`wrôëe°
();

1775 
	`wrôëe°1
();

1776 
	`¸óãã°
();

1778 
	`›íùuâe°
();

1779 
	`exôùuâe°
();

1780 
	`ùuâe°
();

1782 
	`mem
();

1783 
	`pùe1
();

1784 
	`¥ìm±
();

1785 
	`exôwaô
();

1787 
	`rmdŸ
();

1788 
	`fouπìn
();

1789 
	`bigfûe
();

1790 
	`subdú
();

1791 
	`lökã°
();

1792 
	`u∆ökªad
();

1793 
	`dúfûe
();

1794 
	`úef
();

1795 
	`f‹kã°
();

1796 
	`bigdú
();

1798 
	`uio
();

1800 
	`exe˘e°
();

1802 
	`exô
();

1803 
	}
}

	@vm.c

1 
	~"∑øm.h
"

2 
	~"ty≥s.h
"

3 
	~"defs.h
"

4 
	~"x86.h
"

5 
	~"memœyout.h
"

6 
	~"mmu.h
"

7 
	~"¥oc.h
"

8 
	~"ñf.h
"

10 
d©a
[];

11 
pde_t
 *
	gkpgdú
;

16 
	$£göô
()

18 
˝u
 *
c
;

24 
c
 = &
˝us
[
	`˝uid
()];

25 
c
->
gdt
[
SEG_KCODE
] = 
	`SEG
(
STA_X
|
STA_R
, 0, 0xffffffff, 0);

26 
c
->
gdt
[
SEG_KDATA
] = 
	`SEG
(
STA_W
, 0, 0xffffffff, 0);

27 
c
->
gdt
[
SEG_UCODE
] = 
	`SEG
(
STA_X
|
STA_R
, 0, 0xffffffff, 
DPL_USER
);

28 
c
->
gdt
[
SEG_UDATA
] = 
	`SEG
(
STA_W
, 0, 0xffffffff, 
DPL_USER
);

29 
	`lgdt
(
c
->
gdt
, (c->gdt));

30 
	}
}

35 
±e_t
 *

36 
	$wÆkpgdú
(
pde_t
 *
pgdú
, c⁄° *
va
, 
Æloc
)

38 
pde_t
 *
pde
;

39 
±e_t
 *
pgèb
;

41 
pde
 = &
pgdú
[
	`PDX
(
va
)];

42 if(*
pde
 & 
PTE_P
){

43 
pgèb
 = (
±e_t
*)
	`P2V
(
	`PTE_ADDR
(*
pde
));

45 if(!
Æloc
 || (
pgèb
 = (
±e_t
*)
	`kÆloc
()) == 0)

48 
	`mem£t
(
pgèb
, 0, 
PGSIZE
);

52 *
pde
 = 
	`V2P
(
pgèb
Ë| 
PTE_P
 | 
PTE_W
 | 
PTE_U
;

54  &
pgèb
[
	`PTX
(
va
)];

55 
	}
}

61 
	$m≠∑ges
(
pde_t
 *
pgdú
, *
va
, 
uöt
 
size
, uöà
∑
, 
≥rm
)

63 *
a
, *
œ°
;

64 
±e_t
 *
±e
;

66 
a
 = (*)
	`PGROUNDDOWN
((
uöt
)
va
);

67 
œ°
 = (*)
	`PGROUNDDOWN
(((
uöt
)
va
Ë+ 
size
 - 1);

69 if((
±e
 = 
	`wÆkpgdú
(
pgdú
, 
a
, 1)) == 0)

71 if(*
±e
 & 
PTE_P
)

72 
	`∑nic
("remap");

73 *
±e
 = 
∑
 | 
≥rm
 | 
PTE_P
;

74 if(
a
 =
œ°
)

76 
a
 +
PGSIZE
;

77 
∑
 +
PGSIZE
;

80 
	}
}

105 
	skm≠
 {

106 *
	mvút
;

107 
uöt
 
	mphys_°¨t
;

108 
uöt
 
	mphys_íd
;

109 
	m≥rm
;

110 } 
	gkm≠
[] = {

111 { (*)
KERNBASE
, 0, 
EXTMEM
, 
PTE_W
},

112 { (*)
KERNLINK
, 
V2P
(KERNLINK), V2P(
d©a
), 0},

113 { (*)
d©a
, 
V2P
(d©a), 
PHYSTOP
, 
PTE_W
},

114 { (*)
DEVSPACE
, DEVSPACE, 0, 
PTE_W
},

118 
pde_t
*

119 
	$£tupkvm
()

121 
pde_t
 *
pgdú
;

122 
km≠
 *
k
;

124 if((
pgdú
 = (
pde_t
*)
	`kÆloc
()) == 0)

126 
	`mem£t
(
pgdú
, 0, 
PGSIZE
);

127 i‡(
	`P2V
(
PHYSTOP
Ë> (*)
DEVSPACE
)

128 
	`∑nic
("PHYSTOPÅoo high");

129 
k
 = 
km≠
; k < &km≠[
	`NELEM
(kmap)]; k++)

130 if(
	`m≠∑ges
(
pgdú
, 
k
->
vút
, k->
phys_íd
 - k->
phys_°¨t
,

131 (
uöt
)
k
->
phys_°¨t
, k->
≥rm
) < 0) {

132 
	`‰ìvm
(
pgdú
);

135  
pgdú
;

136 
	}
}

141 
	$kvmÆloc
()

143 
kpgdú
 = 
	`£tupkvm
();

144 
	`swôchkvm
();

145 
	}
}

150 
	$swôchkvm
()

152 
	`l¸3
(
	`V2P
(
kpgdú
));

153 
	}
}

157 
	$swôchuvm
(
¥oc
 *
p
)

159 if(
p
 == 0)

160 
	`∑nic
("switchuvm:ÇoÖrocess");

161 if(
p
->
k°ack
 == 0)

162 
	`∑nic
("switchuvm:Ço kstack");

163 if(
p
->
pgdú
 == 0)

164 
	`∑nic
("switchuvm:ÇoÖgdir");

166 
	`push˛i
();

167 
	`my˝u
()->
gdt
[
SEG_TSS
] = 
	`SEG16
(
STS_T32A
, &my˝u()->
ts
,

168 (
	`my˝u
()->
ts
)-1, 0);

169 
	`my˝u
()->
gdt
[
SEG_TSS
].
s
 = 0;

170 
	`my˝u
()->
ts
.
ss0
 = 
SEG_KDATA
 << 3;

171 
	`my˝u
()->
ts
.
e•0
 = (
uöt
)
p
->
k°ack
 + 
KSTACKSIZE
;

174 
	`my˝u
()->
ts
.
iomb
 = (
ush‹t
) 0xFFFF;

175 
	`…r
(
SEG_TSS
 << 3);

176 
	`l¸3
(
	`V2P
(
p
->
pgdú
));

177 
	`p›˛i
();

178 
	}
}

183 
	$öôuvm
(
pde_t
 *
pgdú
, *
öô
, 
uöt
 
sz
)

185 *
mem
;

187 if(
sz
 >
PGSIZE
)

188 
	`∑nic
("inituvm: moreÅhanáÖage");

189 
mem
 = 
	`kÆloc
();

190 
	`mem£t
(
mem
, 0, 
PGSIZE
);

191 
	`m≠∑ges
(
pgdú
, 0, 
PGSIZE
, 
	`V2P
(
mem
), 
PTE_W
|
PTE_U
);

192 
	`memmove
(
mem
, 
öô
, 
sz
);

193 
	}
}

198 
	$lﬂduvm
(
pde_t
 *
pgdú
, *
addr
, 
öode
 *
ù
, 
uöt
 
off£t
, uöà
sz
)

200 
uöt
 
i
, 
∑
, 
n
;

201 
±e_t
 *
±e
;

203 if((
uöt
Ë
addr
 % 
PGSIZE
 != 0)

204 
	`∑nic
("loaduvm:áddr must beÖageáligned");

205 
i
 = 0; i < 
sz
; i +
PGSIZE
){

206 if((
±e
 = 
	`wÆkpgdú
(
pgdú
, 
addr
+
i
, 0)) == 0)

207 
	`∑nic
("loaduvm:áddress shouldÉxist");

208 
∑
 = 
	`PTE_ADDR
(*
±e
);

209 if(
sz
 - 
i
 < 
PGSIZE
)

210 
n
 = 
sz
 - 
i
;

212 
n
 = 
PGSIZE
;

213 if(
	`ªadi
(
ù
, 
	`P2V
(
∑
), 
off£t
+
i
, 
n
) !=Ç)

217 
	}
}

222 
	$Ælocuvm
(
pde_t
 *
pgdú
, 
uöt
 
ﬁdsz
, uöà
√wsz
)

224 *
mem
;

225 
uöt
 
a
;

227 if(
√wsz
 >
KERNBASE
)

229 
	`˝rötf
("newsz\n");

232 if(
√wsz
 < 
ﬁdsz
)

233  
ﬁdsz
;

235 
a
 = 
	`PGROUNDUP
(
ﬁdsz
);

236 ; 
a
 < 
√wsz
;á +
PGSIZE
){

237 
mem
 = 
	`kÆloc
();

238 if(
mem
 == 0){

239 
	`˝rötf
("allocuvm out of memory\n");

240 
	`dóŒocuvm
(
pgdú
, 
√wsz
, 
ﬁdsz
);

243 
	`mem£t
(
mem
, 0, 
PGSIZE
);

244 if(
	`m≠∑ges
(
pgdú
, (*)
a
, 
PGSIZE
, 
	`V2P
(
mem
), 
PTE_W
|
PTE_U
) < 0){

245 
	`˝rötf
("allocuvm out of memory (2)\n");

246 
	`dóŒocuvm
(
pgdú
, 
√wsz
, 
ﬁdsz
);

247 
	`k‰ì
(
mem
);

251  
√wsz
;

252 
	}
}

259 
	$dóŒocuvm
(
pde_t
 *
pgdú
, 
uöt
 
ﬁdsz
, uöà
√wsz
)

261 
±e_t
 *
±e
;

262 
uöt
 
a
, 
∑
;

264 if(
√wsz
 >
ﬁdsz
)

265  
ﬁdsz
;

267 
a
 = 
	`PGROUNDUP
(
√wsz
);

268 ; 
a
 < 
ﬁdsz
;á +
PGSIZE
){

269 
±e
 = 
	`wÆkpgdú
(
pgdú
, (*)
a
, 0);

270 if(!
±e
)

271 
a
 = 
	`PGADDR
(
	`PDX
◊Ë+ 1, 0, 0Ë- 
PGSIZE
;

272 if((*
±e
 & 
PTE_P
) != 0){

273 
∑
 = 
	`PTE_ADDR
(*
±e
);

274 if(
∑
 == 0)

275 
	`∑nic
("kfree");

276 *
v
 = 
	`P2V
(
∑
);

277 
	`k‰ì
(
v
);

278 *
±e
 = 0;

281  
√wsz
;

282 
	}
}

287 
	$‰ìvm
(
pde_t
 *
pgdú
)

289 
uöt
 
i
;

291 if(
pgdú
 == 0)

292 
	`∑nic
("freevm:ÇoÖgdir");

293 
	`dóŒocuvm
(
pgdú
, 
KERNBASE
, 0);

294 
i
 = 0; i < 
NPDENTRIES
; i++){

295 if(
pgdú
[
i
] & 
PTE_P
){

296 * 
v
 = 
	`P2V
(
	`PTE_ADDR
(
pgdú
[
i
]));

297 
	`k‰ì
(
v
);

300 
	`k‰ì
((*)
pgdú
);

301 
	}
}

306 
	$˛óΩãu
(
pde_t
 *
pgdú
, *
uva
)

308 
±e_t
 *
±e
;

310 
±e
 = 
	`wÆkpgdú
(
pgdú
, 
uva
, 0);

311 if(
±e
 == 0)

312 
	`∑nic
("clearpteu");

313 *
±e
 &~
PTE_U
;

314 
	}
}

318 
pde_t
*

319 
	$c›yuvm
(
pde_t
 *
pgdú
, 
uöt
 
sz
)

321 
pde_t
 *
d
;

322 
±e_t
 *
±e
;

323 
uöt
 
∑
, 
i
, 
Êags
;

324 *
mem
;

326 if((
d
 = 
	`£tupkvm
()) == 0)

328 
i
 = 0; i < 
sz
; i +
PGSIZE
){

329 if((
±e
 = 
	`wÆkpgdú
(
pgdú
, (*Ë
i
, 0)) == 0)

330 
	`∑nic
("copyuvm:Öte shouldÉxist");

331 if(!(*
±e
 & 
PTE_P
))

332 
	`∑nic
("copyuvm:ÖageÇotÖresent");

333 
∑
 = 
	`PTE_ADDR
(*
±e
);

334 
Êags
 = 
	`PTE_FLAGS
(*
±e
);

335 if((
mem
 = 
	`kÆloc
()) == 0)

336 
bad
;

337 
	`memmove
(
mem
, (*)
	`P2V
(
∑
), 
PGSIZE
);

338 if(
	`m≠∑ges
(
d
, (*)
i
, 
PGSIZE
, 
	`V2P
(
mem
), 
Êags
) < 0)

339 
bad
;

341  
d
;

343 
bad
:

344 
	`‰ìvm
(
d
);

346 
	}
}

351 
	$uva2ka
(
pde_t
 *
pgdú
, *
uva
)

353 
±e_t
 *
±e
;

355 
±e
 = 
	`wÆkpgdú
(
pgdú
, 
uva
, 0);

356 if((*
±e
 & 
PTE_P
) == 0)

358 if((*
±e
 & 
PTE_U
) == 0)

360  (*)
	`P2V
(
	`PTE_ADDR
(*
±e
));

361 
	}
}

367 
	$c›yout
(
pde_t
 *
pgdú
, 
uöt
 
va
, *
p
, uöà
Àn
)

369 *
buf
, *
∑0
;

370 
uöt
 
n
, 
va0
;

372 
buf
 = (*)
p
;

373 
Àn
 > 0){

374 
va0
 = (
uöt
)
	`PGROUNDDOWN
(
va
);

375 
∑0
 = 
	`uva2ka
(
pgdú
, (*)
va0
);

376 if(
∑0
 == 0)

378 
n
 = 
PGSIZE
 - (
va
 - 
va0
);

379 if(
n
 > 
Àn
)

380 
n
 = 
Àn
;

381 
	`memmove
(
∑0
 + (
va
 - 
va0
), 
buf
, 
n
);

382 
Àn
 -
n
;

383 
buf
 +
n
;

384 
va
 = 
va0
 + 
PGSIZE
;

387 
	}
}

	@wc.c

1 
	~"ty≥s.h
"

2 
	~"°©.h
"

3 
	~"u£r.h
"

5 
	gbuf
[512];

8 
	$wc
(
fd
, *
«me
)

10 
i
, 
n
;

11 
l
, 
w
, 
c
, 
öw‹d
;

13 
l
 = 
w
 = 
c
 = 0;

14 
öw‹d
 = 0;

15 (
n
 = 
	`ªad
(
fd
, 
buf
, (buf))) > 0){

16 
i
=0; i<
n
; i++){

17 
c
++;

18 if(
buf
[
i
] == '\n')

19 
l
++;

20 if(
	`°rchr
(" \r\t\n\v", 
buf
[
i
]))

21 
öw‹d
 = 0;

22 if(!
öw‹d
){

23 
w
++;

24 
öw‹d
 = 1;

28 if(
n
 < 0){

29 
	`¥ötf
(1, "wc:ÑeadÉrror\n");

30 
	`exô
();

32 
	`¥ötf
(1, "%d %d %d %s\n", 
l
, 
w
, 
c
, 
«me
);

33 
	}
}

36 
	$maö
(
¨gc
, *
¨gv
[])

38 
fd
, 
i
;

40 if(
¨gc
 <= 1){

41 
	`wc
(0, "");

42 
	`exô
();

45 
i
 = 1; i < 
¨gc
; i++){

46 if((
fd
 = 
	`›í
(
¨gv
[
i
], 0)) < 0){

47 
	`¥ötf
(1, "wc: c™nŸ o≥¿%s\n", 
¨gv
[
i
]);

48 
	`exô
();

50 
	`wc
(
fd
, 
¨gv
[
i
]);

51 
	`˛o£
(
fd
);

53 
	`exô
();

54 
	}
}

	@x86.h

3 
ölöe
 
uch¨


4 
	$öb
(
ush‹t
 
p‹t
)

6 
uch¨
 
d©a
;

8 
asm
 vﬁ©ûe("ö %1,%0" : "˜" (
d©a
Ë: "d" (
p‹t
));

9  
d©a
;

10 
	}
}

12 
ölöe
 

13 
	$ö¶
(
p‹t
, *
addr
, 
˙t
)

15 
asm
 volatile("cld;Ñep insl" :

16 "=D" (
addr
), "=c" (
˙t
) :

17 "d" (
p‹t
), "0" (
addr
), "1" (
˙t
) :

19 
	}
}

21 
ölöe
 

22 
	$outb
(
ush‹t
 
p‹t
, 
uch¨
 
d©a
)

24 
asm
 vﬁ©ûe("ouà%0,%1" : : "a" (
d©a
), "d" (
p‹t
));

25 
	}
}

27 
ölöe
 

28 
	$outw
(
ush‹t
 
p‹t
, ush‹à
d©a
)

30 
asm
 vﬁ©ûe("ouà%0,%1" : : "a" (
d©a
), "d" (
p‹t
));

31 
	}
}

33 
ölöe
 

34 
	$out¶
(
p‹t
, c⁄° *
addr
, 
˙t
)

36 
asm
 volatile("cld;Ñep outsl" :

37 "=S" (
addr
), "=c" (
˙t
) :

38 "d" (
p‹t
), "0" (
addr
), "1" (
˙t
) :

40 
	}
}

42 
ölöe
 

43 
	$°osb
(*
addr
, 
d©a
, 
˙t
)

45 
asm
 volatile("cld;Ñep stosb" :

46 "=D" (
addr
), "=c" (
˙t
) :

47 "0" (
addr
), "1" (
˙t
), "a" (
d©a
) :

49 
	}
}

51 
ölöe
 

52 
	$°o¶
(*
addr
, 
d©a
, 
˙t
)

54 
asm
 volatile("cld;Ñep stosl" :

55 "=D" (
addr
), "=c" (
˙t
) :

56 "0" (
addr
), "1" (
˙t
), "a" (
d©a
) :

58 
	}
}

60 
	g£gdesc
;

62 
ölöe
 

63 
	$lgdt
(
£gdesc
 *
p
, 
size
)

65 vﬁ©ûê
ush‹t
 
pd
[3];

67 
pd
[0] = 
size
-1;

68 
pd
[1] = (
uöt
)
p
;

69 
pd
[2] = (
uöt
)
p
 >> 16;

71 
asm
 vﬁ©ûe("lgdà(%0)" : : "r" (
pd
));

72 
	}
}

74 
	gg©edesc
;

76 
ölöe
 

77 
	$lidt
(
g©edesc
 *
p
, 
size
)

79 vﬁ©ûê
ush‹t
 
pd
[3];

81 
pd
[0] = 
size
-1;

82 
pd
[1] = (
uöt
)
p
;

83 
pd
[2] = (
uöt
)
p
 >> 16;

85 
asm
 vﬁ©ûe("lidà(%0)" : : "r" (
pd
));

86 
	}
}

88 
ölöe
 

89 
	$…r
(
ush‹t
 
£l
)

91 
asm
 vﬁ©ûe("…∏%0" : : "r" (
£l
));

92 
	}
}

94 
ölöe
 
uöt


95 
	$ªadeÊags
()

97 
uöt
 
eÊags
;

98 
asm
 vﬁ©ûe("pushÊ;Ö›»%0" : "Ù" (
eÊags
));

99  
eÊags
;

100 
	}
}

102 
ölöe
 

103 
	$lﬂdgs
(
ush‹t
 
v
)

105 
asm
 vﬁ©ûe("movw %0, %%gs" : : "r" (
v
));

106 
	}
}

108 
ölöe
 

109 
	$˛i
()

111 
asm
 volatile("cli");

112 
	}
}

114 
ölöe
 

115 
	$°i
()

117 
asm
 volatile("sti");

118 
	}
}

120 
ölöe
 
uöt


121 
	$xchg
(vﬁ©ûê
uöt
 *
addr
, uöà
√wvÆ
)

123 
uöt
 
ªsu…
;

126 
asm
 volatile("lock; xchgl %0, %1" :

127 "+m" (*
addr
), "˜" (
ªsu…
) :

128 "1" (
√wvÆ
) :

130  
ªsu…
;

131 
	}
}

133 
ölöe
 
uöt


134 
	$r¸2
()

136 
uöt
 
vÆ
;

137 
asm
 vﬁ©ûe("mov»%%¸2,%0" : "Ù" (
vÆ
));

138  
vÆ
;

139 
	}
}

141 
ölöe
 

142 
	$l¸3
(
uöt
 
vÆ
)

144 
asm
 vﬁ©ûe("mov»%0,%%¸3" : : "r" (
vÆ
));

145 
	}
}

150 
	så≠‰ame
 {

152 
uöt
 
	medi
;

153 
uöt
 
	mesi
;

154 
uöt
 
	mebp
;

155 
uöt
 
	m€•
;

156 
uöt
 
	mebx
;

157 
uöt
 
	medx
;

158 
uöt
 
	mecx
;

159 
uöt
 
	móx
;

162 
ush‹t
 
	mgs
;

163 
ush‹t
 
	m∑ddög1
;

164 
ush‹t
 
	mfs
;

165 
ush‹t
 
	m∑ddög2
;

166 
ush‹t
 
	mes
;

167 
ush‹t
 
	m∑ddög3
;

168 
ush‹t
 
	mds
;

169 
ush‹t
 
	m∑ddög4
;

170 
uöt
 
	må≠no
;

173 
uöt
 
	mîr
;

174 
uöt
 
	meù
;

175 
ush‹t
 
	mcs
;

176 
ush‹t
 
	m∑ddög5
;

177 
uöt
 
	meÊags
;

180 
uöt
 
	me•
;

181 
ush‹t
 
	mss
;

182 
ush‹t
 
	m∑ddög6
;

	@zombie.c

4 
	~"ty≥s.h
"

5 
	~"°©.h
"

6 
	~"u£r.h
"

9 
	$maö
()

11 if(
	`f‹k
() > 0)

12 
	`¶ìp
(5);

13 
	`exô
();

14 
	}
}

	@/usr/include/assert.h

22 #ifdef 
_ASSERT_H


24 #unde‡
_ASSERT_H


25 #unde‡
as£π


26 #unde‡
__ASSERT_VOID_CAST


28 #ifdef 
__USE_GNU


29 #unde‡
as£π_≥º‹


34 
	#_ASSERT_H
 1

	)

35 
	~<„©uªs.h
>

37 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (2,95)

38 
	#__ASSERT_VOID_CAST
 
°©ic_ˇ°
<>

	)

40 
	#__ASSERT_VOID_CAST
 ()

	)

48 #ifdef 
NDEBUG


50 
	#as£π
(
ex¥
Ë(
	`__ASSERT_VOID_CAST
 (0))

	)

58 #ifdef 
__USE_GNU


59 
	#as£π_≥º‹
(
î∫um
Ë(
	`__ASSERT_VOID_CAST
 (0))

	)

64 #i‚de‡
_ASSERT_H_DECLS


65 
	#_ASSERT_H_DECLS


	)

66 
__BEGIN_DECLS


69 
	$__as£π_Áû
 (c⁄° *
__as£πi⁄
, c⁄° *
__fûe
,

70 
__löe
, c⁄° *
__fun˘i⁄
)

71 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

74 
	$__as£π_≥º‹_Áû
 (
__î∫um
, c⁄° *
__fûe
,

75 
__löe
, c⁄° *
__fun˘i⁄
)

76 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

81 
	$__as£π
 (c⁄° *
__as£πi⁄
, c⁄° *
__fûe
, 
__löe
)

82 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

85 
__END_DECLS


88 
	#as£π
(
ex¥
) \

89 ((
ex¥
) \

90 ? 
	`__ASSERT_VOID_CAST
 (0) \

91 : 
	`__as£π_Áû
 (#ex¥, 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

93 #ifdef 
__USE_GNU


94 
	#as£π_≥º‹
(
î∫um
) \

95 (!(
î∫um
) \

96 ? 
	`__ASSERT_VOID_CAST
 (0) \

97 : 
	`__as£π_≥º‹_Áû
 ((
î∫um
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

105 #i‡
deföed
 
__˝lu•lus
 ? 
	`__GNUC_PREREQ
 (2, 6) : __GNUC_PREREQ (2, 4)

106 
	#__ASSERT_FUNCTION
 
__PRETTY_FUNCTION__


	)

108 #i‡
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

109 
	#__ASSERT_FUNCTION
 
__func__


	)

111 
	#__ASSERT_FUNCTION
 ((c⁄° *Ë0)

	)

118 #i‡
deföed
 
__USE_ISOC11
 && !deföed 
__˝lu•lus


119 #unde‡
°©ic_as£π


120 
	#°©ic_as£π
 
_Sètic_as£π


	)

	@/usr/include/stdio.h

23 #i‚de‡
_STDIO_H


25 #i‡!
deföed
 
__√ed_FILE
 && !deföed 
__√ed___FILE


26 
	#_STDIO_H
 1

	)

27 
	~<„©uªs.h
>

29 
	g__BEGIN_DECLS


31 
	#__√ed_size_t


	)

32 
	#__√ed_NULL


	)

33 
	~<°ddef.h
>

35 
	~<bôs/ty≥s.h
>

36 
	#__√ed_FILE


	)

37 
	#__√ed___FILE


	)

41 #i‡!
deföed
 
__FILE_deföed
 && deföed 
__√ed_FILE


44 
	g_IO_FILE
;

46 
__BEGIN_NAMESPACE_STD


48 
_IO_FILE
 
	tFILE
;

49 
	g__END_NAMESPACE_STD


50 #i‡
deföed
 
__USE_LARGEFILE64
 || deföed 
__USE_POSIX
 \

51 || 
deföed
 
	g__USE_ISOC99
 || deföed 
	g__USE_XOPEN
 \

52 || 
deföed
 
__USE_POSIX2


53 
	$__USING_NAMESPACE_STD
(
FILE
)

56 
	#__FILE_deföed
 1

	)

58 #unde‡
__√ed_FILE


61 #i‡!
deföed
 
____FILE_deföed
 && deföed 
__√ed___FILE


64 
_IO_FILE
 
	t__FILE
;

66 
	#____FILE_deföed
 1

	)

68 #unde‡
__√ed___FILE


71 #ifdef 
_STDIO_H


72 
	#_STDIO_USES_IOSTREAM


	)

74 
	~<libio.h
>

76 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


77 #ifde‡
__GNUC__


78 #i‚de‡
_VA_LIST_DEFINED


79 
_G_va_li°
 
	tva_li°
;

80 
	#_VA_LIST_DEFINED


	)

83 
	~<°d¨g.h
>

87 #ifde‡
__USE_XOPEN2K8


88 #i‚de‡
__off_t_deföed


89 #i‚de‡
__USE_FILE_OFFSET64


90 
__off_t
 
	toff_t
;

92 
__off64_t
 
	toff_t
;

94 
	#__off_t_deföed


	)

96 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


97 
__off64_t
 
	toff64_t
;

98 
	#__off64_t_deföed


	)

101 #i‚de‡
__ssize_t_deföed


102 
__ssize_t
 
	tssize_t
;

103 
	#__ssize_t_deföed


	)

108 
__BEGIN_NAMESPACE_STD


109 #i‚de‡
__USE_FILE_OFFSET64


110 
_G_Âos_t
 
	tÂos_t
;

112 
_G_Âos64_t
 
	tÂos_t
;

114 
__END_NAMESPACE_STD


115 #ifde‡
__USE_LARGEFILE64


116 
_G_Âos64_t
 
	tÂos64_t
;

120 
	#_IOFBF
 0

	)

121 
	#_IOLBF
 1

	)

122 
	#_IONBF
 2

	)

126 #i‚de‡
BUFSIZ


127 
	#BUFSIZ
 
_IO_BUFSIZ


	)

133 #i‚de‡
EOF


134 
	#EOF
 (-1)

	)

140 
	#SEEK_SET
 0

	)

141 
	#SEEK_CUR
 1

	)

142 
	#SEEK_END
 2

	)

143 #ifde‡
__USE_GNU


144 
	#SEEK_DATA
 3

	)

145 
	#SEEK_HOLE
 4

	)

149 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


151 
	#P_tmpdú
 "/tmp"

	)

164 
	~<bôs/°dio_lim.h
>

168 
_IO_FILE
 *
°dö
;

169 
_IO_FILE
 *
°dout
;

170 
_IO_FILE
 *
°dîr
;

172 
	#°dö
 
°dö


	)

173 
	#°dout
 
°dout


	)

174 
	#°dîr
 
°dîr


	)

176 
__BEGIN_NAMESPACE_STD


178 
	$ªmove
 (c⁄° *
__fûíame
Ë
__THROW
;

180 
	$ª«me
 (c⁄° *
__ﬁd
, c⁄° *
__√w
Ë
__THROW
;

181 
__END_NAMESPACE_STD


183 #ifde‡
__USE_ATFILE


185 
	$ª«mót
 (
__ﬁdfd
, c⁄° *
__ﬁd
, 
__√wfd
,

186 c⁄° *
__√w
Ë
__THROW
;

189 
__BEGIN_NAMESPACE_STD


194 #i‚de‡
__USE_FILE_OFFSET64


195 
FILE
 *
	$tmpfûe
 (Ë
__wur
;

197 #ifde‡
__REDIRECT


198 
FILE
 *
	`__REDIRECT
 (
tmpfûe
, (), 
tmpfûe64
Ë
__wur
;

200 
	#tmpfûe
 
tmpfûe64


	)

204 #ifde‡
__USE_LARGEFILE64


205 
FILE
 *
	$tmpfûe64
 (Ë
__wur
;

209 *
	$tm≤am
 (*
__s
Ë
__THROW
 
__wur
;

210 
__END_NAMESPACE_STD


212 #ifde‡
__USE_MISC


215 *
	$tm≤am_r
 (*
__s
Ë
__THROW
 
__wur
;

219 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


227 *
	$ãm≤am
 (c⁄° *
__dú
, c⁄° *
__pfx
)

228 
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

232 
__BEGIN_NAMESPACE_STD


237 
	`f˛o£
 (
FILE
 *
__°ªam
);

242 
	`fÊush
 (
FILE
 *
__°ªam
);

243 
__END_NAMESPACE_STD


245 #ifde‡
__USE_MISC


252 
	`fÊush_u∆ocked
 (
FILE
 *
__°ªam
);

255 #ifde‡
__USE_GNU


262 
	`f˛o£Æl
 ();

266 
__BEGIN_NAMESPACE_STD


267 #i‚de‡
__USE_FILE_OFFSET64


272 
FILE
 *
	$f›í
 (c⁄° *
__ª°ri˘
 
__fûíame
,

273 c⁄° *
__ª°ri˘
 
__modes
Ë
__wur
;

278 
FILE
 *
	$‰e›í
 (c⁄° *
__ª°ri˘
 
__fûíame
,

279 c⁄° *
__ª°ri˘
 
__modes
,

280 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

282 #ifde‡
__REDIRECT


283 
FILE
 *
	`__REDIRECT
 (
f›í
, (c⁄° *
__ª°ri˘
 
__fûíame
,

284 c⁄° *
__ª°ri˘
 
__modes
), 
f›í64
)

285 
__wur
;

286 
FILE
 *
	`__REDIRECT
 (
‰e›í
, (c⁄° *
__ª°ri˘
 
__fûíame
,

287 c⁄° *
__ª°ri˘
 
__modes
,

288 
FILE
 *
__ª°ri˘
 
__°ªam
), 
‰e›í64
)

289 
__wur
;

291 
	#f›í
 
f›í64


	)

292 
	#‰e›í
 
‰e›í64


	)

295 
__END_NAMESPACE_STD


296 #ifde‡
__USE_LARGEFILE64


297 
FILE
 *
	$f›í64
 (c⁄° *
__ª°ri˘
 
__fûíame
,

298 c⁄° *
__ª°ri˘
 
__modes
Ë
__wur
;

299 
FILE
 *
	$‰e›í64
 (c⁄° *
__ª°ri˘
 
__fûíame
,

300 c⁄° *
__ª°ri˘
 
__modes
,

301 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

304 #ifdef 
__USE_POSIX


306 
FILE
 *
	$fd›í
 (
__fd
, c⁄° *
__modes
Ë
__THROW
 
__wur
;

309 #ifdef 
__USE_GNU


312 
FILE
 *
	$f›ícookõ
 (*
__ª°ri˘
 
__magic_cookõ
,

313 c⁄° *
__ª°ri˘
 
__modes
,

314 
_IO_cookõ_io_fun˘i⁄s_t
 
__io_funcs
Ë
__THROW
 
__wur
;

317 #ifde‡
__USE_XOPEN2K8


319 
FILE
 *
	$fmem›í
 (*
__s
, 
size_t
 
__Àn
, c⁄° *
__modes
)

320 
__THROW
 
__wur
;

325 
FILE
 *
	$›í_mem°ªam
 (**
__buÊoc
, 
size_t
 *
__sizñoc
Ë
__THROW
 
__wur
;

329 
__BEGIN_NAMESPACE_STD


332 
	$£tbuf
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
Ë
__THROW
;

336 
	$£tvbuf
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
,

337 
__modes
, 
size_t
 
__n
Ë
__THROW
;

338 
__END_NAMESPACE_STD


340 #ifdef 
__USE_MISC


343 
	$£tbuf„r
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
,

344 
size_t
 
__size
Ë
__THROW
;

347 
	$£éöebuf
 (
FILE
 *
__°ªam
Ë
__THROW
;

351 
__BEGIN_NAMESPACE_STD


356 
	`Ârötf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

357 c⁄° *
__ª°ri˘
 
__f‹m©
, ...);

362 
	`¥ötf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, ...);

364 
	$•rötf
 (*
__ª°ri˘
 
__s
,

365 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROWNL
;

371 
	`vÂrötf
 (
FILE
 *
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__f‹m©
,

372 
_G_va_li°
 
__¨g
);

377 
	`v¥ötf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
);

379 
	$v•rötf
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__f‹m©
,

380 
_G_va_li°
 
__¨g
Ë
__THROWNL
;

381 
__END_NAMESPACE_STD


383 #i‡
deföed
 
__USE_ISOC99
 || deföed 
__USE_UNIX98


384 
__BEGIN_NAMESPACE_C99


386 
	$¢¥ötf
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxÀn
,

387 c⁄° *
__ª°ri˘
 
__f‹m©
, ...)

388 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 4)));

390 
	$v¢¥ötf
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxÀn
,

391 c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

392 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 0)));

393 
__END_NAMESPACE_C99


396 #ifde‡
__USE_GNU


399 
	$va•rötf
 (**
__ª°ri˘
 
__±r
, c⁄° *__ª°ri˘ 
__f
,

400 
_G_va_li°
 
__¨g
)

401 
__THROWNL
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 0))Ë
__wur
;

402 
	$__a•rötf
 (**
__ª°ri˘
 
__±r
,

403 c⁄° *
__ª°ri˘
 
__fmt
, ...)

404 
__THROWNL
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 3))Ë
__wur
;

405 
	$a•rötf
 (**
__ª°ri˘
 
__±r
,

406 c⁄° *
__ª°ri˘
 
__fmt
, ...)

407 
__THROWNL
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 3))Ë
__wur
;

410 #ifde‡
__USE_XOPEN2K8


412 
	$vd¥ötf
 (
__fd
, c⁄° *
__ª°ri˘
 
__fmt
,

413 
_G_va_li°
 
__¨g
)

414 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

415 
	$d¥ötf
 (
__fd
, c⁄° *
__ª°ri˘
 
__fmt
, ...)

416 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

420 
__BEGIN_NAMESPACE_STD


425 
	$fsˇnf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

426 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

431 
	$sˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

433 
	$ssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

434 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROW
;

436 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__USE_GNU
 \

437 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

438 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

439 #ifde‡
__REDIRECT


443 
	`__REDIRECT
 (
fsˇnf
, (
FILE
 *
__ª°ri˘
 
__°ªam
,

444 c⁄° *
__ª°ri˘
 
__f‹m©
, ...),

445 
__isoc99_fsˇnf
Ë
__wur
;

446 
	`__REDIRECT
 (
sˇnf
, (c⁄° *
__ª°ri˘
 
__f‹m©
, ...),

447 
__isoc99_sˇnf
Ë
__wur
;

448 
	`__REDIRECT_NTH
 (
ssˇnf
, (c⁄° *
__ª°ri˘
 
__s
,

449 c⁄° *
__ª°ri˘
 
__f‹m©
, ...),

450 
__isoc99_ssˇnf
);

452 
	$__isoc99_fsˇnf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

453 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

454 
	$__isoc99_sˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

455 
	$__isoc99_ssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

456 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROW
;

457 
	#fsˇnf
 
__isoc99_fsˇnf


	)

458 
	#sˇnf
 
__isoc99_sˇnf


	)

459 
	#ssˇnf
 
__isoc99_ssˇnf


	)

463 
__END_NAMESPACE_STD


465 #ifdef 
__USE_ISOC99


466 
__BEGIN_NAMESPACE_C99


471 
	$vfsˇnf
 (
FILE
 *
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__f‹m©
,

472 
_G_va_li°
 
__¨g
)

473 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 2, 0))Ë
__wur
;

479 
	$vsˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

480 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 1, 0))Ë
__wur
;

483 
	$vssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

484 c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

485 
__THROW
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__sˇnf__
, 2, 0)));

487 #i‡!
deföed
 
__USE_GNU
 \

488 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

489 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

490 #ifde‡
__REDIRECT


494 
	`__REDIRECT
 (
vfsˇnf
,

495 (
FILE
 *
__ª°ri˘
 
__s
,

496 c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
),

497 
__isoc99_vfsˇnf
)

498 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 2, 0))Ë
__wur
;

499 
	`__REDIRECT
 (
vsˇnf
, (c⁄° *
__ª°ri˘
 
__f‹m©
,

500 
_G_va_li°
 
__¨g
), 
__isoc99_vsˇnf
)

501 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 1, 0))Ë
__wur
;

502 
	`__REDIRECT_NTH
 (
vssˇnf
,

503 (c⁄° *
__ª°ri˘
 
__s
,

504 c⁄° *
__ª°ri˘
 
__f‹m©
,

505 
_G_va_li°
 
__¨g
), 
__isoc99_vssˇnf
)

506 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__sˇnf__
, 2, 0)));

508 
	$__isoc99_vfsˇnf
 (
FILE
 *
__ª°ri˘
 
__s
,

509 c⁄° *
__ª°ri˘
 
__f‹m©
,

510 
_G_va_li°
 
__¨g
Ë
__wur
;

511 
	$__isoc99_vsˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
,

512 
_G_va_li°
 
__¨g
Ë
__wur
;

513 
	$__isoc99_vssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

514 c⁄° *
__ª°ri˘
 
__f‹m©
,

515 
_G_va_li°
 
__¨g
Ë
__THROW
;

516 
	#vfsˇnf
 
__isoc99_vfsˇnf


	)

517 
	#vsˇnf
 
__isoc99_vsˇnf


	)

518 
	#vssˇnf
 
__isoc99_vssˇnf


	)

522 
__END_NAMESPACE_C99


526 
__BEGIN_NAMESPACE_STD


531 
	`fgëc
 (
FILE
 *
__°ªam
);

532 
	`gëc
 (
FILE
 *
__°ªam
);

538 
	`gëch¨
 ();

539 
__END_NAMESPACE_STD


543 
	#gëc
(
_Â
Ë
	`_IO_gëc
 (_Â)

	)

545 #ifde‡
__USE_POSIX


550 
	`gëc_u∆ocked
 (
FILE
 *
__°ªam
);

551 
	`gëch¨_u∆ocked
 ();

554 #ifde‡
__USE_MISC


561 
	`fgëc_u∆ocked
 (
FILE
 *
__°ªam
);

565 
__BEGIN_NAMESPACE_STD


573 
	`Âutc
 (
__c
, 
FILE
 *
__°ªam
);

574 
	`putc
 (
__c
, 
FILE
 *
__°ªam
);

580 
	`putch¨
 (
__c
);

581 
__END_NAMESPACE_STD


585 
	#putc
(
_ch
, 
_Â
Ë
	`_IO_putc
 (_ch, _Â)

	)

587 #ifde‡
__USE_MISC


594 
	`Âutc_u∆ocked
 (
__c
, 
FILE
 *
__°ªam
);

597 #ifde‡
__USE_POSIX


602 
	`putc_u∆ocked
 (
__c
, 
FILE
 *
__°ªam
);

603 
	`putch¨_u∆ocked
 (
__c
);

607 #i‡
deföed
 
__USE_MISC
 \

608 || (
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
)

610 
	`gëw
 (
FILE
 *
__°ªam
);

613 
	`putw
 (
__w
, 
FILE
 *
__°ªam
);

617 
__BEGIN_NAMESPACE_STD


622 *
	$fgës
 (*
__ª°ri˘
 
__s
, 
__n
, 
FILE
 *__ª°ri˘ 
__°ªam
)

623 
__wur
;

625 #i‡!
deföed
 
__USE_ISOC11
 \

626 || (
deföed
 
__˝lu•lus
 && __cplusplus <= 201103L)

638 *
	$gës
 (*
__s
Ë
__wur
 
__©åibuã_dïªˇãd__
;

640 
__END_NAMESPACE_STD


642 #ifde‡
__USE_GNU


649 *
	$fgës_u∆ocked
 (*
__ª°ri˘
 
__s
, 
__n
,

650 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

654 #ifdef 
__USE_XOPEN2K8


665 
_IO_ssize_t
 
	$__gëdñim
 (**
__ª°ri˘
 
__löïå
,

666 
size_t
 *
__ª°ri˘
 
__n
, 
__dñimôî
,

667 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

668 
_IO_ssize_t
 
	$gëdñim
 (**
__ª°ri˘
 
__löïå
,

669 
size_t
 *
__ª°ri˘
 
__n
, 
__dñimôî
,

670 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

678 
_IO_ssize_t
 
	$gëlöe
 (**
__ª°ri˘
 
__löïå
,

679 
size_t
 *
__ª°ri˘
 
__n
,

680 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

684 
__BEGIN_NAMESPACE_STD


689 
	`Âuts
 (c⁄° *
__ª°ri˘
 
__s
, 
FILE
 *__ª°ri˘ 
__°ªam
);

695 
	`puts
 (c⁄° *
__s
);

702 
	`ungëc
 (
__c
, 
FILE
 *
__°ªam
);

709 
size_t
 
	$‰ód
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

710 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

715 
size_t
 
	`fwrôe
 (c⁄° *
__ª°ri˘
 
__±r
, size_à
__size
,

716 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__s
);

717 
__END_NAMESPACE_STD


719 #ifde‡
__USE_GNU


726 
	`Âuts_u∆ocked
 (c⁄° *
__ª°ri˘
 
__s
,

727 
FILE
 *
__ª°ri˘
 
__°ªam
);

730 #ifde‡
__USE_MISC


737 
size_t
 
	$‰ód_u∆ocked
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

738 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

739 
size_t
 
	`fwrôe_u∆ocked
 (c⁄° *
__ª°ri˘
 
__±r
, size_à
__size
,

740 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
);

744 
__BEGIN_NAMESPACE_STD


749 
	`f£ek
 (
FILE
 *
__°ªam
, 
__off
, 
__whí˚
);

754 
	$·ñl
 (
FILE
 *
__°ªam
Ë
__wur
;

759 
	`ªwöd
 (
FILE
 *
__°ªam
);

760 
__END_NAMESPACE_STD


767 #i‡
deföed
 
__USE_LARGEFILE
 || deföed 
__USE_XOPEN2K


768 #i‚de‡
__USE_FILE_OFFSET64


773 
	`f£eko
 (
FILE
 *
__°ªam
, 
__off_t
 
__off
, 
__whí˚
);

778 
__off_t
 
	$·ñlo
 (
FILE
 *
__°ªam
Ë
__wur
;

780 #ifde‡
__REDIRECT


781 
	`__REDIRECT
 (
f£eko
,

782 (
FILE
 *
__°ªam
, 
__off64_t
 
__off
, 
__whí˚
),

783 
f£eko64
);

784 
__off64_t
 
	`__REDIRECT
 (
·ñlo
, (
FILE
 *
__°ªam
), 
·ñlo64
);

786 
	#f£eko
 
f£eko64


	)

787 
	#·ñlo
 
·ñlo64


	)

792 
__BEGIN_NAMESPACE_STD


793 #i‚de‡
__USE_FILE_OFFSET64


798 
	`fgëpos
 (
FILE
 *
__ª°ri˘
 
__°ªam
, 
Âos_t
 *__ª°ri˘ 
__pos
);

803 
	`f£ços
 (
FILE
 *
__°ªam
, c⁄° 
Âos_t
 *
__pos
);

805 #ifde‡
__REDIRECT


806 
	`__REDIRECT
 (
fgëpos
, (
FILE
 *
__ª°ri˘
 
__°ªam
,

807 
Âos_t
 *
__ª°ri˘
 
__pos
), 
fgëpos64
);

808 
	`__REDIRECT
 (
f£ços
,

809 (
FILE
 *
__°ªam
, c⁄° 
Âos_t
 *
__pos
), 
f£ços64
);

811 
	#fgëpos
 
fgëpos64


	)

812 
	#f£ços
 
f£ços64


	)

815 
__END_NAMESPACE_STD


817 #ifde‡
__USE_LARGEFILE64


818 
	`f£eko64
 (
FILE
 *
__°ªam
, 
__off64_t
 
__off
, 
__whí˚
);

819 
__off64_t
 
	$·ñlo64
 (
FILE
 *
__°ªam
Ë
__wur
;

820 
	`fgëpos64
 (
FILE
 *
__ª°ri˘
 
__°ªam
, 
Âos64_t
 *__ª°ri˘ 
__pos
);

821 
	`f£ços64
 (
FILE
 *
__°ªam
, c⁄° 
Âos64_t
 *
__pos
);

824 
__BEGIN_NAMESPACE_STD


826 
	$˛óªº
 (
FILE
 *
__°ªam
Ë
__THROW
;

828 
	$„of
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

830 
	$„º‹
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

831 
__END_NAMESPACE_STD


833 #ifde‡
__USE_MISC


835 
	$˛óªº_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
;

836 
	$„of_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

837 
	$„º‹_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

841 
__BEGIN_NAMESPACE_STD


846 
	`≥º‹
 (c⁄° *
__s
);

847 
__END_NAMESPACE_STD


853 
	~<bôs/sys_îæi°.h
>

856 #ifdef 
__USE_POSIX


858 
	$fûío
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

861 #ifde‡
__USE_MISC


863 
	$fûío_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

867 #ifde‡
__USE_POSIX2


872 
FILE
 *
	$p›í
 (c⁄° *
__comm™d
, c⁄° *
__modes
Ë
__wur
;

878 
	`p˛o£
 (
FILE
 *
__°ªam
);

882 #ifdef 
__USE_POSIX


884 *
	$˘îmid
 (*
__s
Ë
__THROW
;

888 #ifde‡
__USE_XOPEN


890 *
	`cu£rid
 (*
__s
);

894 #ifdef 
__USE_GNU


895 
ob°ack
;

898 
	$ob°ack_¥ötf
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

899 c⁄° *
__ª°ri˘
 
__f‹m©
, ...)

900 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

901 
	$ob°ack_v¥ötf
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

902 c⁄° *
__ª°ri˘
 
__f‹m©
,

903 
_G_va_li°
 
__¨gs
)

904 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

908 #ifde‡
__USE_POSIX


912 
	$Êockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
;

916 
	$·rylockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

919 
	$fu∆ockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
;

922 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
 && !deföed 
__USE_GNU


926 
	#__√ed_gë›t


	)

927 
	~<gë›t.h
>

932 #ifde‡
__USE_EXTERN_INLINES


933 
	~<bôs/°dio.h
>

935 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


936 
	~<bôs/°dio2.h
>

938 #ifde‡
__LDBL_COMPAT


939 
	~<bôs/°dio-ldbl.h
>

942 
__END_DECLS


	@/usr/include/stdlib.h

22 #i‚def 
_STDLIB_H


24 
	~<„©uªs.h
>

27 
	#__√ed_size_t


	)

28 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


29 
	#__√ed_wch¨_t


	)

30 
	#__√ed_NULL


	)

32 
	~<°ddef.h
>

34 
	g__BEGIN_DECLS


36 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


37 
	#_STDLIB_H
 1

	)

39 #i‡(
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8
Ë&& !deföed 
_SYS_WAIT_H


41 
	~<bôs/waôÊags.h
>

42 
	~<bôs/waô°©us.h
>

44 #ifde‡
__USE_MISC


49 #i‡
deföed
 
__GNUC__
 && !deföed 
__˝lu•lus


50 
	#__WAIT_INT
(
°©us
) \

51 (
	`__exãnsi⁄__
 (((uni⁄ { 
	`__ty≥of
(
°©us
Ë
__ö
; 
__i
; }) \

52 { .
__ö
 = (
°©us
Ë}).
__i
))

	)

54 
	#__WAIT_INT
(
°©us
Ë(*(*Ë&(°©us))

	)

62 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2 || deföed 
__˝lu•lus


63 
	#__WAIT_STATUS
 *

	)

64 
	#__WAIT_STATUS_DEFN
 *

	)

69 
waô
 *
	m__u±r
;

70 *
	m__ùå
;

71 } 
	t__WAIT_STATUS
 
	t__©åibuã__
 ((
	t__å™•¨ít_uni⁄__
));

72 
	#__WAIT_STATUS_DEFN
 *

	)

77 
	#__WAIT_INT
(
°©us
Ë(°©us)

	)

78 
	#__WAIT_STATUS
 *

	)

79 
	#__WAIT_STATUS_DEFN
 *

	)

84 
	#WEXITSTATUS
(
°©us
Ë
	`__WEXITSTATUS
 (
	`__WAIT_INT
 (°©us))

	)

85 
	#WTERMSIG
(
°©us
Ë
	`__WTERMSIG
 (
	`__WAIT_INT
 (°©us))

	)

86 
	#WSTOPSIG
(
°©us
Ë
	`__WSTOPSIG
 (
	`__WAIT_INT
 (°©us))

	)

87 
	#WIFEXITED
(
°©us
Ë
	`__WIFEXITED
 (
	`__WAIT_INT
 (°©us))

	)

88 
	#WIFSIGNALED
(
°©us
Ë
	`__WIFSIGNALED
 (
	`__WAIT_INT
 (°©us))

	)

89 
	#WIFSTOPPED
(
°©us
Ë
	`__WIFSTOPPED
 (
	`__WAIT_INT
 (°©us))

	)

90 #ifde‡
__WIFCONTINUED


91 
	#WIFCONTINUED
(
°©us
Ë
	`__WIFCONTINUED
 (
	`__WAIT_INT
 (°©us))

	)

95 
__BEGIN_NAMESPACE_STD


99 
	mquŸ
;

100 
	mªm
;

101 } 
	tdiv_t
;

104 #i‚de‡
__ldiv_t_deföed


107 
	mquŸ
;

108 
	mªm
;

109 } 
	tldiv_t
;

110 
	#__ldiv_t_deföed
 1

	)

112 
	g__END_NAMESPACE_STD


114 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__Œdiv_t_deföed


115 
__BEGIN_NAMESPACE_C99


117 
__exãnsi⁄__
 struct

119 
	mquŸ
;

120 
	mªm
;

121 } 
	tŒdiv_t
;

122 
	#__Œdiv_t_deföed
 1

	)

123 
	g__END_NAMESPACE_C99


128 
	#RAND_MAX
 2147483647

	)

133 
	#EXIT_FAILURE
 1

	)

134 
	#EXIT_SUCCESS
 0

	)

138 
	#MB_CUR_MAX
 (
	`__˘y≥_gë_mb_cur_max
 ())

	)

139 
size_t
 
	$__˘y≥_gë_mb_cur_max
 (Ë
__THROW
 
__wur
;

142 
__BEGIN_NAMESPACE_STD


144 
	$©of
 (c⁄° *
__≈å
)

145 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

147 
	$©oi
 (c⁄° *
__≈å
)

148 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

150 
	$©ﬁ
 (c⁄° *
__≈å
)

151 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

152 
__END_NAMESPACE_STD


154 #ifde‡
__USE_ISOC99


155 
__BEGIN_NAMESPACE_C99


157 
__exãnsi⁄__
 
	$©ﬁl
 (c⁄° *
__≈å
)

158 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

159 
__END_NAMESPACE_C99


162 
__BEGIN_NAMESPACE_STD


164 
	$°πod
 (c⁄° *
__ª°ri˘
 
__≈å
,

165 **
__ª°ri˘
 
__íd±r
)

166 
__THROW
 
	`__n⁄nuŒ
 ((1));

167 
__END_NAMESPACE_STD


169 #ifdef 
__USE_ISOC99


170 
__BEGIN_NAMESPACE_C99


172 
	$°πof
 (c⁄° *
__ª°ri˘
 
__≈å
,

173 **
__ª°ri˘
 
__íd±r
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

175 
	$°πﬁd
 (c⁄° *
__ª°ri˘
 
__≈å
,

176 **
__ª°ri˘
 
__íd±r
)

177 
__THROW
 
	`__n⁄nuŒ
 ((1));

178 
__END_NAMESPACE_C99


181 
__BEGIN_NAMESPACE_STD


183 
	$°πﬁ
 (c⁄° *
__ª°ri˘
 
__≈å
,

184 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

185 
__THROW
 
	`__n⁄nuŒ
 ((1));

187 
	$°πoul
 (c⁄° *
__ª°ri˘
 
__≈å
,

188 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

189 
__THROW
 
	`__n⁄nuŒ
 ((1));

190 
__END_NAMESPACE_STD


192 #ifde‡
__USE_MISC


194 
__exãnsi⁄__


195 
	$°πoq
 (c⁄° *
__ª°ri˘
 
__≈å
,

196 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

197 
__THROW
 
	`__n⁄nuŒ
 ((1));

199 
__exãnsi⁄__


200 
	$°πouq
 (c⁄° *
__ª°ri˘
 
__≈å
,

201 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

202 
__THROW
 
	`__n⁄nuŒ
 ((1));

205 #ifde‡
__USE_ISOC99


206 
__BEGIN_NAMESPACE_C99


208 
__exãnsi⁄__


209 
	$°πﬁl
 (c⁄° *
__ª°ri˘
 
__≈å
,

210 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

211 
__THROW
 
	`__n⁄nuŒ
 ((1));

213 
__exãnsi⁄__


214 
	$°πouŒ
 (c⁄° *
__ª°ri˘
 
__≈å
,

215 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

216 
__THROW
 
	`__n⁄nuŒ
 ((1));

217 
__END_NAMESPACE_C99


221 #ifde‡
__USE_GNU


235 
	~<xloˇÀ.h
>

239 
	$°πﬁ_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

240 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

241 
__loˇÀ_t
 
__loc
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

243 
	$°πoul_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

244 **
__ª°ri˘
 
__íd±r
,

245 
__ba£
, 
__loˇÀ_t
 
__loc
)

246 
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

248 
__exãnsi⁄__


249 
	$°πﬁl_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

250 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

251 
__loˇÀ_t
 
__loc
)

252 
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

254 
__exãnsi⁄__


255 
	$°πouŒ_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

256 **
__ª°ri˘
 
__íd±r
,

257 
__ba£
, 
__loˇÀ_t
 
__loc
)

258 
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

260 
	$°πod_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

261 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

262 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

264 
	$°πof_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

265 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

266 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

268 
	$°πﬁd_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

269 **
__ª°ri˘
 
__íd±r
,

270 
__loˇÀ_t
 
__loc
)

271 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

275 #ifde‡
__USE_EXTERN_INLINES


276 
__BEGIN_NAMESPACE_STD


277 
__exã∫_ölöe
 

278 
	`__NTH
 (
	$©oi
 (c⁄° *
__≈å
))

280  (Ë
	`°πﬁ
 (
__≈å
, (**Ë
NULL
, 10);

281 
	}
}

282 
__exã∫_ölöe
 

283 
__NTH
 (
	$©ﬁ
 (c⁄° *
__≈å
))

285  
	`°πﬁ
 (
__≈å
, (**Ë
NULL
, 10);

286 
	}
}

287 
	g__END_NAMESPACE_STD


289 #ifde‡
__USE_ISOC99


290 
__BEGIN_NAMESPACE_C99


291 
__exãnsi⁄__
 
__exã∫_ölöe
 

292 
__NTH
 (
	$©ﬁl
 (c⁄° *
__≈å
))

294  
	`°πﬁl
 (
__≈å
, (**Ë
NULL
, 10);

295 
	}
}

296 
	g__END_NAMESPACE_C99


301 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


305 *
	$l64a
 (
__n
Ë
__THROW
 
__wur
;

308 
	$a64l
 (c⁄° *
__s
)

309 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

313 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


314 
	~<sys/ty≥s.h
>

321 
	$øndom
 (Ë
__THROW
;

324 
	$§™dom
 (
__£ed
Ë
__THROW
;

330 *
	$öô°©e
 (
__£ed
, *
__°©ebuf
,

331 
size_t
 
__°©ñí
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

335 *
	$£t°©e
 (*
__°©ebuf
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

338 #ifde‡
__USE_MISC


343 
	søndom_d©a


345 
öt32_t
 *
Âå
;

346 
öt32_t
 *
Ωå
;

347 
öt32_t
 *
°©e
;

348 
ønd_ty≥
;

349 
ønd_deg
;

350 
ønd_£p
;

351 
öt32_t
 *
íd_±r
;

354 
	$øndom_r
 (
øndom_d©a
 *
__ª°ri˘
 
__buf
,

355 
öt32_t
 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

357 
	$§™dom_r
 (
__£ed
, 
øndom_d©a
 *
__buf
)

358 
__THROW
 
	`__n⁄nuŒ
 ((2));

360 
	$öô°©e_r
 (
__£ed
, *
__ª°ri˘
 
__°©ebuf
,

361 
size_t
 
__°©ñí
,

362 
øndom_d©a
 *
__ª°ri˘
 
__buf
)

363 
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

365 
	$£t°©e_r
 (*
__ª°ri˘
 
__°©ebuf
,

366 
øndom_d©a
 *
__ª°ri˘
 
__buf
)

367 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

372 
__BEGIN_NAMESPACE_STD


374 
	$ønd
 (Ë
__THROW
;

376 
	$§™d
 (
__£ed
Ë
__THROW
;

377 
__END_NAMESPACE_STD


379 #ifde‡
__USE_POSIX


381 
	$ønd_r
 (*
__£ed
Ë
__THROW
;

385 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


389 
	$dønd48
 (Ë
__THROW
;

390 
	$î™d48
 (
__xsubi
[3]Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

393 
	$Ã™d48
 (Ë
__THROW
;

394 
	$ƒ™d48
 (
__xsubi
[3])

395 
__THROW
 
	`__n⁄nuŒ
 ((1));

398 
	$mønd48
 (Ë
__THROW
;

399 
	$jønd48
 (
__xsubi
[3])

400 
__THROW
 
	`__n⁄nuŒ
 ((1));

403 
	$§™d48
 (
__£edvÆ
Ë
__THROW
;

404 *
	$£ed48
 (
__£ed16v
[3])

405 
__THROW
 
	`__n⁄nuŒ
 ((1));

406 
	$lc⁄g48
 (
__∑øm
[7]Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

408 #ifde‡
__USE_MISC


412 
	sdønd48_d©a


414 
__x
[3];

415 
__ﬁd_x
[3];

416 
__c
;

417 
__öô
;

418 
__exãnsi⁄__
 
__a
;

423 
	$dønd48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

424 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

425 
	$î™d48_r
 (
__xsubi
[3],

426 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

427 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

430 
	$Ã™d48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

431 *
__ª°ri˘
 
__ªsu…
)

432 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

433 
	$ƒ™d48_r
 (
__xsubi
[3],

434 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

435 *
__ª°ri˘
 
__ªsu…
)

436 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

439 
	$mønd48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

440 *
__ª°ri˘
 
__ªsu…
)

441 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

442 
	$jønd48_r
 (
__xsubi
[3],

443 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

444 *
__ª°ri˘
 
__ªsu…
)

445 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

448 
	$§™d48_r
 (
__£edvÆ
, 
dønd48_d©a
 *
__buf„r
)

449 
__THROW
 
	`__n⁄nuŒ
 ((2));

451 
	$£ed48_r
 (
__£ed16v
[3],

452 
dønd48_d©a
 *
__buf„r
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

454 
	$lc⁄g48_r
 (
__∑øm
[7],

455 
dønd48_d©a
 *
__buf„r
)

456 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

462 #i‚de‡
__mÆloc_™d_ˇŒoc_deföed


463 
	#__mÆloc_™d_ˇŒoc_deföed


	)

464 
__BEGIN_NAMESPACE_STD


466 *
	$mÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

468 *
	$ˇŒoc
 (
size_t
 
__nmemb
, size_à
__size
)

469 
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

470 
__END_NAMESPACE_STD


473 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


474 
__BEGIN_NAMESPACE_STD


480 *
	$ªÆloc
 (*
__±r
, 
size_t
 
__size
)

481 
__THROW
 
__©åibuã_w¨n_unu£d_ªsu…__
;

483 
	$‰ì
 (*
__±r
Ë
__THROW
;

484 
__END_NAMESPACE_STD


486 #ifdef 
__USE_MISC


488 
	$c‰ì
 (*
__±r
Ë
__THROW
;

491 #ifde‡
__USE_MISC


492 
	~<Æloˇ.h
>

495 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K
) \

496 || 
deföed
 
__USE_MISC


498 *
	$vÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

501 #ifde‡
__USE_XOPEN2K


503 
	$posix_memÆign
 (**
__mem±r
, 
size_t
 
__Æignmít
, size_à
__size
)

504 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

507 #ifde‡
__USE_ISOC11


509 *
	$Æig√d_Æloc
 (
size_t
 
__Æignmít
, size_à
__size
)

510 
__THROW
 
__©åibuã_mÆloc__
 
	`__©åibuã_Æloc_size__
 ((2)Ë
__wur
;

513 
__BEGIN_NAMESPACE_STD


515 
	$ab‹t
 (Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

519 
	$©exô
 ((*
__func
Ë()Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

521 #i‡
deföed
 
__USE_ISOC11
 || deföed 
__USE_ISOCXX11


523 #ifde‡
__˝lu•lus


524 "C++" 
	$©_quick_exô
 ((*
__func
) ())

525 
__THROW
 
	`__asm
 ("©_quick_exô"Ë
	`__n⁄nuŒ
 ((1));

527 
	$©_quick_exô
 ((*
__func
Ë()Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

530 
__END_NAMESPACE_STD


532 #ifdef 
__USE_MISC


535 
	$⁄_exô
 ((*
__func
Ë(
__°©us
, *
__¨g
), *__arg)

536 
__THROW
 
	`__n⁄nuŒ
 ((1));

539 
__BEGIN_NAMESPACE_STD


543 
	$exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

545 #i‡
deföed
 
__USE_ISOC11
 || deföed 
__USE_ISOCXX11


549 
	$quick_exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

551 
__END_NAMESPACE_STD


553 #ifde‡
__USE_ISOC99


554 
__BEGIN_NAMESPACE_C99


557 
	$_Exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

558 
__END_NAMESPACE_C99


562 
__BEGIN_NAMESPACE_STD


564 *
	$gëív
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

565 
__END_NAMESPACE_STD


567 #ifde‡
__USE_GNU


570 *
	$£cuª_gëív
 (c⁄° *
__«me
)

571 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

574 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


578 
	$puãnv
 (*
__°rög
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

581 #ifde‡
__USE_XOPEN2K


584 
	$£ãnv
 (c⁄° *
__«me
, c⁄° *
__vÆue
, 
__ª∂a˚
)

585 
__THROW
 
	`__n⁄nuŒ
 ((2));

588 
	$un£ãnv
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

591 #ifdef 
__USE_MISC


595 
	$˛óªnv
 (Ë
__THROW
;

599 #i‡
deföed
 
__USE_MISC
 \

600 || (
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
)

606 *
	$mkãmp
 (*
__ãm∂©e
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

609 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


618 #i‚de‡
__USE_FILE_OFFSET64


619 
	$mk°emp
 (*
__ãm∂©e
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

621 #ifde‡
__REDIRECT


622 
	`__REDIRECT
 (
mk°emp
, (*
__ãm∂©e
), 
mk°emp64
)

623 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

625 
	#mk°emp
 
mk°emp64


	)

628 #ifde‡
__USE_LARGEFILE64


629 
	$mk°emp64
 (*
__ãm∂©e
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

633 #ifde‡
__USE_MISC


640 #i‚de‡
__USE_FILE_OFFSET64


641 
	$mk°emps
 (*
__ãm∂©e
, 
__suffixÀn
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

643 #ifde‡
__REDIRECT


644 
	`__REDIRECT
 (
mk°emps
, (*
__ãm∂©e
, 
__suffixÀn
),

645 
mk°emps64
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

647 
	#mk°emps
 
mk°emps64


	)

650 #ifde‡
__USE_LARGEFILE64


651 
	$mk°emps64
 (*
__ãm∂©e
, 
__suffixÀn
)

652 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

656 #ifde‡
__USE_XOPEN2K8


662 *
	$mkdãmp
 (*
__ãm∂©e
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

665 #ifde‡
__USE_GNU


672 #i‚de‡
__USE_FILE_OFFSET64


673 
	$mko°emp
 (*
__ãm∂©e
, 
__Êags
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

675 #ifde‡
__REDIRECT


676 
	`__REDIRECT
 (
mko°emp
, (*
__ãm∂©e
, 
__Êags
), 
mko°emp64
)

677 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

679 
	#mko°emp
 
mko°emp64


	)

682 #ifde‡
__USE_LARGEFILE64


683 
	$mko°emp64
 (*
__ãm∂©e
, 
__Êags
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

692 #i‚de‡
__USE_FILE_OFFSET64


693 
	$mko°emps
 (*
__ãm∂©e
, 
__suffixÀn
, 
__Êags
)

694 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

696 #ifde‡
__REDIRECT


697 
	`__REDIRECT
 (
mko°emps
, (*
__ãm∂©e
, 
__suffixÀn
,

698 
__Êags
), 
mko°emps64
)

699 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

701 
	#mko°emps
 
mko°emps64


	)

704 #ifde‡
__USE_LARGEFILE64


705 
	$mko°emps64
 (*
__ãm∂©e
, 
__suffixÀn
, 
__Êags
)

706 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

711 
__BEGIN_NAMESPACE_STD


716 
	$sy°em
 (c⁄° *
__comm™d
Ë
__wur
;

717 
__END_NAMESPACE_STD


720 #ifdef 
__USE_GNU


723 *
	$ˇn⁄iˇlize_fûe_«me
 (c⁄° *
__«me
)

724 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

727 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


733 *
	$ªÆ∑th
 (c⁄° *
__ª°ri˘
 
__«me
,

734 *
__ª°ri˘
 
__ªsﬁved
Ë
__THROW
 
__wur
;

739 #i‚de‡
__COMPAR_FN_T


740 
	#__COMPAR_FN_T


	)

741 (*
	t__com∑r_‚_t
) (const *, const *);

743 #ifdef 
__USE_GNU


744 
__com∑r_‚_t
 
	tcom∑ris⁄_‚_t
;

747 #ifde‡
__USE_GNU


748 (*
	t__com∑r_d_‚_t
) (const *, const *, *);

751 
__BEGIN_NAMESPACE_STD


754 *
	$b£¨ch
 (c⁄° *
__key
, c⁄° *
__ba£
,

755 
size_t
 
__nmemb
, size_à
__size
, 
__com∑r_‚_t
 
__com∑r
)

756 
	`__n⁄nuŒ
 ((1, 2, 5)Ë
__wur
;

758 #ifde‡
__USE_EXTERN_INLINES


759 
	~<bôs/°dlib-b£¨ch.h
>

764 
	$qs‹t
 (*
__ba£
, 
size_t
 
__nmemb
, size_à
__size
,

765 
__com∑r_‚_t
 
__com∑r
Ë
	`__n⁄nuŒ
 ((1, 4));

766 #ifde‡
__USE_GNU


767 
	$qs‹t_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_à
__size
,

768 
__com∑r_d_‚_t
 
__com∑r
, *
__¨g
)

769 
	`__n⁄nuŒ
 ((1, 4));

774 
	$abs
 (
__x
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

775 
	$œbs
 (
__x
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

776 
__END_NAMESPACE_STD


778 #ifde‡
__USE_ISOC99


779 
__exãnsi⁄__
 
	$Œabs
 (
__x
)

780 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

784 
__BEGIN_NAMESPACE_STD


788 
div_t
 
	$div
 (
__numî
, 
__díom
)

789 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

790 
ldiv_t
 
	$ldiv
 (
__numî
, 
__díom
)

791 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

792 
__END_NAMESPACE_STD


794 #ifde‡
__USE_ISOC99


795 
__BEGIN_NAMESPACE_C99


796 
__exãnsi⁄__
 
Œdiv_t
 
	$Œdiv
 (
__numî
,

797 
__díom
)

798 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

799 
__END_NAMESPACE_C99


803 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

804 || 
deföed
 
__USE_MISC


811 *
	$ecvt
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

812 *
__ª°ri˘
 
__sign
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

817 *
	$fcvt
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

818 *
__ª°ri˘
 
__sign
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

823 *
	$gcvt
 (
__vÆue
, 
__ndigô
, *
__buf
)

824 
__THROW
 
	`__n⁄nuŒ
 ((3)Ë
__wur
;

827 #ifde‡
__USE_MISC


829 *
	$qecvt
 (
__vÆue
, 
__ndigô
,

830 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
)

831 
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

832 *
	$qfcvt
 (
__vÆue
, 
__ndigô
,

833 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
)

834 
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

835 *
	$qgcvt
 (
__vÆue
, 
__ndigô
, *
__buf
)

836 
__THROW
 
	`__n⁄nuŒ
 ((3)Ë
__wur
;

841 
	$ecvt_r
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

842 *
__ª°ri˘
 
__sign
, *__ª°ri˘ 
__buf
,

843 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

844 
	$fcvt_r
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

845 *
__ª°ri˘
 
__sign
, *__ª°ri˘ 
__buf
,

846 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

848 
	$qecvt_r
 (
__vÆue
, 
__ndigô
,

849 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
,

850 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

851 
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

852 
	$qfcvt_r
 (
__vÆue
, 
__ndigô
,

853 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
,

854 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

855 
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

859 
__BEGIN_NAMESPACE_STD


862 
	$mbÀn
 (c⁄° *
__s
, 
size_t
 
__n
Ë
__THROW
;

865 
	$mbtowc
 (
wch¨_t
 *
__ª°ri˘
 
__pwc
,

866 c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
Ë
__THROW
;

869 
	$w˘omb
 (*
__s
, 
wch¨_t
 
__wch¨
Ë
__THROW
;

873 
size_t
 
	$mb°owcs
 (
wch¨_t
 *
__ª°ri˘
 
__pwcs
,

874 c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
Ë
__THROW
;

876 
size_t
 
	$wc°ombs
 (*
__ª°ri˘
 
__s
,

877 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__pwcs
, 
size_t
 
__n
)

878 
__THROW
;

879 
__END_NAMESPACE_STD


882 #ifde‡
__USE_MISC


887 
	$Ωm©ch
 (c⁄° *
__ª•⁄£
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

891 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


898 
	$gësub›t
 (**
__ª°ri˘
 
__›ti⁄p
,

899 *c⁄° *
__ª°ri˘
 
__tokís
,

900 **
__ª°ri˘
 
__vÆuï
)

901 
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3)Ë
__wur
;

905 #ifde‡
__USE_XOPEN


907 
	$£tkey
 (c⁄° *
__key
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

913 #ifde‡
__USE_XOPEN2KXSI


915 
	$posix_›í±
 (
__oÊag
Ë
__wur
;

918 #ifde‡
__USE_XOPEN


923 
	$gø¡±
 (
__fd
Ë
__THROW
;

927 
	$u∆ock±
 (
__fd
Ë
__THROW
;

932 *
	$±¢ame
 (
__fd
Ë
__THROW
 
__wur
;

935 #ifde‡
__USE_GNU


939 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
)

940 
__THROW
 
	`__n⁄nuŒ
 ((2));

943 
	`gë±
 ();

946 #ifde‡
__USE_MISC


950 
	$gëlﬂdavg
 (
__lﬂdavg
[], 
__√Àm
)

951 
__THROW
 
	`__n⁄nuŒ
 ((1));

954 
	~<bôs/°dlib-Êﬂt.h
>

957 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


958 
	~<bôs/°dlib.h
>

960 #ifde‡
__LDBL_COMPAT


961 
	~<bôs/°dlib-ldbl.h
>

965 #unde‡
__√ed_mÆloc_™d_ˇŒoc


967 
__END_DECLS


	@/usr/include/string.h

22 #i‚def 
_STRING_H


23 
	#_STRING_H
 1

	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


30 
	#__√ed_size_t


	)

31 
	#__√ed_NULL


	)

32 
	~<°ddef.h
>

35 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (4, 4)

36 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

40 
__BEGIN_NAMESPACE_STD


42 *
	$mem˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

43 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

46 *
	$memmove
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
)

47 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

48 
__END_NAMESPACE_STD


53 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


54 *
	$memc˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

55 
__c
, 
size_t
 
__n
)

56 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

60 
__BEGIN_NAMESPACE_STD


62 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

65 
	$memcmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

66 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

69 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


72 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

73 
__THROW
 
	`__asm
 ("memchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

74 c⁄° *
	`memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

75 
__THROW
 
	`__asm
 ("memchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

77 #ifde‡
__OPTIMIZE__


78 
__exã∫_Æways_ölöe
 *

79 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW


81  
	`__buûtö_memchr
 (
__s
, 
__c
, 
__n
);

84 
__exã∫_Æways_ölöe
 const *

85 
	`memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW


87  
	`__buûtö_memchr
 (
__s
, 
__c
, 
__n
);

90 
	}
}

92 *
	$memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

93 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

95 
__END_NAMESPACE_STD


97 #ifde‡
__USE_GNU


100 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


101 "C++" *
	$øwmemchr
 (*
__s
, 
__c
)

102 
__THROW
 
	`__asm
 ("øwmemchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

103 "C++" c⁄° *
	$øwmemchr
 (c⁄° *
__s
, 
__c
)

104 
__THROW
 
	`__asm
 ("øwmemchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

106 *
	$øwmemchr
 (c⁄° *
__s
, 
__c
)

107 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

111 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


112 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

113 
__THROW
 
	`__asm
 ("memrchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

114 "C++" c⁄° *
	$memrchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

115 
__THROW
 
	`__asm
 ("memrchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

117 *
	$memrchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

118 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

123 
__BEGIN_NAMESPACE_STD


125 *
	$°r˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

126 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

128 *
	$°∫˝y
 (*
__ª°ri˘
 
__de°
,

129 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

130 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

133 *
	$°rˇt
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

134 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

136 *
	$°∫ˇt
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

137 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

140 
	$°rcmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

141 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

143 
	$°∫cmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

144 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

147 
	$°rcﬁl
 (c⁄° *
__s1
, c⁄° *
__s2
)

148 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

150 
size_t
 
	$°rx‰m
 (*
__ª°ri˘
 
__de°
,

151 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

152 
__THROW
 
	`__n⁄nuŒ
 ((2));

153 
__END_NAMESPACE_STD


155 #ifde‡
__USE_XOPEN2K8


159 
	~<xloˇÀ.h
>

162 
	$°rcﬁl_l
 (c⁄° *
__s1
, c⁄° *
__s2
, 
__loˇÀ_t
 
__l
)

163 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

165 
size_t
 
	$°rx‰m_l
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
,

166 
__loˇÀ_t
 
__l
Ë
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

169 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


171 *
	$°rdup
 (c⁄° *
__s
)

172 
__THROW
 
__©åibuã_mÆloc__
 
	`__n⁄nuŒ
 ((1));

178 #i‡
deföed
 
__USE_XOPEN2K8


179 *
	$°∫dup
 (c⁄° *
__°rög
, 
size_t
 
__n
)

180 
__THROW
 
__©åibuã_mÆloc__
 
	`__n⁄nuŒ
 ((1));

183 #i‡
deföed
 
__USE_GNU
 && deföed 
__GNUC__


185 
	#°rdu∑
(
s
) \

186 (
__exãnsi⁄__
 \

188 c⁄° *
__ﬁd
 = (
s
); \

189 
size_t
 
__Àn
 = 
	`°æí
 (
__ﬁd
) + 1; \

190 *
__√w
 = (*Ë
	`__buûtö_Æloˇ
 (
__Àn
); \

191 (*Ë
	`mem˝y
 (
__√w
, 
__ﬁd
, 
__Àn
); \

192 
	}
}))

	)

195 
	#°∫du∑
(
s
, 
n
) \

196 (
__exãnsi⁄__
 \

198 c⁄° *
__ﬁd
 = (
s
); \

199 
size_t
 
__Àn
 = 
	`°∫Àn
 (
__ﬁd
, (
n
)); \

200 *
__√w
 = (*Ë
	`__buûtö_Æloˇ
 (
__Àn
 + 1); \

201 
__√w
[
__Àn
] = '\0'; \

202 (*Ë
	`mem˝y
 (
__√w
, 
__ﬁd
, 
__Àn
); \

203 }))

	)

206 
	g__BEGIN_NAMESPACE_STD


208 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


211 *
°rchr
 (*
__s
, 
__c
)

212 
__THROW
 
__asm
 ("°rchr"Ë
__©åibuã_puª__
 
__n⁄nuŒ
 ((1));

213 c⁄° *
°rchr
 (c⁄° *
__s
, 
__c
)

214 
__THROW
 
__asm
 ("°rchr"Ë
__©åibuã_puª__
 
__n⁄nuŒ
 ((1));

216 #ifde‡
__OPTIMIZE__


217 
__exã∫_Æways_ölöe
 *

218 
°rchr
 (*
__s
, 
__c
Ë
	g__THROW


220  
__buûtö_°rchr
 (
__s
, 
__c
);

223 
__exã∫_Æways_ölöe
 const *

224 
°rchr
 (c⁄° *
__s
, 
__c
Ë
	g__THROW


226  
__buûtö_°rchr
 (
__s
, 
__c
);

231 *
	$°rchr
 (c⁄° *
__s
, 
__c
)

232 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

235 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


238 *
	`°ºchr
 (*
__s
, 
__c
)

239 
__THROW
 
	`__asm
 ("°ºchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

240 c⁄° *
	`°ºchr
 (c⁄° *
__s
, 
__c
)

241 
__THROW
 
	`__asm
 ("°ºchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

243 #ifde‡
__OPTIMIZE__


244 
__exã∫_Æways_ölöe
 *

245 
	`°ºchr
 (*
__s
, 
__c
Ë
__THROW


247  
	`__buûtö_°ºchr
 (
__s
, 
__c
);

250 
__exã∫_Æways_ölöe
 const *

251 
	`°ºchr
 (c⁄° *
__s
, 
__c
Ë
__THROW


253  
	`__buûtö_°ºchr
 (
__s
, 
__c
);

256 
	}
}

258 *
	$°ºchr
 (c⁄° *
__s
, 
__c
)

259 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

261 
__END_NAMESPACE_STD


263 #ifde‡
__USE_GNU


266 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


267 "C++" *
	$°rch∫ul
 (*
__s
, 
__c
)

268 
__THROW
 
	`__asm
 ("°rch∫ul"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

269 "C++" c⁄° *
	$°rch∫ul
 (c⁄° *
__s
, 
__c
)

270 
__THROW
 
	`__asm
 ("°rch∫ul"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

272 *
	$°rch∫ul
 (c⁄° *
__s
, 
__c
)

273 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

277 
__BEGIN_NAMESPACE_STD


280 
size_t
 
	$°rc•n
 (c⁄° *
__s
, c⁄° *
__ªje˘
)

281 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

284 
size_t
 
	$°r•n
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

285 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

287 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


290 *
	`°Ωbrk
 (*
__s
, c⁄° *
__ac˚±
)

291 
__THROW
 
	`__asm
 ("°Ωbrk"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

292 c⁄° *
	`°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

293 
__THROW
 
	`__asm
 ("°Ωbrk"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

295 #ifde‡
__OPTIMIZE__


296 
__exã∫_Æways_ölöe
 *

297 
	`°Ωbrk
 (*
__s
, c⁄° *
__ac˚±
Ë
__THROW


299  
	`__buûtö_°Ωbrk
 (
__s
, 
__ac˚±
);

302 
__exã∫_Æways_ölöe
 const *

303 
	`°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
Ë
__THROW


305  
	`__buûtö_°Ωbrk
 (
__s
, 
__ac˚±
);

308 
	}
}

310 *
	$°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

311 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

314 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


317 *
	`°r°r
 (*
__hay°ack
, c⁄° *
__√edÀ
)

318 
__THROW
 
	`__asm
 ("°r°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

319 c⁄° *
	`°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

320 
__THROW
 
	`__asm
 ("°r°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

322 #ifde‡
__OPTIMIZE__


323 
__exã∫_Æways_ölöe
 *

324 
	`°r°r
 (*
__hay°ack
, c⁄° *
__√edÀ
Ë
__THROW


326  
	`__buûtö_°r°r
 (
__hay°ack
, 
__√edÀ
);

329 
__exã∫_Æways_ölöe
 const *

330 
	`°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
Ë
__THROW


332  
	`__buûtö_°r°r
 (
__hay°ack
, 
__√edÀ
);

335 
	}
}

337 *
	$°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

338 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

343 *
	$°πok
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__dñim
)

344 
__THROW
 
	`__n⁄nuŒ
 ((2));

345 
__END_NAMESPACE_STD


349 *
	$__°πok_r
 (*
__ª°ri˘
 
__s
,

350 c⁄° *
__ª°ri˘
 
__dñim
,

351 **
__ª°ri˘
 
__ßve_±r
)

352 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

353 #ifde‡
__USE_POSIX


354 *
	$°πok_r
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__dñim
,

355 **
__ª°ri˘
 
__ßve_±r
)

356 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

359 #ifde‡
__USE_GNU


361 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


362 "C++" *
	$°rˇ£°r
 (*
__hay°ack
, c⁄° *
__√edÀ
)

363 
__THROW
 
	`__asm
 ("°rˇ£°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

364 "C++" c⁄° *
	$°rˇ£°r
 (c⁄° *
__hay°ack
,

365 c⁄° *
__√edÀ
)

366 
__THROW
 
	`__asm
 ("°rˇ£°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

368 *
	$°rˇ£°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

369 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

373 #ifde‡
__USE_GNU


377 *
	$memmem
 (c⁄° *
__hay°ack
, 
size_t
 
__hay°ackÀn
,

378 c⁄° *
__√edÀ
, 
size_t
 
__√edÀÀn
)

379 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 3));

383 *
	$__memp˝y
 (*
__ª°ri˘
 
__de°
,

384 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

385 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

386 *
	$memp˝y
 (*
__ª°ri˘
 
__de°
,

387 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

388 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

392 
__BEGIN_NAMESPACE_STD


394 
size_t
 
	$°æí
 (c⁄° *
__s
)

395 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

396 
__END_NAMESPACE_STD


398 #ifdef 
__USE_XOPEN2K8


401 
size_t
 
	$°∫Àn
 (c⁄° *
__°rög
, 
size_t
 
__maxÀn
)

402 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

406 
__BEGIN_NAMESPACE_STD


408 *
	$°ªº‹
 (
__î∫um
Ë
__THROW
;

409 
__END_NAMESPACE_STD


410 #ifde‡
__USE_XOPEN2K


418 #i‡
deföed
 
__USE_XOPEN2K
 && !deföed 
__USE_GNU


421 #ifde‡
__REDIRECT_NTH


422 
	`__REDIRECT_NTH
 (
°ªº‹_r
,

423 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
),

424 
__xpg_°ªº‹_r
Ë
	`__n⁄nuŒ
 ((2));

426 
	$__xpg_°ªº‹_r
 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
)

427 
__THROW
 
	`__n⁄nuŒ
 ((2));

428 
	#°ªº‹_r
 
__xpg_°ªº‹_r


	)

433 *
	$°ªº‹_r
 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
)

434 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

438 #ifde‡
__USE_XOPEN2K8


440 *
	$°ªº‹_l
 (
__î∫um
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

446 
	$__bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

448 #ifde‡
__USE_MISC


450 
	$bc›y
 (c⁄° *
__§c
, *
__de°
, 
size_t
 
__n
)

451 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

454 
	$bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

457 
	$bcmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

458 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

461 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


464 *
	`ödex
 (*
__s
, 
__c
)

465 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

466 c⁄° *
	`ödex
 (c⁄° *
__s
, 
__c
)

467 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

469 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


470 
__exã∫_Æways_ölöe
 *

471 
	`ödex
 (*
__s
, 
__c
Ë
__THROW


473  
	`__buûtö_ödex
 (
__s
, 
__c
);

476 
__exã∫_Æways_ölöe
 const *

477 
	`ödex
 (c⁄° *
__s
, 
__c
Ë
__THROW


479  
	`__buûtö_ödex
 (
__s
, 
__c
);

482 
	}
}

484 *
	$ödex
 (c⁄° *
__s
, 
__c
)

485 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

489 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


492 *
	`rödex
 (*
__s
, 
__c
)

493 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

494 c⁄° *
	`rödex
 (c⁄° *
__s
, 
__c
)

495 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

497 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


498 
__exã∫_Æways_ölöe
 *

499 
	`rödex
 (*
__s
, 
__c
Ë
__THROW


501  
	`__buûtö_rödex
 (
__s
, 
__c
);

504 
__exã∫_Æways_ölöe
 const *

505 
	`rödex
 (c⁄° *
__s
, 
__c
Ë
__THROW


507  
	`__buûtö_rödex
 (
__s
, 
__c
);

510 
	}
}

512 *
	$rödex
 (c⁄° *
__s
, 
__c
)

513 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

518 
	$ffs
 (
__i
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

522 #ifdef 
__USE_GNU


523 
	$ff¶
 (
__l
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

524 
__exãnsi⁄__
 
	$ff¶l
 (
__Œ
)

525 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

529 
	$°rˇ£cmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

530 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

533 
	$°∫ˇ£cmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

534 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

537 #ifdef 
__USE_GNU


540 
	$°rˇ£cmp_l
 (c⁄° *
__s1
, c⁄° *
__s2
,

541 
__loˇÀ_t
 
__loc
)

542 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

544 
	$°∫ˇ£cmp_l
 (c⁄° *
__s1
, c⁄° *
__s2
,

545 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
)

546 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 4));

549 #ifdef 
__USE_MISC


552 *
	$°r£p
 (**
__ª°ri˘
 
__°rögp
,

553 c⁄° *
__ª°ri˘
 
__dñim
)

554 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

557 #ifdef 
__USE_XOPEN2K8


559 *
	$°rsig«l
 (
__sig
Ë
__THROW
;

562 *
	$__°p˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

563 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

564 *
	$°p˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

565 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

569 *
	$__°≤˝y
 (*
__ª°ri˘
 
__de°
,

570 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

571 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

572 *
	$°≤˝y
 (*
__ª°ri˘
 
__de°
,

573 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

574 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

577 #ifdef 
__USE_GNU


579 
	$°rvîscmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

580 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

583 *
	$°r‰y
 (*
__°rög
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

586 *
	$mem‰ob
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

588 #i‚de‡
ba£«me


593 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


594 "C++" *
	$ba£«me
 (*
__fûíame
)

595 
__THROW
 
	`__asm
 ("ba£«me"Ë
	`__n⁄nuŒ
 ((1));

596 "C++" c⁄° *
	$ba£«me
 (c⁄° *
__fûíame
)

597 
__THROW
 
	`__asm
 ("ba£«me"Ë
	`__n⁄nuŒ
 ((1));

599 *
	$ba£«me
 (c⁄° *
__fûíame
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

605 #i‡
deföed
 
__GNUC__
 && __GNUC__ >= 2

606 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__OPTIMIZE_SIZE__
 \

607 && !
deföed
 
__NO_INLINE__
 && !deföed 
__˝lu•lus


627 
	~<bôs/°rög.h
>

630 
	~<bôs/°rög2.h
>

633 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


635 
	~<bôs/°rög3.h
>

639 #i‡
deföed
 
__USE_GNU
 && deföed 
__OPTIMIZE__
 \

640 && 
deföed
 
__exã∫_Æways_ölöe
 && 
	$__GNUC_PREREQ
 (3,2)

641 #i‡!
deföed
 
_FORCE_INLINES
 && !deföed 
_HAVE_STRING_ARCH_memp˝y


643 #unde‡
memp˝y


644 #unde‡
__memp˝y


645 
	#memp˝y
(
de°
, 
§c
, 
n
Ë
	`__memp˝y_ölöe
 (de°, src,Ç)

	)

646 
	#__memp˝y
(
de°
, 
§c
, 
n
Ë
	`__memp˝y_ölöe
 (de°, src,Ç)

	)

648 
__exã∫_Æways_ölöe
 *

649 
	$__memp˝y_ölöe
 (*
__ª°ri˘
 
__de°
,

650 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

652  (*Ë
	`mem˝y
 (
__de°
, 
__§c
, 
__n
) + __n;

653 
	}
}

658 
	g__END_DECLS


	@/usr/include/unistd.h

22 #i‚def 
_UNISTD_H


23 
	#_UNISTD_H
 1

	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


32 #ifde‡
__USE_XOPEN2K8


34 
	#_POSIX_VERSION
 200809L

	)

35 #ñi‡
deföed
 
__USE_XOPEN2K


37 
	#_POSIX_VERSION
 200112L

	)

38 #ñi‡
deföed
 
__USE_POSIX199506


40 
	#_POSIX_VERSION
 199506L

	)

41 #ñi‡
deföed
 
__USE_POSIX199309


43 
	#_POSIX_VERSION
 199309L

	)

46 
	#_POSIX_VERSION
 199009L

	)

52 #ifde‡
__USE_XOPEN2K8


53 
	#__POSIX2_THIS_VERSION
 200809L

	)

55 #ñi‡
deföed
 
__USE_XOPEN2K


57 
	#__POSIX2_THIS_VERSION
 200112L

	)

58 #ñi‡
deföed
 
__USE_POSIX199506


60 
	#__POSIX2_THIS_VERSION
 199506L

	)

63 
	#__POSIX2_THIS_VERSION
 199209L

	)

67 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

70 
	#_POSIX2_C_VERSION
 
__POSIX2_THIS_VERSION


	)

74 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

78 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

82 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

86 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

89 #ifde‡
__USE_XOPEN2K8


90 
	#_XOPEN_VERSION
 700

	)

91 #ñi‡
deföed
 
__USE_XOPEN2K


92 
	#_XOPEN_VERSION
 600

	)

93 #ñi‡
deföed
 
__USE_UNIX98


94 
	#_XOPEN_VERSION
 500

	)

96 
	#_XOPEN_VERSION
 4

	)

100 
	#_XOPEN_XCU_VERSION
 4

	)

103 
	#_XOPEN_XPG2
 1

	)

104 
	#_XOPEN_XPG3
 1

	)

105 
	#_XOPEN_XPG4
 1

	)

108 
	#_XOPEN_UNIX
 1

	)

111 
	#_XOPEN_CRYPT
 1

	)

115 
	#_XOPEN_ENH_I18N
 1

	)

118 
	#_XOPEN_LEGACY
 1

	)

205 
	~<bôs/posix_›t.h
>

208 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


209 
	~<bôs/ívú⁄míts.h
>

213 
	#STDIN_FILENO
 0

	)

214 
	#STDOUT_FILENO
 1

	)

215 
	#STDERR_FILENO
 2

	)

220 
	~<bôs/ty≥s.h
>

222 #i‚def 
__ssize_t_deföed


223 
__ssize_t
 
	tssize_t
;

224 
	#__ssize_t_deföed


	)

227 
	#__√ed_size_t


	)

228 
	#__√ed_NULL


	)

229 
	~<°ddef.h
>

231 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


234 #i‚de‡
__gid_t_deföed


235 
__gid_t
 
	tgid_t
;

236 
	#__gid_t_deföed


	)

239 #i‚de‡
__uid_t_deföed


240 
__uid_t
 
	tuid_t
;

241 
	#__uid_t_deföed


	)

244 #i‚de‡
__off_t_deföed


245 #i‚de‡
__USE_FILE_OFFSET64


246 
__off_t
 
	toff_t
;

248 
__off64_t
 
	toff_t
;

250 
	#__off_t_deföed


	)

252 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


253 
__off64_t
 
	toff64_t
;

254 
	#__off64_t_deföed


	)

257 #i‚de‡
__u£c⁄ds_t_deföed


258 
__u£c⁄ds_t
 
	tu£c⁄ds_t
;

259 
	#__u£c⁄ds_t_deföed


	)

262 #i‚de‡
__pid_t_deföed


263 
__pid_t
 
	tpid_t
;

264 
	#__pid_t_deföed


	)

268 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


269 #i‚de‡
__öçå_t_deföed


270 
__öçå_t
 
	töçå_t
;

271 
	#__öçå_t_deföed


	)

275 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


276 #i‚de‡
__sockÀn_t_deföed


277 
__sockÀn_t
 
	tsockÀn_t
;

278 
	#__sockÀn_t_deföed


	)

284 
	#R_OK
 4

	)

285 
	#W_OK
 2

	)

286 
	#X_OK
 1

	)

287 
	#F_OK
 0

	)

290 
	$ac˚ss
 (c⁄° *
__«me
, 
__ty≥
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

292 #ifde‡
__USE_GNU


295 
	$euidac˚ss
 (c⁄° *
__«me
, 
__ty≥
)

296 
__THROW
 
	`__n⁄nuŒ
 ((1));

299 
	$óc˚ss
 (c⁄° *
__«me
, 
__ty≥
)

300 
__THROW
 
	`__n⁄nuŒ
 ((1));

303 #ifde‡
__USE_ATFILE


307 
	$Ác˚sßt
 (
__fd
, c⁄° *
__fûe
, 
__ty≥
, 
__Êag
)

308 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

313 #i‚def 
_STDIO_H


314 
	#SEEK_SET
 0

	)

315 
	#SEEK_CUR
 1

	)

316 
	#SEEK_END
 2

	)

317 #ifde‡
__USE_GNU


318 
	#SEEK_DATA
 3

	)

319 
	#SEEK_HOLE
 4

	)

323 #i‡
deföed
 
__USE_MISC
 && !deföed 
L_SET


325 
	#L_SET
 
SEEK_SET


	)

326 
	#L_INCR
 
SEEK_CUR


	)

327 
	#L_XTND
 
SEEK_END


	)

336 #i‚de‡
__USE_FILE_OFFSET64


337 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__whí˚
Ë
__THROW
;

339 #ifde‡
__REDIRECT_NTH


340 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

341 (
__fd
, 
__off64_t
 
__off£t
, 
__whí˚
),

342 
l£ek64
);

344 
	#l£ek
 
l£ek64


	)

347 #ifde‡
__USE_LARGEFILE64


348 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__whí˚
)

349 
__THROW
;

356 
	`˛o£
 (
__fd
);

363 
ssize_t
 
	$ªad
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
Ë
__wur
;

369 
ssize_t
 
	$wrôe
 (
__fd
, c⁄° *
__buf
, 
size_t
 
__n
Ë
__wur
;

371 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


372 #i‚de‡
__USE_FILE_OFFSET64


379 
ssize_t
 
	$¥ód
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

380 
__off_t
 
__off£t
Ë
__wur
;

387 
ssize_t
 
	$pwrôe
 (
__fd
, c⁄° *
__buf
, 
size_t
 
__n
,

388 
__off_t
 
__off£t
Ë
__wur
;

390 #ifde‡
__REDIRECT


391 
ssize_t
 
	`__REDIRECT
 (
¥ód
, (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

392 
__off64_t
 
__off£t
),

393 
¥ód64
Ë
__wur
;

394 
ssize_t
 
	`__REDIRECT
 (
pwrôe
, (
__fd
, c⁄° *
__buf
,

395 
size_t
 
__nbyãs
, 
__off64_t
 
__off£t
),

396 
pwrôe64
Ë
__wur
;

398 
	#¥ód
 
¥ód64


	)

399 
	#pwrôe
 
pwrôe64


	)

403 #ifde‡
__USE_LARGEFILE64


407 
ssize_t
 
	$¥ód64
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

408 
__off64_t
 
__off£t
Ë
__wur
;

411 
ssize_t
 
	$pwrôe64
 (
__fd
, c⁄° *
__buf
, 
size_t
 
__n
,

412 
__off64_t
 
__off£t
Ë
__wur
;

420 
	$pùe
 (
__pùedes
[2]Ë
__THROW
 
__wur
;

422 #ifde‡
__USE_GNU


425 
	$pùe2
 (
__pùedes
[2], 
__Êags
Ë
__THROW
 
__wur
;

435 
	$Æ¨m
 (
__£c⁄ds
Ë
__THROW
;

447 
	`¶ìp
 (
__£c⁄ds
);

449 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

450 || 
deföed
 
__USE_MISC


455 
__u£c⁄ds_t
 
	$uÆ¨m
 (
__u£c⁄ds_t
 
__vÆue
, __u£c⁄ds_à
__öãrvÆ
)

456 
__THROW
;

463 
	`u¶ìp
 (
__u£c⁄ds_t
 
__u£c⁄ds
);

472 
	`∑u£
 ();

476 
	$chown
 (c⁄° *
__fûe
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
)

477 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

479 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


481 
	$fchown
 (
__fd
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
Ë
__THROW
 
__wur
;

486 
	$lchown
 (c⁄° *
__fûe
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
)

487 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

491 #ifde‡
__USE_ATFILE


494 
	$fchow«t
 (
__fd
, c⁄° *
__fûe
, 
__uid_t
 
__ow√r
,

495 
__gid_t
 
__group
, 
__Êag
)

496 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

500 
	$chdú
 (c⁄° *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

502 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


504 
	$fchdú
 (
__fd
Ë
__THROW
 
__wur
;

514 *
	$gëcwd
 (*
__buf
, 
size_t
 
__size
Ë
__THROW
 
__wur
;

516 #ifdef 
__USE_GNU


520 *
	$gë_cuºít_dú_«me
 (Ë
__THROW
;

523 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

524 || 
deföed
 
__USE_MISC


528 *
	$gëwd
 (*
__buf
)

529 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__©åibuã_dïªˇãd__
 
__wur
;

534 
	$dup
 (
__fd
Ë
__THROW
 
__wur
;

537 
	$dup2
 (
__fd
, 
__fd2
Ë
__THROW
;

539 #ifde‡
__USE_GNU


542 
	$dup3
 (
__fd
, 
__fd2
, 
__Êags
Ë
__THROW
;

546 **
__ívú⁄
;

547 #ifde‡
__USE_GNU


548 **
ívú⁄
;

554 
	$execve
 (c⁄° *
__∑th
, *c⁄° 
__¨gv
[],

555 *c⁄° 
__ívp
[]Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

557 #ifde‡
__USE_XOPEN2K8


560 
	$„xecve
 (
__fd
, *c⁄° 
__¨gv
[], *c⁄° 
__ívp
[])

561 
__THROW
 
	`__n⁄nuŒ
 ((2));

566 
	$execv
 (c⁄° *
__∑th
, *c⁄° 
__¨gv
[])

567 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

571 
	$exe˛e
 (c⁄° *
__∑th
, c⁄° *
__¨g
, ...)

572 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

576 
	$exe˛
 (c⁄° *
__∑th
, c⁄° *
__¨g
, ...)

577 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

581 
	$execvp
 (c⁄° *
__fûe
, *c⁄° 
__¨gv
[])

582 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

587 
	$exe˛p
 (c⁄° *
__fûe
, c⁄° *
__¨g
, ...)

588 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

590 #ifde‡
__USE_GNU


593 
	$execv≥
 (c⁄° *
__fûe
, *c⁄° 
__¨gv
[],

594 *c⁄° 
__ívp
[])

595 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

599 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


601 
	$ni˚
 (
__öc
Ë
__THROW
 
__wur
;

606 
	$_exô
 (
__°©us
Ë
	`__©åibuã__
 ((
__n‹ëu∫__
));

612 
	~<bôs/c⁄‚ame.h
>

615 
	$∑thc⁄f
 (c⁄° *
__∑th
, 
__«me
)

616 
__THROW
 
	`__n⁄nuŒ
 ((1));

619 
	$Â©hc⁄f
 (
__fd
, 
__«me
Ë
__THROW
;

622 
	$sysc⁄f
 (
__«me
Ë
__THROW
;

624 #ifdef 
__USE_POSIX2


626 
size_t
 
	$c⁄f°r
 (
__«me
, *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

631 
__pid_t
 
	$gëpid
 (Ë
__THROW
;

634 
__pid_t
 
	$gëµid
 (Ë
__THROW
;

637 
__pid_t
 
	$gëpgΩ
 (Ë
__THROW
;

640 
__pid_t
 
	$__gëpgid
 (
__pid_t
 
__pid
Ë
__THROW
;

641 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


642 
__pid_t
 
	$gëpgid
 (
__pid_t
 
__pid
Ë
__THROW
;

649 
	$£çgid
 (
__pid_t
 
__pid
, __pid_à
__pgid
Ë
__THROW
;

651 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


663 
	$£çgΩ
 (Ë
__THROW
;

670 
__pid_t
 
	$£tsid
 (Ë
__THROW
;

672 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


674 
__pid_t
 
	$gësid
 (
__pid_t
 
__pid
Ë
__THROW
;

678 
__uid_t
 
	$gëuid
 (Ë
__THROW
;

681 
__uid_t
 
	$gëeuid
 (Ë
__THROW
;

684 
__gid_t
 
	$gëgid
 (Ë
__THROW
;

687 
__gid_t
 
	$gëegid
 (Ë
__THROW
;

692 
	$gëgroups
 (
__size
, 
__gid_t
 
__li°
[]Ë
__THROW
 
__wur
;

694 #ifdef 
__USE_GNU


696 
	$group_membî
 (
__gid_t
 
__gid
Ë
__THROW
;

703 
	$£tuid
 (
__uid_t
 
__uid
Ë
__THROW
 
__wur
;

705 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


708 
	$£åeuid
 (
__uid_t
 
__ruid
, __uid_à
__euid
Ë
__THROW
 
__wur
;

711 #ifde‡
__USE_XOPEN2K


713 
	$£ãuid
 (
__uid_t
 
__uid
Ë
__THROW
 
__wur
;

720 
	$£tgid
 (
__gid_t
 
__gid
Ë
__THROW
 
__wur
;

722 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


725 
	$£åegid
 (
__gid_t
 
__rgid
, __gid_à
__egid
Ë
__THROW
 
__wur
;

728 #ifde‡
__USE_XOPEN2K


730 
	$£ãgid
 (
__gid_t
 
__gid
Ë
__THROW
 
__wur
;

733 #ifde‡
__USE_GNU


736 
	$gëªsuid
 (
__uid_t
 *
__ruid
, __uid_à*
__euid
, __uid_à*
__suid
)

737 
__THROW
;

741 
	$gëªsgid
 (
__gid_t
 *
__rgid
, __gid_à*
__egid
, __gid_à*
__sgid
)

742 
__THROW
;

746 
	$£åesuid
 (
__uid_t
 
__ruid
, __uid_à
__euid
, __uid_à
__suid
)

747 
__THROW
 
__wur
;

751 
	$£åesgid
 (
__gid_t
 
__rgid
, __gid_à
__egid
, __gid_à
__sgid
)

752 
__THROW
 
__wur
;

759 
__pid_t
 
	$f‹k
 (Ë
__THROWNL
;

761 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

762 || 
deföed
 
__USE_MISC


767 
__pid_t
 
	$vf‹k
 (Ë
__THROW
;

773 *
	$ây«me
 (
__fd
Ë
__THROW
;

777 
	$ây«me_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
)

778 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

782 
	$ißây
 (
__fd
Ë
__THROW
;

784 #i‡
deföed
 
__USE_MISC
 \

785 || (
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_UNIX98
)

788 
	$ây¶Ÿ
 (Ë
__THROW
;

793 
	$lök
 (c⁄° *
__‰om
, c⁄° *
__to
)

794 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

796 #ifde‡
__USE_ATFILE


799 
	$lök©
 (
__‰omfd
, c⁄° *
__‰om
, 
__tofd
,

800 c⁄° *
__to
, 
__Êags
)

801 
__THROW
 
	`__n⁄nuŒ
 ((2, 4)Ë
__wur
;

804 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


806 
	$symlök
 (c⁄° *
__‰om
, c⁄° *
__to
)

807 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

812 
ssize_t
 
	$ªadlök
 (c⁄° *
__ª°ri˘
 
__∑th
,

813 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

814 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

817 #ifde‡
__USE_ATFILE


819 
	$symlök©
 (c⁄° *
__‰om
, 
__tofd
,

820 c⁄° *
__to
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 3)Ë
__wur
;

823 
ssize_t
 
	$ªadlök©
 (
__fd
, c⁄° *
__ª°ri˘
 
__∑th
,

824 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

825 
__THROW
 
	`__n⁄nuŒ
 ((2, 3)Ë
__wur
;

829 
	$u∆ök
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

831 #ifde‡
__USE_ATFILE


833 
	$u∆ök©
 (
__fd
, c⁄° *
__«me
, 
__Êag
)

834 
__THROW
 
	`__n⁄nuŒ
 ((2));

838 
	$rmdú
 (c⁄° *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

842 
__pid_t
 
	$tcgëpgΩ
 (
__fd
Ë
__THROW
;

845 
	$tc£çgΩ
 (
__fd
, 
__pid_t
 
__pgΩ_id
Ë
__THROW
;

852 *
	`gëlogö
 ();

853 #i‡
deföed
 
__USE_REENTRANT
 || deföed 
__USE_POSIX199506


860 
	$gëlogö_r
 (*
__«me
, 
size_t
 
__«me_Àn
Ë
	`__n⁄nuŒ
 ((1));

863 #ifdef 
__USE_MISC


865 
	$£éogö
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

869 #ifdef 
__USE_POSIX2


873 
	#__√ed_gë›t


	)

874 
	~<gë›t.h
>

878 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


882 
	$gëho°«me
 (*
__«me
, 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

886 #i‡
deföed
 
__USE_MISC


889 
	$£tho°«me
 (c⁄° *
__«me
, 
size_t
 
__Àn
)

890 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

894 
	$£tho°id
 (
__id
Ë
__THROW
 
__wur
;

900 
	$gëdomaö«me
 (*
__«me
, 
size_t
 
__Àn
)

901 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

902 
	$£tdomaö«me
 (c⁄° *
__«me
, 
size_t
 
__Àn
)

903 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

909 
	$vh™gup
 (Ë
__THROW
;

912 
	$ªvoke
 (c⁄° *
__fûe
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

920 
	$¥ofû
 (*
__ßm∂e_buf„r
, 
size_t
 
__size
,

921 
size_t
 
__off£t
, 
__sˇÀ
)

922 
__THROW
 
	`__n⁄nuŒ
 ((1));

928 
	$ac˘
 (c⁄° *
__«me
Ë
__THROW
;

932 *
	$gëu£rshñl
 (Ë
__THROW
;

933 
	$ídu£rshñl
 (Ë
__THROW
;

934 
	$£tu£rshñl
 (Ë
__THROW
;

940 
	$d´m⁄
 (
__nochdú
, 
__no˛o£
Ë
__THROW
 
__wur
;

944 #i‡
deföed
 
__USE_MISC
 || (deföed 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
)

947 
	$chroŸ
 (c⁄° *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

951 *
	$gë∑ss
 (c⁄° *
__¥om±
Ë
	`__n⁄nuŒ
 ((1));

959 
	`fsync
 (
__fd
);

962 #ifde‡
__USE_GNU


965 
	$syncfs
 (
__fd
Ë
__THROW
;

969 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


972 
	`gëho°id
 ();

975 
	$sync
 (Ë
__THROW
;

978 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K


981 
	$gë∑gesize
 (Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

986 
	$gëdèbÀsize
 (Ë
__THROW
;

992 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


995 #i‚de‡
__USE_FILE_OFFSET64


996 
	$åunˇã
 (c⁄° *
__fûe
, 
__off_t
 
__Àngth
)

997 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

999 #ifde‡
__REDIRECT_NTH


1000 
	`__REDIRECT_NTH
 (
åunˇã
,

1001 (c⁄° *
__fûe
, 
__off64_t
 
__Àngth
),

1002 
åunˇã64
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

1004 
	#åunˇã
 
åunˇã64


	)

1007 #ifde‡
__USE_LARGEFILE64


1008 
	$åunˇã64
 (c⁄° *
__fûe
, 
__off64_t
 
__Àngth
)

1009 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

1014 #i‡
deföed
 
__USE_POSIX199309
 \

1015 || 
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


1018 #i‚de‡
__USE_FILE_OFFSET64


1019 
	$·runˇã
 (
__fd
, 
__off_t
 
__Àngth
Ë
__THROW
 
__wur
;

1021 #ifde‡
__REDIRECT_NTH


1022 
	`__REDIRECT_NTH
 (
·runˇã
, (
__fd
, 
__off64_t
 
__Àngth
),

1023 
·runˇã64
Ë
__wur
;

1025 
	#·runˇã
 
·runˇã64


	)

1028 #ifde‡
__USE_LARGEFILE64


1029 
	$·runˇã64
 (
__fd
, 
__off64_t
 
__Àngth
Ë
__THROW
 
__wur
;

1035 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K
) \

1036 || 
deföed
 
__USE_MISC


1040 
	$brk
 (*
__addr
Ë
__THROW
 
__wur
;

1046 *
	$sbrk
 (
öçå_t
 
__dñè
Ë
__THROW
;

1050 #ifde‡
__USE_MISC


1061 
	$sysˇŒ
 (
__sy¢o
, ...Ë
__THROW
;

1066 #i‡(
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED
Ë&& !deföed 
F_LOCK


1078 
	#F_ULOCK
 0

	)

1079 
	#F_LOCK
 1

	)

1080 
	#F_TLOCK
 2

	)

1081 
	#F_TEST
 3

	)

1083 #i‚de‡
__USE_FILE_OFFSET64


1084 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Àn
Ë
__wur
;

1086 #ifde‡
__REDIRECT


1087 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
),

1088 
lockf64
Ë
__wur
;

1090 
	#lockf
 
lockf64


	)

1093 #ifde‡
__USE_LARGEFILE64


1094 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
Ë
__wur
;

1099 #ifde‡
__USE_GNU


1104 
	#TEMP_FAILURE_RETRY
(
ex¥essi⁄
) \

1105 (
__exãnsi⁄__
 \

1106 ({ 
__ªsu…
; \

1107 dÿ
__ªsu…
 = (Ë(
ex¥essi⁄
); \

1108 
__ªsu…
 =-1L && 
î∫o
 =
EINTR
); \

1109 
__ªsu…
; 
	}
}))

	)

1112 #i‡
deföed
 
__USE_POSIX199309
 || deföed 
__USE_UNIX98


1115 
fd©async
 (
__fûdes
);

1121 #ifdef 
__USE_XOPEN


1123 *
	$¸y±
 (c⁄° *
__key
, c⁄° *
__ß…
)

1124 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1128 
	$í¸y±
 (*
__glibc_block
, 
__edÊag
)

1129 
__THROW
 
	`__n⁄nuŒ
 ((1));

1136 
	$swab
 (c⁄° *
__ª°ri˘
 
__‰om
, *__ª°ri˘ 
__to
,

1137 
ssize_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1143 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K


1145 *
	$˘îmid
 (*
__s
Ë
__THROW
;

1150 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


1151 
	~<bôs/uni°d.h
>

1154 
__END_DECLS


	@/usr/include/alloca.h

18 #i‚def 
_ALLOCA_H


19 
	#_ALLOCA_H
 1

	)

21 
	~<„©uªs.h
>

23 
	#__√ed_size_t


	)

24 
	~<°ddef.h
>

26 
	g__BEGIN_DECLS


29 #unde‡
Æloˇ


32 *
	$Æloˇ
 (
size_t
 
__size
Ë
__THROW
;

34 #ifdef 
__GNUC__


35 
	#Æloˇ
(
size
Ë
	`__buûtö_Æloˇ
 (size)

	)

38 
__END_DECLS


	@/usr/include/features.h

18 #i‚def 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

97 #unde‡
__USE_ISOC11


98 #unde‡
__USE_ISOC99


99 #unde‡
__USE_ISOC95


100 #unde‡
__USE_ISOCXX11


101 #unde‡
__USE_POSIX


102 #unde‡
__USE_POSIX2


103 #unde‡
__USE_POSIX199309


104 #unde‡
__USE_POSIX199506


105 #unde‡
__USE_XOPEN


106 #unde‡
__USE_XOPEN_EXTENDED


107 #unde‡
__USE_UNIX98


108 #unde‡
__USE_XOPEN2K


109 #unde‡
__USE_XOPEN2KXSI


110 #unde‡
__USE_XOPEN2K8


111 #unde‡
__USE_XOPEN2K8XSI


112 #unde‡
__USE_LARGEFILE


113 #unde‡
__USE_LARGEFILE64


114 #unde‡
__USE_FILE_OFFSET64


115 #unde‡
__USE_MISC


116 #unde‡
__USE_ATFILE


117 #unde‡
__USE_GNU


118 #unde‡
__USE_REENTRANT


119 #unde‡
__USE_FORTIFY_LEVEL


120 #unde‡
__KERNEL_STRICT_NAMES


124 #i‚de‡
_LOOSE_KERNEL_NAMES


125 
	#__KERNEL_STRICT_NAMES


	)

135 #i‡
deföed
 
__GNUC__
 && deföed 
__GNUC_MINOR__


136 
	#__GNUC_PREREQ
(
maj
, 
mö
) \

137 ((
__GNUC__
 << 16Ë+ 
__GNUC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

139 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë0

	)

146 #i‡(
deföed
 
_BSD_SOURCE
 || deföed 
_SVID_SOURCE
) \

147 && !
deföed
 
	g_DEFAULT_SOURCE


152 #unde‡
_DEFAULT_SOURCE


153 
	#_DEFAULT_SOURCE
 1

	)

157 #ifde‡
_GNU_SOURCE


158 #unde‡
_ISOC95_SOURCE


159 
	#_ISOC95_SOURCE
 1

	)

160 #unde‡
_ISOC99_SOURCE


161 
	#_ISOC99_SOURCE
 1

	)

162 #unde‡
_ISOC11_SOURCE


163 
	#_ISOC11_SOURCE
 1

	)

164 #unde‡
_POSIX_SOURCE


165 
	#_POSIX_SOURCE
 1

	)

166 #unde‡
_POSIX_C_SOURCE


167 
	#_POSIX_C_SOURCE
 200809L

	)

168 #unde‡
_XOPEN_SOURCE


169 
	#_XOPEN_SOURCE
 700

	)

170 #unde‡
_XOPEN_SOURCE_EXTENDED


171 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

172 #unde‡
_LARGEFILE64_SOURCE


173 
	#_LARGEFILE64_SOURCE
 1

	)

174 #unde‡
_DEFAULT_SOURCE


175 
	#_DEFAULT_SOURCE
 1

	)

176 #unde‡
_ATFILE_SOURCE


177 
	#_ATFILE_SOURCE
 1

	)

182 #i‡(
deföed
 
_DEFAULT_SOURCE
 \

183 || (!
deföed
 
	g__STRICT_ANSI__
 \

184 && !
deföed
 
	g_ISOC99_SOURCE
 \

185 && !
deföed
 
	g_POSIX_SOURCE
 && !deföed 
	g_POSIX_C_SOURCE
 \

186 && !
deföed
 
	g_XOPEN_SOURCE
))

187 #unde‡
_DEFAULT_SOURCE


188 
	#_DEFAULT_SOURCE
 1

	)

192 #i‡(
deföed
 
_ISOC11_SOURCE
 \

193 || (
deföed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

194 
	#__USE_ISOC11
 1

	)

198 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

199 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

200 
	#__USE_ISOC99
 1

	)

204 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

205 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

206 
	#__USE_ISOC95
 1

	)

213 #i‡((
deföed
 
__˝lu•lus
 && __cplusplus >= 201103L) \

214 || 
deföed
 
__GXX_EXPERIMENTAL_CXX0X__
)

215 
	#__USE_ISOCXX11
 1

	)

221 #ifde‡
_DEFAULT_SOURCE


222 #i‡!
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE


223 
	#__USE_POSIX_IMPLICITLY
 1

	)

225 #unde‡
_POSIX_SOURCE


226 
	#_POSIX_SOURCE
 1

	)

227 #unde‡
_POSIX_C_SOURCE


228 
	#_POSIX_C_SOURCE
 200809L

	)

230 #i‡((!
deföed
 
__STRICT_ANSI__
 \

231 || (
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) >= 500)) \

232 && !
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE
)

233 
	#_POSIX_SOURCE
 1

	)

234 #i‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

235 
	#_POSIX_C_SOURCE
 2

	)

236 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

237 
	#_POSIX_C_SOURCE
 199506L

	)

238 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

239 
	#_POSIX_C_SOURCE
 200112L

	)

241 
	#_POSIX_C_SOURCE
 200809L

	)

243 
	#__USE_POSIX_IMPLICITLY
 1

	)

246 #i‡(
deföed
 
_POSIX_SOURCE
 \

247 || (
deföed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >= 1) \

248 || 
deföed
 
_XOPEN_SOURCE
)

249 
	#__USE_POSIX
 1

	)

252 #i‡
deföed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >2 || deföed 
_XOPEN_SOURCE


253 
	#__USE_POSIX2
 1

	)

256 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199309L

257 
	#__USE_POSIX199309
 1

	)

260 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199506L

261 
	#__USE_POSIX199506
 1

	)

264 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200112L

265 
	#__USE_XOPEN2K
 1

	)

266 #unde‡
__USE_ISOC95


267 
	#__USE_ISOC95
 1

	)

268 #unde‡
__USE_ISOC99


269 
	#__USE_ISOC99
 1

	)

272 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200809L

273 
	#__USE_XOPEN2K8
 1

	)

274 #unde‡
_ATFILE_SOURCE


275 
	#_ATFILE_SOURCE
 1

	)

278 #ifdef 
_XOPEN_SOURCE


279 
	#__USE_XOPEN
 1

	)

280 #i‡(
_XOPEN_SOURCE
 - 0) >= 500

281 
	#__USE_XOPEN_EXTENDED
 1

	)

282 
	#__USE_UNIX98
 1

	)

283 #unde‡
_LARGEFILE_SOURCE


284 
	#_LARGEFILE_SOURCE
 1

	)

285 #i‡(
_XOPEN_SOURCE
 - 0) >= 600

286 #i‡(
_XOPEN_SOURCE
 - 0) >= 700

287 
	#__USE_XOPEN2K8
 1

	)

288 
	#__USE_XOPEN2K8XSI
 1

	)

290 
	#__USE_XOPEN2K
 1

	)

291 
	#__USE_XOPEN2KXSI
 1

	)

292 #unde‡
__USE_ISOC95


293 
	#__USE_ISOC95
 1

	)

294 #unde‡
__USE_ISOC99


295 
	#__USE_ISOC99
 1

	)

298 #ifde‡
_XOPEN_SOURCE_EXTENDED


299 
	#__USE_XOPEN_EXTENDED
 1

	)

304 #ifde‡
_LARGEFILE_SOURCE


305 
	#__USE_LARGEFILE
 1

	)

308 #ifde‡
_LARGEFILE64_SOURCE


309 
	#__USE_LARGEFILE64
 1

	)

312 #i‡
deföed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

313 
	#__USE_FILE_OFFSET64
 1

	)

316 #i‡
deföed
 
_DEFAULT_SOURCE


317 
	#__USE_MISC
 1

	)

320 #ifdef 
_ATFILE_SOURCE


321 
	#__USE_ATFILE
 1

	)

324 #ifdef 
_GNU_SOURCE


325 
	#__USE_GNU
 1

	)

328 #i‡
deföed
 
_REENTRANT
 || deföed 
_THREAD_SAFE


329 
	#__USE_REENTRANT
 1

	)

332 #i‡
deföed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

333 && 
__GNUC_PREREQ
 (4, 1Ë&& 
deföed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

334 #i‡
_FORTIFY_SOURCE
 > 1

335 
	#__USE_FORTIFY_LEVEL
 2

	)

337 
	#__USE_FORTIFY_LEVEL
 1

	)

340 
	#__USE_FORTIFY_LEVEL
 0

	)

345 
	~<°dc-¥edef.h
>

353 #unde‡
__GNU_LIBRARY__


354 
	#__GNU_LIBRARY__
 6

	)

358 
	#__GLIBC__
 2

	)

359 
	#__GLIBC_MINOR__
 23

	)

361 
	#__GLIBC_PREREQ
(
maj
, 
mö
) \

362 ((
__GLIBC__
 << 16Ë+ 
__GLIBC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

365 #i‚de‡
__ASSEMBLER__


366 #i‚de‡
_SYS_CDEFS_H


367 
	~<sys/cdefs.h
>

372 #i‡
deföed
 
__USE_FILE_OFFSET64
 && !deföed 
__REDIRECT


373 
	#__USE_LARGEFILE
 1

	)

374 
	#__USE_LARGEFILE64
 1

	)

380 #i‡
__GNUC_PREREQ
 (2, 7Ë&& 
deföed
 
__OPTIMIZE__
 \

381 && !
deföed
 
	g__OPTIMIZE_SIZE__
 && !deföed 
	g__NO_INLINE__
 \

382 && 
deföed
 
	g__exã∫_ölöe


383 
	#__USE_EXTERN_INLINES
 1

	)

391 
	~<gnu/°ubs.h
>

	@/usr/include/getopt.h

19 #i‚de‡
_GETOPT_H


21 #i‚de‡
__√ed_gë›t


22 
	#_GETOPT_H
 1

	)

32 #i‡!
deföed
 
__GNU_LIBRARY__


33 
	~<˘y≥.h
>

36 #i‚de‡
__THROW


37 #i‚de‡
__GNUC_PREREQ


38 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë(0)

	)

40 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (2,8)

41 
	#__THROW
 
	`throw
 ()

	)

43 
	#__THROW


	)

47 #ifdef 
__˝lu•lus


57 *
›èrg
;

71 
›töd
;

76 
›ãº
;

80 
›t›t
;

82 #i‚de‡
__√ed_gë›t


104 
	s›ti⁄


106 c⁄° *
	g«me
;

109 
	ghas_¨g
;

110 *
	gÊag
;

111 
	gvÆ
;

116 
	#no_¨gumít
 0

	)

117 
	#ªquúed_¨gumít
 1

	)

118 
	#›ti⁄Æ_¨gumít
 2

	)

146 #ifde‡
__GNU_LIBRARY__


150 
gë›t
 (
___¨gc
, *c⁄° *
___¨gv
, c⁄° *
__sh‹t›ts
)

151 
__THROW
;

153 #i‡
deföed
 
__√ed_gë›t
 && deföed 
__USE_POSIX2
 \

154 && !
deföed
 
	g__USE_POSIX_IMPLICITLY
 && !deföed 
	g__USE_GNU


158 #ifde‡
__REDIRECT


159 
__REDIRECT_NTH
 (
gë›t
, (
___¨gc
, *c⁄° *
___¨gv
,

160 c⁄° *
__sh‹t›ts
),

161 
__posix_gë›t
);

163 
__posix_gë›t
 (
___¨gc
, *c⁄° *
___¨gv
,

164 c⁄° *
__sh‹t›ts
Ë
__THROW
;

165 
	#gë›t
 
__posix_gë›t


	)

169 
gë›t
 ();

172 #i‚de‡
__√ed_gë›t


173 
gë›t_l⁄g
 (
___¨gc
, *c⁄° *
___¨gv
,

174 c⁄° *
__sh‹t›ts
,

175 c⁄° 
›ti⁄
 *
__l⁄g›ts
, *
__l⁄göd
)

176 
__THROW
;

177 
gë›t_l⁄g_⁄ly
 (
___¨gc
, *c⁄° *
___¨gv
,

178 c⁄° *
__sh‹t›ts
,

179 c⁄° 
›ti⁄
 *
__l⁄g›ts
, *
__l⁄göd
)

180 
__THROW
;

184 #ifdef 
__˝lu•lus


189 #unde‡
__√ed_gë›t


	@/usr/include/libio.h

28 #i‚de‡
_IO_STDIO_H


29 
	#_IO_STDIO_H


	)

31 
	~<_G_c⁄fig.h
>

33 
	#_IO_Âos_t
 
_G_Âos_t


	)

34 
	#_IO_Âos64_t
 
_G_Âos64_t


	)

35 
	#_IO_size_t
 
size_t


	)

36 
	#_IO_ssize_t
 
__ssize_t


	)

37 
	#_IO_off_t
 
__off_t


	)

38 
	#_IO_off64_t
 
__off64_t


	)

39 
	#_IO_pid_t
 
__pid_t


	)

40 
	#_IO_uid_t
 
__uid_t


	)

41 
	#_IO_ic⁄v_t
 
_G_ic⁄v_t


	)

42 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

43 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

44 
	#_IO_va_li°
 
_G_va_li°


	)

45 
	#_IO_wöt_t
 
wöt_t


	)

48 
	#__√ed___va_li°


	)

49 
	~<°d¨g.h
>

50 #ifde‡
__GNUC_VA_LIST


51 #unde‡
_IO_va_li°


52 
	#_IO_va_li°
 
__gnuc_va_li°


	)

55 #i‚de‡
__P


56 
	~<sys/cdefs.h
>

59 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

61 #i‚de‡
EOF


62 
	#EOF
 (-1)

	)

64 #i‚de‡
NULL


65 #i‡
deföed
 
__GNUG__
 && \

66 (
	g__GNUC__
 > 2 || (__GNUC__ =2 && 
__GNUC_MINOR__
 >= 8))

67 
	#NULL
 (
__nuŒ
)

	)

69 #i‡!
deföed
(
__˝lu•lus
)

70 
	#NULL
 ((*)0)

	)

72 
	#NULL
 (0)

	)

77 
	#_IOS_INPUT
 1

	)

78 
	#_IOS_OUTPUT
 2

	)

79 
	#_IOS_ATEND
 4

	)

80 
	#_IOS_APPEND
 8

	)

81 
	#_IOS_TRUNC
 16

	)

82 
	#_IOS_NOCREATE
 32

	)

83 
	#_IOS_NOREPLACE
 64

	)

84 
	#_IOS_BIN
 128

	)

92 
	#_IO_MAGIC
 0xFBAD0000

	)

93 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

94 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

95 
	#_IO_USER_BUF
 1

	)

96 
	#_IO_UNBUFFERED
 2

	)

97 
	#_IO_NO_READS
 4

	)

98 
	#_IO_NO_WRITES
 8

	)

99 
	#_IO_EOF_SEEN
 0x10

	)

100 
	#_IO_ERR_SEEN
 0x20

	)

101 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

102 
	#_IO_LINKED
 0x80

	)

103 
	#_IO_IN_BACKUP
 0x100

	)

104 
	#_IO_LINE_BUF
 0x200

	)

105 
	#_IO_TIED_PUT_GET
 0x400

	)

106 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

107 
	#_IO_IS_APPENDING
 0x1000

	)

108 
	#_IO_IS_FILEBUF
 0x2000

	)

109 
	#_IO_BAD_SEEN
 0x4000

	)

110 
	#_IO_USER_LOCK
 0x8000

	)

112 
	#_IO_FLAGS2_MMAP
 1

	)

113 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

114 #ifde‡
_LIBC


115 
	#_IO_FLAGS2_FORTIFY
 4

	)

117 
	#_IO_FLAGS2_USER_WBUF
 8

	)

118 #ifde‡
_LIBC


119 
	#_IO_FLAGS2_SCANF_STD
 16

	)

120 
	#_IO_FLAGS2_NOCLOSE
 32

	)

121 
	#_IO_FLAGS2_CLOEXEC
 64

	)

125 
	#_IO_SKIPWS
 01

	)

126 
	#_IO_LEFT
 02

	)

127 
	#_IO_RIGHT
 04

	)

128 
	#_IO_INTERNAL
 010

	)

129 
	#_IO_DEC
 020

	)

130 
	#_IO_OCT
 040

	)

131 
	#_IO_HEX
 0100

	)

132 
	#_IO_SHOWBASE
 0200

	)

133 
	#_IO_SHOWPOINT
 0400

	)

134 
	#_IO_UPPERCASE
 01000

	)

135 
	#_IO_SHOWPOS
 02000

	)

136 
	#_IO_SCIENTIFIC
 04000

	)

137 
	#_IO_FIXED
 010000

	)

138 
	#_IO_UNITBUF
 020000

	)

139 
	#_IO_STDIO
 040000

	)

140 
	#_IO_DONT_CLOSE
 0100000

	)

141 
	#_IO_BOOLALPHA
 0200000

	)

144 
_IO_jump_t
; 
	g_IO_FILE
;

147 #ifde‡
_IO_MTSAFE_IO


150 
	t_IO_lock_t
;

156 
	s_IO_m¨kî
 {

157 
_IO_m¨kî
 *
	m_√xt
;

158 
_IO_FILE
 *
	m_sbuf
;

162 
	m_pos
;

164 
£t_°ªampos
(
°ªampos
 
•
Ë{ 
	m_•os
 = sp; }

165 
£t_off£t
(
off£t
Ë{ 
	m_pos
 = off£t; 
	m_•os
 = (
°ªampos
)(-2); }

166 
	mpublic
:

167 
°ªamm¨kî
(
°ªambuf
 *
sb
);

168 ~
°ªamm¨kî
();

169 
ßvög
(Ë{  
	m_•os
 == -2; }

170 
dñè
(
°ªamm¨kî
&);

171 
dñè
();

176 
	e__codecvt_ªsu…


178 
	m__codecvt_ok
,

179 
	m__codecvt_∑πül
,

180 
	m__codecvt_îr‹
,

181 
	m__codecvt_noc⁄v


184 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


187 
	s_IO_codecvt


189 (*
	m__codecvt_de°r
Ë(
	m_IO_codecvt
 *);

190 
__codecvt_ªsu…
 (*
__codecvt_do_out
Ë(
	m_IO_codecvt
 *,

191 
	m__mb°©e_t
 *,

192 c⁄° 
	mwch¨_t
 *,

193 c⁄° 
	mwch¨_t
 *,

194 c⁄° 
	mwch¨_t
 **, *,

196 
__codecvt_ªsu…
 (*
__codecvt_do_unshi·
Ë(
	m_IO_codecvt
 *,

197 
	m__mb°©e_t
 *, *,

199 
__codecvt_ªsu…
 (*
__codecvt_do_ö
Ë(
	m_IO_codecvt
 *,

200 
	m__mb°©e_t
 *,

202 c⁄° **, 
	mwch¨_t
 *,

203 
	mwch¨_t
 *, wchar_t **);

204 (*
	m__codecvt_do_ícodög
Ë(
	m_IO_codecvt
 *);

205 (*
	m__codecvt_do_Æways_noc⁄v
Ë(
	m_IO_codecvt
 *);

206 (*
	m__codecvt_do_Àngth
Ë(
	m_IO_codecvt
 *, 
	m__mb°©e_t
 *,

207 c⁄° *, c⁄° *, 
	m_IO_size_t
);

208 (*
	m__codecvt_do_max_Àngth
Ë(
	m_IO_codecvt
 *);

210 
_IO_ic⁄v_t
 
	m__cd_ö
;

211 
_IO_ic⁄v_t
 
	m__cd_out
;

215 
	s_IO_wide_d©a


217 
wch¨_t
 *
	m_IO_ªad_±r
;

218 
wch¨_t
 *
	m_IO_ªad_íd
;

219 
wch¨_t
 *
	m_IO_ªad_ba£
;

220 
wch¨_t
 *
	m_IO_wrôe_ba£
;

221 
wch¨_t
 *
	m_IO_wrôe_±r
;

222 
wch¨_t
 *
	m_IO_wrôe_íd
;

223 
wch¨_t
 *
	m_IO_buf_ba£
;

224 
wch¨_t
 *
	m_IO_buf_íd
;

226 
wch¨_t
 *
	m_IO_ßve_ba£
;

227 
wch¨_t
 *
	m_IO_backup_ba£
;

229 
wch¨_t
 *
	m_IO_ßve_íd
;

231 
__mb°©e_t
 
	m_IO_°©e
;

232 
__mb°©e_t
 
	m_IO_œ°_°©e
;

233 
_IO_codecvt
 
	m_codecvt
;

235 
wch¨_t
 
	m_sh‹tbuf
[1];

237 c⁄° 
_IO_jump_t
 *
	m_wide_vèbÀ
;

241 
	s_IO_FILE
 {

242 
	m_Êags
;

243 
	#_IO_fûe_Êags
 
_Êags


	)

247 * 
	m_IO_ªad_±r
;

248 * 
	m_IO_ªad_íd
;

249 * 
	m_IO_ªad_ba£
;

250 * 
	m_IO_wrôe_ba£
;

251 * 
	m_IO_wrôe_±r
;

252 * 
	m_IO_wrôe_íd
;

253 * 
	m_IO_buf_ba£
;

254 * 
	m_IO_buf_íd
;

256 *
	m_IO_ßve_ba£
;

257 *
	m_IO_backup_ba£
;

258 *
	m_IO_ßve_íd
;

260 
_IO_m¨kî
 *
	m_m¨kîs
;

262 
_IO_FILE
 *
	m_chaö
;

264 
	m_fûío
;

266 
	m_blksize
;

268 
	m_Êags2
;

270 
_IO_off_t
 
	m_ﬁd_off£t
;

272 
	#__HAVE_COLUMN


	)

274 
	m_cur_cﬁumn
;

275 sig√d 
	m_vèbÀ_off£t
;

276 
	m_sh‹tbuf
[1];

280 
_IO_lock_t
 *
	m_lock
;

281 #ifde‡
_IO_USE_OLD_IO_FILE


284 
	s_IO_FILE_com∂ëe


286 
_IO_FILE
 
	m_fûe
;

288 #i‡
deföed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

289 
_IO_off64_t
 
	m_off£t
;

290 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


292 
_IO_codecvt
 *
	m_codecvt
;

293 
_IO_wide_d©a
 *
	m_wide_d©a
;

294 
_IO_FILE
 *
	m_‰ìªs_li°
;

295 *
	m_‰ìªs_buf
;

297 *
	m__∑d1
;

298 *
	m__∑d2
;

299 *
	m__∑d3
;

300 *
	m__∑d4
;

302 
size_t
 
	m__∑d5
;

303 
	m_mode
;

305 
	m_unu£d2
[15 *  (Ë- 4 *  (*Ë-  (
size_t
)];

309 #i‚de‡
__˝lu•lus


310 
_IO_FILE
 
	t_IO_FILE
;

313 
	g_IO_FILE_∂us
;

315 
_IO_FILE_∂us
 
_IO_2_1_°dö_
;

316 
_IO_FILE_∂us
 
_IO_2_1_°dout_
;

317 
_IO_FILE_∂us
 
_IO_2_1_°dîr_
;

318 #i‚de‡
_LIBC


319 
	#_IO_°dö
 ((
_IO_FILE
*)(&
_IO_2_1_°dö_
))

	)

320 
	#_IO_°dout
 ((
_IO_FILE
*)(&
_IO_2_1_°dout_
))

	)

321 
	#_IO_°dîr
 ((
_IO_FILE
*)(&
_IO_2_1_°dîr_
))

	)

323 
_IO_FILE
 *
_IO_°dö
 
©åibuã_hiddí
;

324 
_IO_FILE
 *
_IO_°dout
 
©åibuã_hiddí
;

325 
_IO_FILE
 *
_IO_°dîr
 
©åibuã_hiddí
;

333 
__ssize_t
 
	t__io_ªad_‚
 (*
	t__cookõ
, *
	t__buf
, 
	tsize_t
 
	t__nbyãs
);

341 
__ssize_t
 
	t__io_wrôe_‚
 (*
	t__cookõ
, c⁄° *
	t__buf
,

342 
	tsize_t
 
	t__n
);

350 
	t__io_£ek_‚
 (*
	t__cookõ
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

353 
	t__io_˛o£_‚
 (*
	t__cookõ
);

356 #ifde‡
_GNU_SOURCE


358 
__io_ªad_‚
 
	tcookõ_ªad_fun˘i⁄_t
;

359 
__io_wrôe_‚
 
	tcookõ_wrôe_fun˘i⁄_t
;

360 
__io_£ek_‚
 
	tcookõ_£ek_fun˘i⁄_t
;

361 
__io_˛o£_‚
 
	tcookõ_˛o£_fun˘i⁄_t
;

366 
__io_ªad_‚
 *
	mªad
;

367 
__io_wrôe_‚
 *
	mwrôe
;

368 
__io_£ek_‚
 *
	m£ek
;

369 
__io_˛o£_‚
 *
	m˛o£
;

370 } 
	t_IO_cookõ_io_fun˘i⁄s_t
;

371 
_IO_cookõ_io_fun˘i⁄s_t
 
	tcookõ_io_fun˘i⁄s_t
;

373 
	g_IO_cookõ_fûe
;

376 
_IO_cookõ_öô
 (
_IO_cookõ_fûe
 *
__cfûe
, 
__ªad_wrôe
,

377 *
__cookõ
, 
_IO_cookõ_io_fun˘i⁄s_t
 
__‚s
);

381 #ifde‡
__˝lu•lus


385 
__undîÊow
 (
_IO_FILE
 *);

386 
__uÊow
 (
_IO_FILE
 *);

387 
__ovîÊow
 (
_IO_FILE
 *, );

388 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


389 
_IO_wöt_t
 
__wundîÊow
 (
_IO_FILE
 *);

390 
_IO_wöt_t
 
__wuÊow
 (
_IO_FILE
 *);

391 
_IO_wöt_t
 
__wovîÊow
 (
_IO_FILE
 *, _IO_wint_t);

394 #i‡ 
__GNUC__
 >= 3

395 
	#_IO_BE
(
ex¥
, 
ªs
Ë
	`__buûtö_ex≥˘
 (”x¥),Ñes)

	)

397 
	#_IO_BE
(
ex¥
, 
ªs
Ë”x¥)

	)

400 
	#_IO_gëc_u∆ocked
(
_Â
) \

401 (
	`_IO_BE
 ((
_Â
)->
_IO_ªad_±r
 >(_Â)->
_IO_ªad_íd
, 0) \

402 ? 
	`__uÊow
 (
_Â
Ë: *(*Ë(_Â)->
_IO_ªad_±r
++)

	)

403 
	#_IO_≥ekc_u∆ocked
(
_Â
) \

404 (
	`_IO_BE
 ((
_Â
)->
_IO_ªad_±r
 >(_Â)->
_IO_ªad_íd
, 0) \

405 && 
	`__undîÊow
 (
_Â
Ë=
EOF
 ? EOF \

406 : *(*Ë(
_Â
)->
_IO_ªad_±r
)

	)

407 
	#_IO_putc_u∆ocked
(
_ch
, 
_Â
) \

408 (
	`_IO_BE
 ((
_Â
)->
_IO_wrôe_±r
 >(_Â)->
_IO_wrôe_íd
, 0) \

409 ? 
	`__ovîÊow
 (
_Â
, (Ë(
_ch
)) \

410 : (Ë(*(
_Â
)->
_IO_wrôe_±r
++ = (
_ch
)))

	)

412 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


413 
	#_IO_gëwc_u∆ocked
(
_Â
) \

414 (
	`_IO_BE
 ((
_Â
)->
_wide_d©a
 =
NULL
 \

415 || ((
_Â
)->
_wide_d©a
->
_IO_ªad_±r
 \

416 >(
_Â
)->
_wide_d©a
->
_IO_ªad_íd
), 0) \

417 ? 
	`__wuÊow
 (
_Â
Ë: (
_IO_wöt_t
Ë*(_Â)->
_wide_d©a
->
_IO_ªad_±r
++)

	)

418 
	#_IO_putwc_u∆ocked
(
_wch
, 
_Â
) \

419 (
	`_IO_BE
 ((
_Â
)->
_wide_d©a
 =
NULL
 \

420 || ((
_Â
)->
_wide_d©a
->
_IO_wrôe_±r
 \

421 >(
_Â
)->
_wide_d©a
->
_IO_wrôe_íd
), 0) \

422 ? 
	`__wovîÊow
 (
_Â
, 
_wch
) \

423 : (
_IO_wöt_t
Ë(*(
_Â
)->
_wide_d©a
->
_IO_wrôe_±r
++ = (
_wch
)))

	)

426 
	#_IO_„of_u∆ocked
(
__Â
Ë(((__Â)->
_Êags
 & 
_IO_EOF_SEEN
Ë!0)

	)

427 
	#_IO_„º‹_u∆ocked
(
__Â
Ë(((__Â)->
_Êags
 & 
_IO_ERR_SEEN
Ë!0)

	)

429 
_IO_gëc
 (
_IO_FILE
 *
__Â
);

430 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__Â
);

431 
_IO_„of
 (
_IO_FILE
 *
__Â
Ë
__THROW
;

432 
_IO_„º‹
 (
_IO_FILE
 *
__Â
Ë
__THROW
;

434 
_IO_≥ekc_locked
 (
_IO_FILE
 *
__Â
);

437 
	#_IO_PENDING_OUTPUT_COUNT
(
_Â
) \

438 ((
_Â
)->
_IO_wrôe_±r
 - (_Â)->
_IO_wrôe_ba£
)

	)

440 
_IO_Êockfûe
 (
_IO_FILE
 *Ë
__THROW
;

441 
_IO_fu∆ockfûe
 (
_IO_FILE
 *Ë
__THROW
;

442 
_IO_·rylockfûe
 (
_IO_FILE
 *Ë
__THROW
;

444 #ifde‡
_IO_MTSAFE_IO


445 
	#_IO_≥ekc
(
_Â
Ë
	`_IO_≥ekc_locked
 (_Â)

	)

446 
	#_IO_Êockfûe
(
_Â
) \

447 i‡(((
_Â
)->
_Êags
 & 
_IO_USER_LOCK
Ë=0Ë
	`_IO_Êockfûe
 (_Â)

	)

448 
	#_IO_fu∆ockfûe
(
_Â
) \

449 i‡(((
_Â
)->
_Êags
 & 
_IO_USER_LOCK
Ë=0Ë
	`_IO_fu∆ockfûe
 (_Â)

	)

451 
	#_IO_≥ekc
(
_Â
Ë
	`_IO_≥ekc_u∆ocked
 (_Â)

	)

452 
	#_IO_Êockfûe
(
_Â
Ë

	)

453 
	#_IO_fu∆ockfûe
(
_Â
Ë

	)

454 
	#_IO_·rylockfûe
(
_Â
Ë

	)

455 
	#_IO_˛ónup_ªgi⁄_°¨t
(
_f˘
, 
_Â
Ë

	)

456 
	#_IO_˛ónup_ªgi⁄_íd
(
_Doô
Ë

	)

459 
_IO_vfsˇnf
 (
_IO_FILE
 * 
__ª°ri˘
, const * __restrict,

460 
_IO_va_li°
, *
__ª°ri˘
);

461 
_IO_vÂrötf
 (
_IO_FILE
 *
__ª°ri˘
, const *__restrict,

462 
_IO_va_li°
);

463 
_IO_ssize_t
 
_IO_∑dn
 (
_IO_FILE
 *, , _IO_ssize_t);

464 
_IO_size_t
 
_IO_sgën
 (
_IO_FILE
 *, *, _IO_size_t);

466 
_IO_off64_t
 
_IO_£ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

467 
_IO_off64_t
 
_IO_£ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

469 
_IO_‰ì_backup_¨ó
 (
_IO_FILE
 *Ë
__THROW
;

471 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


472 
_IO_wöt_t
 
_IO_gëwc
 (
_IO_FILE
 *
__Â
);

473 
_IO_wöt_t
 
_IO_putwc
 (
wch¨_t
 
__wc
, 
_IO_FILE
 *
__Â
);

474 
_IO_fwide
 (
_IO_FILE
 *
__Â
, 
__mode
Ë
__THROW
;

475 #i‡
__GNUC__
 >= 2

478 #i‡
deföed
 
_LIBC
 && deföed 
SHARED


479 
	~<shlib-com∑t.h
>

480 #i‡
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

481 
	#_IO_fwide_maybe_öcom∑tibÀ
 \

482 (
	`__buûtö_ex≥˘
 (&
_IO_°dö_u£d
 =
NULL
, 0))

	)

483 c⁄° 
_IO_°dö_u£d
;

484 
wók_exã∫
 (
_IO_°dö_u£d
);

487 #i‚de‡
_IO_fwide_maybe_öcom∑tibÀ


488 
	#_IO_fwide_maybe_öcom∑tibÀ
 (0)

	)

492 
	#_IO_fwide
(
__Â
, 
__mode
) \

493 ({ 
__ªsu…
 = (
__mode
); \

494 i‡(
__ªsu…
 < 0 && ! 
_IO_fwide_maybe_öcom∑tibÀ
) \

496 i‡((
__Â
)->
_mode
 == 0) \

498 (
__Â
)->
_mode
 = -1; \

499 
__ªsu…
 = (
__Â
)->
_mode
; \

501 i‡(
	`__buûtö_c⁄°™t_p
 (
__mode
) && (__mode) == 0) \

502 
__ªsu…
 = 
_IO_fwide_maybe_öcom∑tibÀ
 ? -1 : (
__Â
)->
_mode
; \

504 
__ªsu…
 = 
	`_IO_fwide
 (
__Â
, __result); \

505 
__ªsu…
; })

	)

508 
_IO_vfwsˇnf
 (
_IO_FILE
 * 
__ª°ri˘
, c⁄° 
wch¨_t
 * __restrict,

509 
_IO_va_li°
, *
__ª°ri˘
);

510 
_IO_vfw¥ötf
 (
_IO_FILE
 *
__ª°ri˘
, c⁄° 
wch¨_t
 *__restrict,

511 
_IO_va_li°
);

512 
_IO_ssize_t
 
_IO_w∑dn
 (
_IO_FILE
 *, 
wöt_t
, _IO_ssize_t);

513 
_IO_‰ì_wbackup_¨ó
 (
_IO_FILE
 *Ë
__THROW
;

516 #ifde‡
__LDBL_COMPAT


517 
	~<bôs/libio-ldbl.h
>

520 #ifde‡
__˝lu•lus


	@/usr/include/xlocale.h

20 #i‚de‡
_XLOCALE_H


21 
	#_XLOCALE_H
 1

	)

27 
	s__loˇÀ_°ru˘


30 
__loˇÀ_d©a
 *
	m__loˇÀs
[13];

33 c⁄° *
	m__˘y≥_b
;

34 c⁄° *
	m__˘y≥_tﬁowî
;

35 c⁄° *
	m__˘y≥_touµî
;

38 c⁄° *
	m__«mes
[13];

39 } *
	t__loˇÀ_t
;

42 
__loˇÀ_t
 
	tloˇÀ_t
;

	@/usr/include/_G_config.h

4 #i‚de‡
_G_c⁄fig_h


5 
	#_G_c⁄fig_h
 1

	)

9 
	~<bôs/ty≥s.h
>

10 
	#__√ed_size_t


	)

11 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


12 
	#__√ed_wch¨_t


	)

14 
	#__√ed_NULL


	)

15 
	~<°ddef.h
>

16 
	#__√ed_mb°©e_t


	)

17 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


18 
	#__√ed_wöt_t


	)

20 
	~<wch¨.h
>

23 
__off_t
 
	m__pos
;

24 
__mb°©e_t
 
	m__°©e
;

25 } 
	t_G_Âos_t
;

28 
__off64_t
 
	m__pos
;

29 
__mb°©e_t
 
	m__°©e
;

30 } 
	t_G_Âos64_t
;

31 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


32 
	~<gc⁄v.h
>

35 
__gc⁄v_öfo
 
	m__cd
;

38 
__gc⁄v_öfo
 
	m__cd
;

39 
__gc⁄v_°ï_d©a
 
	m__d©a
;

40 } 
	m__comböed
;

41 } 
	t_G_ic⁄v_t
;

46 
	#_G_va_li°
 
__gnuc_va_li°


	)

48 
	#_G_HAVE_MMAP
 1

	)

49 
	#_G_HAVE_MREMAP
 1

	)

51 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

54 
	#_G_HAVE_ST_BLKSIZE
 
	`deföed
 (
_STATBUF_ST_BLKSIZE
)

	)

56 
	#_G_BUFSIZ
 8192

	)

	@/usr/include/ctype.h

22 #i‚def 
_CTYPE_H


23 
	#_CTYPE_H
 1

	)

25 
	~<„©uªs.h
>

26 
	~<bôs/ty≥s.h
>

28 
	g__BEGIN_DECLS


30 #i‚de‡
_ISbô


39 
	~<ídün.h
>

40 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


41 
	#_ISbô
(
bô
Ë(1 << (bô))

	)

43 
	#_ISbô
(
bô
Ë((bôË< 8 ? ((1 << (bô)Ë<< 8Ë: ((1 << (bô)Ë>> 8))

	)

48 
	m_ISuµî
 = 
_ISbô
 (0),

49 
	m_ISlowî
 = 
_ISbô
 (1),

50 
	m_ISÆpha
 = 
_ISbô
 (2),

51 
	m_ISdigô
 = 
_ISbô
 (3),

52 
	m_ISxdigô
 = 
_ISbô
 (4),

53 
	m_IS•a˚
 = 
_ISbô
 (5),

54 
	m_IS¥öt
 = 
_ISbô
 (6),

55 
	m_ISgøph
 = 
_ISbô
 (7),

56 
	m_ISbœnk
 = 
_ISbô
 (8),

57 
	m_IS˙ål
 = 
_ISbô
 (9),

58 
	m_ISpun˘
 = 
_ISbô
 (10),

59 
	m_ISÆnum
 = 
_ISbô
 (11)

79 c⁄° **
	$__˘y≥_b_loc
 ()

80 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

81 c⁄° 
__öt32_t
 **
	$__˘y≥_tﬁowî_loc
 ()

82 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

83 c⁄° 
__öt32_t
 **
	$__˘y≥_touµî_loc
 ()

84 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

87 #i‚de‡
__˝lu•lus


88 
	#__is˘y≥
(
c
, 
ty≥
) \

89 ((*
	`__˘y≥_b_loc
 ())[(Ë(
c
)] & (Ë
ty≥
)

	)

90 #ñi‡
deföed
 
__USE_EXTERN_INLINES


91 
	#__is˘y≥_f
(
ty≥
) \

92 
__exã∫_ölöe
 \

93 
is
##
	`ty≥
 (
__c
Ë
__THROW
 \

95  (*
	`__˘y≥_b_loc
 ())[(Ë(
__c
)] & (Ë
_IS
##
ty≥
; \

96 
	}

	)
}

99 
	#__ißscii
(
c
Ë(((cË& ~0x7fË=0Ë

	)

100 
	#__tﬂscii
(
c
Ë((cË& 0x7fË

	)

102 
	#__ex˘y≥
(
«me
Ë
	`«me
 (Ë
__THROW


	)

104 
__BEGIN_NAMESPACE_STD


110 
__ex˘y≥
 (
iß um
);

111 
__ex˘y≥
 (
ißÕha
);

112 
__ex˘y≥
 (
is˙ål
);

113 
__ex˘y≥
 (
isdigô
);

114 
__ex˘y≥
 (
i¶owî
);

115 
__ex˘y≥
 (
isgøph
);

116 
__ex˘y≥
 (
i•röt
);

117 
__ex˘y≥
 (
i•un˘
);

118 
__ex˘y≥
 (
is•a˚
);

119 
__ex˘y≥
 (
isuµî
);

120 
__ex˘y≥
 (
isxdigô
);

124 
	$tﬁowî
 (
__c
Ë
__THROW
;

127 
	$touµî
 (
__c
Ë
__THROW
;

129 
__END_NAMESPACE_STD


133 #ifdef 
__USE_ISOC99


134 
__BEGIN_NAMESPACE_C99


136 
	`__ex˘y≥
 (
isbœnk
);

138 
__END_NAMESPACE_C99


141 #ifde‡
__USE_GNU


143 
	$is˘y≥
 (
__c
, 
__mask
Ë
__THROW
;

146 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


150 
	$ißscii
 (
__c
Ë
__THROW
;

154 
	$tﬂscii
 (
__c
Ë
__THROW
;

158 
	`__ex˘y≥
 (
_touµî
);

159 
	`__ex˘y≥
 (
_tﬁowî
);

163 
	#__tobody
(
c
, 
f
, 
a
, 
¨gs
) \

164 (
__exãnsi⁄__
 \

165 ({ 
__ªs
; \

166 i‡( (
c
) > 1) \

168 i‡(
	`__buûtö_c⁄°™t_p
 (
c
)) \

170 
__c
 = (
c
); \

171 
__ªs
 = 
__c
 < -128 || __¯> 255 ? __¯: (
a
)[__c]; \

174 
__ªs
 = 
f
 
¨gs
; \

177 
__ªs
 = (
a
)[(Ë(
c
)]; \

178 
__ªs
; 
	}
}))

	)

180 #i‡!
deföed
 
__NO_CTYPE


181 #ifde‡
__is˘y≥_f


182 
	$__is˘y≥_f
 (
Ænum
)

183 
	$__is˘y≥_f
 (
Æpha
)

184 
	$__is˘y≥_f
 (
˙ål
)

185 
	$__is˘y≥_f
 (
digô
)

186 
	$__is˘y≥_f
 (
lowî
)

187 
	$__is˘y≥_f
 (
gøph
)

188 
	$__is˘y≥_f
 (
¥öt
)

189 
	$__is˘y≥_f
 (
pun˘
)

190 
	$__is˘y≥_f
 (
•a˚
)

191 
	$__is˘y≥_f
 (
uµî
)

192 
	$__is˘y≥_f
 (
xdigô
)

193 #ifde‡
__USE_ISOC99


194 
	$__is˘y≥_f
 (
bœnk
)

196 #ñi‡
deföed
 
__is˘y≥


197 
	#iß um
(
c
Ë
	`__is˘y≥
((c), 
_ISÆnum
)

	)

198 
	#ißÕha
(
c
Ë
	`__is˘y≥
((c), 
_ISÆpha
)

	)

199 
	#is˙ål
(
c
Ë
	`__is˘y≥
((c), 
_IS˙ål
)

	)

200 
	#isdigô
(
c
Ë
	`__is˘y≥
((c), 
_ISdigô
)

	)

201 
	#i¶owî
(
c
Ë
	`__is˘y≥
((c), 
_ISlowî
)

	)

202 
	#isgøph
(
c
Ë
	`__is˘y≥
((c), 
_ISgøph
)

	)

203 
	#i•röt
(
c
Ë
	`__is˘y≥
((c), 
_IS¥öt
)

	)

204 
	#i•un˘
(
c
Ë
	`__is˘y≥
((c), 
_ISpun˘
)

	)

205 
	#is•a˚
(
c
Ë
	`__is˘y≥
((c), 
_IS•a˚
)

	)

206 
	#isuµî
(
c
Ë
	`__is˘y≥
((c), 
_ISuµî
)

	)

207 
	#isxdigô
(
c
Ë
	`__is˘y≥
((c), 
_ISxdigô
)

	)

208 #ifde‡
__USE_ISOC99


209 
	#isbœnk
(
c
Ë
	`__is˘y≥
((c), 
_ISbœnk
)

	)

213 #ifde‡
__USE_EXTERN_INLINES


214 
__exã∫_ölöe
 

215 
	`__NTH
 (
	$tﬁowî
 (
__c
))

217  
__c
 >-128 && __¯< 256 ? (*
	`__˘y≥_tﬁowî_loc
 ())[__c] : __c;

218 
	}
}

220 
__exã∫_ölöe
 

221 
__NTH
 (
	$touµî
 (
__c
))

223  
__c
 >-128 && __¯< 256 ? (*
	`__˘y≥_touµî_loc
 ())[__c] : __c;

224 
	}
}

227 #i‡
__GNUC__
 >2 && 
deföed
 
__OPTIMIZE__
 && !deföed 
__˝lu•lus


228 
	#tﬁowî
(
c
Ë
	`__tobody
 (c, 
tﬁowî
, *
	`__˘y≥_tﬁowî_loc
 (), (c))

	)

229 
	#touµî
(
c
Ë
	`__tobody
 (c, 
touµî
, *
	`__˘y≥_touµî_loc
 (), (c))

	)

232 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


233 
	#ißscii
(
c
Ë
	`__ißscii
 (c)

	)

234 
	#tﬂscii
(
c
Ë
	`__tﬂscii
 (c)

	)

236 
	#_tﬁowî
(
c
Ë((Ë(*
	`__˘y≥_tﬁowî_loc
 ())[(Ë(c)])

	)

237 
	#_touµî
(
c
Ë((Ë(*
	`__˘y≥_touµî_loc
 ())[(Ë(c)])

	)

243 #ifde‡
__USE_XOPEN2K8


257 
	~<xloˇÀ.h
>

261 
	#__is˘y≥_l
(
c
, 
ty≥
, 
loˇÀ
) \

262 ((
loˇÀ
)->
__˘y≥_b
[(Ë(
c
)] & (Ë
ty≥
)

	)

264 
	#__ex˘y≥_l
(
«me
) \

265 
	`«me
 (, 
__loˇÀ_t
Ë
__THROW


	)

271 
__ex˘y≥_l
 (
iß um_l
);

272 
__ex˘y≥_l
 (
ißÕha_l
);

273 
__ex˘y≥_l
 (
is˙ål_l
);

274 
__ex˘y≥_l
 (
isdigô_l
);

275 
__ex˘y≥_l
 (
i¶owî_l
);

276 
__ex˘y≥_l
 (
isgøph_l
);

277 
__ex˘y≥_l
 (
i•röt_l
);

278 
__ex˘y≥_l
 (
i•un˘_l
);

279 
__ex˘y≥_l
 (
is•a˚_l
);

280 
__ex˘y≥_l
 (
isuµî_l
);

281 
__ex˘y≥_l
 (
isxdigô_l
);

283 
__ex˘y≥_l
 (
isbœnk_l
);

287 
	$__tﬁowî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

288 
	$tﬁowî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

291 
	$__touµî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

292 
	$touµî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

294 #i‡
__GNUC__
 >2 && 
deföed
 
__OPTIMIZE__
 && !deföed 
__˝lu•lus


295 
	#__tﬁowî_l
(
c
, 
loˇÀ
) \

296 
	`__tobody
 (
c
, 
__tﬁowî_l
, (
loˇÀ
)->
__˘y≥_tﬁowî
, (c,ÜoˇÀ))

	)

297 
	#__touµî_l
(
c
, 
loˇÀ
) \

298 
	`__tobody
 (
c
, 
__touµî_l
, (
loˇÀ
)->
__˘y≥_touµî
, (c,ÜoˇÀ))

	)

299 
	#tﬁowî_l
(
c
, 
loˇÀ
Ë
	`__tﬁowî_l
 ((c), (loˇÀ))

	)

300 
	#touµî_l
(
c
, 
loˇÀ
Ë
	`__touµî_l
 ((c), (loˇÀ))

	)

304 #i‚de‡
__NO_CTYPE


305 
	#__iß um_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISÆnum
, (l))

	)

306 
	#__ißÕha_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISÆpha
, (l))

	)

307 
	#__is˙ål_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS˙ål
, (l))

	)

308 
	#__isdigô_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISdigô
, (l))

	)

309 
	#__i¶owî_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISlowî
, (l))

	)

310 
	#__isgøph_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISgøph
, (l))

	)

311 
	#__i•röt_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS¥öt
, (l))

	)

312 
	#__i•un˘_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISpun˘
, (l))

	)

313 
	#__is•a˚_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS•a˚
, (l))

	)

314 
	#__isuµî_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISuµî
, (l))

	)

315 
	#__isxdigô_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISxdigô
, (l))

	)

317 
	#__isbœnk_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISbœnk
, (l))

	)

319 #ifde‡
__USE_MISC


320 
	#__ißscii_l
(
c
,
l
Ë(÷), 
	`__ißscii
 (c))

	)

321 
	#__tﬂscii_l
(
c
,
l
Ë(÷), 
	`__tﬂscii
 (c))

	)

324 
	#iß um_l
(
c
,
l
Ë
	`__iß um_l
 ((c), (l))

	)

325 
	#ißÕha_l
(
c
,
l
Ë
	`__ißÕha_l
 ((c), (l))

	)

326 
	#is˙ål_l
(
c
,
l
Ë
	`__is˙ål_l
 ((c), (l))

	)

327 
	#isdigô_l
(
c
,
l
Ë
	`__isdigô_l
 ((c), (l))

	)

328 
	#i¶owî_l
(
c
,
l
Ë
	`__i¶owî_l
 ((c), (l))

	)

329 
	#isgøph_l
(
c
,
l
Ë
	`__isgøph_l
 ((c), (l))

	)

330 
	#i•röt_l
(
c
,
l
Ë
	`__i•röt_l
 ((c), (l))

	)

331 
	#i•un˘_l
(
c
,
l
Ë
	`__i•un˘_l
 ((c), (l))

	)

332 
	#is•a˚_l
(
c
,
l
Ë
	`__is•a˚_l
 ((c), (l))

	)

333 
	#isuµî_l
(
c
,
l
Ë
	`__isuµî_l
 ((c), (l))

	)

334 
	#isxdigô_l
(
c
,
l
Ë
	`__isxdigô_l
 ((c), (l))

	)

336 
	#isbœnk_l
(
c
,
l
Ë
	`__isbœnk_l
 ((c), (l))

	)

338 #ifde‡
__USE_MISC


339 
	#ißscii_l
(
c
,
l
Ë
	`__ißscii_l
 ((c), (l))

	)

340 
	#tﬂscii_l
(
c
,
l
Ë
	`__tﬂscii_l
 ((c), (l))

	)

347 
__END_DECLS


	@/usr/include/stdc-predef.h

18 #i‚def 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifde‡
__GCC_IEC_559


37 #i‡
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifde‡
__GCC_IEC_559_COMPLEX


45 #i‡
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

55 
	#__STDC_ISO_10646__
 201505L

	)

58 
	#__STDC_NO_THREADS__
 1

	)

	@/usr/include/endian.h

18 #i‚def 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<„©uªs.h
>

31 
	#__LITTLE_ENDIAN
 1234

	)

32 
	#__BIG_ENDIAN
 4321

	)

33 
	#__PDP_ENDIAN
 3412

	)

36 
	~<bôs/ídün.h
>

40 #i‚de‡
__FLOAT_WORD_ORDER


41 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

44 #ifdef 
__USE_MISC


45 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

46 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

47 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

48 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

51 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


52 
	#__LONG_LONG_PAIR
(
HI
, 
LO
ËLO, 
	)
HI

53 #ñi‡
__BYTE_ORDER
 =
__BIG_ENDIAN


54 
	#__LONG_LONG_PAIR
(
HI
, 
LO
ËHI, 
	)
LO

58 #i‡
deföed
 
__USE_MISC
 && !deföed 
__ASSEMBLER__


60 
	~<bôs/byãsw≠.h
>

62 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


63 
	#htobe16
(
x
Ë
	`__bsw≠_16
 (x)

	)

64 
	#htﬁe16
(
x
Ë(x)

	)

65 
	#be16toh
(
x
Ë
	`__bsw≠_16
 (x)

	)

66 
	#À16toh
(
x
Ë(x)

	)

68 
	#htobe32
(
x
Ë
	`__bsw≠_32
 (x)

	)

69 
	#htﬁe32
(
x
Ë(x)

	)

70 
	#be32toh
(
x
Ë
	`__bsw≠_32
 (x)

	)

71 
	#À32toh
(
x
Ë(x)

	)

73 
	#htobe64
(
x
Ë
	`__bsw≠_64
 (x)

	)

74 
	#htﬁe64
(
x
Ë(x)

	)

75 
	#be64toh
(
x
Ë
	`__bsw≠_64
 (x)

	)

76 
	#À64toh
(
x
Ë(x)

	)

79 
	#htobe16
(
x
Ë(x)

	)

80 
	#htﬁe16
(
x
Ë
	`__bsw≠_16
 (x)

	)

81 
	#be16toh
(
x
Ë(x)

	)

82 
	#À16toh
(
x
Ë
	`__bsw≠_16
 (x)

	)

84 
	#htobe32
(
x
Ë(x)

	)

85 
	#htﬁe32
(
x
Ë
	`__bsw≠_32
 (x)

	)

86 
	#be32toh
(
x
Ë(x)

	)

87 
	#À32toh
(
x
Ë
	`__bsw≠_32
 (x)

	)

89 
	#htobe64
(
x
Ë(x)

	)

90 
	#htﬁe64
(
x
Ë
	`__bsw≠_64
 (x)

	)

91 
	#be64toh
(
x
Ë(x)

	)

92 
	#À64toh
(
x
Ë
	`__bsw≠_64
 (x)

	)

	@/usr/include/gconv.h

22 #i‚de‡
_GCONV_H


23 
	#_GCONV_H
 1

	)

25 
	~<„©uªs.h
>

26 
	#__√ed_mb°©e_t


	)

27 
	#__√ed_wöt_t


	)

28 
	~<wch¨.h
>

29 
	#__√ed_size_t


	)

30 
	#__√ed_wch¨_t


	)

31 
	~<°ddef.h
>

34 
	#__UNKNOWN_10646_CHAR
 ((
wch¨_t
Ë0xfffd)

	)

39 
	m__GCONV_OK
 = 0,

40 
	m__GCONV_NOCONV
,

41 
	m__GCONV_NODB
,

42 
	m__GCONV_NOMEM
,

44 
	m__GCONV_EMPTY_INPUT
,

45 
	m__GCONV_FULL_OUTPUT
,

46 
	m__GCONV_ILLEGAL_INPUT
,

47 
	m__GCONV_INCOMPLETE_INPUT
,

49 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

50 
	m__GCONV_INTERNAL_ERROR


57 
	m__GCONV_IS_LAST
 = 0x0001,

58 
	m__GCONV_IGNORE_ERRORS
 = 0x0002,

59 
	m__GCONV_SWAP
 = 0x0004,

60 
	m__GCONV_TRANSLIT
 = 0x0008

65 
	g__gc⁄v_°ï
;

66 
	g__gc⁄v_°ï_d©a
;

67 
	g__gc⁄v_lﬂded_obje˘
;

71 (*
	t__gc⁄v_f˘
Ë(
	t__gc⁄v_°ï
 *, 
	t__gc⁄v_°ï_d©a
 *,

73 **, 
	tsize_t
 *, , );

76 
	$wöt_t
 (*
	t__gc⁄v_btowc_f˘
Ë(
	t__gc⁄v_°ï
 *, );

79 (*
	t__gc⁄v_öô_f˘
Ë(
	t__gc⁄v_°ï
 *);

80 (*
	t__gc⁄v_íd_f˘
Ë(
	t__gc⁄v_°ï
 *);

84 
	s__gc⁄v_°ï


86 
__gc⁄v_lﬂded_obje˘
 *
__shlib_h™dÀ
;

87 c⁄° *
__mod«me
;

89 
__cou¡î
;

91 *
__‰om_«me
;

92 *
__to_«me
;

94 
__gc⁄v_f˘
 
__f˘
;

95 
__gc⁄v_btowc_f˘
 
__btowc_f˘
;

96 
__gc⁄v_öô_f˘
 
__öô_f˘
;

97 
__gc⁄v_íd_f˘
 
__íd_f˘
;

101 
__mö_√eded_‰om
;

102 
__max_√eded_‰om
;

103 
__mö_√eded_to
;

104 
__max_√eded_to
;

107 
__°©eful
;

109 *
__d©a
;

114 
	s__gc⁄v_°ï_d©a


116 *
__outbuf
;

117 *
__outbu„nd
;

121 
__Êags
;

125 
__övoˇti⁄_cou¡î
;

129 
__öã∫Æ_u£
;

131 
__mb°©e_t
 *
__°©ï
;

132 
__mb°©e_t
 
__°©e
;

138 
	s__gc⁄v_öfo


140 
size_t
 
__n°ïs
;

141 
__gc⁄v_°ï
 *
__°ïs
;

142 
__exãnsi⁄__
 
__gc⁄v_°ï_d©a
 
__d©a
 
__Êex¨r
;

143 } *
	t__gc⁄v_t
;

146 
	`__gc⁄v_å™¶ôî©e
 (
__gc⁄v_°ï
 *
°ï
,

147 
__gc⁄v_°ï_d©a
 *
°ï_d©a
,

148 c⁄° *
öbuf°¨t
,

149 c⁄° **
öbuÂ
,

150 c⁄° *
öbu„nd
,

151 **
outbuf°¨t
,

152 
size_t
 *
úªvîsibÀ
);

	@/usr/include/wchar.h

23 #i‚de‡
_WCHAR_H


25 #i‡!
deföed
 
__√ed_mb°©e_t
 && !deföed 
__√ed_wöt_t


26 
	#_WCHAR_H
 1

	)

27 
	~<„©uªs.h
>

30 #ifde‡
_WCHAR_H


32 
	#__√ed___FILE


	)

33 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


34 
	#__√ed_FILE


	)

36 
	~<°dio.h
>

38 
	#__√ed___va_li°


	)

39 
	~<°d¨g.h
>

41 
	~<bôs/wch¨.h
>

44 
	#__√ed_size_t


	)

45 
	#__√ed_wch¨_t


	)

46 
	#__√ed_NULL


	)

48 #i‡
deföed
 
_WCHAR_H
 || deföed 
__√ed_wöt_t
 || !deföed 
__WINT_TYPE__


49 #unde‡
__√ed_wöt_t


50 
	#__√ed_wöt_t


	)

51 
	~<°ddef.h
>

55 #i‚de‡
_WINT_T


60 
	#_WINT_T


	)

61 
	twöt_t
;

65 #i‡
deföed
 
__˝lu•lus
 && deföed 
_GLIBCPP_USE_NAMESPACES
 \

66 && 
deföed
 
__WINT_TYPE__


67 
__BEGIN_NAMESPACE_STD


68 
__WINT_TYPE__
 
	twöt_t
;

69 
	g__END_NAMESPACE_STD


74 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (4, 4)

75 
	#__CORRECT_ISO_CPP_WCHAR_H_PROTO


	)

79 #i‡(
deföed
 
_WCHAR_H
 || deföed 
__√ed_mb°©e_t
Ë&& !deföed 
____mb°©e_t_deföed


80 
	#____mb°©e_t_deföed
 1

	)

84 
	m__cou¡
;

87 #ifde‡
__WINT_TYPE__


88 
__WINT_TYPE__
 
	m__wch
;

90 
wöt_t
 
	m__wch
;

92 
	m__wchb
[4];

93 } 
	m__vÆue
;

94 } 
	t__mb°©e_t
;

96 #unde‡
__√ed_mb°©e_t


101 #ifde‡
_WCHAR_H


103 #i‚de‡
__mb°©e_t_deföed


104 
__BEGIN_NAMESPACE_C99


106 
__mb°©e_t
 
	tmb°©e_t
;

107 
	g__END_NAMESPACE_C99


108 
	#__mb°©e_t_deföed
 1

	)

111 #ifde‡
__USE_GNU


112 
	$__USING_NAMESPACE_C99
(
mb°©e_t
)

115 #i‚de‡
WCHAR_MIN


117 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

118 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

121 #i‚de‡
WEOF


122 
	#WEOF
 (0xffffffffu)

	)

127 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_UNIX98


128 
	~<w˘y≥.h
>

132 
__BEGIN_DECLS


134 
__BEGIN_NAMESPACE_STD


137 
tm
;

138 
__END_NAMESPACE_STD


142 
	$__USING_NAMESPACE_STD
(
tm
)

145 
__BEGIN_NAMESPACE_STD


147 
wch¨_t
 *
	$wcs˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

148 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
)

149 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

152 
wch¨_t
 *
	$wc¢˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

153 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

154 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

157 
wch¨_t
 *
	$wcsˇt
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

158 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
)

159 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

161 
wch¨_t
 *
	$wc¢ˇt
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

162 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

163 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

166 
	$wcscmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
)

167 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

169 
	$wc¢cmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
, 
size_t
 
__n
)

170 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

171 
__END_NAMESPACE_STD


173 #ifde‡
__USE_XOPEN2K8


175 
	$wcsˇ£cmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
Ë
__THROW
;

178 
	$wc¢ˇ£cmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

179 
size_t
 
__n
Ë
__THROW
;

183 
	~<xloˇÀ.h
>

185 
	$wcsˇ£cmp_l
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

186 
__loˇÀ_t
 
__loc
Ë
__THROW
;

188 
	$wc¢ˇ£cmp_l
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

189 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

192 
__BEGIN_NAMESPACE_STD


195 
	$wcscﬁl
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
Ë
__THROW
;

199 
size_t
 
	$wcsx‰m
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

200 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
Ë
__THROW
;

201 
__END_NAMESPACE_STD


203 #ifde‡
__USE_XOPEN2K8


209 
	$wcscﬁl_l
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

210 
__loˇÀ_t
 
__loc
Ë
__THROW
;

215 
size_t
 
	$wcsx‰m_l
 (
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

216 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

219 
wch¨_t
 *
	$wcsdup
 (c⁄° 
wch¨_t
 *
__s
Ë
__THROW
 
__©åibuã_mÆloc__
;

222 
__BEGIN_NAMESPACE_STD


224 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


225 "C++" 
wch¨_t
 *
	$wcschr
 (
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

226 
__THROW
 
	`__asm
 ("wcschr"Ë
__©åibuã_puª__
;

227 "C++" c⁄° 
wch¨_t
 *
	$wcschr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

228 
__THROW
 
	`__asm
 ("wcschr"Ë
__©åibuã_puª__
;

230 
wch¨_t
 *
	$wcschr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

231 
__THROW
 
__©åibuã_puª__
;

234 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


235 "C++" 
wch¨_t
 *
	$wc§chr
 (
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

236 
__THROW
 
	`__asm
 ("wc§chr"Ë
__©åibuã_puª__
;

237 "C++" c⁄° 
wch¨_t
 *
	$wc§chr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

238 
__THROW
 
	`__asm
 ("wc§chr"Ë
__©åibuã_puª__
;

240 
wch¨_t
 *
	$wc§chr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

241 
__THROW
 
__©åibuã_puª__
;

243 
__END_NAMESPACE_STD


245 #ifde‡
__USE_GNU


248 
wch¨_t
 *
	$wcsch∫ul
 (c⁄° 
wch¨_t
 *
__s
, wch¨_à
__wc
)

249 
__THROW
 
__©åibuã_puª__
;

252 
__BEGIN_NAMESPACE_STD


255 
size_t
 
	$wcsc•n
 (c⁄° 
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ªje˘
)

256 
__THROW
 
__©åibuã_puª__
;

259 
size_t
 
	$wcs•n
 (c⁄° 
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ac˚±
)

260 
__THROW
 
__©åibuã_puª__
;

262 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


263 "C++" 
wch¨_t
 *
	$wc•brk
 (
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ac˚±
)

264 
__THROW
 
	`__asm
 ("wc•brk"Ë
__©åibuã_puª__
;

265 "C++" c⁄° 
wch¨_t
 *
	$wc•brk
 (c⁄° 
wch¨_t
 *
__wcs
,

266 c⁄° 
wch¨_t
 *
__ac˚±
)

267 
__THROW
 
	`__asm
 ("wc•brk"Ë
__©åibuã_puª__
;

269 
wch¨_t
 *
	$wc•brk
 (c⁄° 
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ac˚±
)

270 
__THROW
 
__©åibuã_puª__
;

273 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


274 "C++" 
wch¨_t
 *
	$wcs°r
 (
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

275 
__THROW
 
	`__asm
 ("wcs°r"Ë
__©åibuã_puª__
;

276 "C++" c⁄° 
wch¨_t
 *
	$wcs°r
 (c⁄° 
wch¨_t
 *
__hay°ack
,

277 c⁄° 
wch¨_t
 *
__√edÀ
)

278 
__THROW
 
	`__asm
 ("wcs°r"Ë
__©åibuã_puª__
;

280 
wch¨_t
 *
	$wcs°r
 (c⁄° 
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

281 
__THROW
 
__©åibuã_puª__
;

285 
wch¨_t
 *
	$wc°ok
 (
wch¨_t
 *
__ª°ri˘
 
__s
,

286 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__dñim
,

287 
wch¨_t
 **
__ª°ri˘
 
__±r
Ë
__THROW
;

290 
size_t
 
	$wc¶í
 (c⁄° 
wch¨_t
 *
__s
Ë
__THROW
 
__©åibuã_puª__
;

291 
__END_NAMESPACE_STD


293 #ifde‡
__USE_XOPEN


295 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


296 "C++" 
wch¨_t
 *
	$wcswcs
 (
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

297 
__THROW
 
	`__asm
 ("wcswcs"Ë
__©åibuã_puª__
;

298 "C++" c⁄° 
wch¨_t
 *
	$wcswcs
 (c⁄° 
wch¨_t
 *
__hay°ack
,

299 c⁄° 
wch¨_t
 *
__√edÀ
)

300 
__THROW
 
	`__asm
 ("wcswcs"Ë
__©åibuã_puª__
;

302 
wch¨_t
 *
	$wcswcs
 (c⁄° 
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

303 
__THROW
 
__©åibuã_puª__
;

307 #ifde‡
__USE_XOPEN2K8


309 
size_t
 
	$wc¢Àn
 (c⁄° 
wch¨_t
 *
__s
, 
size_t
 
__maxÀn
)

310 
__THROW
 
__©åibuã_puª__
;

314 
__BEGIN_NAMESPACE_STD


316 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


317 "C++" 
wch¨_t
 *
	$wmemchr
 (
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
)

318 
__THROW
 
	`__asm
 ("wmemchr"Ë
__©åibuã_puª__
;

319 "C++" c⁄° 
wch¨_t
 *
	$wmemchr
 (c⁄° 
wch¨_t
 *
__s
, wch¨_à
__c
,

320 
size_t
 
__n
)

321 
__THROW
 
	`__asm
 ("wmemchr"Ë
__©åibuã_puª__
;

323 
wch¨_t
 *
	$wmemchr
 (c⁄° 
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
)

324 
__THROW
 
__©åibuã_puª__
;

328 
	$wmemcmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
, 
size_t
 
__n
)

329 
__THROW
 
__©åibuã_puª__
;

332 
wch¨_t
 *
	$wmem˝y
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

333 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
Ë
__THROW
;

337 
wch¨_t
 *
	$wmemmove
 (
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
, 
size_t
 
__n
)

338 
__THROW
;

341 
wch¨_t
 *
	$wmem£t
 (
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
Ë
__THROW
;

342 
__END_NAMESPACE_STD


344 #ifde‡
__USE_GNU


347 
wch¨_t
 *
	$wmemp˝y
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

348 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
)

349 
__THROW
;

353 
__BEGIN_NAMESPACE_STD


356 
wöt_t
 
	$btowc
 (
__c
Ë
__THROW
;

360 
	$w˘ob
 (
wöt_t
 
__c
Ë
__THROW
;

364 
	$mbsöô
 (c⁄° 
mb°©e_t
 *
__ps
Ë
__THROW
 
__©åibuã_puª__
;

368 
size_t
 
	$mbπowc
 (
wch¨_t
 *
__ª°ri˘
 
__pwc
,

369 c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

370 
mb°©e_t
 *
__ª°ri˘
 
__p
Ë
__THROW
;

373 
size_t
 
	$w¸tomb
 (*
__ª°ri˘
 
__s
, 
wch¨_t
 
__wc
,

374 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

377 
size_t
 
	$__mbæí
 (c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

378 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

379 
size_t
 
	$mbæí
 (c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

380 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

381 
__END_NAMESPACE_STD


383 #ifde‡
__USE_EXTERN_INLINES


389 
wöt_t
 
	$__btowc_Æüs
 (
__c
Ë
	`__asm
 ("btowc");

390 
__exã∫_ölöe
 
wöt_t


391 
	`__NTH
 (
	$btowc
 (
__c
))

392 {  (
	`__buûtö_c⁄°™t_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

393 ? (
wöt_t
Ë
__c
 : 
	`__btowc_Æüs
 (__c)); 
	}
}

395 
	$__w˘ob_Æüs
 (
wöt_t
 
__c
Ë
	`__asm
 ("wctob");

396 
__exã∫_ölöe
 

397 
	`__NTH
 (
	$w˘ob
 (
wöt_t
 
__wc
))

398 {  (
	`__buûtö_c⁄°™t_p
 (
__wc
Ë&& __w¯>
L
'\0' && __wc <= L'\x7f'

399 ? (Ë
__wc
 : 
	`__w˘ob_Æüs
 (__wc)); 
	}
}

401 
__exã∫_ölöe
 
size_t


402 
__NTH
 (
	$mbæí
 (c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

403 
mb°©e_t
 *
__ª°ri˘
 
__ps
))

404 {  (
__ps
 !
NULL


405 ? 
	`mbπowc
 (
NULL
, 
__s
, 
__n
, 
__ps
Ë: 
	`__mbæí
 (__s, __n, NULL)); 
	}
}

408 
__BEGIN_NAMESPACE_STD


411 
size_t
 
	$mb§towcs
 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

412 c⁄° **
__ª°ri˘
 
__§c
, 
size_t
 
__Àn
,

413 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

417 
size_t
 
	$wc§tombs
 (*
__ª°ri˘
 
__d°
,

418 c⁄° 
wch¨_t
 **
__ª°ri˘
 
__§c
, 
size_t
 
__Àn
,

419 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

420 
__END_NAMESPACE_STD


423 #ifdef 
__USE_XOPEN2K8


426 
size_t
 
	$mb¢πowcs
 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

427 c⁄° **
__ª°ri˘
 
__§c
, 
size_t
 
__nmc
,

428 
size_t
 
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

432 
size_t
 
	$wc¢πombs
 (*
__ª°ri˘
 
__d°
,

433 c⁄° 
wch¨_t
 **
__ª°ri˘
 
__§c
,

434 
size_t
 
__nwc
, size_à
__Àn
,

435 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

440 #ifde‡
__USE_XOPEN


442 
	$wcwidth
 (
wch¨_t
 
__c
Ë
__THROW
;

446 
	$wcswidth
 (c⁄° 
wch¨_t
 *
__s
, 
size_t
 
__n
Ë
__THROW
;

450 
__BEGIN_NAMESPACE_STD


453 
	$wc°od
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

454 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

455 
__END_NAMESPACE_STD


457 #ifde‡
__USE_ISOC99


458 
__BEGIN_NAMESPACE_C99


460 
	$wc°of
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

461 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

462 
	$wc°ﬁd
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

463 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

464 
__END_NAMESPACE_C99


468 
__BEGIN_NAMESPACE_STD


471 
	$wc°ﬁ
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

472 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
Ë
__THROW
;

476 
	$wc°oul
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

477 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

478 
__THROW
;

479 
__END_NAMESPACE_STD


481 #ifde‡
__USE_ISOC99


482 
__BEGIN_NAMESPACE_C99


485 
__exãnsi⁄__


486 
	$wc°ﬁl
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

487 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

488 
__THROW
;

492 
__exãnsi⁄__


493 
	$wc°ouŒ
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

494 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

495 
__ba£
Ë
__THROW
;

496 
__END_NAMESPACE_C99


499 #ifde‡
__USE_GNU


502 
__exãnsi⁄__


503 
	$wc°oq
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

504 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

505 
__THROW
;

509 
__exãnsi⁄__


510 
	$wc°ouq
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

511 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

512 
__ba£
Ë
__THROW
;

515 #ifde‡
__USE_GNU


529 
	~<xloˇÀ.h
>

533 
	$wc°ﬁ_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

534 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

535 
__loˇÀ_t
 
__loc
Ë
__THROW
;

537 
	$wc°oul_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

538 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

539 
__ba£
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

541 
__exãnsi⁄__


542 
	$wc°ﬁl_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

543 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

544 
__ba£
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

546 
__exãnsi⁄__


547 
	$wc°ouŒ_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

548 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

549 
__ba£
, 
__loˇÀ_t
 
__loc
)

550 
__THROW
;

552 
	$wc°od_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

553 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

554 
__THROW
;

556 
	$wc°of_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

557 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

558 
__THROW
;

560 
	$wc°ﬁd_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

561 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

562 
__loˇÀ_t
 
__loc
Ë
__THROW
;

566 #ifde‡
__USE_XOPEN2K8


569 
wch¨_t
 *
	$w˝˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

570 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
Ë
__THROW
;

574 
wch¨_t
 *
	$w˝n˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

575 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

576 
__THROW
;

583 
__FILE
 *
	$›í_wmem°ªam
 (
wch¨_t
 **
__buÊoc
, 
size_t
 *
__sizñoc
Ë
__THROW
;

586 #i‡
deföed
 
__USE_ISOC95
 || deföed 
__USE_UNIX98


587 
__BEGIN_NAMESPACE_STD


590 
	$fwide
 (
__FILE
 *
__Â
, 
__mode
Ë
__THROW
;

597 
	`fw¥ötf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

598 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

604 
	`w¥ötf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

607 
	$sw¥ötf
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

608 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

609 
__THROW
 ;

615 
	`vfw¥ötf
 (
__FILE
 *
__ª°ri˘
 
__s
,

616 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

617 
__gnuc_va_li°
 
__¨g
)

623 
	`vw¥ötf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

624 
__gnuc_va_li°
 
__¨g
)

628 
	$vsw¥ötf
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

629 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

630 
__gnuc_va_li°
 
__¨g
)

631 
__THROW
 ;

638 
	`fwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

639 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

645 
	`wsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

648 
	$swsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

649 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

650 
__THROW
 ;

652 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__USE_GNU
 \

653 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

654 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

655 #ifde‡
__REDIRECT


659 
	`__REDIRECT
 (
fwsˇnf
, (
__FILE
 *
__ª°ri˘
 
__°ªam
,

660 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...),

661 
__isoc99_fwsˇnf
)

663 
	`__REDIRECT
 (
wsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...),

664 
__isoc99_wsˇnf
)

666 
	`__REDIRECT_NTH
 (
swsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

667 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

668 ...), 
__isoc99_swsˇnf
)

671 
	`__isoc99_fwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

672 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...);

673 
	`__isoc99_wsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...);

674 
	$__isoc99_swsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

675 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

676 
__THROW
;

677 
	#fwsˇnf
 
__isoc99_fwsˇnf


	)

678 
	#wsˇnf
 
__isoc99_wsˇnf


	)

679 
	#swsˇnf
 
__isoc99_swsˇnf


	)

683 
__END_NAMESPACE_STD


686 #ifde‡
__USE_ISOC99


687 
__BEGIN_NAMESPACE_C99


692 
	`vfwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__s
,

693 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

694 
__gnuc_va_li°
 
__¨g
)

700 
	`vwsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

701 
__gnuc_va_li°
 
__¨g
)

704 
	$vswsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

705 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

706 
__gnuc_va_li°
 
__¨g
)

707 
__THROW
 ;

709 #i‡!
deföed
 
__USE_GNU
 \

710 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

711 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

712 #ifde‡
__REDIRECT


713 
	`__REDIRECT
 (
vfwsˇnf
, (
__FILE
 *
__ª°ri˘
 
__s
,

714 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

715 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vfwsˇnf
)

717 
	`__REDIRECT
 (
vwsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

718 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vwsˇnf
)

720 
	`__REDIRECT_NTH
 (
vswsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

721 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

722 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vswsˇnf
)

725 
	`__isoc99_vfwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__s
,

726 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

727 
__gnuc_va_li°
 
__¨g
);

728 
	`__isoc99_vwsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

729 
__gnuc_va_li°
 
__¨g
);

730 
	$__isoc99_vswsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

731 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

732 
__gnuc_va_li°
 
__¨g
Ë
__THROW
;

733 
	#vfwsˇnf
 
__isoc99_vfwsˇnf


	)

734 
	#vwsˇnf
 
__isoc99_vwsˇnf


	)

735 
	#vswsˇnf
 
__isoc99_vswsˇnf


	)

739 
__END_NAMESPACE_C99


743 
__BEGIN_NAMESPACE_STD


748 
wöt_t
 
	`fgëwc
 (
__FILE
 *
__°ªam
);

749 
wöt_t
 
	`gëwc
 (
__FILE
 *
__°ªam
);

755 
wöt_t
 
	`gëwch¨
 ();

762 
wöt_t
 
	`Âutwc
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

763 
wöt_t
 
	`putwc
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

769 
wöt_t
 
	`putwch¨
 (
wch¨_t
 
__wc
);

777 
wch¨_t
 *
	`fgëws
 (wch¨_à*
__ª°ri˘
 
__ws
, 
__n
,

778 
__FILE
 *
__ª°ri˘
 
__°ªam
);

784 
	`Âutws
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__ws
,

785 
__FILE
 *
__ª°ri˘
 
__°ªam
);

792 
wöt_t
 
	`ungëwc
 (wöt_à
__wc
, 
__FILE
 *
__°ªam
);

793 
__END_NAMESPACE_STD


796 #ifde‡
__USE_GNU


804 
wöt_t
 
	`gëwc_u∆ocked
 (
__FILE
 *
__°ªam
);

805 
wöt_t
 
	`gëwch¨_u∆ocked
 ();

813 
wöt_t
 
	`fgëwc_u∆ocked
 (
__FILE
 *
__°ªam
);

821 
wöt_t
 
	`Âutwc_u∆ocked
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

830 
wöt_t
 
	`putwc_u∆ocked
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

831 
wöt_t
 
	`putwch¨_u∆ocked
 (
wch¨_t
 
__wc
);

840 
wch¨_t
 *
	`fgëws_u∆ocked
 (wch¨_à*
__ª°ri˘
 
__ws
, 
__n
,

841 
__FILE
 *
__ª°ri˘
 
__°ªam
);

849 
	`Âutws_u∆ocked
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__ws
,

850 
__FILE
 *
__ª°ri˘
 
__°ªam
);

854 
__BEGIN_NAMESPACE_C99


858 
size_t
 
	$wcs·ime
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

859 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

860 c⁄° 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

861 
__END_NAMESPACE_C99


863 #ifde‡
__USE_GNU


864 
	~<xloˇÀ.h
>

868 
size_t
 
	$wcs·ime_l
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

869 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

870 c⁄° 
tm
 *
__ª°ri˘
 
__ç
,

871 
__loˇÀ_t
 
__loc
Ë
__THROW
;

880 #i‡
deföed
 
__USE_UNIX98
 && !deföed 
__USE_GNU


881 
	#__√ed_iswxxx


	)

882 
	~<w˘y≥.h
>

886 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


887 
	~<bôs/wch¨2.h
>

890 #ifde‡
__LDBL_COMPAT


891 
	~<bôs/wch¨-ldbl.h
>

894 
__END_DECLS


902 #unde‡
__√ed_mb°©e_t


903 #unde‡
__√ed_wöt_t


	@/usr/include/wctype.h

23 #i‚de‡
_WCTYPE_H


25 
	~<„©uªs.h
>

26 
	~<bôs/ty≥s.h
>

28 #i‚de‡
__√ed_iswxxx


29 
	#_WCTYPE_H
 1

	)

32 
	#__√ed_wöt_t


	)

33 
	~<wch¨.h
>

37 #i‚de‡
WEOF


38 
	#WEOF
 (0xffffffffu)

	)

41 #unde‡
__√ed_iswxxx


46 #i‚de‡
__iswxxx_deföed


47 
	#__iswxxx_deföed
 1

	)

49 
__BEGIN_NAMESPACE_C99


52 
	tw˘y≥_t
;

53 
	g__END_NAMESPACE_C99


55 #i‚de‡
_ISwbô


60 
	~<ídün.h
>

61 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


62 
	#_ISwbô
(
bô
Ë(1 << (bô))

	)

64 
	#_ISwbô
(
bô
) \

65 ((
bô
) < 8 ? () ((1UL << (bit)) << 24) \

66 : ((
bô
) < 16 ? () ((1UL << (bit)) << 8) \

67 : ((
bô
) < 24 ? () ((1UL << (bit)) >> 8) \

68 : (Ë((1UL << (
bô
)Ë>> 24))))

	)

73 
	m__ISwuµî
 = 0,

74 
	m__ISwlowî
 = 1,

75 
	m__ISwÆpha
 = 2,

76 
	m__ISwdigô
 = 3,

77 
	m__ISwxdigô
 = 4,

78 
	m__ISw•a˚
 = 5,

79 
	m__ISw¥öt
 = 6,

80 
	m__ISwgøph
 = 7,

81 
	m__ISwbœnk
 = 8,

82 
	m__ISw˙ål
 = 9,

83 
	m__ISwpun˘
 = 10,

84 
	m__ISwÆnum
 = 11,

86 
	m_ISwuµî
 = 
_ISwbô
 (
__ISwuµî
),

87 
	m_ISwlowî
 = 
_ISwbô
 (
__ISwlowî
),

88 
	m_ISwÆpha
 = 
_ISwbô
 (
__ISwÆpha
),

89 
	m_ISwdigô
 = 
_ISwbô
 (
__ISwdigô
),

90 
	m_ISwxdigô
 = 
_ISwbô
 (
__ISwxdigô
),

91 
	m_ISw•a˚
 = 
_ISwbô
 (
__ISw•a˚
),

92 
	m_ISw¥öt
 = 
_ISwbô
 (
__ISw¥öt
),

93 
	m_ISwgøph
 = 
_ISwbô
 (
__ISwgøph
),

94 
	m_ISwbœnk
 = 
_ISwbô
 (
__ISwbœnk
),

95 
	m_ISw˙ål
 = 
_ISwbô
 (
__ISw˙ål
),

96 
	m_ISwpun˘
 = 
_ISwbô
 (
__ISwpun˘
),

97 
	m_ISwÆnum
 = 
_ISwbô
 (
__ISwÆnum
)

102 
__BEGIN_DECLS


104 
__BEGIN_NAMESPACE_C99


111 
	$iswÆnum
 (
wöt_t
 
__wc
Ë
__THROW
;

117 
	$iswÆpha
 (
wöt_t
 
__wc
Ë
__THROW
;

120 
	$isw˙ål
 (
wöt_t
 
__wc
Ë
__THROW
;

124 
	$iswdigô
 (
wöt_t
 
__wc
Ë
__THROW
;

128 
	$iswgøph
 (
wöt_t
 
__wc
Ë
__THROW
;

133 
	$iswlowî
 (
wöt_t
 
__wc
Ë
__THROW
;

136 
	$isw¥öt
 (
wöt_t
 
__wc
Ë
__THROW
;

141 
	$iswpun˘
 (
wöt_t
 
__wc
Ë
__THROW
;

146 
	$isw•a˚
 (
wöt_t
 
__wc
Ë
__THROW
;

151 
	$iswuµî
 (
wöt_t
 
__wc
Ë
__THROW
;

156 
	$iswxdigô
 (
wöt_t
 
__wc
Ë
__THROW
;

161 #ifde‡
__USE_ISOC99


162 
	$iswbœnk
 (
wöt_t
 
__wc
Ë
__THROW
;

171 
w˘y≥_t
 
	$w˘y≥
 (c⁄° *
__¥›îty
Ë
__THROW
;

175 
	$isw˘y≥
 (
wöt_t
 
__wc
, 
w˘y≥_t
 
__desc
Ë
__THROW
;

176 
__END_NAMESPACE_C99


183 
__BEGIN_NAMESPACE_C99


186 c⁄° 
	t__öt32_t
 *
	tw˘øns_t
;

187 
__END_NAMESPACE_C99


188 #ifde‡
__USE_GNU


189 
	$__USING_NAMESPACE_C99
(
w˘øns_t
)

192 
__BEGIN_NAMESPACE_C99


194 
wöt_t
 
	$towlowî
 (
wöt_t
 
__wc
Ë
__THROW
;

197 
wöt_t
 
	$towuµî
 (
wöt_t
 
__wc
Ë
__THROW
;

198 
__END_NAMESPACE_C99


200 
__END_DECLS


207 #ifde‡
_WCTYPE_H


213 
__BEGIN_DECLS


215 
__BEGIN_NAMESPACE_C99


218 
w˘øns_t
 
	$w˘øns
 (c⁄° *
__¥›îty
Ë
__THROW
;

221 
wöt_t
 
	$tow˘øns
 (
wöt_t
 
__wc
, 
w˘øns_t
 
__desc
Ë
__THROW
;

222 
__END_NAMESPACE_C99


224 #ifde‡
__USE_XOPEN2K8


226 
	~<xloˇÀ.h
>

230 
	$iswÆnum_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

236 
	$iswÆpha_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

239 
	$isw˙ål_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

243 
	$iswdigô_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

247 
	$iswgøph_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

252 
	$iswlowî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

255 
	$isw¥öt_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

260 
	$iswpun˘_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

265 
	$isw•a˚_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

270 
	$iswuµî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

275 
	$iswxdigô_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

280 
	$iswbœnk_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

284 
w˘y≥_t
 
	$w˘y≥_l
 (c⁄° *
__¥›îty
, 
__loˇÀ_t
 
__loˇÀ
)

285 
__THROW
;

289 
	$isw˘y≥_l
 (
wöt_t
 
__wc
, 
w˘y≥_t
 
__desc
, 
__loˇÀ_t
 
__loˇÀ
)

290 
__THROW
;

298 
wöt_t
 
	$towlowî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

301 
wöt_t
 
	$towuµî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

305 
w˘øns_t
 
	$w˘øns_l
 (c⁄° *
__¥›îty
, 
__loˇÀ_t
 
__loˇÀ
)

306 
__THROW
;

309 
wöt_t
 
	$tow˘øns_l
 (
wöt_t
 
__wc
, 
w˘øns_t
 
__desc
,

310 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

314 
__END_DECLS


	@
1
.
1
/usr/include
95
1040
asm.h
bio.c
bootmain.c
buf.h
cat.c
console.c
date.h
defs.h
echo.c
elf.h
exec.c
fcntl.h
file.c
file.h
forktest.c
fs.c
fs.h
grep.c
hugefiletest.c
ide.c
init.c
ioapic.c
kalloc.c
kbd.c
kbd.h
kill.c
lapic.c
ln.c
log.c
ls.c
main.c
memide.c
memlayout.h
mkdir.c
mkfs.c
mmu.h
mp.c
mp.h
param.h
picirq.c
pipe.c
printf.c
proc.c
proc.h
pwritetest.c
rm.c
set_cpu_share.c
sh.c
sleeplock.c
sleeplock.h
spinlock.c
spinlock.h
stat.h
stressfs.c
string.c
syscall.c
syscall.h
sysfile.c
sysproc.c
temp.c
test_master.c
test_master_DI.c
test_mlfq.c
test_stride.c
thread_fork_1.c
threadtest.c
trap.c
traps.h
types.h
uart.c
ulib.c
umalloc.c
user.h
usertests.c
vm.c
wc.c
x86.h
zombie.c
/usr/include/assert.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/unistd.h
/usr/include/alloca.h
/usr/include/features.h
/usr/include/getopt.h
/usr/include/libio.h
/usr/include/xlocale.h
/usr/include/_G_config.h
/usr/include/ctype.h
/usr/include/stdc-predef.h
/usr/include/endian.h
/usr/include/gconv.h
/usr/include/wchar.h
/usr/include/wctype.h
